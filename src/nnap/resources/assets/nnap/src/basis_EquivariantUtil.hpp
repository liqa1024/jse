#ifndef BASIS_EQUIVARIANT_UTIL_H
#define BASIS_EQUIVARIANT_UTIL_H

namespace JSE_NNAP {

static constexpr jint CG_SIZE[5][25] = {{
    1,
    0, 0, 0,
    0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0
}, {
    4,
    1, 1, 1,
    1, 1, 3, 1, 2,
    0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0
}, {
    9,
    5, 4, 5,
    4, 5, 9, 5, 6,
    2, 3, 4, 3, 4, 3, 2,
    1, 2, 2, 3, 5, 3, 3, 2, 2
},{
    16,
    13, 9, 13,
    13, 14, 17, 14, 16,
    8, 9, 13, 9, 13, 9, 8,
    6, 8, 11, 12, 15, 12, 13, 8, 8
},{
    25,
    25, 16, 25,
    27, 29, 31, 29, 31,
    21, 24, 29, 19, 29, 24, 21,
    16, 21, 26, 28, 30, 28, 29, 21, 19
}};
static constexpr jint CG_INDEX1[5][25][40] = {{
    {0},
    {}, {}, {},
    {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {}, {}, {}
},{
    {0, 1, 2, 3},
    {0}, {0}, {0},
    {1}, {1}, {1, 2, 3}, {2}, {1, 3},
    {}, {}, {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {}, {}, {}
},{
    {0, 1, 2, 3, 4, 5, 6, 7, 8},
    {0, 1, 1, 2, 3}, {0, 1, 2, 3}, {0, 1, 2, 3, 3},
    {0, 1, 4, 5}, {0, 1, 4, 5, 5}, {0, 1, 2, 3, 4, 5, 6, 7, 8}, {0, 2, 4, 6, 7}, {0, 1, 3, 5, 6, 7},
    {1, 3}, {1, 2, 3}, {1, 1, 2, 3}, {1, 2, 3}, {1, 2, 3, 3}, {1, 2, 3}, {1, 3},
    {4}, {4, 5}, {4, 5}, {4, 5, 5}, {4, 5, 6, 7, 8}, {4, 6, 7}, {5, 6, 7}, {4, 7}, {4, 8}
},{
    {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15},
    {0, 1, 1, 2, 3, 4, 4, 5, 5, 6, 7, 8, 8},
    {0, 1, 2, 3, 4, 5, 6, 7, 8},
    {0, 1, 2, 3, 3, 4, 4, 5, 6, 7, 7, 8, 8},
    {0, 1, 1, 1, 2, 3, 3, 4, 5, 9, 10, 11, 11},
    {0, 1, 1, 1, 2, 3, 4, 5, 5, 9, 10, 10, 11, 11},
    {0, 1, 1, 2, 2, 3, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 15},
    {0, 1, 2, 2, 3, 3, 4, 6, 7, 9, 10, 12, 13, 14},
    {0, 1, 1, 1, 2, 3, 3, 3, 5, 6, 7, 9, 11, 12, 13, 13},
    {0, 1, 3, 4, 5, 6, 7, 8},
    {0, 1, 2, 3, 4, 5, 5, 7, 7},
    {0, 1, 1, 2, 3, 4, 4, 5, 5, 6, 7, 8, 8},
    {0, 1, 2, 3, 4, 5, 6, 7, 8},
    {0, 1, 2, 3, 3, 4, 4, 5, 6, 7, 7, 8, 8},
    {0, 1, 2, 3, 5, 5, 7, 7, 8},
    {0, 1, 3, 4, 5, 6, 7, 8},
    {1, 3, 4, 9, 10, 11},
    {1, 2, 3, 4, 5, 9, 10, 11},
    {1, 1, 2, 3, 3, 4, 5, 9, 10, 11, 11},
    {1, 1, 2, 3, 4, 5, 5, 9, 10, 10, 11, 11},
    {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15},
    {1, 2, 3, 3, 4, 6, 7, 9, 10, 12, 13, 14},
    {1, 1, 2, 3, 3, 5, 6, 7, 9, 11, 12, 13, 13},
    {1, 2, 3, 4, 7, 10, 12, 13},
    {1, 3, 4, 8, 9, 10, 13, 14}
},{
    {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24},
    {0, 1, 1, 2, 3, 4, 4, 5, 5, 6, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 13, 14, 14, 15, 15},
    {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15},
    {0, 1, 2, 3, 3, 4, 4, 5, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 12, 13, 13, 14, 14, 15, 15},
    {0, 1, 1, 1, 2, 3, 3, 4, 4, 4, 5, 5, 5, 6, 7, 7, 8, 9, 10, 11, 11, 16, 17, 18, 18, 19, 19},
    {0, 1, 1, 1, 2, 3, 4, 4, 4, 5, 5, 5, 5, 6, 7, 8, 8, 9, 10, 10, 11, 11, 16, 17, 17, 18, 18, 19, 19},
    {0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 11, 12, 13, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24},
    {0, 1, 2, 2, 3, 3, 4, 4, 4, 5, 6, 6, 7, 7, 7, 8, 8, 9, 10, 12, 13, 14, 16, 17, 18, 20, 21, 22, 23},
    {0, 1, 1, 1, 2, 3, 3, 3, 4, 5, 5, 5, 6, 6, 7, 7, 7, 8, 8, 9, 11, 12, 13, 13, 16, 17, 19, 20, 21, 21, 22},
    {0, 1, 1, 1, 2, 3, 3, 3, 4, 5, 6, 7, 8, 9, 10, 11, 11, 12, 13, 13, 14},
    {0, 1, 1, 1, 2, 2, 3, 3, 3, 4, 5, 5, 7, 7, 9, 10, 10, 11, 11, 12, 13, 13, 14, 15},
    {0, 1, 1, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 13, 14, 14, 15, 15},
    {0, 1, 1, 2, 2, 3, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15},
    {0, 1, 1, 2, 2, 3, 3, 3, 3, 4, 4, 5, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 12, 13, 13, 14, 14, 15, 15},
    {0, 1, 1, 1, 2, 2, 3, 3, 3, 5, 5, 7, 7, 8, 9, 10, 11, 11, 12, 13, 13, 14, 14, 15},
    {0, 1, 1, 1, 2, 3, 3, 3, 4, 5, 6, 7, 8, 10, 11, 11, 12, 13, 13, 14, 15},
    {0, 1, 3, 4, 4, 5, 6, 7, 8, 9, 10, 11, 16, 17, 18, 19},
    {0, 1, 2, 3, 4, 4, 5, 5, 5, 6, 7, 7, 8, 9, 10, 11, 16, 17, 18, 19, 19},
    {0, 1, 1, 2, 3, 3, 4, 4, 4, 5, 5, 5, 6, 7, 7, 8, 9, 10, 11, 11, 16, 17, 18, 18, 19, 19},
    {0, 1, 1, 2, 3, 4, 4, 4, 5, 5, 5, 5, 6, 7, 8, 8, 9, 10, 10, 11, 11, 16, 17, 17, 18, 18, 19, 19},
    {0, 1, 2, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24},
    {0, 1, 2, 3, 3, 4, 4, 4, 5, 6, 6, 7, 7, 7, 8, 8, 9, 10, 12, 13, 14, 16, 17, 18, 20, 21, 22, 23},
    {0, 1, 1, 2, 3, 3, 4, 5, 5, 5, 6, 6, 7, 7, 7, 8, 8, 9, 11, 12, 13, 13, 16, 17, 19, 20, 21, 21, 22},
    {0, 1, 2, 3, 4, 4, 5, 5, 6, 7, 7, 7, 8, 10, 12, 13, 16, 18, 20, 21, 21},
    {0, 1, 3, 4, 4, 5, 6, 7, 8, 8, 9, 10, 13, 14, 17, 18, 20, 21, 22}
}};
static constexpr jint CG_INDEX2[5][25][40] = {{
    {0},
    {}, {}, {},
    {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {}, {}, {}
},{
    {0, 1, 2, 3},
    {1}, {2}, {3},
    {3}, {2}, {1, 2, 3}, {3}, {1, 3},
    {}, {}, {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {}, {}, {}
},{
    {0, 1, 2, 3, 4, 5, 6, 7, 8},
    {1, 6, 8, 5, 4}, {2, 5, 6, 7}, {3, 4, 7, 6, 8},
    {4, 3, 6, 7}, {5, 2, 7, 6, 8}, {6, 1, 2, 3, 4, 5, 6, 7, 8}, {7, 3, 5, 7, 8}, {8, 1, 3, 5, 8, 7},
    {8, 4}, {7, 4, 5}, {6, 8, 5, 4}, {5, 6, 7}, {4, 7, 6, 8}, {5, 8, 7}, {4, 8},
    {8}, {7, 8}, {6, 7}, {7, 6, 8}, {4, 5, 6, 7, 8}, {5, 7, 8}, {5, 8, 7}, {5, 8}, {4, 8}
},{
    {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15},
    {1, 6, 8, 5, 4, 13, 15, 12, 14, 11, 10, 9, 11},
    {2, 5, 6, 7, 10, 11, 12, 13, 14},
    {3, 4, 7, 6, 8, 9, 11, 10, 13, 12, 14, 13, 15},
    {4, 3, 13, 15, 10, 9, 11, 6, 7, 13, 12, 13, 15},
    {5, 2, 12, 14, 11, 10, 7, 6, 8, 14, 13, 15, 12, 14},
    {6, 1, 11, 2, 12, 3, 13, 4, 5, 6, 7, 8, 9, 11, 12, 13, 15},
    {7, 10, 3, 13, 12, 14, 5, 7, 8, 10, 11, 13, 14, 15},
    {8, 1, 9, 11, 14, 3, 13, 15, 5, 8, 7, 11, 11, 14, 13, 15},
    {9, 8, 4, 13, 14, 9, 10, 11},
    {10, 7, 4, 5, 12, 13, 15, 9, 11},
    {11, 6, 8, 5, 4, 13, 15, 12, 14, 11, 10, 9, 11},
    {12, 5, 6, 7, 10, 11, 12, 13, 14},
    {13, 4, 7, 6, 8, 9, 11, 10, 13, 12, 14, 13, 15},
    {14, 5, 8, 7, 9, 11, 13, 15, 12},
    {15, 4, 8, 11, 10, 15, 14, 13},
    {15, 9, 8, 13, 14, 15},
    {14, 9, 10, 7, 8, 12, 13, 14},
    {13, 15, 10, 9, 11, 6, 7, 13, 12, 13, 15},
    {12, 14, 11, 10, 7, 6, 8, 14, 13, 15, 12, 14},
    {11, 12, 13, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15},
    {10, 13, 12, 14, 5, 7, 8, 10, 11, 13, 14, 15},
    {9, 11, 14, 13, 15, 5, 8, 7, 11, 11, 14, 13, 15},
    {10, 15, 14, 5, 8, 11, 15, 14},
    {9, 15, 4, 8, 11, 10, 15, 14}
},{
    {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24},
    {1, 6, 8, 5, 4, 13, 15, 12, 14, 11, 10, 9, 11, 22, 24, 21, 23, 20, 22, 19, 18, 17, 19, 16, 18},
    {2, 5, 6, 7, 10, 11, 12, 13, 14, 17, 18, 19, 20, 21, 22, 23},
    {3, 4, 7, 6, 8, 9, 11, 10, 13, 12, 14, 13, 15, 16, 18, 17, 19, 18, 21, 20, 22, 21, 23, 22, 24},
    {4, 3, 13, 15, 10, 9, 11, 6, 20, 24, 7, 21, 23, 18, 17, 19, 16, 13, 12, 13, 15, 22, 21, 20, 24, 21, 23},
    {5, 2, 12, 14, 11, 10, 7, 21, 23, 6, 8, 20, 22, 19, 18, 17, 19, 14, 13, 15, 12, 14, 23, 22, 24, 21, 23, 20, 22},
    {6, 1, 11, 2, 12, 3, 13, 4, 18, 5, 19, 6, 20, 7, 21, 8, 22, 9, 11, 12, 13, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24},
    {7, 10, 3, 13, 12, 14, 5, 17, 19, 18, 7, 21, 8, 20, 22, 21, 23, 10, 11, 13, 14, 15, 17, 18, 19, 21, 22, 23, 24},
    {8, 1, 9, 11, 14, 3, 13, 15, 16, 5, 17, 19, 8, 22, 7, 21, 23, 20, 24, 11, 11, 14, 13, 15, 18, 19, 19, 22, 21, 23, 24},
    {9, 8, 22, 24, 17, 4, 16, 18, 13, 14, 9, 10, 11, 20, 21, 22, 24, 17, 16, 18, 19},
    {10, 7, 21, 23, 4, 18, 5, 17, 19, 12, 13, 15, 9, 11, 21, 20, 24, 21, 23, 18, 17, 19, 16, 19},
    {11, 6, 8, 20, 22, 5, 19, 4, 18, 13, 15, 12, 14, 11, 10, 9, 11, 22, 24, 21, 23, 20, 22, 19, 18, 17, 19, 16, 18},
    {12, 5, 19, 6, 20, 7, 21, 10, 11, 12, 13, 14, 17, 18, 19, 20, 21, 22, 23},
    {13, 4, 18, 7, 21, 6, 8, 20, 22, 9, 11, 10, 13, 12, 14, 13, 15, 16, 18, 17, 19, 18, 21, 20, 22, 21, 23, 22, 24},
    {14, 5, 17, 19, 8, 22, 7, 21, 23, 9, 11, 13, 15, 12, 19, 16, 17, 19, 22, 21, 23, 20, 24, 21},
    {15, 4, 16, 18, 23, 8, 22, 24, 11, 10, 15, 14, 13, 19, 16, 18, 23, 22, 24, 21, 20},
    {16, 15, 9, 8, 22, 23, 16, 17, 18, 13, 14, 15, 20, 21, 22, 23},
    {17, 14, 9, 10, 7, 21, 8, 22, 24, 17, 16, 18, 19, 12, 13, 14, 21, 20, 21, 22, 24},
    {18, 13, 15, 10, 9, 11, 6, 20, 24, 7, 21, 23, 18, 17, 19, 16, 13, 12, 13, 15, 22, 21, 20, 24, 21, 23},
    {19, 12, 14, 11, 10, 7, 21, 23, 6, 8, 20, 22, 19, 18, 17, 19, 14, 13, 15, 12, 14, 23, 22, 24, 21, 23, 20, 22},
    {20, 11, 12, 13, 4, 18, 5, 19, 6, 20, 7, 21, 8, 22, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24},
    {21, 10, 13, 12, 14, 5, 17, 19, 18, 7, 21, 8, 20, 22, 21, 23, 10, 11, 13, 14, 15, 17, 18, 19, 21, 22, 23, 24},
    {22, 9, 11, 14, 13, 15, 16, 5, 17, 19, 8, 22, 7, 21, 23, 20, 24, 11, 11, 14, 13, 15, 18, 19, 19, 22, 21, 23, 24},
    {23, 10, 15, 14, 5, 19, 16, 18, 23, 8, 22, 24, 21, 11, 15, 14, 19, 19, 23, 22, 24},
    {24, 9, 15, 4, 18, 17, 24, 23, 8, 22, 11, 10, 15, 14, 19, 18, 24, 23, 22}
}};
static constexpr jdouble CG_COEFF[5][25][40] = {{
    {1.0},
    {}, {}, {},
    {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {}, {}, {}
},{
    {1.0, -0.5773502691896256, -0.5773502691896257, -0.5773502691896256},
    {1.9999999999999996}, {1.9999999999999998}, {1.9999999999999996},
    {1.4142135623730947}, {1.414213562373095}, {-0.40824829046386296, 0.816496580927726, -0.40824829046386296}, {1.414213562373095}, {-0.7071067811865474, 0.7071067811865474},
    {}, {}, {}, {}, {}, {}, {},
    {}, {}, {}, {}, {}, {}, {}, {}, {}
},{
    {1.0, -0.5773502691896256, -0.5773502691896257, -0.5773502691896256, 0.4472135954999578, 0.4472135954999578, 0.4472135954999579, 0.4472135954999578, 0.4472135954999578},
    {1.9999999999999996, 0.6324555320336758, 1.095445115010332, -1.095445115010332, -1.095445115010332},
    {1.9999999999999998, -1.0954451150103317, -1.2649110640673515, -1.0954451150103317},
    {1.9999999999999996, -1.095445115010332, -1.095445115010332, 0.6324555320336758, -1.095445115010332},
    {2.0, 1.4142135623730947, 1.0690449676496976, -0.9258200997725514},
    {2.0, 1.414213562373095, -0.9258200997725514, -0.5345224838248488, 0.9258200997725514},
    {2.0, -0.40824829046386296, 0.816496580927726, -0.40824829046386296, 0.5345224838248487, -0.26726124191242434, -0.5345224838248488, -0.26726124191242434, 0.5345224838248487},
    {2.0, 1.414213562373095, -0.9258200997725514, -0.5345224838248488, -0.9258200997725514},
    {2.0, -0.7071067811865474, 0.7071067811865474, 0.4629100498862757, 1.0690449676496976, -0.4629100498862757},
    {1.414213562373095, 1.414213562373095}, {1.1547005383792515, 1.1547005383792517, 1.1547005383792515},
    {1.2649110640673518, 0.3651483716701107, 1.4605934866804429, -0.3651483716701107},
    {-0.8944271909999156, 1.549193338482967, -0.8944271909999156},
    {-0.3651483716701107, 1.4605934866804429, 1.2649110640673518, -0.3651483716701107},
    {-1.1547005383792515, 1.1547005383792517, 1.1547005383792515}, {-1.414213562373095, 1.414213562373095},
    {1.414213562373095}, {1.0, 1.0}, {0.9258200997725513, 1.0690449676496976}, {-0.3779644730092272, 1.3093073414159542, 0.3779644730092272},
    {0.11952286093343935, -0.4780914437337574, 0.7171371656006362, -0.4780914437337574, 0.11952286093343935},
    {-0.3779644730092272, 1.3093073414159542, -0.3779644730092272}, {-0.5345224838248488, 0.9258200997725513, 0.5345224838248488}, {-1.0, 1.0}, {-0.7071067811865475, 0.7071067811865475}
},{
    {1.0, -0.5773502691896256, -0.5773502691896257, -0.5773502691896256, 0.4472135954999578, 0.4472135954999578, 0.4472135954999579, 0.4472135954999578,
        0.4472135954999578, -0.3779644730092272, -0.37796447300922714, -0.37796447300922703, -0.3779644730092272, -0.37796447300922703, -0.37796447300922714, -0.3779644730092272},
    {1.9999999999999996, 0.6324555320336758, 1.095445115010332, -1.095445115010332, -1.095445115010332, -0.2390457218668787, -0.9258200997725513, -0.5855400437691198,
        -0.7559289460184544, 0.828078671210825, 0.7559289460184544, 0.9258200997725513, 0.2390457218668787},
    {1.9999999999999998, -1.0954451150103317, -1.2649110640673515, -1.0954451150103317, 0.7559289460184543, 0.9561828874675148, 1.01418510567422, 0.9561828874675148,
        0.7559289460184543},
    {1.9999999999999996, -1.095445115010332, -1.095445115010332, 0.6324555320336758, -1.095445115010332, 0.9258200997725513, -0.2390457218668787, 0.7559289460184544,
        0.828078671210825, -0.5855400437691198, 0.7559289460184544, -0.2390457218668787, 0.9258200997725513},
    {2.0, 1.4142135623730947, 0.3086066999241838, 1.1952286093343936, -0.9759000729485333, -1.1952286093343936, 0.3086066999241838, 1.0690449676496976,
        -0.9258200997725514, -0.4879500364742665, -0.9759000729485333, 0.7559289460184544, 0.4879500364742665},
    {2.0, 1.414213562373095, 0.7559289460184544, 0.9759000729485331, -1.2344267996967353, -0.9759000729485331, -0.9258200997725514, -0.5345224838248488,
        0.9258200997725514, 0.7715167498104596, 0.5976143046671968, -0.7715167498104596, 0.3086066999241838, -0.5976143046671968},
    {2.0, -0.40824829046386296, -1.0690449676496974, 0.816496580927726, -1.3093073414159544, -0.40824829046386296, -1.0690449676496974, 0.5345224838248487,
        -0.26726124191242434, -0.5345224838248488, -0.26726124191242434, 0.5345224838248487, -0.5455447255899809, 0.3273268353539885, 0.4364357804719848, 0.3273268353539885,
        -0.5455447255899809},
    {2.0, -0.9759000729485331, 1.414213562373095, -1.2344267996967353, 0.7559289460184544, -0.9759000729485331, -0.9258200997725514, -0.5345224838248488,
        -0.9258200997725514, 0.7715167498104596, 0.5976143046671968, 0.3086066999241838, 0.5976143046671968, 0.7715167498104596},
    {2.0, -0.7071067811865474, -1.1952286093343936, -0.3086066999241838, -0.9759000729485333, 0.7071067811865474, 0.3086066999241838, -1.1952286093343936,
        0.4629100498862757, 1.0690449676496976, -0.4629100498862757, -0.4879500364742665, -0.3779644730092272, -0.9759000729485333, 0.3779644730092272, -0.4879500364742665},
    {2.0000000000000004, 1.414213562373095, 1.414213562373095, 0.5773502691896256, -0.9128709291752769, 1.2909944487358058, -0.9128709291752769, 0.5773502691896256},
    {2.0, 1.1547005383792515, 1.1547005383792517, 1.1547005383792515, 1.1547005383792517, -0.7071067811865475, 0.9128709291752769, -0.9128709291752769,
        -0.7071067811865475},
    {1.9999999999999996, 1.2649110640673518, 0.3651483716701107, 1.4605934866804429, -0.3651483716701107, -0.8944271909999159, -0.5773502691896256, -0.3651483716701107,
        0.7071067811865475, -0.7745966692414832, -0.7071067811865475, 0.5773502691896256, 0.8944271909999159},
    {2.0, -0.8944271909999156, 1.549193338482967, -0.8944271909999156, 1.1547005383792515, -0.36514837167011066, -1.0327955589886446, -0.36514837167011066,
        1.1547005383792515},
    {1.9999999999999996, -0.3651483716701107, 1.4605934866804429, 1.2649110640673518, -0.3651483716701107, 0.5773502691896256, -0.8944271909999159, -0.7071067811865475,
        -0.7745966692414832, -0.3651483716701107, -0.7071067811865475, -0.8944271909999159, 0.5773502691896256},
    {2.0, -1.1547005383792515, 1.1547005383792517, 1.1547005383792515, -0.9128709291752769, 0.7071067811865475, -0.7071067811865475, -0.9128709291752769,
        1.1547005383792517},
    {2.0000000000000004, -1.414213562373095, 1.414213562373095, -0.5773502691896256, 0.9128709291752769, 1.2909944487358058, -0.9128709291752769, 0.5773502691896256},
    {1.414213562373095, 1.414213562373095, 1.414213562373095, 0.7385489458759963, -0.9534625892455924, 0.7385489458759963},
    {1.2247448713915892, 1.0, 1.2247448713915892, 1.0, 1.0, 1.2792042981336627, -0.42640143271122083, -0.42640143271122083},
    {1.0350983390135313, 0.2672612419124244, 1.3093073414159544, -0.2672612419124244, 1.0350983390135313, 0.9258200997725513, 1.0690449676496976, -0.8374357893586237,
        0.27914526311954124, -0.7207499701564472, 0.8374357893586237},
    {1.1952286093343938, 0.4629100498862757, 1.4638501094227998, -0.4629100498862757, -0.3779644730092272, 1.3093073414159542, 0.3779644730092272, 0.6241877839323592,
        -0.6446583712203041, -0.6241877839323592, -0.6241877839323593, 0.6446583712203041},
    {-0.9258200997725513, 1.511857892036909, -0.9258200997725513, 0.11952286093343935, -0.4780914437337574, 0.7171371656006362, -0.4780914437337574, 0.11952286093343935,
        -0.24174688920761406, 0.5640760748177661, -0.08058229640253806, -0.4834937784152282, -0.08058229640253806, 0.5640760748177661, -0.24174688920761406},
    {-0.4629100498862757, 1.4638501094227998, 1.1952286093343938, -0.4629100498862757, -0.3779644730092272, 1.3093073414159542, -0.3779644730092272, 0.6241877839323592,
        -0.6446583712203041, -0.6241877839323593, -0.6446583712203041, 0.6241877839323592},
    {-0.2672612419124244, -1.0350983390135313, 1.3093073414159544, 1.0350983390135313, -0.2672612419124244, -0.5345224838248488, 0.9258200997725513, 0.5345224838248488,
        -0.8374357893586237, 0.3603749850782236, 0.27914526311954124, -0.3603749850782236, -0.8374357893586237},
    {-1.2247448713915892, 1.0, 1.2247448713915892, -1.0, 1.0, 0.42640143271122083, 1.2792042981336627, -0.42640143271122083},
    {-1.414213562373095, 1.414213562373095, -0.7071067811865475, 0.7071067811865475, -0.7385489458759963, 0.4767312946227962, 0.7385489458759963, -0.4767312946227962}
},{
    {1.0, -0.5773502691896256, -0.5773502691896257, -0.5773502691896256, 0.4472135954999578, 0.4472135954999578, 0.4472135954999579, 0.4472135954999578,
        0.4472135954999578, -0.3779644730092272, -0.37796447300922714, -0.37796447300922703, -0.3779644730092272, -0.37796447300922703, -0.37796447300922714, -0.3779644730092272,
        0.33333333333333326, 0.33333333333333326, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.3333333333333333, 0.33333333333333326,
        0.33333333333333326},
    {1.9999999999999996, 0.6324555320336758, 1.095445115010332, -1.095445115010332, -1.095445115010332, -0.2390457218668787, -0.9258200997725513, -0.5855400437691198,
        -0.7559289460184544, 0.828078671210825, 0.7559289460184544, 0.9258200997725513, 0.2390457218668787, 0.1543033499620919, 0.816496580927726, 0.26726124191242434,
        0.7071067811865475, 0.5345224838248488, 0.5976143046671968, -0.6900655593423543, -0.5976143046671968, -0.7071067811865475, -0.26726124191242434, -0.816496580927726,
        -0.1543033499620919},
    {1.9999999999999998, -1.0954451150103317, -1.2649110640673515, -1.0954451150103317, 0.7559289460184543, 0.9561828874675148, 1.01418510567422, 0.9561828874675148,
        0.7559289460184543, -0.5773502691896257, -0.7559289460184543, -0.8451542547285165, -0.8728715609439696, -0.8451542547285165, -0.7559289460184543, -0.5773502691896257},
    {1.9999999999999996, -1.095445115010332, -1.095445115010332, 0.6324555320336758, -1.095445115010332, 0.9258200997725513, -0.2390457218668787, 0.7559289460184544,
        0.828078671210825, -0.5855400437691198, 0.7559289460184544, -0.2390457218668787, 0.9258200997725513, -0.816496580927726, 0.1543033499620919, -0.7071067811865475,
        0.26726124191242434, -0.5976143046671968, -0.6900655593423543, 0.5345224838248488, -0.5976143046671968, 0.26726124191242434, -0.7071067811865475, 0.1543033499620919,
        -0.816496580927726},
    {2.0, 1.4142135623730947, 0.3086066999241838, 1.1952286093343936, -0.9759000729485333, -1.1952286093343936, 0.3086066999241838, 1.0690449676496976,
        0.1781741612749496, -1.0540925533894596, -0.9258200997725514, -0.2817180849095055, -0.7453559924999298, 0.6900655593423541, 0.7453559924999298, -0.2817180849095055,
        1.0540925533894596, -0.4879500364742665, -0.9759000729485333, 0.7559289460184544, 0.4879500364742665, 0.3481553119113957, 0.5222329678670935, 0.8827348295047495,
        -0.3481553119113957, -0.6579516949597689, -0.5222329678670935},
    {2.0, 1.414213562373095, 0.7559289460184544, 0.9759000729485331, -1.2344267996967353, -0.9759000729485331, -0.9258200997725514, -0.2817180849095055,
        -0.7453559924999298, -0.5345224838248488, 0.9258200997725514, -0.7126966450997984, -0.7968190728895957, 0.9759000729485331, 0.7968190728895957, 0.7453559924999298,
        0.2817180849095055, 0.7715167498104596, 0.5976143046671968, -0.7715167498104596, 0.3086066999241838, -0.5976143046671968, -0.6513389472789296, -0.6154574548966636,
        0.6513389472789296, -0.41871789467931186, 0.6154574548966636, -0.20806259464411977, 0.41871789467931186},
    {2.0, -0.40824829046386296, -1.0690449676496974, 0.816496580927726, -1.3093073414159544, -0.40824829046386296, -1.0690449676496974, 0.5345224838248487,
        0.690065559342354, -0.26726124191242434, 0.975900072948533, -0.5345224838248488, 1.0690449676496976, -0.26726124191242434, 0.975900072948533, 0.5345224838248487,
        0.690065559342354, -0.5455447255899809, 0.3273268353539885, 0.4364357804719848, 0.3273268353539885, -0.5455447255899809, 0.5318160234783104, 0.1329540058695776,
        -0.15194743527951726, -0.32288829996897417, -0.3798685881987932, -0.32288829996897417, -0.15194743527951726, 0.1329540058695776, 0.5318160234783104},
    {2.0, -0.9759000729485331, 1.414213562373095, -1.2344267996967353, 0.7559289460184544, -0.9759000729485331, -0.9258200997725514, 0.7453559924999298,
        -0.2817180849095055, 0.7968190728895957, -0.5345224838248488, 0.9759000729485331, -0.9258200997725514, -0.7126966450997984, 0.7968190728895957, -0.2817180849095055,
        0.7453559924999298, 0.7715167498104596, 0.5976143046671968, 0.3086066999241838, 0.5976143046671968, 0.7715167498104596, -0.6513389472789296, -0.6154574548966636,
        -0.41871789467931186, -0.20806259464411977, -0.41871789467931186, -0.6154574548966636, -0.6513389472789296},
    {2.0, -0.7071067811865474, -1.1952286093343936, -0.3086066999241838, -0.9759000729485333, 0.7071067811865474, 0.3086066999241838, -1.1952286093343936,
        1.0540925533894596, 0.4629100498862757, 0.7453559924999298, 0.2817180849095055, 1.0690449676496976, 0.6900655593423541, -0.4629100498862757, -0.2817180849095055,
        0.7453559924999298, 0.1781741612749496, 1.0540925533894596, -0.4879500364742665, -0.3779644730092272, -0.9759000729485333, 0.3779644730092272, -0.4879500364742665,
        0.3481553119113957, 0.5222329678670935, 0.32897584747988445, 0.8827348295047495, -0.32897584747988445, 0.5222329678670935, 0.3481553119113957},
    {2.0000000000000004, 1.414213562373095, 0.23570226039551584, 1.2472191289246473, -0.881917103688197, 1.414213562373095, -1.2472191289246473, 0.23570226039551584,
        0.5773502691896256, -0.9128709291752769, 1.2909944487358058, -0.9128709291752769, 0.5773502691896256, 0.4264014327112209, -0.5504818825631803, 0.7385489458759964,
        0.6513389472789295, -1.1281521496355325, -0.6513389472789295, 0.7385489458759964, -0.5504818825631803},
    {2.0, 1.1547005383792515, 0.408248290463863, 1.0801234497346435, 1.1547005383792517, -1.1547005383792517, 1.1547005383792515, -1.0801234497346435,
        0.408248290463863, 1.1547005383792517, -0.7071067811865475, 0.9128709291752769, -0.9128709291752769, -0.7071067811865475, -0.5504818825631803, -0.9949366763261821,
        -0.8408749651825218, 0.5685352436149611, -0.37605071654517747, -0.24618298195866548, 0.37605071654517747, 0.5685352436149611, 0.8408749651825218, 0.5504818825631803},
    {1.9999999999999996, 1.2649110640673518, 0.3651483716701107, 0.816496580927726, 0.9128709291752769, 1.4605934866804429, -1.2909944487358058, -0.3651483716701107,
        -0.9128709291752769, -0.8944271909999159, -0.5773502691896256, -0.3651483716701107, 0.7071067811865475, -0.7745966692414832, -0.7071067811865475, 0.5773502691896256,
        0.8944271909999159, 0.7385489458759964, 0.6513389472789295, 0.5685352436149611, -0.37605071654517747, 0.14213381090374036, -0.6356417261637282, 0.5504818825631803,
        0.6356417261637282, 0.37605071654517747, -0.5685352436149611, -0.6513389472789295, -0.7385489458759964},
    {2.0, -0.8944271909999156, -1.0540925533894598, 1.549193338482967, -1.3333333333333335, -0.8944271909999156, -1.0540925533894598, 1.1547005383792515,
        -0.36514837167011066, -1.0327955589886446, -0.36514837167011066, 1.1547005383792515, -1.1281521496355322, -0.24618298195866542, 0.5504818825631801, 0.8528028654224419,
        0.5504818825631801, -0.24618298195866542, -1.1281521496355322},
    {1.9999999999999996, -0.3651483716701107, -0.9128709291752769, 1.4605934866804429, -1.2909944487358058, 1.2649110640673518, -0.3651483716701107, 0.816496580927726,
        -0.9128709291752769, 0.5773502691896256, -0.8944271909999159, -0.7071067811865475, -0.7745966692414832, -0.3651483716701107, -0.7071067811865475, -0.8944271909999159,
        0.5773502691896256, -0.6513389472789295, 0.7385489458759964, 0.37605071654517747, 0.5685352436149611, 0.6356417261637282, 0.5504818825631803, 0.14213381090374036,
        0.6356417261637282, 0.5685352436149611, 0.37605071654517747, 0.7385489458759964, -0.6513389472789295},
    {2.0, -1.1547005383792515, -1.0801234497346435, -0.408248290463863, 1.1547005383792517, -1.1547005383792517, 1.1547005383792515, 0.408248290463863,
        -1.0801234497346435, -0.9128709291752769, 0.7071067811865475, -0.7071067811865475, -0.9128709291752769, 1.1547005383792517, -0.5504818825631803, 0.8408749651825218,
        0.37605071654517747, -0.5685352436149611, -0.24618298195866548, 0.5685352436149611, 0.37605071654517747, -0.9949366763261821, 0.8408749651825218, -0.5504818825631803},
    {2.0000000000000004, -1.414213562373095, -1.2472191289246473, -0.23570226039551584, -0.881917103688197, 1.414213562373095, 0.23570226039551584, -1.2472191289246473,
        -0.5773502691896256, 0.9128709291752769, 1.2909944487358058, -0.9128709291752769, 0.5773502691896256, 0.5504818825631803, -0.6513389472789295, -0.7385489458759964,
        -1.1281521496355325, 0.7385489458759964, -0.6513389472789295, -0.5504818825631803, 0.4264014327112209},
    {2.0, 1.414213562373095, 1.414213562373095, 1.414213562373095, 0.4670993664969138, -0.8738628975053029, 1.4270121360253518, -0.8738628975053029,
        0.4670993664969138, 0.7385489458759963, -0.9534625892455924, 0.7385489458759963, 0.6257862187747438, -0.699650262281441, 0.7933288280219175, -0.699650262281441},
    {2.0, 1.2247448713915892, 1.0, 1.2247448713915892, 1.0, 0.7006490497453706, 1.0, -0.8257228238447704,
        0.8738628975053029, 0.3567530340063379, -0.8738628975053029, -0.8257228238447704, 0.7006490497453706, 1.2792042981336627, -0.42640143271122083, -0.42640143271122083,
        -0.699650262281441, -0.9386793281621156, 0.26444294267397245, 0.26444294267397245, 0.699650262281441},
    {2.0, 1.0350983390135313, 0.2672612419124244, 1.3093073414159544, -0.2672612419124244, 1.0350983390135313, 0.9258200997725513, 1.184313050927584,
        -0.4670993664969138, 1.0690449676496976, -0.5617690055391233, 0.8257228238447704, -0.4077177531501005, -0.8257228238447704, -0.5617690055391233, 0.4670993664969138,
        -0.8374357893586237, 0.27914526311954124, -0.7207499701564472, 0.8374357893586237, 0.7933288280219175, 0.26444294267397245, -0.4916891718944415, -0.7933288280219175,
        0.5997002248126638, -0.26444294267397245},
    {2.0, 1.1952286093343938, 0.4629100498862757, 1.4638501094227998, -0.4629100498862757, -0.3779644730092272, -0.8827348295047495, -0.7006490497453706,
        1.3093073414159542, 0.3779644730092272, -0.27914526311954124, 0.5617690055391233, -0.8664002254439636, -0.5617690055391233, 0.7006490497453706, 0.8827348295047495,
        0.6241877839323592, -0.6446583712203041, -0.6241877839323592, -0.6241877839323593, 0.6446583712203041, -0.699650262281441, 0.26444294267397245, 0.699650262281441,
        0.5997002248126638, -0.26444294267397245, 0.4022911406409067, -0.5997002248126638},
    {2.0, -0.9258200997725513, 1.511857892036909, -0.9258200997725513, 0.11952286093343935, 1.1843130509275839, -0.4780914437337574, -0.2791452631195412,
        0.7171371656006362, -1.0192943828752512, -0.4780914437337574, -0.2791452631195412, 0.11952286093343935, 1.1843130509275839, -0.24174688920761406, 0.5640760748177661,
        -0.08058229640253806, -0.4834937784152282, -0.08058229640253806, 0.5640760748177661, -0.24174688920761406, 0.31289310938737186, -0.46933966408105776, -0.24584458594722075,
        0.20114557032045333, 0.4022911406409068, 0.20114557032045333, -0.24584458594722075, -0.46933966408105776, 0.31289310938737186},
    {2.0, -0.4629100498862757, 1.4638501094227998, 1.1952286093343938, -0.4629100498862757, -0.3779644730092272, 0.7006490497453706, -0.8827348295047495,
        -0.5617690055391233, 1.3093073414159542, -0.8664002254439636, -0.3779644730092272, -0.27914526311954124, -0.5617690055391233, -0.8827348295047495, 0.7006490497453706,
        0.6241877839323592, -0.6446583712203041, -0.6241877839323593, -0.6446583712203041, 0.6241877839323592, -0.699650262281441, 0.26444294267397245, 0.5997002248126638,
        0.4022911406409067, 0.5997002248126638, 0.26444294267397245, -0.699650262281441},
    {2.0, -0.2672612419124244, -1.0350983390135313, 1.3093073414159544, 1.0350983390135313, -0.2672612419124244, 0.4670993664969138, -0.5345224838248488,
        -0.8257228238447704, 0.5617690055391233, 0.9258200997725513, -0.4077177531501005, 0.5345224838248488, -0.5617690055391233, -0.8257228238447704, 1.184313050927584,
        0.4670993664969138, -0.8374357893586237, 0.3603749850782236, 0.27914526311954124, -0.3603749850782236, -0.8374357893586237, 0.7933288280219175, 0.26444294267397245,
        -0.2998501124063319, -0.4916891718944415, 0.2998501124063319, 0.26444294267397245, 0.7933288280219175},
    {2.0, -1.2247448713915892, 1.0, 1.2247448713915892, -1.0, -0.7006490497453706, -0.8738628975053029, 0.8257228238447704,
        0.3567530340063379, 1.0, -0.8257228238447704, -0.8738628975053029, 0.7006490497453706, 0.42640143271122083, 1.2792042981336627, -0.42640143271122083,
        -0.699650262281441, -0.26444294267397245, -0.9386793281621156, 0.26444294267397245, -0.699650262281441},
    {2.0, -1.414213562373095, 1.414213562373095, -0.7071067811865475, -0.4670993664969138, 0.8738628975053029, 1.4270121360253518, -0.8738628975053029,
        0.7071067811865475, 0.4670993664969138, -0.7385489458759963, 0.4767312946227962, 0.7385489458759963, -0.4767312946227962, 0.699650262281441, -0.39666441401095875,
        0.6257862187747438, -0.699650262281441, 0.39666441401095875}
}};


template <jint LMAX, jint CGIDX, jint SUBIDX>
static inline jdouble mplusHnlm2SubSub_(jdouble *aAnlm) noexcept {
    constexpr jint i1 = CG_INDEX1[LMAX][CGIDX][SUBIDX];
    constexpr jint i2 = CG_INDEX2[LMAX][CGIDX][SUBIDX];
    constexpr jdouble coeff = CG_COEFF[LMAX][CGIDX][SUBIDX];
    return coeff * aAnlm[i1] * aAnlm[i2];
}
template <jint LMAX, jint CGIDX>
static jdouble mplusHnlm2Sub_(jdouble *aAnlm) noexcept {
    constexpr jint tSize = CG_SIZE[LMAX][CGIDX];
    jdouble rSubHnlm = 0.0;
    if (tSize==0) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 0>(aAnlm);
    if (tSize==1) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 1>(aAnlm);
    if (tSize==2) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 2>(aAnlm);
    if (tSize==3) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 3>(aAnlm);
    if (tSize==4) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 4>(aAnlm);
    if (tSize==5) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 5>(aAnlm);
    if (tSize==6) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 6>(aAnlm);
    if (tSize==7) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 7>(aAnlm);
    if (tSize==8) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 8>(aAnlm);
    if (tSize==9) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 9>(aAnlm);
    if (tSize==10) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 10>(aAnlm);
    if (tSize==11) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 11>(aAnlm);
    if (tSize==12) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 12>(aAnlm);
    if (tSize==13) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 13>(aAnlm);
    if (tSize==14) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 14>(aAnlm);
    if (tSize==15) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 15>(aAnlm);
    if (tSize==16) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 16>(aAnlm);
    if (tSize==17) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 17>(aAnlm);
    if (tSize==18) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 18>(aAnlm);
    if (tSize==19) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 19>(aAnlm);
    if (tSize==20) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 20>(aAnlm);
    if (tSize==21) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 21>(aAnlm);
    if (tSize==22) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 22>(aAnlm);
    if (tSize==23) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 23>(aAnlm);
    if (tSize==24) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 24>(aAnlm);
    if (tSize==25) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 25>(aAnlm);
    if (tSize==26) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 26>(aAnlm);
    if (tSize==27) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 27>(aAnlm);
    if (tSize==28) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 28>(aAnlm);
    if (tSize==29) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 29>(aAnlm);
    if (tSize==30) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 30>(aAnlm);
    if (tSize==31) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 31>(aAnlm);
    if (tSize==32) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 32>(aAnlm);
    if (tSize==33) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 33>(aAnlm);
    if (tSize==34) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 34>(aAnlm);
    if (tSize==35) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 35>(aAnlm);
    if (tSize==36) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 36>(aAnlm);
    if (tSize==37) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 37>(aAnlm);
    if (tSize==38) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 38>(aAnlm);
    if (tSize==39) {return rSubHnlm;} rSubHnlm += mplusHnlm2SubSub_<LMAX, CGIDX, 39>(aAnlm);
    return rSubHnlm;
}
template <jint LMAX, jint LLMAX>
static void mplusHnlm2_(jdouble *rHnlm, jdouble *aAnlm) noexcept {
    rHnlm[0] += mplusHnlm2Sub_<LMAX, 0>(aAnlm);
    if (LLMAX==0) return;
    rHnlm[1] += mplusHnlm2Sub_<LMAX, 1>(aAnlm);
    rHnlm[2] += mplusHnlm2Sub_<LMAX, 2>(aAnlm);
    rHnlm[3] += mplusHnlm2Sub_<LMAX, 3>(aAnlm);
    if (LLMAX==1) return;
    rHnlm[4] += mplusHnlm2Sub_<LMAX, 4>(aAnlm);
    rHnlm[5] += mplusHnlm2Sub_<LMAX, 5>(aAnlm);
    rHnlm[6] += mplusHnlm2Sub_<LMAX, 6>(aAnlm);
    rHnlm[7] += mplusHnlm2Sub_<LMAX, 7>(aAnlm);
    rHnlm[8] += mplusHnlm2Sub_<LMAX, 8>(aAnlm);
    if (LLMAX==2) return;
    rHnlm[9] += mplusHnlm2Sub_<LMAX, 9>(aAnlm);
    rHnlm[10] += mplusHnlm2Sub_<LMAX, 10>(aAnlm);
    rHnlm[11] += mplusHnlm2Sub_<LMAX, 11>(aAnlm);
    rHnlm[12] += mplusHnlm2Sub_<LMAX, 12>(aAnlm);
    rHnlm[13] += mplusHnlm2Sub_<LMAX, 13>(aAnlm);
    rHnlm[14] += mplusHnlm2Sub_<LMAX, 14>(aAnlm);
    rHnlm[15] += mplusHnlm2Sub_<LMAX, 15>(aAnlm);
    if (LLMAX==3) return;
    rHnlm[16] += mplusHnlm2Sub_<LMAX, 16>(aAnlm);
    rHnlm[17] += mplusHnlm2Sub_<LMAX, 17>(aAnlm);
    rHnlm[18] += mplusHnlm2Sub_<LMAX, 18>(aAnlm);
    rHnlm[19] += mplusHnlm2Sub_<LMAX, 19>(aAnlm);
    rHnlm[20] += mplusHnlm2Sub_<LMAX, 20>(aAnlm);
    rHnlm[21] += mplusHnlm2Sub_<LMAX, 21>(aAnlm);
    rHnlm[22] += mplusHnlm2Sub_<LMAX, 22>(aAnlm);
    rHnlm[23] += mplusHnlm2Sub_<LMAX, 23>(aAnlm);
    rHnlm[24] += mplusHnlm2Sub_<LMAX, 24>(aAnlm);
}
template <jint LMAX, jint LLMAX>
static void mplusHnlm(jdouble *rHnlm, jdouble *aAnlm, jint aEquSize) noexcept {
    constexpr jint tLMAll = (LMAX+1)*(LMAX+1);
    constexpr jint tLLMMAll = (LLMAX+1)*(LLMAX+1);
    jdouble *tHnlm = rHnlm;
    jdouble *tAnlm = aAnlm;
    // v == 1
    constexpr jint tMinLM = tLMAll>tLLMMAll ? tLLMMAll : tLMAll;
    for (jint np = 0; np < aEquSize; ++np) {
        for (jint i = 0; i < tMinLM; ++i) {
            tHnlm[i] += tAnlm[i];
        }
        tHnlm += tLLMMAll;
        tAnlm += tLMAll;
    }
    // v == 2
    tAnlm = aAnlm;
    for (jint np = 0; np < aEquSize; ++np) {
        mplusHnlm2_<LMAX, LLMAX>(tHnlm, tAnlm);
        tHnlm += tLLMMAll;
        tAnlm += tLMAll;
    }
}
template <jint LMAX>
static void mplusHnlm(jdouble *rHnlm, jdouble *aAnlm, jint aEquSize, jint aLLMax) noexcept {
    switch (aLLMax) {
    case 0: {mplusHnlm<LMAX, 0>(rHnlm, aAnlm, aEquSize); return;}
    case 1: {mplusHnlm<LMAX, 1>(rHnlm, aAnlm, aEquSize); return;}
    case 2: {mplusHnlm<LMAX, 2>(rHnlm, aAnlm, aEquSize); return;}
    case 3: {mplusHnlm<LMAX, 3>(rHnlm, aAnlm, aEquSize); return;}
    case 4: {mplusHnlm<LMAX, 4>(rHnlm, aAnlm, aEquSize); return;}
    default: {return;}
    }
}
static void mplusHnlm(jdouble *rHnlm, jdouble *aAnlm, jint aEquSize, jint aLMax, jint aLLMax) noexcept {
    switch (aLMax) {
    case 0: {mplusHnlm<0>(rHnlm, aAnlm, aEquSize, aLLMax); return;}
    case 1: {mplusHnlm<1>(rHnlm, aAnlm, aEquSize, aLLMax); return;}
    case 2: {mplusHnlm<2>(rHnlm, aAnlm, aEquSize, aLLMax); return;}
    case 3: {mplusHnlm<3>(rHnlm, aAnlm, aEquSize, aLLMax); return;}
    case 4: {mplusHnlm<4>(rHnlm, aAnlm, aEquSize, aLLMax); return;}
    default: {return;}
    }
}

template <jint LMAX, jint CGIDX, jint SUBIDX>
static inline void mplusGradHnlm2SubSub_(jdouble aSubGradHnlm, jdouble *aAnlm, jdouble *rGradAnlm) noexcept {
    constexpr jint i1 = CG_INDEX1[LMAX][CGIDX][SUBIDX];
    constexpr jint i2 = CG_INDEX2[LMAX][CGIDX][SUBIDX];
    constexpr jdouble coeff = CG_COEFF[LMAX][CGIDX][SUBIDX];
    const jdouble tMul = coeff * aSubGradHnlm;
    rGradAnlm[i1] += tMul * aAnlm[i2];
    rGradAnlm[i2] += tMul * aAnlm[i1];
}
template <jint LMAX, jint CGIDX>
static void mplusGradHnlm2Sub_(jdouble aSubGradHnlm, jdouble *aAnlm, jdouble *rGradAnlm) noexcept {
    constexpr jint tSize = CG_SIZE[LMAX][CGIDX];
    if (tSize==0) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 0>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==1) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 1>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==2) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 2>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==3) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 3>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==4) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 4>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==5) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 5>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==6) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 6>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==7) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 7>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==8) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 8>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==9) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 9>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==10) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 10>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==11) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 11>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==12) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 12>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==13) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 13>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==14) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 14>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==15) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 15>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==16) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 16>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==17) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 17>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==18) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 18>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==19) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 19>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==20) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 20>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==21) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 21>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==22) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 22>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==23) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 23>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==24) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 24>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==25) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 25>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==26) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 26>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==27) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 27>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==28) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 28>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==29) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 29>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==30) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 30>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==31) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 31>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==32) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 32>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==33) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 33>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==34) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 34>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==35) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 35>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==36) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 36>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==37) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 37>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==38) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 38>(aSubGradHnlm, aAnlm, rGradAnlm);
    if (tSize==39) {return;} mplusGradHnlm2SubSub_<LMAX, CGIDX, 39>(aSubGradHnlm, aAnlm, rGradAnlm);
}
template <jint LMAX, jint LLMAX>
static void mplusGradHnlm2_(jdouble *aGradHnlm, jdouble *aAnlm, jdouble *rGradAnlm) noexcept {
    mplusGradHnlm2Sub_<LMAX, 0>(aGradHnlm[0], aAnlm, rGradAnlm);
    if (LLMAX==0) return;
    mplusGradHnlm2Sub_<LMAX, 1>(aGradHnlm[1], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 2>(aGradHnlm[2], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 3>(aGradHnlm[3], aAnlm, rGradAnlm);
    if (LLMAX==1) return;
    mplusGradHnlm2Sub_<LMAX, 4>(aGradHnlm[4], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 5>(aGradHnlm[5], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 6>(aGradHnlm[6], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 7>(aGradHnlm[7], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 8>(aGradHnlm[8], aAnlm, rGradAnlm);
    if (LLMAX==2) return;
    mplusGradHnlm2Sub_<LMAX, 9>(aGradHnlm[9], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 10>(aGradHnlm[10], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 11>(aGradHnlm[11], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 12>(aGradHnlm[12], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 13>(aGradHnlm[13], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 14>(aGradHnlm[14], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 15>(aGradHnlm[15], aAnlm, rGradAnlm);
    if (LLMAX==3) return;
    mplusGradHnlm2Sub_<LMAX, 16>(aGradHnlm[16], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 17>(aGradHnlm[17], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 18>(aGradHnlm[18], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 19>(aGradHnlm[19], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 20>(aGradHnlm[20], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 21>(aGradHnlm[21], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 22>(aGradHnlm[22], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 23>(aGradHnlm[23], aAnlm, rGradAnlm);
    mplusGradHnlm2Sub_<LMAX, 24>(aGradHnlm[24], aAnlm, rGradAnlm);
}
template <jint LMAX, jint LLMAX>
static void mplusGradHnlm(jdouble *aGradHnlm, jdouble *aAnlm, jdouble *rGradAnlm, jint aEquSize) noexcept {
    constexpr jint tLMAll = (LMAX+1)*(LMAX+1);
    constexpr jint tLLMMAll = (LLMAX+1)*(LLMAX+1);
    jdouble *tGradHnlm = aGradHnlm;
    jdouble *tGradAnlm = rGradAnlm;
    // v == 1
    constexpr jint tMinLM = tLMAll>tLLMMAll ? tLLMMAll : tLMAll;
    for (jint np = 0; np < aEquSize; ++np) {
        for (jint i = 0; i < tMinLM; ++i) {
            tGradAnlm[i] += tGradHnlm[i];
        }
        tGradHnlm += tLLMMAll;
        tGradAnlm += tLMAll;
    }
    // v == 2
    jdouble *tAnlm = aAnlm;
    tGradAnlm = rGradAnlm;
    for (jint np = 0; np < aEquSize; ++np) {
        mplusGradHnlm2_<LMAX, LLMAX>(tGradHnlm, tAnlm, tGradAnlm);
        tGradHnlm += tLLMMAll;
        tGradAnlm += tLMAll;
        tAnlm += tLMAll;
    }
}
template <jint LMAX>
static void mplusGradHnlm(jdouble *aGradHnlm, jdouble *aAnlm, jdouble *rGradAnlm, jint aEquSize, jint aLLMax) noexcept {
    switch (aLLMax) {
    case 0: {mplusGradHnlm<LMAX, 0>(aGradHnlm, aAnlm, rGradAnlm, aEquSize); return;}
    case 1: {mplusGradHnlm<LMAX, 1>(aGradHnlm, aAnlm, rGradAnlm, aEquSize); return;}
    case 2: {mplusGradHnlm<LMAX, 2>(aGradHnlm, aAnlm, rGradAnlm, aEquSize); return;}
    case 3: {mplusGradHnlm<LMAX, 3>(aGradHnlm, aAnlm, rGradAnlm, aEquSize); return;}
    case 4: {mplusGradHnlm<LMAX, 4>(aGradHnlm, aAnlm, rGradAnlm, aEquSize); return;}
    default: {return;}
    }
}
static void mplusGradHnlm(jdouble *aGradHnlm, jdouble *aAnlm, jdouble *rGradAnlm, jint aEquSize, jint aLMax, jint aLLMax) noexcept {
    switch (aLMax) {
    case 0: {mplusGradHnlm<0>(aGradHnlm, aAnlm, rGradAnlm, aEquSize, aLLMax); return;}
    case 1: {mplusGradHnlm<1>(aGradHnlm, aAnlm, rGradAnlm, aEquSize, aLLMax); return;}
    case 2: {mplusGradHnlm<2>(aGradHnlm, aAnlm, rGradAnlm, aEquSize, aLLMax); return;}
    case 3: {mplusGradHnlm<3>(aGradHnlm, aAnlm, rGradAnlm, aEquSize, aLLMax); return;}
    case 4: {mplusGradHnlm<4>(aGradHnlm, aAnlm, rGradAnlm, aEquSize, aLLMax); return;}
    default: {return;}
    }
}

template <jint LMAX, jint CGIDX, jint SUBIDX>
static inline jdouble mplusGradNNGradHnlm2SubSub_(jdouble *aAnlm, jdouble *aGradNNGradAnlm) noexcept {
    constexpr jint i1 = CG_INDEX1[LMAX][CGIDX][SUBIDX];
    constexpr jint i2 = CG_INDEX2[LMAX][CGIDX][SUBIDX];
    constexpr jdouble coeff = CG_COEFF[LMAX][CGIDX][SUBIDX];
    return coeff * (aAnlm[i2]*aGradNNGradAnlm[i1] + aAnlm[i1]*aGradNNGradAnlm[i2]);
}
template <jint LMAX, jint CGIDX>
static jdouble mplusGradNNGradHnlm2Sub_(jdouble *aAnlm, jdouble *aGradNNGradAnlm) noexcept {
    constexpr jint tSize = CG_SIZE[LMAX][CGIDX];
    jdouble rSubGGHnlm = 0.0;
    if (tSize==0) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 0>(aAnlm, aGradNNGradAnlm);
    if (tSize==1) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 1>(aAnlm, aGradNNGradAnlm);
    if (tSize==2) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 2>(aAnlm, aGradNNGradAnlm);
    if (tSize==3) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 3>(aAnlm, aGradNNGradAnlm);
    if (tSize==4) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 4>(aAnlm, aGradNNGradAnlm);
    if (tSize==5) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 5>(aAnlm, aGradNNGradAnlm);
    if (tSize==6) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 6>(aAnlm, aGradNNGradAnlm);
    if (tSize==7) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 7>(aAnlm, aGradNNGradAnlm);
    if (tSize==8) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 8>(aAnlm, aGradNNGradAnlm);
    if (tSize==9) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 9>(aAnlm, aGradNNGradAnlm);
    if (tSize==10) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 10>(aAnlm, aGradNNGradAnlm);
    if (tSize==11) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 11>(aAnlm, aGradNNGradAnlm);
    if (tSize==12) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 12>(aAnlm, aGradNNGradAnlm);
    if (tSize==13) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 13>(aAnlm, aGradNNGradAnlm);
    if (tSize==14) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 14>(aAnlm, aGradNNGradAnlm);
    if (tSize==15) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 15>(aAnlm, aGradNNGradAnlm);
    if (tSize==16) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 16>(aAnlm, aGradNNGradAnlm);
    if (tSize==17) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 17>(aAnlm, aGradNNGradAnlm);
    if (tSize==18) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 18>(aAnlm, aGradNNGradAnlm);
    if (tSize==19) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 19>(aAnlm, aGradNNGradAnlm);
    if (tSize==20) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 20>(aAnlm, aGradNNGradAnlm);
    if (tSize==21) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 21>(aAnlm, aGradNNGradAnlm);
    if (tSize==22) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 22>(aAnlm, aGradNNGradAnlm);
    if (tSize==23) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 23>(aAnlm, aGradNNGradAnlm);
    if (tSize==24) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 24>(aAnlm, aGradNNGradAnlm);
    if (tSize==25) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 25>(aAnlm, aGradNNGradAnlm);
    if (tSize==26) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 26>(aAnlm, aGradNNGradAnlm);
    if (tSize==27) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 27>(aAnlm, aGradNNGradAnlm);
    if (tSize==28) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 28>(aAnlm, aGradNNGradAnlm);
    if (tSize==29) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 29>(aAnlm, aGradNNGradAnlm);
    if (tSize==30) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 30>(aAnlm, aGradNNGradAnlm);
    if (tSize==31) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 31>(aAnlm, aGradNNGradAnlm);
    if (tSize==32) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 32>(aAnlm, aGradNNGradAnlm);
    if (tSize==33) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 33>(aAnlm, aGradNNGradAnlm);
    if (tSize==34) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 34>(aAnlm, aGradNNGradAnlm);
    if (tSize==35) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 35>(aAnlm, aGradNNGradAnlm);
    if (tSize==36) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 36>(aAnlm, aGradNNGradAnlm);
    if (tSize==37) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 37>(aAnlm, aGradNNGradAnlm);
    if (tSize==38) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 38>(aAnlm, aGradNNGradAnlm);
    if (tSize==39) {return rSubGGHnlm;} rSubGGHnlm += mplusGradNNGradHnlm2SubSub_<LMAX, CGIDX, 39>(aAnlm, aGradNNGradAnlm);
    return rSubGGHnlm;
}
template <jint LMAX, jint LLMAX>
static void mplusGradNNGradHnlm2_(jdouble *rGradNNGradHnlm, jdouble *aAnlm, jdouble *aGradNNGradAnlm) noexcept {
    rGradNNGradHnlm[0] += mplusGradNNGradHnlm2Sub_<LMAX, 0>(aAnlm, aGradNNGradAnlm);
    if (LLMAX==0) return;
    rGradNNGradHnlm[1] += mplusGradNNGradHnlm2Sub_<LMAX, 1>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[2] += mplusGradNNGradHnlm2Sub_<LMAX, 2>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[3] += mplusGradNNGradHnlm2Sub_<LMAX, 3>(aAnlm, aGradNNGradAnlm);
    if (LLMAX==1) return;
    rGradNNGradHnlm[4] += mplusGradNNGradHnlm2Sub_<LMAX, 4>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[5] += mplusGradNNGradHnlm2Sub_<LMAX, 5>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[6] += mplusGradNNGradHnlm2Sub_<LMAX, 6>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[7] += mplusGradNNGradHnlm2Sub_<LMAX, 7>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[8] += mplusGradNNGradHnlm2Sub_<LMAX, 8>(aAnlm, aGradNNGradAnlm);
    if (LLMAX==2) return;
    rGradNNGradHnlm[9] += mplusGradNNGradHnlm2Sub_<LMAX, 9>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[10] += mplusGradNNGradHnlm2Sub_<LMAX, 10>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[11] += mplusGradNNGradHnlm2Sub_<LMAX, 11>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[12] += mplusGradNNGradHnlm2Sub_<LMAX, 12>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[13] += mplusGradNNGradHnlm2Sub_<LMAX, 13>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[14] += mplusGradNNGradHnlm2Sub_<LMAX, 14>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[15] += mplusGradNNGradHnlm2Sub_<LMAX, 15>(aAnlm, aGradNNGradAnlm);
    if (LLMAX==3) return;
    rGradNNGradHnlm[16] += mplusGradNNGradHnlm2Sub_<LMAX, 16>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[17] += mplusGradNNGradHnlm2Sub_<LMAX, 17>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[18] += mplusGradNNGradHnlm2Sub_<LMAX, 18>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[19] += mplusGradNNGradHnlm2Sub_<LMAX, 19>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[20] += mplusGradNNGradHnlm2Sub_<LMAX, 20>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[21] += mplusGradNNGradHnlm2Sub_<LMAX, 21>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[22] += mplusGradNNGradHnlm2Sub_<LMAX, 22>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[23] += mplusGradNNGradHnlm2Sub_<LMAX, 23>(aAnlm, aGradNNGradAnlm);
    rGradNNGradHnlm[24] += mplusGradNNGradHnlm2Sub_<LMAX, 24>(aAnlm, aGradNNGradAnlm);
}
template <jint LMAX, jint LLMAX>
static void mplusGradNNGradHnlm(jdouble *rGradNNGradHnlm, jdouble *aAnlm, jdouble *aGradNNGradAnlm, jint aEquSize) noexcept {
    constexpr jint tLMAll = (LMAX+1)*(LMAX+1);
    constexpr jint tLLMMAll = (LLMAX+1)*(LLMAX+1);
    jdouble *tGradNNGradHnlm = rGradNNGradHnlm;
    jdouble *tGradNNGradAnlm = aGradNNGradAnlm;
    // v == 1
    constexpr jint tMinLM = tLMAll>tLLMMAll ? tLLMMAll : tLMAll;
    for (jint np = 0; np < aEquSize; ++np) {
        for (jint i = 0; i < tMinLM; ++i) {
            tGradNNGradHnlm[i] += tGradNNGradAnlm[i];
        }
        tGradNNGradHnlm += tLLMMAll;
        tGradNNGradAnlm += tLMAll;
    }
    // v == 2
    jdouble *tAnlm = aAnlm;
    tGradNNGradAnlm = aGradNNGradAnlm;
    for (jint np = 0; np < aEquSize; ++np) {
        mplusGradNNGradHnlm2_<LMAX, LLMAX>(tGradNNGradHnlm, tAnlm, tGradNNGradAnlm);
        tGradNNGradHnlm += tLLMMAll;
        tGradNNGradAnlm += tLMAll;
        tAnlm += tLMAll;
    }
}
template <jint LMAX>
    static void mplusGradNNGradHnlm(jdouble *rGradNNGradHnlm, jdouble *aAnlm, jdouble *aGradNNGradAnlm, jint aEquSize, jint aLLMax) noexcept {
    switch (aLLMax) {
    case 0: {mplusGradNNGradHnlm<LMAX, 0>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 1: {mplusGradNNGradHnlm<LMAX, 1>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 2: {mplusGradNNGradHnlm<LMAX, 2>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 3: {mplusGradNNGradHnlm<LMAX, 3>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 4: {mplusGradNNGradHnlm<LMAX, 4>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize); return;}
    default: {return;}
    }
}
static void mplusGradNNGradHnlm(jdouble *rGradNNGradHnlm, jdouble *aAnlm, jdouble *aGradNNGradAnlm, jint aEquSize, jint aLMax, jint aLLMax) noexcept {
    switch (aLMax) {
    case 0: {mplusGradNNGradHnlm<0>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 1: {mplusGradNNGradHnlm<1>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 2: {mplusGradNNGradHnlm<2>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 3: {mplusGradNNGradHnlm<3>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 4: {mplusGradNNGradHnlm<4>(rGradNNGradHnlm, aAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    default: {return;}
    }
}

template <jint LMAX, jint LLMAX>
static void mplusGradHnlmAnlm(jdouble *aNNGradHnlm, jdouble *rGradAnlm, jdouble *aGradNNGradAnlm, jint aEquSize) noexcept {
    constexpr jint tLMAll = (LMAX+1)*(LMAX+1);
    constexpr jint tLLMMAll = (LLMAX+1)*(LLMAX+1);
    jdouble *tNNGradHnlm = aNNGradHnlm + tLLMMAll*aEquSize;
    jdouble *tGradNNGradAnlm = aGradNNGradAnlm;
    jdouble *tGradAnlm = rGradAnlm;
    for (jint np = 0; np < aEquSize; ++np) {
        mplusGradHnlm2_<LMAX, LLMAX>(tNNGradHnlm, tGradNNGradAnlm, tGradAnlm);
        tNNGradHnlm += tLLMMAll;
        tGradNNGradAnlm += tLMAll;
        tGradAnlm += tLMAll;
    }
}
template <jint LMAX>
static void mplusGradHnlmAnlm(jdouble *aNNGradHnlm, jdouble *rGradAnlm, jdouble *aGradNNGradAnlm, jint aEquSize, jint aLLMax) noexcept {
    switch (aLLMax) {
    case 0: {mplusGradHnlmAnlm<LMAX, 0>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 1: {mplusGradHnlmAnlm<LMAX, 1>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 2: {mplusGradHnlmAnlm<LMAX, 2>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 3: {mplusGradHnlmAnlm<LMAX, 3>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize); return;}
    case 4: {mplusGradHnlmAnlm<LMAX, 4>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize); return;}
    default: {return;}
    }
}
static void mplusGradHnlmAnlm(jdouble *aNNGradHnlm, jdouble *rGradAnlm, jdouble *aGradNNGradAnlm, jint aEquSize, jint aLMax, jint aLLMax) noexcept {
    switch (aLMax) {
    case 0: {mplusGradHnlmAnlm<0>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 1: {mplusGradHnlmAnlm<1>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 2: {mplusGradHnlmAnlm<2>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 3: {mplusGradHnlmAnlm<3>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    case 4: {mplusGradHnlmAnlm<4>(aNNGradHnlm, rGradAnlm, aGradNNGradAnlm, aEquSize, aLLMax); return;}
    default: {return;}
    }
}

}

#endif //BASIS_EQUIVARIANT_UTIL_H
#ifndef BASIS_SPHERICAL_UTIL_H
#define BASIS_SPHERICAL_UTIL_H

#include "nnap_util.hpp"

namespace JSE_NNAP {

static constexpr jint SH_LARGEST_L = 20;

static constexpr jint L3NCOLS[7] = {0, 0, 2, 4, 9, 14, 23};
static constexpr jint L3NCOLS_NOCROSS[7] = {0, 0, 1, 1, 2, 2, 3};

static constexpr jint L4NCOLS[4] = {0, 1, 3, 9};
static constexpr jint L4NCOLS_NOCROSS[4] = {0, 1, 2, 3};

// l = 2: 222 112
// l = 3: 233 123
// l = 4: 444 224 334 244 134
// l = 5: 255 455 235 145 345
// l = 6: 666 336 446 556 266 466 246 156 356
static constexpr jint L3_SIZE[23] = {
    8, 8,
    24, 21,
    23, 23, 39, 36, 31,
    46, 65, 55, 41, 93,
    46, 46, 68, 94, 56, 91, 73, 51, 109
};
static constexpr jint L3_INDEX[23][110][3] = {{
    {4, 4, 6}, {4, 5, 7}, {5, 5, 6}, {5, 5, 8}, {6, 6, 6}, {6, 7, 7}, {6, 8, 8}, {7, 7, 8}
},{
    {1, 1, 6}, {1, 1, 8}, {1, 2, 5}, {1, 3, 4}, {2, 2, 6}, {2, 3, 7}, {3, 3, 6}, {3, 3, 8}
}, {
    {4, 9, 13}, {4, 10, 12}, {4, 11, 13}, {4, 11, 15}, {5, 9, 14}, {5, 10, 13}, {5, 10, 15}, {5, 11, 12},
    {5, 11, 14}, {6, 9, 9}, {6, 11, 11}, {6, 12, 12}, {6, 13, 13}, {6, 15, 15}, {7, 9, 10}, {7, 10, 11},
    {7, 12, 13}, {7, 13, 14}, {7, 14, 15}, {8, 9, 11}, {8, 11, 11}, {8, 12, 14}, {8, 13, 13}, {8, 13, 15}
}, {
    {1, 4, 13}, {1, 4, 15}, {1, 5, 12}, {1, 5, 14}, {1, 6, 11}, {1, 7, 10}, {1, 8, 9}, {1, 8, 11},
    {2, 4, 10}, {2, 5, 11}, {2, 6, 12}, {2, 7, 13}, {2, 8, 14}, {3, 4, 9}, {3, 4, 11}, {3, 5, 10},
    {3, 6, 13}, {3, 7, 12}, {3, 7, 14}, {3, 8, 13}, {3, 8, 15}
}, {
    {16, 16, 20}, {16, 17, 21}, {16, 18, 22}, {16, 19, 23}, {17, 17, 20}, {17, 18, 21}, {17, 19, 22}, {17, 19, 24},
    {18, 18, 20}, {18, 18, 24}, {18, 19, 21}, {18, 19, 23}, {19, 19, 20}, {19, 19, 22}, {20, 20, 20}, {20, 21, 21},
    {20, 22, 22}, {20, 23, 23}, {20, 24, 24}, {21, 21, 22}, {21, 22, 23}, {21, 23, 24}, {22, 22, 24}
}, {
    {4, 4, 20}, {4, 4, 24}, {4, 5, 21}, {4, 5, 23}, {4, 6, 18}, {4, 7, 17}, {4, 7, 19}, {4, 8, 16},
    {5, 5, 20}, {5, 5, 22}, {5, 6, 19}, {5, 7, 18}, {5, 8, 17}, {5, 8, 19}, {6, 6, 20}, {6, 7, 21},
    {6, 8, 22}, {7, 7, 20}, {7, 7, 22}, {7, 8, 21}, {7, 8, 23}, {8, 8, 20}, {8, 8, 24}
}, {
    {9, 9, 20}, {9, 10, 21}, {9, 11, 22}, {9, 11, 24}, {9, 12, 17}, {9, 13, 16}, {9, 13, 18}, {9, 14, 19},
    {10, 10, 20}, {10, 10, 24}, {10, 11, 21}, {10, 11, 23}, {10, 12, 18}, {10, 13, 17}, {10, 13, 19}, {10, 14, 16},
    {10, 15, 19}, {11, 11, 20}, {11, 11, 22}, {11, 12, 19}, {11, 13, 18}, {11, 14, 17}, {11, 14, 19}, {11, 15, 16},
    {11, 15, 18}, {12, 12, 20}, {12, 13, 21}, {12, 14, 22}, {12, 15, 23}, {13, 13, 20}, {13, 13, 22}, {13, 14, 21},
    {13, 14, 23}, {13, 15, 22}, {13, 15, 24}, {14, 14, 20}, {14, 14, 24}, {14, 15, 21}, {15, 15, 20}
}, {
    {4, 16, 22}, {4, 17, 21}, {4, 18, 20}, {4, 18, 24}, {4, 19, 21}, {4, 19, 23}, {5, 16, 23}, {5, 17, 22},
    {5, 17, 24}, {5, 18, 21}, {5, 18, 23}, {5, 19, 20}, {5, 19, 22}, {6, 16, 16}, {6, 17, 17}, {6, 18, 18},
    {6, 19, 19}, {6, 20, 20}, {6, 21, 21}, {6, 22, 22}, {6, 23, 23}, {6, 24, 24}, {7, 16, 17}, {7, 17, 18},
    {7, 18, 19}, {7, 20, 21}, {7, 21, 22}, {7, 22, 23}, {7, 23, 24}, {8, 16, 18}, {8, 17, 19}, {8, 19, 19},
    {8, 20, 22}, {8, 21, 21}, {8, 21, 23}, {8, 22, 24}
}, {
    {1, 9, 22}, {1, 9, 24}, {1, 10, 21}, {1, 10, 23}, {1, 11, 20}, {1, 11, 22}, {1, 12, 19}, {1, 13, 18},
    {1, 14, 17}, {1, 14, 19}, {1, 15, 16}, {1, 15, 18}, {2, 9, 17}, {2, 10, 18}, {2, 11, 19}, {2, 12, 20},
    {2, 13, 21}, {2, 14, 22}, {2, 15, 23}, {3, 9, 16}, {3, 9, 18}, {3, 10, 17}, {3, 10, 19}, {3, 11, 18},
    {3, 12, 21}, {3, 13, 20}, {3, 13, 22}, {3, 14, 21}, {3, 14, 23}, {3, 15, 22}, {3, 15, 24}
}, {
    {4, 25, 33}, {4, 26, 32}, {4, 27, 31}, {4, 27, 35}, {4, 28, 30}, {4, 28, 34}, {4, 29, 31}, {4, 29, 33},
    {5, 25, 34}, {5, 26, 33}, {5, 26, 35}, {5, 27, 32}, {5, 27, 34}, {5, 28, 31}, {5, 28, 33}, {5, 29, 30},
    {5, 29, 32}, {6, 25, 25}, {6, 26, 26}, {6, 27, 27}, {6, 28, 28}, {6, 29, 29}, {6, 30, 30}, {6, 31, 31},
    {6, 32, 32}, {6, 33, 33}, {6, 34, 34}, {6, 35, 35}, {7, 25, 26}, {7, 26, 27}, {7, 27, 28}, {7, 28, 29},
    {7, 30, 31}, {7, 31, 32}, {7, 32, 33}, {7, 33, 34}, {7, 34, 35}, {8, 25, 27}, {8, 26, 28}, {8, 27, 29},
    {8, 29, 29}, {8, 30, 32}, {8, 31, 31}, {8, 31, 33}, {8, 32, 34}, {8, 33, 35}
}, {
    {16, 25, 31}, {16, 26, 30}, {16, 27, 31}, {16, 28, 32}, {16, 29, 33}, {16, 29, 35}, {17, 25, 32}, {17, 26, 31},
    {17, 27, 30}, {17, 28, 31}, {17, 28, 35}, {17, 29, 32}, {17, 29, 34}, {18, 25, 33}, {18, 26, 32}, {18, 27, 35},
    {18, 28, 30}, {18, 28, 34}, {18, 29, 31}, {19, 25, 34}, {19, 26, 35}, {19, 27, 32}, {19, 28, 31}, {19, 28, 33},
    {19, 29, 30}, {19, 29, 32}, {20, 25, 25}, {20, 26, 26}, {20, 27, 27}, {20, 28, 28}, {20, 29, 29}, {20, 30, 30},
    {20, 31, 31}, {20, 32, 32}, {20, 33, 33}, {20, 34, 34}, {20, 35, 35}, {21, 25, 26}, {21, 27, 28}, {21, 28, 29},
    {21, 30, 31}, {21, 31, 32}, {21, 32, 33}, {21, 34, 35}, {22, 25, 27}, {22, 26, 28}, {22, 29, 29}, {22, 30, 32},
    {22, 31, 31}, {22, 32, 34}, {22, 33, 35}, {23, 25, 28}, {23, 26, 29}, {23, 28, 29}, {23, 30, 33}, {23, 31, 32},
    {23, 31, 34}, {23, 32, 35}, {24, 25, 29}, {24, 27, 29}, {24, 28, 28}, {24, 30, 34}, {24, 31, 33}, {24, 31, 35},
    {24, 32, 32}
}, {
    {4, 9, 31}, {4, 9, 35}, {4, 10, 30}, {4, 10, 34}, {4, 11, 31}, {4, 11, 33}, {4, 12, 28}, {4, 13, 27},
    {4, 13, 29}, {4, 14, 26}, {4, 15, 25}, {4, 15, 29}, {5, 9, 32}, {5, 9, 34}, {5, 10, 31}, {5, 10, 33},
    {5, 11, 30}, {5, 11, 32}, {5, 12, 29}, {5, 13, 28}, {5, 14, 27}, {5, 14, 29}, {5, 15, 26}, {5, 15, 28},
    {6, 9, 27}, {6, 10, 28}, {6, 11, 29}, {6, 12, 30}, {6, 13, 31}, {6, 14, 32}, {6, 15, 33}, {7, 9, 26},
    {7, 9, 28}, {7, 10, 27}, {7, 10, 29}, {7, 11, 28}, {7, 12, 31}, {7, 13, 30}, {7, 13, 32}, {7, 14, 31},
    {7, 14, 33}, {7, 15, 32}, {7, 15, 34}, {8, 9, 25}, {8, 9, 29}, {8, 10, 26}, {8, 11, 27}, {8, 11, 29},
    {8, 12, 32}, {8, 13, 31}, {8, 13, 33}, {8, 14, 30}, {8, 14, 34}, {8, 15, 31}, {8, 15, 35}
}, {
    {1, 16, 33}, {1, 16, 35}, {1, 17, 32}, {1, 17, 34}, {1, 18, 31}, {1, 18, 33}, {1, 19, 30}, {1, 19, 32},
    {1, 20, 29}, {1, 21, 28}, {1, 22, 27}, {1, 22, 29}, {1, 23, 26}, {1, 23, 28}, {1, 24, 25}, {1, 24, 27},
    {2, 16, 26}, {2, 17, 27}, {2, 18, 28}, {2, 19, 29}, {2, 20, 30}, {2, 21, 31}, {2, 22, 32}, {2, 23, 33},
    {2, 24, 34}, {3, 16, 25}, {3, 16, 27}, {3, 17, 26}, {3, 17, 28}, {3, 18, 27}, {3, 18, 29}, {3, 19, 28},
    {3, 20, 31}, {3, 21, 30}, {3, 21, 32}, {3, 22, 31}, {3, 22, 33}, {3, 23, 32}, {3, 23, 34}, {3, 24, 33},
    {3, 24, 35}
}, {
    {9, 16, 31}, {9, 17, 30}, {9, 18, 31}, {9, 18, 35}, {9, 19, 32}, {9, 19, 34}, {9, 20, 27}, {9, 21, 26},
    {9, 21, 28}, {9, 22, 25}, {9, 22, 29}, {9, 24, 29}, {10, 16, 32}, {10, 17, 31}, {10, 17, 35}, {10, 18, 30},
    {10, 18, 34}, {10, 19, 31}, {10, 19, 33}, {10, 20, 28}, {10, 21, 27}, {10, 21, 29}, {10, 22, 26}, {10, 23, 25},
    {10, 23, 29}, {10, 24, 28}, {11, 16, 33}, {11, 16, 35}, {11, 17, 32}, {11, 17, 34}, {11, 18, 31}, {11, 18, 33},
    {11, 19, 30}, {11, 19, 32}, {11, 20, 29}, {11, 21, 28}, {11, 22, 27}, {11, 22, 29}, {11, 23, 26}, {11, 23, 28},
    {11, 24, 25}, {11, 24, 27}, {12, 16, 26}, {12, 17, 27}, {12, 18, 28}, {12, 19, 29}, {12, 20, 30}, {12, 21, 31},
    {12, 22, 32}, {12, 23, 33}, {12, 24, 34}, {13, 16, 25}, {13, 16, 27}, {13, 17, 26}, {13, 17, 28}, {13, 18, 27},
    {13, 18, 29}, {13, 19, 28}, {13, 20, 31}, {13, 21, 30}, {13, 21, 32}, {13, 22, 31}, {13, 22, 33}, {13, 23, 32},
    {13, 23, 34}, {13, 24, 33}, {13, 24, 35}, {14, 16, 28}, {14, 17, 25}, {14, 17, 29}, {14, 18, 26}, {14, 19, 27},
    {14, 19, 29}, {14, 20, 32}, {14, 21, 31}, {14, 21, 33}, {14, 22, 30}, {14, 22, 34}, {14, 23, 31}, {14, 23, 35},
    {14, 24, 32}, {15, 16, 29}, {15, 18, 25}, {15, 18, 29}, {15, 19, 26}, {15, 19, 28}, {15, 20, 33}, {15, 21, 32},
    {15, 21, 34}, {15, 22, 31}, {15, 22, 35}, {15, 23, 30}, {15, 24, 31}
}, {
    {36, 36, 42}, {36, 37, 43}, {36, 38, 44}, {36, 39, 45}, {36, 40, 46}, {36, 41, 47}, {37, 37, 42}, {37, 38, 43},
    {37, 39, 44}, {37, 40, 45}, {37, 41, 46}, {37, 41, 48}, {38, 38, 42}, {38, 39, 43}, {38, 40, 44}, {38, 40, 48},
    {38, 41, 45}, {38, 41, 47}, {39, 39, 42}, {39, 39, 48}, {39, 40, 43}, {39, 40, 47}, {39, 41, 44}, {39, 41, 46},
    {40, 40, 42}, {40, 40, 46}, {40, 41, 43}, {40, 41, 45}, {41, 41, 42}, {41, 41, 44}, {42, 42, 42}, {42, 43, 43},
    {42, 44, 44}, {42, 45, 45}, {42, 46, 46}, {42, 47, 47}, {42, 48, 48}, {43, 43, 44}, {43, 44, 45}, {43, 45, 46},
    {43, 46, 47}, {43, 47, 48}, {44, 44, 46}, {44, 45, 47}, {44, 46, 48}, {45, 45, 48}
}, {
    {9, 9, 42}, {9, 9, 48}, {9, 10, 43}, {9, 10, 47}, {9, 11, 44}, {9, 11, 46}, {9, 12, 39}, {9, 13, 38},
    {9, 13, 40}, {9, 14, 37}, {9, 14, 41}, {9, 15, 36}, {10, 10, 42}, {10, 10, 46}, {10, 11, 43}, {10, 11, 45},
    {10, 12, 40}, {10, 13, 39}, {10, 13, 41}, {10, 14, 38}, {10, 15, 37}, {10, 15, 41}, {11, 11, 42}, {11, 11, 44},
    {11, 12, 41}, {11, 13, 40}, {11, 14, 39}, {11, 14, 41}, {11, 15, 38}, {11, 15, 40}, {12, 12, 42}, {12, 13, 43},
    {12, 14, 44}, {12, 15, 45}, {13, 13, 42}, {13, 13, 44}, {13, 14, 43}, {13, 14, 45}, {13, 15, 44}, {13, 15, 46},
    {14, 14, 42}, {14, 14, 46}, {14, 15, 43}, {14, 15, 47}, {15, 15, 42}, {15, 15, 48}
}, {
    {16, 16, 42}, {16, 17, 43}, {16, 18, 44}, {16, 18, 48}, {16, 19, 45}, {16, 19, 47}, {16, 20, 38}, {16, 21, 37},
    {16, 21, 39}, {16, 22, 36}, {16, 22, 40}, {16, 23, 41}, {17, 17, 42}, {17, 17, 48}, {17, 18, 43}, {17, 18, 47},
    {17, 19, 44}, {17, 19, 46}, {17, 20, 39}, {17, 21, 38}, {17, 21, 40}, {17, 22, 37}, {17, 22, 41}, {17, 23, 36},
    {17, 24, 41}, {18, 18, 42}, {18, 18, 46}, {18, 19, 43}, {18, 19, 45}, {18, 21, 39}, {18, 21, 41}, {18, 22, 38},
    {18, 23, 37}, {18, 23, 41}, {18, 24, 36}, {18, 24, 40}, {19, 19, 42}, {19, 19, 44}, {19, 20, 41}, {19, 21, 40},
    {19, 22, 39}, {19, 22, 41}, {19, 23, 38}, {19, 23, 40}, {19, 24, 37}, {19, 24, 39}, {20, 20, 42}, {20, 21, 43},
    {20, 23, 45}, {20, 24, 46}, {21, 21, 42}, {21, 21, 44}, {21, 22, 43}, {21, 22, 45}, {21, 23, 44}, {21, 23, 46},
    {21, 24, 45}, {21, 24, 47}, {22, 22, 42}, {22, 22, 46}, {22, 23, 43}, {22, 23, 47}, {22, 24, 44}, {22, 24, 48},
    {23, 23, 42}, {23, 23, 48}, {23, 24, 43}, {24, 24, 42}
}, {
    {25, 25, 42}, {25, 26, 43}, {25, 27, 44}, {25, 28, 45}, {25, 29, 46}, {25, 29, 48}, {25, 30, 37}, {25, 31, 36},
    {25, 31, 38}, {25, 32, 39}, {25, 33, 40}, {25, 34, 41}, {26, 26, 42}, {26, 27, 43}, {26, 28, 44}, {26, 28, 48},
    {26, 29, 45}, {26, 29, 47}, {26, 30, 38}, {26, 31, 37}, {26, 31, 39}, {26, 32, 36}, {26, 32, 40}, {26, 33, 41},
    {26, 35, 41}, {27, 27, 42}, {27, 27, 48}, {27, 28, 43}, {27, 28, 47}, {27, 29, 44}, {27, 29, 46}, {27, 30, 39},
    {27, 31, 38}, {27, 31, 40}, {27, 32, 37}, {27, 32, 41}, {27, 33, 36}, {27, 34, 41}, {27, 35, 40}, {28, 28, 42},
    {28, 28, 46}, {28, 29, 43}, {28, 29, 45}, {28, 30, 40}, {28, 31, 39}, {28, 31, 41}, {28, 32, 38}, {28, 33, 37},
    {28, 33, 41}, {28, 34, 36}, {28, 34, 40}, {28, 35, 39}, {29, 29, 42}, {29, 29, 44}, {29, 30, 41}, {29, 31, 40},
    {29, 32, 39}, {29, 32, 41}, {29, 33, 38}, {29, 33, 40}, {29, 34, 37}, {29, 34, 39}, {29, 35, 36}, {29, 35, 38},
    {30, 30, 42}, {30, 31, 43}, {30, 32, 44}, {30, 33, 45}, {30, 34, 46}, {30, 35, 47}, {31, 31, 42}, {31, 31, 44},
    {31, 32, 43}, {31, 32, 45}, {31, 33, 44}, {31, 33, 46}, {31, 34, 45}, {31, 34, 47}, {31, 35, 46}, {31, 35, 48},
    {32, 32, 42}, {32, 32, 46}, {32, 33, 43}, {32, 33, 47}, {32, 34, 44}, {32, 34, 48}, {32, 35, 45}, {33, 33, 42},
    {33, 33, 48}, {33, 34, 43}, {33, 35, 44}, {34, 34, 42}, {34, 35, 43}, {35, 35, 42}
}, {
    {4, 36, 46}, {4, 37, 45}, {4, 38, 44}, {4, 38, 48}, {4, 39, 43}, {4, 39, 47}, {4, 40, 42}, {4, 40, 46},
    {4, 41, 43}, {4, 41, 45}, {5, 36, 47}, {5, 37, 46}, {5, 37, 48}, {5, 38, 45}, {5, 38, 47}, {5, 39, 44},
    {5, 39, 46}, {5, 40, 43}, {5, 40, 45}, {5, 41, 42}, {5, 41, 44}, {6, 36, 36}, {6, 37, 37}, {6, 38, 38},
    {6, 39, 39}, {6, 40, 40}, {6, 41, 41}, {6, 42, 42}, {6, 43, 43}, {6, 44, 44}, {6, 45, 45}, {6, 46, 46},
    {6, 47, 47}, {6, 48, 48}, {7, 36, 37}, {7, 37, 38}, {7, 38, 39}, {7, 39, 40}, {7, 40, 41}, {7, 42, 43},
    {7, 43, 44}, {7, 44, 45}, {7, 45, 46}, {7, 46, 47}, {7, 47, 48}, {8, 36, 38}, {8, 37, 39}, {8, 38, 40},
    {8, 39, 41}, {8, 41, 41}, {8, 42, 44}, {8, 43, 43}, {8, 43, 45}, {8, 44, 46}, {8, 45, 47}, {8, 46, 48}
}, {
    {16, 36, 44}, {16, 37, 43}, {16, 38, 42}, {16, 39, 43}, {16, 40, 44}, {16, 40, 48}, {16, 41, 45}, {16, 41, 47},
    {17, 36, 45}, {17, 37, 44}, {17, 38, 43}, {17, 39, 42}, {17, 39, 48}, {17, 40, 43}, {17, 40, 47}, {17, 41, 44},
    {17, 41, 46}, {18, 36, 46}, {18, 37, 45}, {18, 38, 44}, {18, 38, 48}, {18, 39, 43}, {18, 39, 47}, {18, 40, 42},
    {18, 40, 46}, {18, 41, 43}, {18, 41, 45}, {19, 36, 47}, {19, 37, 46}, {19, 37, 48}, {19, 38, 45}, {19, 38, 47},
    {19, 39, 44}, {19, 39, 46}, {19, 40, 43}, {19, 40, 45}, {19, 41, 42}, {19, 41, 44}, {20, 36, 36}, {20, 37, 37},
    {20, 38, 38}, {20, 39, 39}, {20, 40, 40}, {20, 41, 41}, {20, 42, 42}, {20, 43, 43}, {20, 44, 44}, {20, 45, 45},
    {20, 46, 46}, {20, 47, 47}, {20, 48, 48}, {21, 36, 37}, {21, 37, 38}, {21, 38, 39}, {21, 39, 40}, {21, 40, 41},
    {21, 42, 43}, {21, 43, 44}, {21, 44, 45}, {21, 45, 46}, {21, 46, 47}, {21, 47, 48}, {22, 36, 38}, {22, 37, 39},
    {22, 38, 40}, {22, 39, 41}, {22, 41, 41}, {22, 42, 44}, {22, 43, 43}, {22, 43, 45}, {22, 44, 46}, {22, 45, 47},
    {22, 46, 48}, {23, 36, 39}, {23, 37, 40}, {23, 38, 41}, {23, 40, 41}, {23, 42, 45}, {23, 43, 44}, {23, 43, 46},
    {23, 44, 47}, {23, 45, 48}, {24, 36, 40}, {24, 37, 41}, {24, 39, 41}, {24, 40, 40}, {24, 42, 46}, {24, 43, 45},
    {24, 43, 47}, {24, 44, 44}, {24, 44, 48}
}, {
    {4, 16, 44}, {4, 16, 48}, {4, 17, 43}, {4, 17, 47}, {4, 18, 42}, {4, 18, 46}, {4, 19, 43}, {4, 19, 45},
    {4, 20, 40}, {4, 21, 39}, {4, 21, 41}, {4, 22, 38}, {4, 23, 37}, {4, 23, 41}, {4, 24, 36}, {4, 24, 40},
    {5, 16, 45}, {5, 16, 47}, {5, 17, 44}, {5, 17, 46}, {5, 18, 43}, {5, 18, 45}, {5, 19, 42}, {5, 19, 44},
    {5, 20, 41}, {5, 21, 40}, {5, 22, 39}, {5, 22, 41}, {5, 23, 38}, {5, 23, 40}, {5, 24, 37}, {5, 24, 39},
    {6, 16, 38}, {6, 17, 39}, {6, 18, 40}, {6, 19, 41}, {6, 20, 42}, {6, 21, 43}, {6, 22, 44}, {6, 23, 45},
    {6, 24, 46}, {7, 16, 37}, {7, 16, 39}, {7, 17, 38}, {7, 17, 40}, {7, 18, 39}, {7, 18, 41}, {7, 19, 40},
    {7, 20, 43}, {7, 21, 42}, {7, 21, 44}, {7, 22, 43}, {7, 22, 45}, {7, 23, 44}, {7, 23, 46}, {7, 24, 45},
    {7, 24, 47}, {8, 16, 36}, {8, 16, 40}, {8, 17, 37}, {8, 17, 41}, {8, 18, 38}, {8, 19, 39}, {8, 19, 41},
    {8, 20, 44}, {8, 21, 43}, {8, 21, 45}, {8, 22, 42}, {8, 22, 46}, {8, 23, 43}, {8, 23, 47}, {8, 24, 44},
    {8, 24, 48}
}, {
    {1, 25, 46}, {1, 25, 48}, {1, 26, 45}, {1, 26, 47}, {1, 27, 44}, {1, 27, 46}, {1, 28, 43}, {1, 28, 45},
    {1, 29, 42}, {1, 29, 44}, {1, 30, 41}, {1, 31, 40}, {1, 32, 39}, {1, 32, 41}, {1, 33, 38}, {1, 33, 40},
    {1, 34, 37}, {1, 34, 39}, {1, 35, 36}, {1, 35, 38}, {2, 25, 37}, {2, 26, 38}, {2, 27, 39}, {2, 28, 40},
    {2, 29, 41}, {2, 30, 42}, {2, 31, 43}, {2, 32, 44}, {2, 33, 45}, {2, 34, 46}, {2, 35, 47}, {3, 25, 36},
    {3, 25, 38}, {3, 26, 37}, {3, 26, 39}, {3, 27, 38}, {3, 27, 40}, {3, 28, 39}, {3, 28, 41}, {3, 29, 40},
    {3, 30, 43}, {3, 31, 42}, {3, 31, 44}, {3, 32, 43}, {3, 32, 45}, {3, 33, 44}, {3, 33, 46}, {3, 34, 45},
    {3, 34, 47}, {3, 35, 46}, {3, 35, 48}
}, {
    {9, 25, 44}, {9, 26, 43}, {9, 27, 42}, {9, 27, 48}, {9, 28, 43}, {9, 28, 47}, {9, 29, 44}, {9, 29, 46},
    {9, 30, 39}, {9, 31, 38}, {9, 31, 40}, {9, 32, 37}, {9, 32, 41}, {9, 33, 36}, {9, 34, 41}, {9, 35, 40},
    {10, 25, 45}, {10, 26, 44}, {10, 26, 48}, {10, 27, 43}, {10, 27, 47}, {10, 28, 42}, {10, 28, 46}, {10, 29, 43},
    {10, 30, 40}, {10, 31, 41}, {10, 32, 38}, {10, 33, 37}, {10, 33, 41}, {10, 34, 36}, {10, 34, 40}, {10, 35, 39},
    {11, 25, 46}, {11, 25, 48}, {11, 26, 45}, {11, 27, 44}, {11, 27, 46}, {11, 28, 43}, {11, 28, 45}, {11, 29, 44},
    {11, 30, 41}, {11, 31, 40}, {11, 32, 39}, {11, 32, 41}, {11, 33, 38}, {11, 33, 40}, {11, 34, 39}, {11, 35, 36},
    {11, 35, 38}, {12, 25, 37}, {12, 26, 38}, {12, 27, 39}, {12, 28, 40}, {12, 29, 41}, {12, 30, 42}, {12, 31, 43},
    {12, 32, 44}, {12, 33, 45}, {12, 34, 46}, {12, 35, 47}, {13, 25, 36}, {13, 25, 38}, {13, 26, 39}, {13, 27, 38},
    {13, 27, 40}, {13, 28, 39}, {13, 28, 41}, {13, 29, 40}, {13, 30, 43}, {13, 31, 44}, {13, 32, 43}, {13, 32, 45},
    {13, 33, 44}, {13, 33, 46}, {13, 34, 45}, {13, 35, 46}, {13, 35, 48}, {14, 25, 39}, {14, 26, 36}, {14, 26, 40},
    {14, 27, 37}, {14, 27, 41}, {14, 28, 38}, {14, 29, 41}, {14, 30, 44}, {14, 31, 43}, {14, 32, 42}, {14, 32, 46},
    {14, 33, 43}, {14, 33, 47}, {14, 34, 44}, {14, 34, 48}, {14, 35, 45}, {15, 25, 40}, {15, 26, 41}, {15, 27, 36},
    {15, 28, 37}, {15, 28, 41}, {15, 29, 38}, {15, 29, 40}, {15, 30, 45}, {15, 31, 44}, {15, 31, 46}, {15, 32, 43},
    {15, 32, 47}, {15, 33, 42}, {15, 33, 48}, {15, 34, 43}, {15, 35, 44}
}};
static constexpr jdouble L3_COEFF[23][110] = {{
    0.7171371656006361, -1.2421180068162376, -0.35856858280031806, 0.6210590034081187, -0.23904572186687872, -0.35856858280031806, 0.7171371656006361, -0.6210590034081187
}, {
    -0.18257418583505533, -0.3162277660168378, 0.6324555320336757, 0.6324555320336755, 0.3651483716701107, 0.6324555320336757, -0.18257418583505533, 0.3162277660168378
}, {
    -0.21821789023599228, -0.4364357804719847, 0.33806170189140655, 0.21821789023599228, 0.345032779671177, 0.2672612419124243, -0.345032779671177, 0.13801311186847082,
    -0.2672612419124243, -0.24397501823713325, 0.14638501094227993, 0.19518001458970663, 0.14638501094227993, -0.24397501823713325, 0.345032779671177, 0.2672612419124243,
    0.13801311186847082, 0.2672612419124243, 0.345032779671177, -0.21821789023599228, -0.16903085094570328, -0.4364357804719847, 0.16903085094570328, -0.21821789023599228
}, {
    0.0690065559342354, 0.2672612419124243, 0.16903085094570328, 0.21821789023599233, -0.2390457218668787, -0.21821789023599233, -0.2672612419124243, -0.0690065559342354,
    -0.21821789023599236, -0.27602622373694163, -0.29277002188455997, -0.27602622373694163, -0.21821789023599236, -0.2672612419124243, 0.0690065559342354, -0.21821789023599233,
    -0.2390457218668787, 0.16903085094570328, -0.21821789023599233, 0.0690065559342354, -0.2672612419124243
}, {
    0.3128931093873718, -0.699650262281441, 0.7933288280219174, -0.699650262281441, -0.4693396640810578, 0.2644429426739724, 0.2644429426739724, 0.699650262281441,
    -0.24584458594722075, -0.3966644140109587, 0.5997002248126637, -0.2644429426739724, 0.20114557032045333, -0.29985011240633186, 0.13409704688030227, 0.20114557032045333,
    -0.24584458594722075, -0.4693396640810578, 0.3128931093873718, 0.29985011240633186, 0.2644429426739724, -0.699650262281441, 0.3966644140109587
}, {
    0.03984095364447978, -0.23570226039551576, -0.1259881576697424, -0.33333333333333326, 0.3086066999241837, 0.33333333333333326, -0.1259881576697424, 0.4714045207910315,
    -0.15936381457791912, -0.17817416127494956, 0.43643578047198467, 0.3563483225498991, 0.33333333333333326, 0.1259881576697424, 0.23904572186687872, 0.43643578047198467,
    0.3086066999241837, -0.15936381457791912, 0.17817416127494956, -0.1259881576697424, 0.33333333333333326, 0.03984095364447978, 0.23570226039551576
}, {
    -0.08058229640253801, 0.2080625946441197, -0.2791452631195412, -0.2461829819586654, 0.42640143271122083, 0.2461829819586654, -0.2791452631195412, 0.2080625946441197,
    0.1880253582725887, 0.15891043154093204, -0.21488612374010135, 0.14213381090374025, 0.09304842103984708, -0.14213381090374025, -0.21488612374010135, -0.3178208630818641,
    -0.2080625946441197, -0.026860765467512683, 0.1201249950260745, -0.2080625946441197, -0.240249990052149, -0.14213381090374025, 0.21488612374010135, 0.2461829819586654,
    0.2791452631195412, -0.16116459280507608, -0.2080625946441197, 0.09304842103984708, 0.42640143271122083, -0.026860765467512683, -0.1201249950260745, -0.21488612374010135,
    -0.14213381090374025, -0.2791452631195412, 0.2461829819586654, 0.1880253582725887, -0.15891043154093204, 0.2080625946441197, -0.08058229640253801
}, {
    0.15569978883230456, 0.23354968324845682, 0.3947710169758613, -0.15569978883230456, -0.29424494316824973, -0.23354968324845682, -0.2912876325017676, -0.2752409412815901,
    0.2912876325017676, -0.18725633517970772, 0.2752409412815901, -0.09304842103984708, 0.18725633517970772, 0.23783535600422526, 0.0594588390010563, -0.06795295885835007,
    -0.1444000375739939, -0.1698823971458752, -0.1444000375739939, -0.06795295885835007, 0.0594588390010563, 0.23783535600422526, -0.2912876325017676, -0.2752409412815901,
    -0.18725633517970772, -0.09304842103984708, -0.18725633517970772, -0.2752409412815901, -0.2912876325017676, 0.15569978883230456, 0.23354968324845682, 0.14712247158412486,
    0.3947710169758613, -0.14712247158412486, 0.23354968324845682, 0.15569978883230456
}, {
    -0.04454354031873739, -0.2357022603955158, -0.07715167498104594, -0.20412414523193148, -0.15430334996209188, -0.1725163898355885, 0.19920476822239894, 0.1725163898355885,
    0.20412414523193148, 0.07715167498104594, 0.2357022603955158, 0.04454354031873739, 0.16666666666666666, 0.21821789023599236, 0.24397501823713325, 0.25197631533948484,
    0.24397501823713325, 0.21821789023599236, 0.16666666666666666, 0.2357022603955158, -0.04454354031873739, 0.20412414523193148, -0.07715167498104594, 0.1725163898355885,
    0.19920476822239894, -0.15430334996209188, 0.1725163898355885, -0.07715167498104594, 0.20412414523193148, -0.04454354031873739, 0.2357022603955158
}, {
    -0.1182624791978165, -0.1832114449657377, -0.22850481879919338, 0.1182624791978165, -0.36129784186475633, 0.1832114449657377, 0.2644429426739725, 0.22850481879919338,
    0.25087260300212716, 0.26178515720236795, -0.25087260300212716, 0.21591675854376516, -0.26178515720236795, 0.1399300524562882, -0.21591675854376516, 0.06827887419989184,
    -0.1399300524562882, -0.22901430620717225, -0.09160572248286888, 0.015267620413811474, 0.09160572248286887, 0.13740858372430334, 0.1526762041381148, 0.13740858372430334,
    0.09160572248286887, 0.015267620413811474, -0.09160572248286888, -0.22901430620717225, 0.25087260300212716, 0.26178515720236795, 0.21591675854376516, 0.1399300524562882,
    0.06827887419989184, 0.1399300524562882, 0.21591675854376516, 0.26178515720236795, 0.25087260300212716, -0.1182624791978165, -0.1832114449657377, -0.22850481879919338,
    -0.13222147133698625, -0.36129784186475633, 0.13222147133698625, -0.22850481879919338, -0.1832114449657377, -0.1182624791978165
}, {
    -0.09656090991705349, -0.23652495839563303, 0.21591675854376516, -0.23321675409381368, 0.21591675854376516, 0.09656090991705349, 0.1806489209323781, 0.21591675854376519,
    0.23652495839563295, -0.06232979933389712, -0.1806489209323781, -0.06232979933389712, -0.21591675854376519, -0.236524958395633, -0.15267620413811478, 0.236524958395633,
    0.18064892093237817, 0.15267620413811478, -0.17629529511598163, 0.23652495839563295, -0.23652495839563295, -0.15267620413811478, -0.16490914830605113, 0.15267620413811478,
    -0.09656090991705348, 0.16490914830605113, -0.11826247919781648, 0.1182624791978165, 0.11826247919781652, 0.019710413199636075, -0.07884165279854433, -0.11826247919781652,
    -0.07884165279854433, 0.019710413199636075, 0.11826247919781652, 0.1182624791978165, -0.11826247919781648, 0.23652495839563295, -0.15267620413811478, -0.16490914830605113,
    -0.09656090991705348, -0.16490914830605113, -0.15267620413811478, 0.23652495839563295, -0.236524958395633, -0.15267620413811478, 0.08814764755799082, 0.18064892093237817,
    -0.08814764755799082, -0.15267620413811478, -0.236524958395633, 0.1806489209323781, 0.21591675854376519, 0.06232979933389712, 0.23652495839563295, -0.06232979933389712,
    0.21591675854376519, 0.1806489209323781, -0.09656090991705349, -0.21591675854376516, 0.11660837704690684, -0.23652495839563303, 0.21591675854376516, -0.09656090991705349,
    -0.11660837704690684
}, {
    -0.014712247158412491, 0.2132007163556104, -0.04652421051992354, 0.16514456476895406, 0.056980288229818946, 0.1230914909793327, -0.1230914909793327, -0.1230914909793327,
    0.056980288229818946, -0.16514456476895406, -0.2132007163556104, 0.014712247158412491, 0.038924947208076134, 0.13483997249264837, 0.0720749970156447, 0.15569978883230456,
    0.14712247158412486, 0.15075567228888176, -0.18609684207969415, -0.15075567228888176, -0.15569978883230456, -0.0720749970156447, -0.13483997249264837, -0.038924947208076134,
    -0.11009637651263605, -0.16514456476895406, -0.19738550848793066, -0.20806259464411972, -0.19738550848793066, -0.16514456476895406, -0.11009637651263605, -0.13483997249264837,
    0.038924947208076134, -0.15569978883230456, 0.0720749970156447, -0.15075567228888176, -0.18609684207969415, 0.14712247158412486, -0.15075567228888176, 0.0720749970156447,
    -0.15569978883230456, 0.038924947208076134, -0.13483997249264837, -0.2132007163556104, -0.014712247158412491, -0.16514456476895406, -0.1230914909793327, -0.056980288229818946,
    -0.1230914909793327, 0.056980288229818946, -0.1230914909793327, -0.04652421051992354, -0.16514456476895406, -0.014712247158412491, -0.2132007163556104
}, {
    0.0317820863081864, 0.2132007163556104, 0.05504818825631803, 0.19069251784911842, 0.07784989441615228, 0.16817499303650432, 0.14213381090374028, 0.1456438162508838,
    -0.1740776559556978, -0.1456438162508838, -0.16817499303650432, -0.07784989441615228, -0.19069251784911842, -0.05504818825631803, -0.2132007163556104, -0.0317820863081864,
    -0.1348399724926484, -0.17978662999019787, -0.20597146021777488, -0.2201927530252721, -0.22473328748774735, -0.2201927530252721, -0.20597146021777488, -0.17978662999019787,
    -0.1348399724926484, -0.2132007163556104, 0.0317820863081864, -0.19069251784911842, 0.05504818825631803, -0.16817499303650432, 0.07784989441615228, -0.1456438162508838,
    -0.1740776559556978, 0.14213381090374028, -0.1456438162508838, 0.07784989441615228, -0.16817499303650432, 0.05504818825631803, -0.19069251784911842, 0.0317820863081864,
    -0.2132007163556104
}, {
    0.03413943709994594, 0.0934946990008457, -0.09677620764234544, 0.0934946990008457, 0.12070113739631685, 0.12543630150106358, -0.18698939800169134, -0.12543630150106358,
    0.12070113739631685, -0.0934946990008457, -0.09677620764234544, -0.03413943709994594, -0.07374961314478494, -0.10840727259799846, -0.14281551174949583, -0.16321772771370952,
    -0.09656090991705349, 0.0931229492224321, -0.024140227479263362, -0.062329799333897117, 0.024140227479263362, 0.0931229492224321, 0.09656090991705349, 0.14281551174949583,
    0.10840727259799846, 0.07374961314478494, 0.11425240939959666, 0.12773807700531703, 0.11543640381423582, -0.028563102349899165, 0.07163086018595705, -0.09716254134469433,
    0.009124148357522642, -0.0997276789342354, 0.08194819531574025, 0.0997276789342354, 0.09716254134469433, -0.07163086018595705, 0.028563102349899165, -0.11543640381423582,
    -0.12773807700531703, -0.11425240939959666, -0.1978909779672614, -0.0989454889836307, 0.021591675854376515, 0.10964174397241232, 0.14135069854804388, 0.10964174397241232,
    0.021591675854376515, -0.0989454889836307, -0.1978909779672614, -0.12773807700531703, 0.11425240939959666, 0.028563102349899165, 0.11543640381423582, 0.09716254134469433,
    0.07163086018595705, 0.0997276789342354, 0.08194819531574025, 0.009124148357522642, 0.0997276789342354, 0.07163086018595705, 0.09716254134469433, 0.11543640381423582,
    0.028563102349899165, 0.11425240939959666, -0.12773807700531703, -0.07374961314478494, 0.14281551174949583, -0.10840727259799846, 0.09656090991705349, 0.024140227479263362,
    -0.0931229492224321, -0.062329799333897117, 0.0931229492224321, 0.024140227479263362, -0.16321772771370952, 0.09656090991705349, -0.10840727259799846, 0.14281551174949583,
    -0.07374961314478494, 0.03413943709994594, -0.0934946990008457, 0.09677620764234544, -0.12543630150106358, -0.12070113739631685, -0.18698939800169134, 0.12070113739631685,
    -0.12543630150106358, -0.09677620764234544, -0.0934946990008457, 0.0934946990008457, 0.03413943709994594
}, {
    0.15354817534862972, -0.4062502862402126, 0.547787774217608, -0.6000714413290615, 0.547787774217608, -0.4062502862402126, -0.38387043837157425, 0.45005358099679643,
    -0.1732257040921703, -0.1732257040921703, 0.45005358099679643, 0.4062502862402126, 0.05583570012677441, 0.29197186468509856, -0.4431821304438684, -0.547787774217608,
    0.29197186468509856, -0.45005358099679643, 0.30011688818141263, 0.3000357206645308, -0.19190349173384946, 0.1732257040921703, -0.19190349173384946, -0.29197186468509856,
    0.1535481753486297, 0.22159106522193422, -0.40456808321217275, 0.19190349173384946, -0.13958925031693623, 0.20228404160608637, -0.09305950021129074, -0.13958925031693623,
    0.1535481753486297, 0.30011688818141263, 0.05583570012677441, -0.38387043837157425, 0.15354817534862972, -0.20228404160608637, -0.19190349173384946, 0.29197186468509856,
    0.45005358099679643, -0.4062502862402126, -0.22159106522193422, -0.1732257040921703, 0.547787774217608, -0.3000357206645308
}, {
    -0.009124148357522647, -0.196116135138184, 0.03413943709994593, -0.2773500981126145, -0.06827887419989187, -0.1869893980016914, 0.1672484020014181, 0.1869893980016914,
    -0.06827887419989187, 0.2773500981126145, 0.03413943709994593, 0.392232270276368, 0.05474489014513589, -0.14484136487558025, -0.13222147133698625, -0.25087260300212716,
    0.27311549679956754, 0.25087260300212716, -0.13222147133698625, 0.2896827297511605, 0.2773500981126145, -0.03413943709994593, -0.1368622253628397, -0.13222147133698622,
    0.3413943709994594, 0.26444294267397245, 0.25087260300212716, 0.13222147133698625, 0.1869893980016914, 0.06827887419989187, 0.18248296715045295, 0.3413943709994594,
    0.27311549679956754, 0.1672484020014181, -0.1368622253628397, 0.13222147133698622, -0.13222147133698625, 0.25087260300212716, -0.06827887419989187, 0.1869893980016914,
    0.05474489014513589, 0.14484136487558025, 0.03413943709994593, 0.2773500981126145, -0.009124148357522647, 0.196116135138184
}, {
    0.024931919733558853, -0.08078865345335645, 0.13655774839978374, -0.20254787341673325, -0.19312181983410698, -0.24806946917841685, 0.33449680400283627, 0.24806946917841685,
    -0.19312181983410698, 0.20254787341673325, 0.13655774839978374, -0.08078865345335645, -0.10596065886762514, 0.1339728254114167, 0.19847906537954924, 0.12403473458920843,
    -0.2048366225996756, -0.037397879600338274, 0.21591675854376519, 0.037397879600338274, -0.2048366225996756, -0.12403473458920843, 0.19847906537954924, -0.2679456508228334,
    0.08078865345335645, 0.1371255585345737, 0.09894548898363069, -0.12118298018003468, 0.12773807700531703, -0.12773807700531703, -0.12118298018003468, -0.19789097796726138,
    -0.12403473458920843, -0.19847906537954924, 0.20254787341673325, -0.13655774839978374, 0.006232979933389711, 0.09032446046618905, -0.1806489209323781, -0.1806489209323781,
    -0.12773807700531703, 0.12118298018003468, 0.037397879600338274, 0.2048366225996756, 0.24806946917841685, 0.19312181983410698, -0.12465959866779427, -0.1806489209323781,
    0.21591675854376519, 0.33449680400283627, 0.006232979933389711, -0.09032446046618905, -0.12118298018003468, -0.12773807700531703, -0.2048366225996756, 0.037397879600338274,
    -0.19312181983410698, 0.24806946917841685, 0.1371255585345737, -0.09894548898363069, 0.19847906537954924, -0.12403473458920843, 0.13655774839978374, 0.20254787341673325,
    -0.10596065886762514, -0.1339728254114167, -0.08078865345335645, 0.024931919733558853
}, {
    -0.039275629491923314, 0.1138315887822419, -0.1696901136692636, 0.20782709644228634, -0.2151214823294156, -0.11651034560709256, 0.260525052859453, 0.11651034560709256,
    -0.2151214823294156, 0.20782709644228634, -0.1696901136692636, 0.1138315887822419, 0.12568201437415455, -0.18665912503618995, 0.13144139685142028, 0.19495909769424877,
    -0.024840089146271893, 0.19144603341518263, -0.14051676384485767, -0.19144603341518263, -0.024840089146271893, -0.19495909769424877, 0.13144139685142028, -0.18665912503618995,
    -0.1138315887822419, -0.07593288368438506, -0.11255968753474109, -0.01959412656115353, -0.0795917183440543, 0.12880703352445283, 0.08337788470424276, -0.22675795259753928,
    -0.08337788470424276, 0.12880703352445283, 0.0795917183440543, -0.01959412656115353, 0.22511937506948218, 0.18665912503618995, 0.1696901136692636, -0.09426151078061591,
    -0.08313083857691457, 0.1451250896624251, -0.08604859293176627, -0.07405883719762482, 0.08604859293176627, 0.1451250896624251, 0.16626167715382914, 0.0795917183440543,
    0.01959412656115353, -0.19495909769424877, -0.13144139685142028, -0.20782709644228634, 0.03142050359353869, -0.07588772585482789, 0.12392413738969521, 0.15177545170965578,
    0.08604859293176627, -0.1451250896624251, -0.08337788470424276, -0.12880703352445283, -0.19144603341518263, 0.024840089146271893, 0.11651034560709256, 0.2151214823294156,
    0.10473501197846215, 0.12392413738969521, -0.07405883719762482, -0.22675795259753928, -0.14051676384485767, 0.260525052859453, 0.03142050359353869, 0.07588772585482789,
    0.1451250896624251, 0.08604859293176627, 0.12880703352445283, -0.08337788470424276, -0.024840089146271893, -0.19144603341518263, -0.2151214823294156, 0.11651034560709256,
    -0.09426151078061591, 0.08313083857691457, -0.01959412656115353, 0.0795917183440543, 0.13144139685142028, -0.19495909769424877, 0.20782709644228634, -0.07593288368438506,
    0.11255968753474109, -0.18665912503618995, -0.1696901136692636, 0.12568201437415455, 0.1138315887822419, -0.039275629491923314
}, {
    0.09376144618769905, 0.1482498633322202, 0.18964186237230415, -0.09376144618769905, 0.21897956058054352, -0.1482498633322202, 0.33449680400283627, -0.18964186237230415,
    -0.24236596036006935, -0.21897956058054352, -0.21989008243131003, -0.24359938288234498, 0.21989008243131003, -0.2212488394343548, 0.24359938288234498, -0.17311854311433528,
    0.2212488394343548, -0.10948978029027176, 0.17311854311433528, -0.052888588534794494, 0.10948978029027176, 0.21989008243131003, 0.10994504121565503, 0.01999000749375545,
    -0.04997501873438864, -0.09995003746877731, -0.12993504870941047, -0.13993005245628823, -0.12993504870941047, -0.09995003746877731, -0.04997501873438864, 0.01999000749375545,
    0.10994504121565503, 0.21989008243131003, -0.21989008243131003, -0.24359938288234498, -0.2212488394343548, -0.17311854311433528, -0.10948978029027176, -0.052888588534794494,
    -0.10948978029027176, -0.17311854311433528, -0.2212488394343548, -0.24359938288234498, -0.21989008243131003, 0.09376144618769905, 0.1482498633322202, 0.18964186237230415,
    0.21897956058054352, 0.12118298018003468, 0.33449680400283627, -0.12118298018003468, 0.21897956058054352, 0.18964186237230415, 0.1482498633322202, 0.09376144618769905
}, {
    0.06726727939963122, 0.12281268769726864, 0.23997806015170473, -0.2007800501741212, 0.21164075575770327, -0.06726727939963122, -0.2007800501741212, -0.12281268769726864,
    -0.1426954482463482, -0.19223226273338137, -0.18514709299406212, -0.18588620608454282, 0.1426954482463482, 0.047324311668365454, 0.19223226273338137, 0.047324311668365454,
    0.18514709299406212, 0.20888474752955227, 0.17614708551003072, 0.07197981256149205, -0.20888474752955227, -0.04336441477418737, -0.17614708551003072, -0.1821606537393271,
    -0.07197981256149205, 0.15998537343446978, 0.04336441477418737, -0.23093077732788062, -0.056851227388610225, 0.23093077732788062, 0.09294310304227141, 0.056851227388610225,
    0.15756939126431624, -0.09294310304227141, 0.1354294502248119, -0.15756939126431624, 0.07405883719762482, -0.1354294502248119, 0.1264859959646828, -0.08432399730978855,
    -0.1226530869960561, -0.06899236143528152, 0.014053999551631426, 0.0817687246640374, 0.10732145112154902, 0.0817687246640374, 0.014053999551631426, -0.06899236143528152,
    -0.1226530869960561, -0.08432399730978855, 0.1264859959646828, -0.23093077732788062, -0.056851227388610225, 0.09294310304227141, 0.15756939126431624, 0.1354294502248119,
    0.07405883719762482, 0.1354294502248119, 0.15756939126431624, 0.09294310304227141, -0.056851227388610225, -0.23093077732788062, 0.20888474752955227, 0.17614708551003072,
    0.07197981256149205, -0.04336441477418737, -0.07999268671723489, -0.1821606537393271, 0.07999268671723489, -0.04336441477418737, 0.07197981256149205, 0.17614708551003072,
    0.20888474752955227, -0.1426954482463482, -0.19223226273338137, -0.18514709299406212, -0.047324311668365454, -0.18588620608454282, 0.047324311668365454, -0.18514709299406212,
    -0.19223226273338137, -0.1426954482463482, 0.06726727939963122, 0.12281268769726864, 0.2007800501741212, -0.10582037787885164, 0.23997806015170473, -0.2007800501741212,
    0.12281268769726864, 0.10582037787885164, 0.06726727939963122
}, {
    0.008814764755799082, -0.19611613513818402, 0.019710413199636085, -0.16012815380508713, 0.04828045495852676, -0.12773807700531706, -0.05214885156456198, -0.0989454889836307,
    0.10429770312912395, 0.0989454889836307, -0.05214885156456198, 0.12773807700531706, 0.16012815380508713, -0.019710413199636085, 0.19611613513818402, -0.008814764755799082,
    -0.026444294267397247, -0.11322770341445956, -0.04986383946711772, -0.13655774839978377, -0.07374961314478495, -0.13993005245628823, -0.13655774839978377, -0.13192731864484097,
    0.16490914830605116, 0.13192731864484097, 0.13993005245628823, 0.07374961314478495, 0.13655774839978377, 0.04986383946711772, 0.11322770341445956, 0.026444294267397247,
    0.08362420100070907, 0.1295500551262591, 0.16157730690671293, 0.18064892093237825, 0.18698939800169145, 0.18064892093237825, 0.16157730690671293, 0.1295500551262591,
    0.08362420100070907, 0.11322770341445956, -0.026444294267397247, 0.13655774839978377, -0.04986383946711772, 0.13993005245628823, -0.07374961314478495, 0.13192731864484097,
    0.16490914830605116, -0.13655774839978377, 0.13192731864484097, -0.07374961314478495, 0.13993005245628823, -0.04986383946711772, 0.13655774839978377, -0.026444294267397247,
    0.11322770341445956, 0.19611613513818402, 0.008814764755799082, 0.16012815380508713, 0.019710413199636085, 0.12773807700531706, 0.0989454889836307, 0.05214885156456198,
    0.10429770312912395, -0.05214885156456198, 0.0989454889836307, 0.04828045495852676, 0.12773807700531706, 0.019710413199636085, 0.16012815380508713, 0.008814764755799082,
    0.19611613513818402
}, {
    -0.024140227479263372, -0.19611613513818393, -0.04181210050035453, -0.17902871850985816, -0.05913123959890825, -0.16193756890782388, -0.07633810206905739, -0.14484136487558025,
    -0.13222147133698625, -0.12773807700531703, 0.15644655469368593, 0.12773807700531703, 0.14484136487558025, 0.07633810206905739, 0.16193756890782388, 0.05913123959890825,
    0.17902871850985816, 0.04181210050035453, 0.19611613513818393, 0.024140227479263372, 0.11322770341445955, 0.1526762041381148, 0.17739371879672475, 0.19312181983410703,
    0.20197163363339113, 0.20483662259967567, 0.20197163363339113, 0.19312181983410703, 0.17739371879672475, 0.1526762041381148, 0.11322770341445955, 0.19611613513818393,
    -0.024140227479263372, 0.17902871850985816, -0.04181210050035453, 0.16193756890782388, -0.05913123959890825, 0.14484136487558025, -0.07633810206905739, 0.12773807700531703,
    0.15644655469368593, -0.13222147133698625, 0.12773807700531703, -0.07633810206905739, 0.14484136487558025, -0.05913123959890825, 0.16193756890782388, -0.04181210050035453,
    0.17902871850985816, -0.024140227479263372, 0.19611613513818393
}, {
    -0.02234950781338371, -0.04469901562676742, -0.09656090991705352, -0.0741249316661101, 0.09032446046618912, -0.10482848367219182, -0.10795837927188258, -0.1182624791978165,
    0.16724840200141813, 0.1182624791978165, -0.10795837927188258, 0.10482848367219182, 0.09032446046618912, 0.0741249316661101, 0.04469901562676742, 0.02234950781338371,
    0.05474489014513589, 0.08655927155716765, 0.12838814775327387, 0.1032279548185018, 0.1048284836721918, 0.14484136487558028, 0.05474489014513589, -0.08362420100070907,
    0.06827887419989188, -0.08362420100070907, -0.05474489014513589, -0.1048284836721918, -0.1032279548185018, -0.12838814775327387, -0.08655927155716765, -0.05474489014513589,
    -0.09482093118615208, -0.12838814775327387, -0.10948978029027176, -0.09032446046618912, 0.07067534927402194, -0.04997501873438865, 0.09482093118615209, 0.08362420100070905,
    -0.06827887419989187, -0.08362420100070905, -0.09482093118615209, 0.04997501873438865, -0.07067534927402194, 0.09032446046618912, 0.10948978029027176, 0.12838814775327387,
    0.09482093118615208, 0.18156825980064073, 0.12241329578528219, 0.03160697706205069, -0.0516139774092509, -0.10795837927188262, -0.12773807700531706, -0.10795837927188262,
    -0.0516139774092509, 0.03160697706205069, 0.12241329578528219, 0.18156825980064073, 0.12838814775327387, -0.09482093118615208, -0.10948978029027176, -0.07067534927402194,
    -0.09032446046618912, -0.09482093118615209, -0.04997501873438865, -0.08362420100070905, -0.06827887419989187, -0.08362420100070905, -0.04997501873438865, -0.09482093118615209,
    -0.09032446046618912, -0.07067534927402194, -0.10948978029027176, -0.09482093118615208, 0.12838814775327387, 0.05474489014513589, -0.12838814775327387, 0.08655927155716765,
    -0.1048284836721918, 0.1032279548185018, -0.05474489014513589, 0.08362420100070907, 0.06827887419989188, -0.08362420100070907, 0.14484136487558028, -0.05474489014513589,
    0.1032279548185018, -0.1048284836721918, 0.08655927155716765, -0.12838814775327387, 0.05474489014513589, -0.02234950781338371, -0.04469901562676742, 0.0741249316661101,
    0.10482848367219182, -0.09032446046618912, 0.1182624791978165, 0.10795837927188258, 0.16724840200141813, -0.10795837927188258, 0.1182624791978165, 0.09032446046618912,
    0.10482848367219182, -0.09656090991705352, 0.0741249316661101, -0.04469901562676742, -0.02234950781338371
}};

// l = 1: 1111
// l = 2: 2222 1122
// l = 3: 3333 1133 2233 1113 1333 1223
static constexpr jint L4_SIZE[9] = {
    6,
    15, 25,
    45, 41, 95, 16, 48, 70
};
static constexpr jint L4_INDEX[9][100][4] = {{
    {1, 1, 1, 1}, {1, 1, 2, 2}, {1, 1, 3, 3}, {2, 2, 2, 2}, {2, 2, 3, 3}, {3, 3, 3, 3}
}, {
    {4, 4, 4, 4}, {4, 4, 5, 5}, {4, 4, 6, 6}, {4, 4, 7, 7}, {4, 4, 8, 8}, {5, 5, 5, 5}, {5, 5, 6, 6}, {5, 5, 7, 7},
    {5, 5, 8, 8}, {6, 6, 6, 6}, {6, 6, 7, 7}, {6, 6, 8, 8}, {7, 7, 7, 7}, {7, 7, 8, 8}, {8, 8, 8, 8}
}, {
    {1, 1, 4, 4}, {1, 1, 5, 5}, {1, 1, 6, 6}, {1, 1, 6, 8}, {1, 1, 7, 7}, {1, 1, 8, 8}, {1, 2, 4, 7}, {1, 2, 5, 6},
    {1, 2, 5, 8}, {1, 3, 4, 6}, {1, 3, 5, 7}, {2, 2, 4, 4}, {2, 2, 5, 5}, {2, 2, 6, 6}, {2, 2, 7, 7}, {2, 2, 8, 8},
    {2, 3, 4, 5}, {2, 3, 6, 7}, {2, 3, 7, 8}, {3, 3, 4, 4}, {3, 3, 5, 5}, {3, 3, 6, 6}, {3, 3, 6, 8}, {3, 3, 7, 7},
    {3, 3, 8, 8}
}, {
    {9, 9, 9, 9}, {9, 9, 10, 10}, {9, 9, 11, 11}, {9, 9, 12, 12}, {9, 9, 13, 13}, {9, 9, 14, 14}, {9, 9, 15, 15}, {9, 10, 10, 11},
    {9, 10, 12, 13}, {9, 10, 13, 14}, {9, 11, 11, 11}, {9, 11, 12, 14}, {9, 11, 13, 13}, {9, 11, 14, 14}, {10, 10, 10, 10}, {10, 10, 11, 11},
    {10, 10, 12, 12}, {10, 10, 13, 13}, {10, 10, 13, 15}, {10, 10, 14, 14}, {10, 10, 15, 15}, {10, 11, 12, 13}, {10, 11, 12, 15}, {10, 11, 14, 15},
    {11, 11, 11, 11}, {11, 11, 12, 12}, {11, 11, 12, 14}, {11, 11, 13, 13}, {11, 11, 13, 15}, {11, 11, 14, 14}, {11, 11, 15, 15}, {12, 12, 12, 12},
    {12, 12, 13, 13}, {12, 12, 14, 14}, {12, 12, 15, 15}, {12, 13, 13, 14}, {12, 13, 14, 15}, {13, 13, 13, 13}, {13, 13, 13, 15}, {13, 13, 14, 14},
    {13, 13, 15, 15}, {13, 14, 14, 15}, {14, 14, 14, 14}, {14, 14, 15, 15}, {15, 15, 15, 15}
}, {
    {1, 1, 9, 9}, {1, 1, 9, 11}, {1, 1, 10, 10}, {1, 1, 11, 11}, {1, 1, 12, 12}, {1, 1, 12, 14}, {1, 1, 13, 13}, {1, 1, 13, 15},
    {1, 1, 14, 14}, {1, 1, 15, 15}, {1, 2, 9, 14}, {1, 2, 10, 13}, {1, 2, 10, 15}, {1, 2, 11, 12}, {1, 2, 11, 14}, {1, 3, 9, 13},
    {1, 3, 10, 12}, {1, 3, 11, 13}, {1, 3, 11, 15}, {2, 2, 9, 9}, {2, 2, 10, 10}, {2, 2, 11, 11}, {2, 2, 12, 12}, {2, 2, 13, 13},
    {2, 2, 14, 14}, {2, 2, 15, 15}, {2, 3, 9, 10}, {2, 3, 10, 11}, {2, 3, 12, 13}, {2, 3, 13, 14}, {2, 3, 14, 15}, {3, 3, 9, 9},
    {3, 3, 9, 11}, {3, 3, 10, 10}, {3, 3, 11, 11}, {3, 3, 12, 12}, {3, 3, 12, 14}, {3, 3, 13, 13}, {3, 3, 13, 15}, {3, 3, 14, 14},
    {3, 3, 15, 15}
}, {
    {4, 4, 9, 9}, {4, 4, 9, 11}, {4, 4, 10, 10}, {4, 4, 11, 11}, {4, 4, 12, 12}, {4, 4, 13, 13}, {4, 4, 13, 15}, {4, 4, 14, 14},
    {4, 4, 15, 15}, {4, 5, 9, 10}, {4, 5, 10, 11}, {4, 5, 12, 13}, {4, 5, 12, 15}, {4, 5, 13, 14}, {4, 5, 14, 15}, {4, 6, 9, 13},
    {4, 6, 10, 12}, {4, 6, 11, 13}, {4, 6, 11, 15}, {4, 7, 9, 12}, {4, 7, 9, 14}, {4, 7, 10, 13}, {4, 7, 10, 15}, {4, 7, 11, 12},
    {4, 7, 11, 14}, {4, 8, 9, 13}, {4, 8, 10, 14}, {4, 8, 11, 15}, {5, 5, 9, 9}, {5, 5, 9, 11}, {5, 5, 10, 10}, {5, 5, 11, 11},
    {5, 5, 12, 12}, {5, 5, 12, 14}, {5, 5, 13, 13}, {5, 5, 13, 15}, {5, 5, 14, 14}, {5, 5, 15, 15}, {5, 6, 9, 14}, {5, 6, 10, 13},
    {5, 6, 10, 15}, {5, 6, 11, 12}, {5, 6, 11, 14}, {5, 7, 9, 13}, {5, 7, 10, 12}, {5, 7, 11, 13}, {5, 7, 11, 15}, {5, 8, 9, 12},
    {5, 8, 9, 14}, {5, 8, 10, 13}, {5, 8, 10, 15}, {5, 8, 11, 12}, {5, 8, 11, 14}, {6, 6, 9, 9}, {6, 6, 10, 10}, {6, 6, 11, 11},
    {6, 6, 12, 12}, {6, 6, 13, 13}, {6, 6, 14, 14}, {6, 6, 15, 15}, {6, 7, 9, 10}, {6, 7, 10, 11}, {6, 7, 12, 13}, {6, 7, 13, 14},
    {6, 7, 14, 15}, {6, 8, 9, 11}, {6, 8, 11, 11}, {6, 8, 12, 14}, {6, 8, 13, 13}, {6, 8, 13, 15}, {7, 7, 9, 9}, {7, 7, 9, 11},
    {7, 7, 10, 10}, {7, 7, 11, 11}, {7, 7, 12, 12}, {7, 7, 12, 14}, {7, 7, 13, 13}, {7, 7, 13, 15}, {7, 7, 14, 14}, {7, 7, 15, 15},
    {7, 8, 9, 10}, {7, 8, 10, 11}, {7, 8, 12, 13}, {7, 8, 12, 15}, {7, 8, 13, 14}, {7, 8, 14, 15}, {8, 8, 9, 9}, {8, 8, 9, 11},
    {8, 8, 10, 10}, {8, 8, 11, 11}, {8, 8, 12, 12}, {8, 8, 13, 13}, {8, 8, 13, 15}, {8, 8, 14, 14}, {8, 8, 15, 15}
}, {
    {1, 1, 1, 9}, {1, 1, 1, 11}, {1, 1, 2, 12}, {1, 1, 2, 14}, {1, 1, 3, 13}, {1, 1, 3, 15}, {1, 2, 2, 11}, {1, 2, 3, 10},
    {1, 3, 3, 9}, {1, 3, 3, 11}, {2, 2, 2, 12}, {2, 2, 3, 13}, {2, 3, 3, 12}, {2, 3, 3, 14}, {3, 3, 3, 13}, {3, 3, 3, 15}
}, {
    {1, 9, 9, 11}, {1, 9, 10, 10}, {1, 9, 11, 11}, {1, 9, 12, 14}, {1, 9, 13, 13}, {1, 9, 14, 14}, {1, 10, 10, 11}, {1, 10, 12, 13},
    {1, 10, 12, 15}, {1, 10, 14, 15}, {1, 11, 11, 11}, {1, 11, 12, 12}, {1, 11, 12, 14}, {1, 11, 13, 13}, {1, 11, 13, 15}, {1, 11, 14, 14},
    {1, 11, 15, 15}, {2, 9, 9, 12}, {2, 9, 10, 13}, {2, 9, 11, 14}, {2, 10, 10, 12}, {2, 10, 11, 13}, {2, 10, 11, 15}, {2, 11, 11, 12},
    {2, 11, 11, 14}, {2, 12, 12, 12}, {2, 12, 13, 13}, {2, 12, 14, 14}, {2, 12, 15, 15}, {2, 13, 13, 14}, {2, 13, 14, 15}, {3, 9, 9, 13},
    {3, 9, 10, 12}, {3, 9, 10, 14}, {3, 9, 11, 13}, {3, 10, 10, 13}, {3, 10, 10, 15}, {3, 10, 11, 12}, {3, 11, 11, 13}, {3, 11, 11, 15},
    {3, 12, 12, 13}, {3, 12, 13, 14}, {3, 12, 14, 15}, {3, 13, 13, 13}, {3, 13, 13, 15}, {3, 13, 14, 14}, {3, 13, 15, 15}, {3, 14, 14, 15}
}, {
    {1, 4, 4, 9}, {1, 4, 4, 11}, {1, 4, 5, 10}, {1, 4, 6, 13}, {1, 4, 6, 15}, {1, 4, 7, 12}, {1, 4, 7, 14}, {1, 4, 8, 15},
    {1, 5, 5, 9}, {1, 5, 5, 11}, {1, 5, 6, 12}, {1, 5, 6, 14}, {1, 5, 7, 13}, {1, 5, 7, 15}, {1, 5, 8, 12}, {1, 5, 8, 14},
    {1, 6, 6, 11}, {1, 6, 7, 10}, {1, 6, 8, 9}, {1, 6, 8, 11}, {1, 7, 7, 9}, {1, 7, 7, 11}, {1, 7, 8, 10}, {1, 8, 8, 9},
    {1, 8, 8, 11}, {2, 4, 4, 12}, {2, 4, 5, 13}, {2, 4, 5, 15}, {2, 4, 6, 10}, {2, 4, 7, 9}, {2, 4, 7, 11}, {2, 5, 5, 12},
    {2, 5, 5, 14}, {2, 5, 6, 11}, {2, 5, 7, 10}, {2, 5, 8, 9}, {2, 5, 8, 11}, {2, 6, 6, 12}, {2, 6, 7, 13}, {2, 6, 8, 14},
    {2, 7, 7, 12}, {2, 7, 7, 14}, {2, 7, 8, 13}, {2, 7, 8, 15}, {2, 8, 8, 12}, {3, 4, 4, 13}, {3, 4, 4, 15}, {3, 4, 5, 12},
    {3, 4, 5, 14}, {3, 4, 6, 9}, {3, 4, 6, 11}, {3, 4, 7, 10}, {3, 4, 8, 9}, {3, 5, 5, 13}, {3, 5, 5, 15}, {3, 5, 6, 10},
    {3, 5, 7, 9}, {3, 5, 7, 11}, {3, 5, 8, 10}, {3, 6, 6, 13}, {3, 6, 7, 12}, {3, 6, 7, 14}, {3, 6, 8, 13}, {3, 6, 8, 15},
    {3, 7, 7, 13}, {3, 7, 7, 15}, {3, 7, 8, 12}, {3, 7, 8, 14}, {3, 8, 8, 13}, {3, 8, 8, 15}
}};
static constexpr jdouble L4_COEFF[9][100] = {{
    0.4666666666666665, 0.933333333333333, 0.9333333333333328, 0.4666666666666666, 0.933333333333333, 0.4666666666666665
}, {
    0.31428571428571417, 0.6285714285714283, 0.6285714285714283, 0.6285714285714283, 0.6285714285714284, 0.31428571428571417, 0.6285714285714284, 0.6285714285714283,
    0.6285714285714283, 0.3142857142857143, 0.6285714285714284, 0.6285714285714283, 0.31428571428571417, 0.6285714285714283, 0.31428571428571417
}, {
    -0.3018424677943595, -0.3018424677943594, -0.2145553116999626, -0.15118578920369083, -0.1709117336527641, -0.3018424677943595, -0.26186146828319073, -0.15118578920369083,
    0.26186146828319073, 0.30237157840738166, -0.26186146828319073, -0.17091173365276413, -0.3018424677943595, -0.34548604584155806, -0.3018424677943595, -0.17091173365276413,
    -0.26186146828319073, -0.15118578920369083, -0.26186146828319073, -0.3018424677943595, -0.1709117336527641, -0.2145553116999626, 0.15118578920369083, -0.3018424677943594,
    -0.3018424677943595
}, {
    0.24741924741924734, 0.4948384948384948, 0.44688644688644663, 0.4229104229104228, 0.44688644688644663, 0.4948384948384948, 0.4948384948384948, 0.061905827711607055,
    0.09590409590409593, 0.12381165542321398, 0.024762331084642798, 0.09590409590409593, -0.0742869932539284, -0.061905827711607055, 0.22743922743922734, 0.47885447885447846,
    0.5188145188145188, 0.47885447885447846, -0.061905827711607055, 0.45487845487845474, 0.4948384948384948, -0.049524662169285694, -0.09590409590409593, 0.12381165542321398,
    0.2442224442224441, 0.4804528804528803, 0.024762331084642847, 0.4884448884448882, 0.0742869932539284, 0.47885447885447846, 0.44688644688644663, 0.24022644022644019,
    0.4804528804528803, 0.5188145188145188, 0.4229104229104228, -0.024762331084642847, 0.09590409590409593, 0.2442224442224441, -0.024762331084642798, 0.47885447885447846,
    0.44688644688644663, 0.061905827711607055, 0.22743922743922734, 0.4948384948384948, 0.24741924741924734
}, {
    0.26276143055472967, 0.06900655593423537, 0.21821789023599225, 0.24494401442723468, 0.18258305798100238, 0.1380131118684708, 0.13803951766226497, 0.06900655593423537,
    0.21821789023599225, 0.26276143055472967, 0.21821789023599228, 0.16903085094570325, -0.21821789023599228, 0.08728715609439688, -0.16903085094570325, -0.13801311186847073,
    -0.2760262237369416, 0.2138089935299394, 0.13801311186847073, 0.12913080959851755, 0.21821789023599233, 0.2716701386184771, 0.2894875547459722, 0.2716701386184771,
    0.21821789023599233, 0.12913080959851755, 0.21821789023599228, 0.16903085094570325, 0.08728715609439688, 0.16903085094570325, 0.21821789023599228, 0.26276143055472967,
    -0.06900655593423537, 0.21821789023599225, 0.13803951766226497, 0.18258305798100238, -0.1380131118684708, 0.24494401442723468, -0.06900655593423537, 0.21821789023599225,
    0.26276143055472967
}, {
    -0.23056251083322293, 0.058025885318565916, -0.1989952892774029, -0.13510829884636139, -0.12879485453519743, -0.13510829884636139, -0.058025885318565916, -0.12408419344815379,
    -0.23056251083322293, -0.16907056583634186, -0.13096149716360336, -0.030929434163658072, -0.14213381090374028, -0.036205623227776505, -0.16907056583634186, -0.19047420464224973,
    -0.17994084623265716, 0.08748165054154199, 0.19047420464224973, 0.14213381090374028, -0.16907056583634186, -0.13096149716360336, 0.16907056583634186, -0.030929434163658072,
    0.036205623227776505, 0.11605177063713182, -0.1498221916584982, 0.11605177063713182, -0.12702835662755607, 0.0045610779849368285, -0.19899528927740284, -0.23864245305202825,
    -0.16667552040218145, -0.10692961466725821, -0.1258506913557951, 0.0045610779849368285, -0.19899528927740284, -0.12702835662755607, 0.008327350996300352, -0.1576716496271046,
    -0.008327350996300352, -0.12379740483422552, 0.1576716496271046, -0.009122155969873659, 0.21385922933451645, -0.22558352339246632, 0.009122155969873659, 0.14213381090374028,
    0.16907056583634186, 0.036205623227776505, -0.16907056583634186, 0.030929434163658072, -0.13096149716360336, -0.12997251980695837, -0.12408419344815382, -0.21044451262797,
    -0.2542135048537586, -0.21044451262797, -0.12408419344815382, -0.12997251980695837, 0.008327350996300352, -0.1576716496271046, -0.12379740483422552, -0.1576716496271046,
    0.008327350996300352, -0.19047420464224973, -0.04374082527077099, -0.17994084623265716, 0.04374082527077099, -0.19047420464224973, -0.12702835662755607, -0.0045610779849368285,
    -0.19899528927740284, -0.1258506913557951, -0.16667552040218145, 0.10692961466725821, -0.23864245305202825, -0.0045610779849368285, -0.19899528927740284, -0.12702835662755607,
    -0.16907056583634186, -0.036205623227776505, -0.030929434163658072, 0.14213381090374028, -0.13096149716360336, -0.16907056583634186, -0.23056251083322293, -0.058025885318565916,
    -0.12408419344815379, -0.13510829884636139, -0.12879485453519743, -0.13510829884636139, 0.058025885318565916, -0.1989952892774029, -0.23056251083322293
}, {
    0.08451542547285161, 0.06546536707079768, 0.16035674514745457, 0.20701966780270617, 0.0654653670707977, 0.2535462764185548, -0.2618614682831908, -0.41403933560541245,
    -0.2535462764185548, 0.06546536707079768, -0.10690449676496976, -0.2618614682831908, 0.16035674514745457, -0.20701966780270617, 0.06546536707079768, -0.08451542547285161
}, {
    0.19953649058762643, -0.12880025083442503, 0.10304020066754002, 0.2993047358814397, -0.10304020066754002, 0.12880025083442503, -0.09976824529381322, -0.025760050166885026,
    -0.2993047358814397, -0.25760050166885007, -0.03990729811752528, -0.039907298117525296, 0.025760050166885026, -0.03990729811752528, 0.20608040133508, -0.09976824529381322,
    0.19953649058762643, 0.1221906467513358, -0.08146043116755719, -0.08146043116755719, 0.1629208623351144, -0.3785938719441895, 0.08146043116755719, -0.13848273298484726,
    0.18929693597209474, -0.09775251740106866, -0.13848273298484726, 0.1629208623351144, 0.1221906467513358, -0.18929693597209474, -0.08146043116755719, 0.19953649058762643,
    0.2993047358814397, -0.25760050166885007, -0.20608040133508, -0.09976824529381322, 0.12880025083442503, -0.025760050166885026, -0.03990729811752528, 0.10304020066754002,
    -0.039907298117525296, -0.025760050166885026, 0.2993047358814397, -0.03990729811752528, -0.10304020066754002, -0.09976824529381322, 0.19953649058762643, -0.12880025083442503
}, {
    -0.05754138002994433, 0.08937274226122793, -0.21178422322480248, -0.10306595170917678, -0.19984352703167396, 0.12765498978703646, 0.07083720305586505, -0.11508276005988866,
    0.07214944058816983, -0.0780573872087486, -0.03135406339098164, 0.04089787825294385, -0.022170670841515982, 0.14429888117633966, -0.12765498978703646, -0.21178422322480248,
    -0.044801380946474643, -0.04089787825294385, 0.19984352703167396, 0.10306595170917678, -0.07214944058816983, -0.055886716367232615, -0.07083720305586505, 0.05754138002994433,
    0.08937274226122793, 0.09126262566624607, -0.13417412320770258, 0.05754138002994437, 0.0817957565058877, -0.05754138002994437, -0.13417412320770258, -0.00923894871233266,
    0.10589211161240125, -0.20613190341835358, -0.2117842232248025, -0.05754138002994437, 0.13417412320770258, -0.1640473539078269, -0.20613190341835358, 0.0817957565058877,
    -0.00923894871233266, -0.10589211161240125, -0.13417412320770258, -0.05754138002994437, 0.09126262566624607, 0.08937274226122793, 0.05754138002994433, 0.12765498978703646,
    -0.07083720305586505, 0.19984352703167396, -0.10306595170917678, -0.21178422322480248, -0.11508276005988866, -0.055886716367232615, 0.07214944058816983, -0.04089787825294385,
    -0.14429888117633966, -0.02217067084151598, 0.07083720305586505, -0.044801380946474643, -0.03135406339098164, -0.04089787825294385, -0.10306595170917678, 0.19984352703167396,
    -0.0780573872087486, -0.07214944058816983, 0.12765498978703646, -0.21178422322480248, 0.08937274226122793, -0.05754138002994433
}};

static constexpr jdouble SH_Alm[(SH_LARGEST_L+2)*(SH_LARGEST_L+1)/2] = {
    0.0,
    0.0, 0.0,
    1.9364916731037085, 0.0, 0.0,
    1.9720265943665387, 2.091650066335189, 0.0, 0.0,
    1.984313483298443, 2.04939015319192, 2.29128784747792, 0.0, 0.0,
    1.98997487421324, 2.03100960115899, 2.1712405933672376, 2.48746859276655, 0.0, 0.0,
    1.9930434571835665, 2.0213149892370277, 2.1139418156609704, 2.301368353023109, 2.6739483914241875, 0.0, 0.0,
    1.9948914348241344, 2.0155644370746373, 2.0816659994661326, 2.207940216581962, 2.4308621740219887, 2.850438562747845, 0.0, 0.0,
    1.996089927833914, 2.011869540407391, 2.0615528128088303, 2.15322168769582, 2.3048861143232218, 2.557041559783794, 3.017804310611087, 0.0, 0.0,
    1.9969111950679366, 2.0093531297410117, 2.048122358357819, 2.1180441711898057, 2.229177150706235, 2.401636346922061, 2.679137506321349, 3.1770662567847086, 0.0, 0.0,
    1.997498435543818, 2.0075614636426526, 2.038688303787511, 2.0939473213563384, 2.179449471770337, 2.3065125189341593, 2.496873044429772, 2.7970572771691153, 3.3291640592396967, 0.0, 0.0,
    1.9979328159850827, 2.006240264773888, 2.031798495964875, 2.0766559657295187, 2.1447610589527217, 2.2430448056157952, 2.3837686425440854, 2.5900450446533423, 2.910959328215754, 3.4749100707788108, 0.0, 0.0,
    1.998263134713633, 2.0052378963551982, 2.026608708444444, 2.0637972912229676, 2.1194781197266463, 2.1981657747106436, 2.307395517477243, 2.460209661583209, 2.680951323690902, 3.021089890583219, 3.614994027406106, 0.0, 0.0,
    1.998520162579474, 2.004459314343183, 2.0225995873897262, 2.053959590644373, 2.100420126042015, 2.165063509461097, 2.252817784447915, 2.3717082451262845, 2.53546276418555, 2.7695585470349866, 3.1277162108561214, 3.75, 0.0, 0.0,
    1.9987240828047461, 2.0038424627162224, 2.019436802675439, 2.0462565272714635, 2.085665361461421, 2.1398475105532757, 2.212182180562894, 2.307927774486216, 2.435532422657966, 2.6093477445855915, 2.8559149146989657, 3.2310988842807022, 3.880424243261593, 0.0, 0.0,
    1.9988885800753267, 2.003345416333104, 2.0168969490698876, 2.040107114108727, 2.0739902137422357, 2.120141504711419, 2.1809662438042814, 2.260078437898682, 2.363017336304797, 2.4986107250941583, 2.6817904466978773, 2.9401072717216916, 3.331480966792211, 4.006690832666208, 0.0, 0.0,
    1.9990231989649345, 2.002939017015334, 2.014825999813336, 2.035116803738375, 2.064582282206258, 2.104417123236605, 2.1563858652847827, 2.2230674720995864, 2.3082731640774234, 2.4177911997760035, 2.5607991541103545, 2.7527763762750106, 3.0222389997200043, 3.4290845264669656, 4.129164564412516, 0.0, 0.0,
    1.999134760937227, 2.002602473449653, 2.013114894621608, 2.03100960115899, 2.0568833780186058, 2.091650066335189, 2.1366369348357592, 2.1937410968480306, 2.265686062395524, 2.356455943866682, 2.4720661623652207, 2.622022120425379, 2.822324793743504, 3.1024184114977142, 3.5241105031922135, 4.248161366991607, 0.0, 0.0,
    1.9992282461607314, 2.0023206350873464, 2.011684617428885, 2.0275875100994063, 2.050498830661811, 2.081130384894172, 2.120501774999912, 2.170043987823959, 2.231763704062155, 2.3085099321848035, 2.404423007708918, 2.5257296658248256, 2.6822461565718467, 2.8904737863674566, 3.1807526624998683, 3.616739979706598, 4.363956650455962, 0.0, 0.0,
    1.9993073592865873, 2.0020822493927, 2.0104767610501466, 2.024705365770985, 2.045142707894042, 2.0723520109148583, 2.1071307505705477, 2.1505813167606567, 2.2042200113840402, 2.27014788693852, 2.351326355949745, 2.452039967047846, 2.5787147157554005, 2.7414640249326636, 2.957271469692045, 3.2573446421352252, 3.7071359757712075, 4.476792006187765, 0.0, 0.0,
    1.9993749023132206, 2.0018788167600157, 2.0094473837049796, 2.0222546987202583, 2.0406034646643136, 2.064945519862449, 2.0959143930173156, 2.1343747458109497, 2.181496864867922, 2.2388700687965297, 2.3086792761230392, 2.393988887964797, 2.499218627891526, 2.630984211674012, 2.7996848562146504, 3.0227707252027662, 3.3322915038553673, 3.7954453500749294, 4.586880604965702, 0.0, 0.0
};
static constexpr jdouble SH_Blm[(SH_LARGEST_L+2)*(SH_LARGEST_L+1)/2] = {
    0.0,
    0.0, 0.0,
    -0.5773502691896257, 0.0, 0.0,
    -0.5163977794943222, -0.4472135954999579, 0.0, 0.0,
    -0.50709255283711, -0.47809144373375745, -0.3779644730092272, 0.0, 0.0,
    -0.5039526306789697, -0.4879500364742666, -0.4364357804719847, -0.3333333333333333, 0.0, 0.0,
    -0.502518907629606, -0.49236596391733095, -0.4605661864718383, -0.40201512610368484, -0.30151134457776363, 0.0, 0.0,
    -0.5017452060042545, -0.4947274449181537, -0.47304991679126607, -0.4345240946267408, -0.3739787960033829, -0.2773500981126146, 0.0, 0.0,
    -0.501280411827603, -0.4961389383568338, -0.4803844614152614, -0.4529108136578383, -0.41137667560372115, -0.35082320772281167, -0.2581988897471611, 0.0, 0.0,
    -0.5009794328681196, -0.4970501217477084, -0.48507125007266594, -0.464420364012824, -0.4338609156373123, -0.39107694443752145, -0.3313667478318056, -0.24253562503633297, 0.0, 0.0,
    -0.5007733956671915, -0.4976726017934395, -0.4882520792370033, -0.47213368521878024, -0.44859602103995444, -0.4163827722217815, -0.3732544513450796, -0.3147557901458535, -0.22941573387056177, 0.0, 0.0,
    -0.5006261743217588, -0.4981167541368988, -0.49051147158797265, -0.4775669329409193, -0.45883146774112354, -0.43355498476206, -0.4005009394574071, -0.3575185993374057, -0.3003757045930553, -0.21821789023599236, 0.0, 0.0,
    -0.5005173307126191, -0.49844478627922684, -0.4921747909480132, -0.4815434123430768, -0.4662524041201569, -0.44582257006028225, -0.4195037983773235, -0.38609367125267213, -0.34352936171490267, -0.2877772315344771, -0.20851441405707477, 0.0, 0.0,
    -0.5004345937369794, -0.4986939463979015, -0.49343516379516894, -0.48454371185234896, -0.4718142596956708, -0.4549247429401158, -0.4333890711087691, -0.4064694223485302, -0.3730019232961255, -0.33100637062042226, -0.27662562992324985, -0.2, 0.0, 0.0,
    -0.5003702332976756, -0.49888765156985887, -0.4944132324730442, -0.48686449556014766, -0.4760952285695233, -0.46188021535170065, -0.44388854123195953, -0.4216370213557839, -0.39440531887330776, -0.361068373539376, -0.3197221015541813, -0.26666666666666666, -0.19245008972987526, 0.0, 0.0,
    -0.5003191829243042, -0.49904122634695197, -0.4951875684721383, -0.4886972804594683, -0.47946330148538413, -0.46732301954611777, -0.4520423357472069, -0.433289122413121, -0.4105878413676265, -0.38323753592253257, -0.3501504876259268, -0.30949223029508643, -0.25770378116168946, -0.18569533817705186, 0.0, 0.0,
    -0.5002780094738025, -0.4991650425568579, -0.4958111521072805, -0.49017034109842594, -0.4821623522493073, -0.4716666306365782, -0.458512369387107, -0.4424625195441246, -0.42318775433267225, -0.40022240757904204, -0.3728852122772354, -0.34012364433710335, -0.3001668056842815, -0.24958252127842895, -0.1796053020267749, 0.0, 0.0,
    -0.5002443195845779, -0.4992663238894528, -0.49632077414756665, -0.4913722879016409, -0.4843594796964828, -0.47519096331149147, -0.4637388957601683, -0.44982890197909525, -0.43322428885910585, -0.41360064512297223, -0.39050309681448225, -0.36326960977236206, -0.33088051609837776, -0.2916230242449912, -0.2421797398482414, -0.17407765595569785, 0.0, 0.0,
    -0.5002164033860247, -0.4993502271458874, -0.496742636335202, -0.49236596391733095, -0.4861724348043977, -0.47809144373375745, -0.4680252333449758, -0.4558423058385518, -0.4413674147523748, -0.4243660920556449, -0.40451991747794525, -0.3813850356982369, -0.3543178312491844, -0.3223291856101521, -0.28375954701028216, -0.23539595453459988, -0.1690308509457033, 0.0, 0.0,
    -0.5001930129390556, -0.4994205136163806, -0.49709581280096005, -0.4931969619160719, -0.4876862083736199, -0.48050809658946525, -0.4715864951351156, -0.4608201518545086, -0.44807611046807744, -0.4331798560007005, -0.41590019592802907, -0.3959251908590268, -0.37282185960072, -0.3459640439281511, -0.3143909967567437, -0.2764920911127051, -0.2291498472826297, -0.1643989873053573, 0.0, 0.0,
    -0.5001732201680236, -0.49947997905846986, -0.49739445855502595, -0.493899022003733, -0.48896343328028025, -0.4825435035810065, -0.4745789978762495, -0.46499055497527714, -0.4536752206382952, -0.44049993648148694, -0.4252918772715756, -0.40782369514309286, -0.38779008546009835, -0.3647686020700426, -0.3381495443514812, -0.3069985248304855, -0.26975001902701096, -0.22337423731498202, -0.16012815380508713, 0.0, 0.0
};
static constexpr jdouble SQRT_LPM_LMM1[(SH_LARGEST_L+1)*(SH_LARGEST_L+1)] = {
    0.0,
    0.0, 1.4142135623730951, 1.4142135623730951,
    0.0, 2.0, 2.449489742783178, 2.449489742783178, 2.0,
    0.0, 2.449489742783178, 3.1622776601683795, 3.4641016151377544, 3.4641016151377544, 3.1622776601683795, 2.449489742783178,
    0.0, 2.8284271247461903, 3.7416573867739413, 4.242640687119285, 4.47213595499958, 4.47213595499958, 4.242640687119285, 3.7416573867739413, 2.8284271247461903,
    0.0, 3.1622776601683795, 4.242640687119285, 4.898979485566356, 5.291502622129181, 5.477225575051661, 5.477225575051661, 5.291502622129181, 4.898979485566356, 4.242640687119285, 3.1622776601683795,
    0.0, 3.4641016151377544, 4.69041575982343, 5.477225575051661, 6.0, 6.324555320336759, 6.48074069840786, 6.48074069840786, 6.324555320336759, 6.0, 5.477225575051661, 4.69041575982343, 3.4641016151377544,
    0.0, 3.7416573867739413, 5.0990195135927845, 6.0, 6.6332495807108, 7.0710678118654755, 7.3484692283495345, 7.483314773547883, 7.483314773547883, 7.3484692283495345, 7.0710678118654755, 6.6332495807108, 6.0, 5.0990195135927845, 3.7416573867739413,
    0.0, 4.0, 5.477225575051661, 6.48074069840786, 7.211102550927978, 7.745966692414834, 8.12403840463596, 8.366600265340756, 8.48528137423857, 8.48528137423857, 8.366600265340756, 8.12403840463596, 7.745966692414834, 7.211102550927978, 6.48074069840786, 5.477225575051661, 4.0,
    0.0, 4.242640687119285, 5.830951894845301, 6.928203230275509, 7.745966692414834, 8.366600265340756, 8.831760866327848, 9.16515138991168, 9.38083151964686, 9.486832980505138, 9.486832980505138, 9.38083151964686, 9.16515138991168, 8.831760866327848, 8.366600265340756, 7.745966692414834, 6.928203230275509, 5.830951894845301, 4.242640687119285,
    0.0, 4.47213595499958, 6.164414002968976, 7.3484692283495345, 8.246211251235321, 8.94427190999916, 9.486832980505138, 9.899494936611665, 10.198039027185569, 10.392304845413264, 10.488088481701515, 10.488088481701515, 10.392304845413264, 10.198039027185569, 9.899494936611665, 9.486832980505138, 8.94427190999916, 8.246211251235321, 7.3484692283495345, 6.164414002968976, 4.47213595499958,
    0.0, 4.69041575982343, 6.48074069840786, 7.745966692414834, 8.717797887081348, 9.486832980505138, 10.099504938362077, 10.583005244258363, 10.954451150103322, 11.224972160321824, 11.40175425099138, 11.489125293076057, 11.489125293076057, 11.40175425099138, 11.224972160321824, 10.954451150103322, 10.583005244258363, 10.099504938362077, 9.486832980505138, 8.717797887081348, 7.745966692414834, 6.48074069840786, 4.69041575982343,
    0.0, 4.898979485566356, 6.782329983125268, 8.12403840463596, 9.16515138991168, 10.0, 10.677078252031311, 11.224972160321824, 11.661903789690601, 12.0, 12.24744871391589, 12.409673645990857, 12.489995996796797, 12.489995996796797, 12.409673645990857, 12.24744871391589, 12.0, 11.661903789690601, 11.224972160321824, 10.677078252031311, 10.0, 9.16515138991168, 8.12403840463596, 6.782329983125268, 4.898979485566356,
    0.0, 5.0990195135927845, 7.0710678118654755, 8.48528137423857, 9.591663046625438, 10.488088481701515, 11.224972160321824, 11.832159566199232, 12.328828005937952, 12.727922061357855, 13.038404810405298, 13.2664991614216, 13.416407864998739, 13.490737563232042, 13.490737563232042, 13.416407864998739, 13.2664991614216, 13.038404810405298, 12.727922061357855, 12.328828005937952, 11.832159566199232, 11.224972160321824, 10.488088481701515, 9.591663046625438, 8.48528137423857, 7.0710678118654755, 5.0990195135927845,
    0.0, 5.291502622129181, 7.3484692283495345, 8.831760866327848, 10.0, 10.954451150103322, 11.74734012447073, 12.409673645990857, 12.96148139681572, 13.416407864998739, 13.784048752090222, 14.071247279470288, 14.2828568570857, 14.422205101855956, 14.491376746189438, 14.491376746189438, 14.422205101855956, 14.2828568570857, 14.071247279470288, 13.784048752090222, 13.416407864998739, 12.96148139681572, 12.409673645990857, 11.74734012447073, 10.954451150103322, 10.0, 8.831760866327848, 7.3484692283495345, 5.291502622129181,
    0.0, 5.477225575051661, 7.615773105863909, 9.16515138991168, 10.392304845413264, 11.40175425099138, 12.24744871391589, 12.96148139681572, 13.564659966250536, 14.071247279470288, 14.491376746189438, 14.832396974191326, 15.0996688705415, 15.297058540778355, 15.427248620541512, 15.491933384829668, 15.491933384829668, 15.427248620541512, 15.297058540778355, 15.0996688705415, 14.832396974191326, 14.491376746189438, 14.071247279470288, 13.564659966250536, 12.96148139681572, 12.24744871391589, 11.40175425099138, 10.392304845413264, 9.16515138991168, 7.615773105863909, 5.477225575051661,
    0.0, 5.656854249492381, 7.874007874011811, 9.486832980505138, 10.770329614269007, 11.832159566199232, 12.727922061357855, 13.490737563232042, 14.142135623730951, 14.696938456699069, 15.165750888103101, 15.556349186104045, 15.874507866387544, 16.1245154965971, 16.30950643030009, 16.431676725154983, 16.492422502470642, 16.492422502470642, 16.431676725154983, 16.30950643030009, 16.1245154965971, 15.874507866387544, 15.556349186104045, 15.165750888103101, 14.696938456699069, 14.142135623730951, 13.490737563232042, 12.727922061357855, 11.832159566199232, 10.770329614269007, 9.486832980505138, 7.874007874011811, 5.656854249492381,
    0.0, 5.830951894845301, 8.12403840463596, 9.797958971132712, 11.135528725660043, 12.24744871391589, 13.19090595827292, 14.0, 14.696938456699069, 15.297058540778355, 15.811388300841896, 16.24807680927192, 16.61324772583615, 16.911534525287763, 17.146428199482248, 17.320508075688775, 17.435595774162696, 17.4928556845359, 17.4928556845359, 17.435595774162696, 17.320508075688775, 17.146428199482248, 16.911534525287763, 16.61324772583615, 16.24807680927192, 15.811388300841896, 15.297058540778355, 14.696938456699069, 14.0, 13.19090595827292, 12.24744871391589, 11.135528725660043, 9.797958971132712, 8.12403840463596, 5.830951894845301,
    0.0, 6.0, 8.366600265340756, 10.099504938362077, 11.489125293076057, 12.649110640673518, 13.638181696985855, 14.491376746189438, 15.231546211727817, 15.874507866387544, 16.431676725154983, 16.911534525287763, 17.320508075688775, 17.663521732655695, 17.944358444926362, 18.16590212458495, 18.33030277982336, 18.439088914585774, 18.49324200890693, 18.49324200890693, 18.439088914585774, 18.33030277982336, 18.16590212458495, 17.944358444926362, 17.663521732655695, 17.320508075688775, 16.911534525287763, 16.431676725154983, 15.874507866387544, 15.231546211727817, 14.491376746189438, 13.638181696985855, 12.649110640673518, 11.489125293076057, 10.099504938362077, 8.366600265340756, 6.0,
    0.0, 6.164414002968976, 8.602325267042627, 10.392304845413264, 11.832159566199232, 13.038404810405298, 14.071247279470288, 14.966629547095765, 15.748015748023622, 16.431676725154983, 17.029386365926403, 17.549928774784245, 18.0, 18.384776310850235, 18.708286933869708, 18.973665961010276, 19.183326093250876, 19.339079605813716, 19.44222209522358, 19.493588689617926, 19.493588689617926, 19.44222209522358, 19.339079605813716, 19.183326093250876, 18.973665961010276, 18.708286933869708, 18.384776310850235, 18.0, 17.549928774784245, 17.029386365926403, 16.431676725154983, 15.748015748023622, 14.966629547095765, 14.071247279470288, 13.038404810405298, 11.832159566199232, 10.392304845413264, 8.602325267042627, 6.164414002968976,
    0.0, 6.324555320336759, 8.831760866327848, 10.677078252031311, 12.165525060596439, 13.416407864998739, 14.491376746189438, 15.427248620541512, 16.24807680927192, 16.97056274847714, 17.60681686165901, 18.16590212458495, 18.65475810617763, 19.078784028338912, 19.44222209522358, 19.748417658131498, 20.0, 20.199009876724155, 20.346989949375804, 20.445048300260872, 20.493901531919196, 20.493901531919196, 20.445048300260872, 20.346989949375804, 20.199009876724155, 20.0, 19.748417658131498, 19.44222209522358, 19.078784028338912, 18.65475810617763, 18.16590212458495, 17.60681686165901, 16.97056274847714, 16.24807680927192, 15.427248620541512, 14.491376746189438, 13.416407864998739, 12.165525060596439, 10.677078252031311, 8.831760866327848, 6.324555320336759
};
static constexpr jdouble SQRT_LPM1_LMM[(SH_LARGEST_L+1)*(SH_LARGEST_L+1)] = {
    0.0,
    1.4142135623730951, 1.4142135623730951, 0.0,
    2.0, 2.449489742783178, 2.449489742783178, 2.0, 0.0,
    2.449489742783178, 3.1622776601683795, 3.4641016151377544, 3.4641016151377544, 3.1622776601683795, 2.449489742783178, 0.0,
    2.8284271247461903, 3.7416573867739413, 4.242640687119285, 4.47213595499958, 4.47213595499958, 4.242640687119285, 3.7416573867739413, 2.8284271247461903, 0.0,
    3.1622776601683795, 4.242640687119285, 4.898979485566356, 5.291502622129181, 5.477225575051661, 5.477225575051661, 5.291502622129181, 4.898979485566356, 4.242640687119285, 3.1622776601683795, 0.0,
    3.4641016151377544, 4.69041575982343, 5.477225575051661, 6.0, 6.324555320336759, 6.48074069840786, 6.48074069840786, 6.324555320336759, 6.0, 5.477225575051661, 4.69041575982343, 3.4641016151377544, 0.0,
    3.7416573867739413, 5.0990195135927845, 6.0, 6.6332495807108, 7.0710678118654755, 7.3484692283495345, 7.483314773547883, 7.483314773547883, 7.3484692283495345, 7.0710678118654755, 6.6332495807108, 6.0, 5.0990195135927845, 3.7416573867739413, 0.0,
    4.0, 5.477225575051661, 6.48074069840786, 7.211102550927978, 7.745966692414834, 8.12403840463596, 8.366600265340756, 8.48528137423857, 8.48528137423857, 8.366600265340756, 8.12403840463596, 7.745966692414834, 7.211102550927978, 6.48074069840786, 5.477225575051661, 4.0, 0.0,
    4.242640687119285, 5.830951894845301, 6.928203230275509, 7.745966692414834, 8.366600265340756, 8.831760866327848, 9.16515138991168, 9.38083151964686, 9.486832980505138, 9.486832980505138, 9.38083151964686, 9.16515138991168, 8.831760866327848, 8.366600265340756, 7.745966692414834, 6.928203230275509, 5.830951894845301, 4.242640687119285, 0.0,
    4.47213595499958, 6.164414002968976, 7.3484692283495345, 8.246211251235321, 8.94427190999916, 9.486832980505138, 9.899494936611665, 10.198039027185569, 10.392304845413264, 10.488088481701515, 10.488088481701515, 10.392304845413264, 10.198039027185569, 9.899494936611665, 9.486832980505138, 8.94427190999916, 8.246211251235321, 7.3484692283495345, 6.164414002968976, 4.47213595499958, 0.0,
    4.69041575982343, 6.48074069840786, 7.745966692414834, 8.717797887081348, 9.486832980505138, 10.099504938362077, 10.583005244258363, 10.954451150103322, 11.224972160321824, 11.40175425099138, 11.489125293076057, 11.489125293076057, 11.40175425099138, 11.224972160321824, 10.954451150103322, 10.583005244258363, 10.099504938362077, 9.486832980505138, 8.717797887081348, 7.745966692414834, 6.48074069840786, 4.69041575982343, 0.0,
    4.898979485566356, 6.782329983125268, 8.12403840463596, 9.16515138991168, 10.0, 10.677078252031311, 11.224972160321824, 11.661903789690601, 12.0, 12.24744871391589, 12.409673645990857, 12.489995996796797, 12.489995996796797, 12.409673645990857, 12.24744871391589, 12.0, 11.661903789690601, 11.224972160321824, 10.677078252031311, 10.0, 9.16515138991168, 8.12403840463596, 6.782329983125268, 4.898979485566356, 0.0,
    5.0990195135927845, 7.0710678118654755, 8.48528137423857, 9.591663046625438, 10.488088481701515, 11.224972160321824, 11.832159566199232, 12.328828005937952, 12.727922061357855, 13.038404810405298, 13.2664991614216, 13.416407864998739, 13.490737563232042, 13.490737563232042, 13.416407864998739, 13.2664991614216, 13.038404810405298, 12.727922061357855, 12.328828005937952, 11.832159566199232, 11.224972160321824, 10.488088481701515, 9.591663046625438, 8.48528137423857, 7.0710678118654755, 5.0990195135927845, 0.0,
    5.291502622129181, 7.3484692283495345, 8.831760866327848, 10.0, 10.954451150103322, 11.74734012447073, 12.409673645990857, 12.96148139681572, 13.416407864998739, 13.784048752090222, 14.071247279470288, 14.2828568570857, 14.422205101855956, 14.491376746189438, 14.491376746189438, 14.422205101855956, 14.2828568570857, 14.071247279470288, 13.784048752090222, 13.416407864998739, 12.96148139681572, 12.409673645990857, 11.74734012447073, 10.954451150103322, 10.0, 8.831760866327848, 7.3484692283495345, 5.291502622129181, 0.0,
    5.477225575051661, 7.615773105863909, 9.16515138991168, 10.392304845413264, 11.40175425099138, 12.24744871391589, 12.96148139681572, 13.564659966250536, 14.071247279470288, 14.491376746189438, 14.832396974191326, 15.0996688705415, 15.297058540778355, 15.427248620541512, 15.491933384829668, 15.491933384829668, 15.427248620541512, 15.297058540778355, 15.0996688705415, 14.832396974191326, 14.491376746189438, 14.071247279470288, 13.564659966250536, 12.96148139681572, 12.24744871391589, 11.40175425099138, 10.392304845413264, 9.16515138991168, 7.615773105863909, 5.477225575051661, 0.0,
    5.656854249492381, 7.874007874011811, 9.486832980505138, 10.770329614269007, 11.832159566199232, 12.727922061357855, 13.490737563232042, 14.142135623730951, 14.696938456699069, 15.165750888103101, 15.556349186104045, 15.874507866387544, 16.1245154965971, 16.30950643030009, 16.431676725154983, 16.492422502470642, 16.492422502470642, 16.431676725154983, 16.30950643030009, 16.1245154965971, 15.874507866387544, 15.556349186104045, 15.165750888103101, 14.696938456699069, 14.142135623730951, 13.490737563232042, 12.727922061357855, 11.832159566199232, 10.770329614269007, 9.486832980505138, 7.874007874011811, 5.656854249492381, 0.0,
    5.830951894845301, 8.12403840463596, 9.797958971132712, 11.135528725660043, 12.24744871391589, 13.19090595827292, 14.0, 14.696938456699069, 15.297058540778355, 15.811388300841896, 16.24807680927192, 16.61324772583615, 16.911534525287763, 17.146428199482248, 17.320508075688775, 17.435595774162696, 17.4928556845359, 17.4928556845359, 17.435595774162696, 17.320508075688775, 17.146428199482248, 16.911534525287763, 16.61324772583615, 16.24807680927192, 15.811388300841896, 15.297058540778355, 14.696938456699069, 14.0, 13.19090595827292, 12.24744871391589, 11.135528725660043, 9.797958971132712, 8.12403840463596, 5.830951894845301, 0.0,
    6.0, 8.366600265340756, 10.099504938362077, 11.489125293076057, 12.649110640673518, 13.638181696985855, 14.491376746189438, 15.231546211727817, 15.874507866387544, 16.431676725154983, 16.911534525287763, 17.320508075688775, 17.663521732655695, 17.944358444926362, 18.16590212458495, 18.33030277982336, 18.439088914585774, 18.49324200890693, 18.49324200890693, 18.439088914585774, 18.33030277982336, 18.16590212458495, 17.944358444926362, 17.663521732655695, 17.320508075688775, 16.911534525287763, 16.431676725154983, 15.874507866387544, 15.231546211727817, 14.491376746189438, 13.638181696985855, 12.649110640673518, 11.489125293076057, 10.099504938362077, 8.366600265340756, 6.0, 0.0,
    6.164414002968976, 8.602325267042627, 10.392304845413264, 11.832159566199232, 13.038404810405298, 14.071247279470288, 14.966629547095765, 15.748015748023622, 16.431676725154983, 17.029386365926403, 17.549928774784245, 18.0, 18.384776310850235, 18.708286933869708, 18.973665961010276, 19.183326093250876, 19.339079605813716, 19.44222209522358, 19.493588689617926, 19.493588689617926, 19.44222209522358, 19.339079605813716, 19.183326093250876, 18.973665961010276, 18.708286933869708, 18.384776310850235, 18.0, 17.549928774784245, 17.029386365926403, 16.431676725154983, 15.748015748023622, 14.966629547095765, 14.071247279470288, 13.038404810405298, 11.832159566199232, 10.392304845413264, 8.602325267042627, 6.164414002968976, 0.0,
    6.324555320336759, 8.831760866327848, 10.677078252031311, 12.165525060596439, 13.416407864998739, 14.491376746189438, 15.427248620541512, 16.24807680927192, 16.97056274847714, 17.60681686165901, 18.16590212458495, 18.65475810617763, 19.078784028338912, 19.44222209522358, 19.748417658131498, 20.0, 20.199009876724155, 20.346989949375804, 20.445048300260872, 20.493901531919196, 20.493901531919196, 20.445048300260872, 20.346989949375804, 20.199009876724155, 20.0, 19.748417658131498, 19.44222209522358, 19.078784028338912, 18.65475810617763, 18.16590212458495, 17.60681686165901, 16.97056274847714, 16.24807680927192, 15.427248620541512, 14.491376746189438, 13.416407864998739, 12.165525060596439, 10.677078252031311, 8.831760866327848, 6.324555320336759, 0.0
};
static constexpr jdouble SQRT_2LM1P3[SH_LARGEST_L+1] = {
    1.0, 1.7320508075688772, 2.23606797749979, 2.6457513110645907, 3.0, 3.3166247903554, 3.605551275463989, 3.872983346207417, 4.123105625617661, 4.358898943540674, 4.58257569495584, 4.795831523312719,
    5.0, 5.196152422706632, 5.385164807134504, 5.5677643628300215, 5.744562646538029, 5.916079783099616, 6.082762530298219, 6.244997998398398, 6.4031242374328485
};
static constexpr jdouble SQRT_1P1D2L[SH_LARGEST_L+1] = {
    -1.0, 1.224744871391589, 1.118033988749895, 1.0801234497346435, 1.0606601717798212, 1.0488088481701516, 1.0408329997330663, 1.0350983390135313, 1.0307764064044151, 1.0274023338281628, 1.02469507659596,
    1.02247471629109, 1.0206207261596576, 1.0190493307301363, 1.0177004891982149, 1.0165300454651272, 1.015504800579495, 1.0145993123917847, 1.0137937550497031, 1.0130724502589556, 1.0124228365658292
};


template <jint M, jint L>
static inline void realNormalizedLegendreInterLoopSubSub_(jdouble aX, jdouble *rDest) noexcept {
    constexpr jdouble tSHAlm = SH_Alm[L*(L+1)/2 + M];
    constexpr jdouble tSHBlm = SH_Blm[L*(L+1)/2 + M];
    const jdouble tPlm = tSHAlm * (aX*rDest[(L-1)*(L-1)+(L-1) + M] + tSHBlm*rDest[(L-2)*(L-2)+(L-2) + M]);
    if (M == 0) {
        rDest[L*L+L] = tPlm;
    } else {
        rDest[L*L+L + M] = tPlm;
        rDest[L*L+L - M] = tPlm;
    }
}
template <jint L>
static inline void realNormalizedLegendreInterLoopSub_(jdouble aX, jdouble *rDest) noexcept {
    if (L-1==0) return;
    realNormalizedLegendreInterLoopSubSub_<0, L>(aX, rDest);
    if (L-1==1) return;
    realNormalizedLegendreInterLoopSubSub_<1, L>(aX, rDest);
    if (L-1==2) return;
    realNormalizedLegendreInterLoopSubSub_<2, L>(aX, rDest);
    if (L-1==3) return;
    realNormalizedLegendreInterLoopSubSub_<3, L>(aX, rDest);
    if (L-1==4) return;
    realNormalizedLegendreInterLoopSubSub_<4, L>(aX, rDest);
    if (L-1==5) return;
    realNormalizedLegendreInterLoopSubSub_<5, L>(aX, rDest);
    if (L-1==6) return;
    realNormalizedLegendreInterLoopSubSub_<6, L>(aX, rDest);
    if (L-1==7) return;
    realNormalizedLegendreInterLoopSubSub_<7, L>(aX, rDest);
    if (L-1==8) return;
    realNormalizedLegendreInterLoopSubSub_<8, L>(aX, rDest);
    if (L-1==9) return;
    realNormalizedLegendreInterLoopSubSub_<9, L>(aX, rDest);
    if (L-1==10) return;
    realNormalizedLegendreInterLoopSubSub_<10, L>(aX, rDest);
    if (L-1==11) return;
    realNormalizedLegendreInterLoopSubSub_<11, L>(aX, rDest);
    if (L-1==12) return;
    realNormalizedLegendreInterLoopSubSub_<12, L>(aX, rDest);
}
template <jint L>
static inline void realNormalizedLegendreInterLoop_(jdouble aX, jdouble aY, jdouble *rDest, jdouble &rPll) noexcept {
    realNormalizedLegendreInterLoopSub_<L>(aX, rDest);
    constexpr jdouble tMul1 = SQRT_2LM1P3[L];
    const jdouble tPlm = tMul1 * aX * rPll;
    rDest[L*L+L + (L-1)] = tPlm;
    rDest[L*L+L - (L-1)] = tPlm;
    constexpr jdouble tMul2 = -SQRT_1P1D2L[L];
    rPll *= tMul2 * aY;
    rDest[L*L+L + L] = rPll;
    rDest[L*L+L - L] = rPll;
}
template <jint LMAX>
static inline void realNormalizedLegendreFull(jdouble aX, jdouble aY, jdouble *rDest) noexcept {
    jdouble tPll = 0.28209479177387814347403972578039; // = sqrt(1/(4*PI))
    rDest[0] = tPll;
    if (LMAX == 0) return;
    rDest[2] = SQRT3 * aX * tPll;
    tPll *= (-SQRT3DIV2 * aY);
    rDest[2+1] = tPll;
    rDest[2-1] = tPll;
    if (LMAX == 1) return;
    realNormalizedLegendreInterLoop_<2>(aX, aY, rDest, tPll);
    if (LMAX == 2) return;
    realNormalizedLegendreInterLoop_<3>(aX, aY, rDest, tPll);
    if (LMAX == 3) return;
    realNormalizedLegendreInterLoop_<4>(aX, aY, rDest, tPll);
    if (LMAX == 4) return;
    realNormalizedLegendreInterLoop_<5>(aX, aY, rDest, tPll);
    if (LMAX == 5) return;
    realNormalizedLegendreInterLoop_<6>(aX, aY, rDest, tPll);
    if (LMAX == 6) return;
    realNormalizedLegendreInterLoop_<7>(aX, aY, rDest, tPll);
    if (LMAX == 7) return;
    realNormalizedLegendreInterLoop_<8>(aX, aY, rDest, tPll);
    if (LMAX == 8) return;
    realNormalizedLegendreInterLoop_<9>(aX, aY, rDest, tPll);
    if (LMAX == 9) return;
    realNormalizedLegendreInterLoop_<10>(aX, aY, rDest, tPll);
    if (LMAX == 10) return;
    realNormalizedLegendreInterLoop_<11>(aX, aY, rDest, tPll);
    if (LMAX == 11) return;
    realNormalizedLegendreInterLoop_<12>(aX, aY, rDest, tPll);
}

template <jint M, jint L>
static inline void realSphericalHarmonicsFull4InterLoopSubSub_(jdouble aSqrt2CosMPhi, jdouble aSqrt2SinMPhi, jdouble *rDest) noexcept {
    rDest[L*L+L + M] *= aSqrt2CosMPhi;
    rDest[L*L+L - M] *= aSqrt2SinMPhi;
}
template <jint M, jint LMAX>
static inline void realSphericalHarmonicsFull4InterLoopSub_(jdouble aSqrt2CosMPhi, jdouble aSqrt2SinMPhi, jdouble *rDest) noexcept {
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+0>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+0) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+1>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+1) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+2>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+2) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+3>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+3) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+4>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+4) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+5>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+5) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+6>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+6) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+7>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+7) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+8>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+8) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+9>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+9) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+10>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+10) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+11>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
    if (LMAX==M+11) return;
    realSphericalHarmonicsFull4InterLoopSubSub_<M, M+12>(aSqrt2CosMPhi, aSqrt2SinMPhi, rDest);
}
template <jint M, jint LMAX>
static inline void realSphericalHarmonicsFull4InterLoop_(jdouble aCosPhi2, jdouble &rSinMPhi, jdouble &rSinMmmPhi, jdouble &rCosMPhi, jdouble &rCosMmmPhi, jdouble *rDest) noexcept {
    const jdouble fSqrt2CosMPhi = SQRT2*rCosMPhi;
    const jdouble fSqrt2SinMPhi = SQRT2*rSinMPhi;
    realSphericalHarmonicsFull4InterLoopSub_<M, LMAX>(fSqrt2CosMPhi, fSqrt2SinMPhi, rDest);
    const jdouble tSinMppPhi = aCosPhi2 * rSinMPhi - rSinMmmPhi;
    const jdouble tCosMppPhi = aCosPhi2 * rCosMPhi - rCosMmmPhi;
    rSinMmmPhi = rSinMPhi; rCosMmmPhi = rCosMPhi;
    rSinMPhi = tSinMppPhi; rCosMPhi = tCosMppPhi;
}
template <jint LMAX>
static inline void realSphericalHarmonicsFull4(jdouble aX, jdouble aY, jdouble aZ, jdouble aDis, jdouble *rDest) noexcept {
    const jdouble tXY = hypot(aX, aY);
    const jdouble tCosTheta = aZ / aDis;
    const jdouble tSinTheta = tXY / aDis;
    jdouble tCosPhi;
    jdouble tSinPhi;
    // avoid nan
    if (JSE_NNAP::numericEqual(tXY, 0.0)) {
        tCosPhi = 1.0;
        tSinPhi = 0.0;
    } else {
        tCosPhi = aX / tXY;
        tSinPhi = aY / tXY;
    }
    // cal real Legendre
    realNormalizedLegendreFull<LMAX>(tCosTheta, tSinTheta, rDest);
    if (LMAX == 0) return;
    // cal sinMPhi & conMPhi
    jdouble rSinMmmPhi = 0.0;
    jdouble rCosMmmPhi = 1.0;
    jdouble rSinMPhi = tSinPhi;
    jdouble rCosMPhi = tCosPhi;
    const jdouble tCosPhi2 = rCosMPhi+rCosMPhi;
    realSphericalHarmonicsFull4InterLoop_<1, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 1) return;
    realSphericalHarmonicsFull4InterLoop_<2, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 2) return;
    realSphericalHarmonicsFull4InterLoop_<3, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 3) return;
    realSphericalHarmonicsFull4InterLoop_<4, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 4) return;
    realSphericalHarmonicsFull4InterLoop_<5, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 5) return;
    realSphericalHarmonicsFull4InterLoop_<6, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 6) return;
    realSphericalHarmonicsFull4InterLoop_<7, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 7) return;
    realSphericalHarmonicsFull4InterLoop_<8, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 8) return;
    realSphericalHarmonicsFull4InterLoop_<9, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 9) return;
    realSphericalHarmonicsFull4InterLoop_<10, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 10) return;
    realSphericalHarmonicsFull4InterLoop_<11, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
    if (LMAX == 11) return;
    realSphericalHarmonicsFull4InterLoop_<12, LMAX>(tCosPhi2, rSinMPhi, rSinMmmPhi, rCosMPhi, rCosMmmPhi, rDest);
}

template <jint L>
static inline void calYPphi(jdouble *rYPphi, jdouble *aY) noexcept {
    constexpr jint tStart = L*L;
    constexpr jint tIdx = tStart+L;
    for (jint m = -L; m <= L; ++m) {
        rYPphi[tIdx+m] = -m * aY[tIdx-m];
    }
}
template <jint L>
static inline void calYPtheta(jdouble aCosPhi, jdouble aSinPhi, jdouble *rYPtheta, jdouble *aY) noexcept {
    switch(L) {
    case 0: {
        rYPtheta[0] = 0.0;
        return;
    }
    case 1: {
        constexpr jdouble tMul = SQRT_LPM_LMM1[2]*SQRT2_INV;
        rYPtheta[1] = -tMul * aSinPhi*aY[2];
        rYPtheta[2] =  tMul * (aCosPhi*aY[3] + aSinPhi*aY[1]);
        rYPtheta[3] = -tMul * aCosPhi*aY[2];
        return;
    }
    default: {
        constexpr jint tStart = L*L;
        constexpr jint tIdx = tStart+L;
        constexpr jdouble tMul = SQRT_LPM_LMM1[tIdx]*SQRT2_INV;
        rYPtheta[tIdx] = tMul * (aCosPhi*aY[tIdx+1] + aSinPhi*aY[tIdx-1]);
        rYPtheta[tIdx+1] = -tMul * aCosPhi*aY[tIdx];
        rYPtheta[tIdx-1] = -tMul * aSinPhi*aY[tIdx];
        for (jint m = 2; m <= L; ++m) {
            const jdouble tMul2 = -0.5*SQRT_LPM_LMM1[tIdx+m];
            rYPtheta[tIdx+m] = tMul2 * (aCosPhi*aY[tIdx+m-1] - aSinPhi*aY[tIdx-m+1]);
            rYPtheta[tIdx-m] = tMul2 * (aCosPhi*aY[tIdx-m+1] + aSinPhi*aY[tIdx+m-1]);
        }
        for (jint m = 1; m < L; ++m) {
            const jdouble tMul2 = 0.5*SQRT_LPM1_LMM[tIdx+m];
            rYPtheta[tIdx+m] += tMul2 * (aCosPhi*aY[tIdx+m+1] + aSinPhi*aY[tIdx-m-1]);
            rYPtheta[tIdx-m] += tMul2 * (aCosPhi*aY[tIdx-m-1] - aSinPhi*aY[tIdx+m+1]);
        }
        return;
    }}
}
template <jint LMAX>
static void calYPphiPtheta(jdouble *rYPphi, jdouble aCosPhi, jdouble aSinPhi, jdouble *rYPtheta, jdouble *aY) noexcept {
    calYPphi<0>(rYPphi, aY); calYPtheta<0>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 0) return;
    calYPphi<1>(rYPphi, aY); calYPtheta<1>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 1) return;
    calYPphi<2>(rYPphi, aY); calYPtheta<2>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 2) return;
    calYPphi<3>(rYPphi, aY); calYPtheta<3>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 3) return;
    calYPphi<4>(rYPphi, aY); calYPtheta<4>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 4) return;
    calYPphi<5>(rYPphi, aY); calYPtheta<5>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 5) return;
    calYPphi<6>(rYPphi, aY); calYPtheta<6>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 6) return;
    calYPphi<7>(rYPphi, aY); calYPtheta<7>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 7) return;
    calYPphi<8>(rYPphi, aY); calYPtheta<8>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 8) return;
    calYPphi<9>(rYPphi, aY); calYPtheta<9>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 9) return;
    calYPphi<10>(rYPphi, aY); calYPtheta<10>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 10) return;
    calYPphi<11>(rYPphi, aY); calYPtheta<11>(aCosPhi, aSinPhi, rYPtheta, aY);
    if (LMAX == 11) return;
    calYPphi<12>(rYPphi, aY); calYPtheta<12>(aCosPhi, aSinPhi, rYPtheta, aY);
}
template <jint N>
static inline void convertYPPhiPtheta2YPxyz(jdouble aCosTheta, jdouble aSinTheta, jdouble aCosPhi, jdouble aSinPhi, jdouble aDis, jdouble aDxy, jboolean aDxyCloseZero,
                                            jdouble *rYPx, jdouble *rYPy, jdouble *rYPz, jdouble *aYPtheta, jdouble *aYPphi) noexcept {
    const jdouble thetaPx = -aCosTheta * aCosPhi / aDis;
    const jdouble thetaPy = -aCosTheta * aSinPhi / aDis;
    const jdouble thetaPz =  aSinTheta / aDis;
    const jdouble phiPx = aDxyCloseZero ? 0.0 :  aSinPhi / aDxy;
    const jdouble phiPy = aDxyCloseZero ? 0.0 : -aCosPhi / aDxy;
    for (jint i = 0; i < N; ++i) {
        const jdouble tYPtheta = aYPtheta[i];
        const jdouble tYPphi = aYPphi[i];
        rYPx[i] = tYPtheta*thetaPx + tYPphi*phiPx;
        rYPy[i] = tYPtheta*thetaPy + tYPphi*phiPy;
        rYPz[i] = tYPtheta*thetaPz;
    }
}
template <jint LMAX, jint LMALL>
static inline void calYPxyz(jdouble *aY, jdouble aDx, jdouble aDy, jdouble aDz, jdouble aDis,
                            jdouble *rYPx, jdouble *rYPy, jdouble *rYPz, jdouble *rYPtheta, jdouble *rYPphi) noexcept {
    const jdouble dxy = hypot(aDx, aDy);
    const jdouble cosTheta = aDz / aDis;
    const jdouble sinTheta = dxy / aDis;
    jdouble cosPhi;
    jdouble sinPhi;
    const jboolean dxyCloseZero = JSE_NNAP::numericEqual(dxy, 0.0);
    if (dxyCloseZero) {
        cosPhi = 1.0;
        sinPhi = 0.0;
    } else {
        cosPhi = aDx / dxy;
        sinPhi = aDy / dxy;
    }
    calYPphiPtheta<LMAX>(rYPphi, cosPhi, sinPhi, rYPtheta, aY);
    if (dxyCloseZero) {
        // fix singularity
        for (jint k = 0; k < LMALL; ++k) rYPphi[k] = 0.0;
    }
    // conert to Pxyz
    convertYPPhiPtheta2YPxyz<LMALL>(cosTheta, sinTheta, cosPhi, sinPhi, aDis, dxy, dxyCloseZero,
                                    rYPx, rYPy, rYPz, rYPtheta, rYPphi);
}



template <jint NMAX, jint LMALL, jboolean MPLUS, jboolean WT>
static inline void setormplusCnlm_(jdouble *rCnlm, jdouble *rCnlmWt, jdouble *aY, jdouble aFc, jdouble *aRn, jdouble aWt) noexcept {
    jdouble *tCnlm = rCnlm;
    jdouble *tCnlmWt = rCnlmWt;
    for (jint n = 0; n <= NMAX; ++n) {
        const jdouble tMul = aFc*aRn[n];
        for (jint k = 0; k < LMALL; ++k) {
            const jdouble tValue = tMul*aY[k];
            if (MPLUS) {
                tCnlm[k] += tValue;
                if (WT) tCnlmWt[k] += aWt*tValue;
            } else {
                tCnlm[k] = tValue;
                if (WT) tCnlmWt[k] = aWt*tValue;
            }
        }
        tCnlm += LMALL;
        if (WT) tCnlmWt += LMALL;
    }
}
template <jint LMALL, jboolean MPLUS, jboolean WT>
static inline void setormplusCnlm_(jdouble *rCnlm, jdouble *rCnlmWt, jdouble *aY, jdouble aFc, jdouble *aRn, jdouble aWt, jint aNMax) noexcept {
    switch (aNMax) {
    case 0: {setormplusCnlm_<0, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 1: {setormplusCnlm_<1, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 2: {setormplusCnlm_<2, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 3: {setormplusCnlm_<3, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 4: {setormplusCnlm_<4, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 5: {setormplusCnlm_<5, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 6: {setormplusCnlm_<6, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 7: {setormplusCnlm_<7, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 8: {setormplusCnlm_<8, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 9: {setormplusCnlm_<9, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 10: {setormplusCnlm_<10, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 11: {setormplusCnlm_<11, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 12: {setormplusCnlm_<12, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 13: {setormplusCnlm_<13, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 14: {setormplusCnlm_<14, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 15: {setormplusCnlm_<15, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 16: {setormplusCnlm_<16, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 17: {setormplusCnlm_<17, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 18: {setormplusCnlm_<18, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 19: {setormplusCnlm_<19, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    case 20: {setormplusCnlm_<20, LMALL, MPLUS, WT>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt); return;}
    default: {return;}
    }
}
template <jint LMALL>
static inline void calBnlm(jdouble *rBnlm, jdouble *aY, jdouble aFc, jdouble *aRn, jint aNMax) noexcept {
    setormplusCnlm_<LMALL, JNI_FALSE, JNI_FALSE>(rBnlm, NULL, aY, aFc, aRn, 0, aNMax);
}
template <jint LMALL>
static inline void mplusCnlm(jdouble *rCnlm, jdouble *aY, jdouble aFc, jdouble *aRn, jint aNMax) noexcept {
    setormplusCnlm_<LMALL, JNI_TRUE, JNI_FALSE>(rCnlm, NULL, aY, aFc, aRn, 0, aNMax);
}
template <jint LMALL>
static inline void mplusCnlmWt(jdouble *rCnlm, jdouble *rCnlmWt, jdouble *aY, jdouble aFc, jdouble *aRn, jdouble aWt, jint aNMax) noexcept {
    setormplusCnlm_<LMALL, JNI_TRUE, JNI_TRUE>(rCnlm, rCnlmWt, aY, aFc, aRn, aWt, aNMax);
}

template <jint N>
static inline void mplusBnlm2Cnlm(jdouble *rCnlm, jdouble *aBnlm, jdouble aWt) noexcept {
    for (jint i = 0; i < N; ++i) {
        rCnlm[i] += aWt*aBnlm[i];
    }
}
template <jint LMALL>
static inline void mplusBnlm2Cnlm(jdouble *rCnlm, jdouble *aBnlm, jdouble aWt, jint aNMax) noexcept {
    switch (aNMax) {
    case 0: {mplusBnlm2Cnlm<(0+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 1: {mplusBnlm2Cnlm<(1+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 2: {mplusBnlm2Cnlm<(2+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 3: {mplusBnlm2Cnlm<(3+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 4: {mplusBnlm2Cnlm<(4+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 5: {mplusBnlm2Cnlm<(5+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 6: {mplusBnlm2Cnlm<(6+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 7: {mplusBnlm2Cnlm<(7+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 8: {mplusBnlm2Cnlm<(8+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 9: {mplusBnlm2Cnlm<(9+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 10: {mplusBnlm2Cnlm<(10+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 11: {mplusBnlm2Cnlm<(11+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 12: {mplusBnlm2Cnlm<(12+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 13: {mplusBnlm2Cnlm<(13+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 14: {mplusBnlm2Cnlm<(14+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 15: {mplusBnlm2Cnlm<(15+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 16: {mplusBnlm2Cnlm<(16+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 17: {mplusBnlm2Cnlm<(17+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 18: {mplusBnlm2Cnlm<(18+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 19: {mplusBnlm2Cnlm<(19+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    case 20: {mplusBnlm2Cnlm<(20+1)*LMALL>(rCnlm, aBnlm, aWt); return;}
    default: {return;}
    }
}

template <jint LMALL>
static inline jdouble dotBnlmGradCnlm(jdouble *aBnlm, jdouble *aGradCnlm, jint aNMax) noexcept {
    switch (aNMax) {
    case 0: {return JSE_NNAP::dot<(0+1)*LMALL>(aBnlm, aGradCnlm);}
    case 1: {return JSE_NNAP::dot<(1+1)*LMALL>(aBnlm, aGradCnlm);}
    case 2: {return JSE_NNAP::dot<(2+1)*LMALL>(aBnlm, aGradCnlm);}
    case 3: {return JSE_NNAP::dot<(3+1)*LMALL>(aBnlm, aGradCnlm);}
    case 4: {return JSE_NNAP::dot<(4+1)*LMALL>(aBnlm, aGradCnlm);}
    case 5: {return JSE_NNAP::dot<(5+1)*LMALL>(aBnlm, aGradCnlm);}
    case 6: {return JSE_NNAP::dot<(6+1)*LMALL>(aBnlm, aGradCnlm);}
    case 7: {return JSE_NNAP::dot<(7+1)*LMALL>(aBnlm, aGradCnlm);}
    case 8: {return JSE_NNAP::dot<(8+1)*LMALL>(aBnlm, aGradCnlm);}
    case 9: {return JSE_NNAP::dot<(9+1)*LMALL>(aBnlm, aGradCnlm);}
    case 10: {return JSE_NNAP::dot<(10+1)*LMALL>(aBnlm, aGradCnlm);}
    case 11: {return JSE_NNAP::dot<(11+1)*LMALL>(aBnlm, aGradCnlm);}
    case 12: {return JSE_NNAP::dot<(12+1)*LMALL>(aBnlm, aGradCnlm);}
    case 13: {return JSE_NNAP::dot<(13+1)*LMALL>(aBnlm, aGradCnlm);}
    case 14: {return JSE_NNAP::dot<(14+1)*LMALL>(aBnlm, aGradCnlm);}
    case 15: {return JSE_NNAP::dot<(15+1)*LMALL>(aBnlm, aGradCnlm);}
    case 16: {return JSE_NNAP::dot<(16+1)*LMALL>(aBnlm, aGradCnlm);}
    case 17: {return JSE_NNAP::dot<(17+1)*LMALL>(aBnlm, aGradCnlm);}
    case 18: {return JSE_NNAP::dot<(18+1)*LMALL>(aBnlm, aGradCnlm);}
    case 19: {return JSE_NNAP::dot<(19+1)*LMALL>(aBnlm, aGradCnlm);}
    case 20: {return JSE_NNAP::dot<(20+1)*LMALL>(aBnlm, aGradCnlm);}
    default: {return 0.0;}
    }
}

template <jint LMALL, jboolean WT>
static inline void gradCnlm2Fxyz_(jint j, jdouble *aGradCnlm, jdouble *aGradCnlmWt, jdouble *rGradY,
                                  jdouble *aY, jdouble aFc, jdouble *aRn, jdouble aWt, jint aNMax,
                                  jdouble aFcPx, jdouble aFcPy, jdouble aFcPz,
                                  jdouble *aRnPx, jdouble *aRnPy, jdouble *aRnPz,
                                  jdouble *aYPx, jdouble *aYPy, jdouble *aYPz,
                                  jdouble *rFx, jdouble *rFy, jdouble *rFz) noexcept {
    // clear gradY here
    for (jint k = 0; k < LMALL; ++k) {
        rGradY[k] = 0.0;
    }
    jdouble tGradFc = 0.0;
    jdouble rFxj = 0.0, rFyj = 0.0, rFzj = 0.0;
    jdouble *tGradCnlm = aGradCnlm;
    jdouble *tGradCnlmWt = aGradCnlmWt;
    for (jint n = 0; n <= aNMax; ++n) {
        const jdouble tRnn = aRn[n];
        const jdouble tMul = aFc * tRnn;
        jdouble tGradRn = 0.0;
        for (jint k = 0; k < LMALL; ++k) {
            jdouble subGradBnlm = tGradCnlm[k];
            if (WT) subGradBnlm += aWt*tGradCnlmWt[k];
            rGradY[k] += tMul * subGradBnlm;
            tGradRn += aY[k] * subGradBnlm;
        }
        tGradCnlm += LMALL;
        if (WT) tGradCnlmWt += LMALL;
        
        tGradFc += tRnn * tGradRn;
        tGradRn *= aFc;
        rFxj += tGradRn*aRnPx[n];
        rFyj += tGradRn*aRnPy[n];
        rFzj += tGradRn*aRnPz[n];
    }
    for (jint k = 0; k < LMALL; ++k) {
        const jdouble subGradY = rGradY[k];
        rFxj += subGradY*aYPx[k];
        rFyj += subGradY*aYPy[k];
        rFzj += subGradY*aYPz[k];
    }
    rFxj += aFcPx*tGradFc;
    rFyj += aFcPy*tGradFc;
    rFzj += aFcPz*tGradFc;
    rFx[j] += rFxj; rFy[j] += rFyj; rFz[j] += rFzj;
}
template <jint LMALL>
static inline void gradBnlm2Fxyz(jint j, jdouble *aGradBnlm, jdouble *rGradY, jdouble *aY, jdouble aFc, jdouble *aRn, jint aNMax, jdouble aFcPx, jdouble aFcPy, jdouble aFcPz,
                                 jdouble *aRnPx, jdouble *aRnPy, jdouble *aRnPz, jdouble *aYPx, jdouble *aYPy, jdouble *aYPz, jdouble *rFx, jdouble *rFy, jdouble *rFz) noexcept {
    gradCnlm2Fxyz_<LMALL, JNI_FALSE>(j, aGradBnlm, NULL, rGradY, aY, aFc, aRn, 0, aNMax, aFcPx, aFcPy, aFcPz, aRnPx, aRnPy, aRnPz, aYPx, aYPy, aYPz, rFx, rFy, rFz);
}
template <jint LMALL>
static inline void gradCnlmWt2Fxyz(jint j, jdouble *aGradCnlm, jdouble *aGradCnlmWt, jdouble *rGradY, jdouble *aY, jdouble aFc, jdouble *aRn, jdouble aWt, jint aNMax, jdouble aFcPx, jdouble aFcPy, jdouble aFcPz,
                                   jdouble *aRnPx, jdouble *aRnPy, jdouble *aRnPz, jdouble *aYPx, jdouble *aYPy, jdouble *aYPz, jdouble *rFx, jdouble *rFy, jdouble *rFz) noexcept {
    gradCnlm2Fxyz_<LMALL, JNI_TRUE>(j, aGradCnlm, aGradCnlmWt, rGradY, aY, aFc, aRn, aWt, aNMax, aFcPx, aFcPy, aFcPz, aRnPx, aRnPy, aRnPz, aYPx, aYPy, aYPz, rFx, rFy, rFz);
}

template <jint LMALL, jboolean MPLUS, jboolean WT>
static inline void setormplusGradNNGradCnlm_(jdouble *rGradNNGradCnlm, jdouble *rGradNNGradCnlmWt, jdouble *aY, jdouble aFc, jdouble *aRn, jdouble aWt, jint aNMax,
                                             jdouble *aYPx, jdouble *aYPy, jdouble *aYPz, jdouble *rGradNNGradY,
                                             jdouble aFcPx, jdouble aFcPy, jdouble aFcPz, jdouble *aRnPx, jdouble *aRnPy, jdouble *aRnPz,
                                             jdouble aGradFx, jdouble aGradFy, jdouble aGradFz) noexcept {
    for (jint k = 0; k < LMALL; ++k) {
        rGradNNGradY[k] = aYPx[k]*aGradFx + aYPy[k]*aGradFy + aYPz[k]*aGradFz;
    }
    const jdouble tGradNNGradFc = aFcPx*aGradFx + aFcPy*aGradFy + aFcPz*aGradFz;
    jdouble *tGradNNGradCnlm = rGradNNGradCnlm;
    jdouble *tGradNNGradCnlmWt = rGradNNGradCnlmWt;
    for (jint n = 0; n <= aNMax; ++n) {
        jdouble tGradNNGradRn = aRnPx[n]*aGradFx + aRnPy[n]*aGradFy + aRnPz[n]*aGradFz;
        jdouble tRnn = aRn[n];
        tGradNNGradRn = tRnn*tGradNNGradFc + aFc*tGradNNGradRn;
        tRnn *= aFc;
        for (jint k = 0; k < LMALL; ++k) {
            const jdouble tValue = aY[k]*tGradNNGradRn + tRnn*rGradNNGradY[k];
            if (MPLUS) {
                tGradNNGradCnlm[k] += tValue;
                if (WT) tGradNNGradCnlmWt[k] += aWt*tValue;
            } else {
                tGradNNGradCnlm[k] = tValue;
                if (WT) tGradNNGradCnlmWt[k] = aWt*tValue;
            }
        }
        tGradNNGradCnlm += LMALL;
        if (WT) tGradNNGradCnlmWt += LMALL;
    }
}
template <jint LMALL>
static inline void calGradNNGradBnlm(jdouble *rGradNNGradBnlm, jdouble *aY, jdouble aFc, jdouble *aRn, jint aNMax, jdouble *aYPx, jdouble *aYPy, jdouble *aYPz, jdouble *rGradNNGradY,
                                     jdouble aFcPx, jdouble aFcPy, jdouble aFcPz, jdouble *aRnPx, jdouble *aRnPy, jdouble *aRnPz, jdouble aGradFx, jdouble aGradFy, jdouble aGradFz) noexcept {
    setormplusGradNNGradCnlm_<LMALL, JNI_FALSE, JNI_FALSE>(rGradNNGradBnlm, NULL, aY, aFc, aRn, 0, aNMax, aYPx, aYPy, aYPz, rGradNNGradY, aFcPx, aFcPy, aFcPz, aRnPx, aRnPy, aRnPz, aGradFx, aGradFy, aGradFz);
}
template <jint LMALL>
static inline void mplusGradNNGradCnlm(jdouble *rGradNNGradCnlm, jdouble *aY, jdouble aFc, jdouble *aRn, jint aNMax, jdouble *aYPx, jdouble *aYPy, jdouble *aYPz, jdouble *rGradNNGradY,
                                       jdouble aFcPx, jdouble aFcPy, jdouble aFcPz, jdouble *aRnPx, jdouble *aRnPy, jdouble *aRnPz, jdouble aGradFx, jdouble aGradFy, jdouble aGradFz) noexcept {
    setormplusGradNNGradCnlm_<LMALL, JNI_TRUE, JNI_FALSE>(rGradNNGradCnlm, NULL, aY, aFc, aRn, 0, aNMax, aYPx, aYPy, aYPz, rGradNNGradY, aFcPx, aFcPy, aFcPz, aRnPx, aRnPy, aRnPz, aGradFx, aGradFy, aGradFz);
}
template <jint LMALL>
static inline void mplusGradNNGradCnlmWt(jdouble *rGradNNGradCnlm, jdouble *rGradNNGradCnlmWt, jdouble *aY, jdouble aFc, jdouble *aRn, jdouble aWt, jint aNMax, jdouble *aYPx, jdouble *aYPy, jdouble *aYPz, jdouble *rGradNNGradY,
                                         jdouble aFcPx, jdouble aFcPy, jdouble aFcPz, jdouble *aRnPx, jdouble *aRnPy, jdouble *aRnPz, jdouble aGradFx, jdouble aGradFy, jdouble aGradFz) noexcept {
    setormplusGradNNGradCnlm_<LMALL, JNI_TRUE, JNI_TRUE>(rGradNNGradCnlm, rGradNNGradCnlmWt, aY, aFc, aRn, aWt, aNMax, aYPx, aYPy, aYPz, rGradNNGradY, aFcPx, aFcPy, aFcPz, aRnPx, aRnPy, aRnPz, aGradFx, aGradFy, aGradFz);
}



template <jint L>
static inline void calL2Sub_(jdouble *aCnlm, jdouble *rFp) noexcept {
    constexpr jint tLen = L+L+1;
    const jdouble rDot = JSE_NNAP::dot<tLen>(aCnlm + (L*L));
    rFp[L-1] = (PI4/(jdouble)tLen) * rDot;
}
template <jint LMAX, jboolean NO_RADIAL>
static void calL2_(jdouble *aCnlm, jdouble *rFp) noexcept {
    // l == 0
    jdouble *tFp = rFp;
    if (!NO_RADIAL) {
        const jdouble tCnl0 = aCnlm[0];
        tFp[0] = PI4 * (tCnl0*tCnl0);
        ++tFp;
    }
    if (LMAX == 0) return;
    calL2Sub_<1>(aCnlm, tFp);
    if (LMAX == 1) return;
    calL2Sub_<2>(aCnlm, tFp);
    if (LMAX == 2) return;
    calL2Sub_<3>(aCnlm, tFp);
    if (LMAX == 3) return;
    calL2Sub_<4>(aCnlm, tFp);
    if (LMAX == 4) return;
    calL2Sub_<5>(aCnlm, tFp);
    if (LMAX == 5) return;
    calL2Sub_<6>(aCnlm, tFp);
    if (LMAX == 6) return;
    calL2Sub_<7>(aCnlm, tFp);
    if (LMAX == 7) return;
    calL2Sub_<8>(aCnlm, tFp);
    if (LMAX == 8) return;
    calL2Sub_<9>(aCnlm, tFp);
    if (LMAX == 9) return;
    calL2Sub_<10>(aCnlm, tFp);
    if (LMAX == 10) return;
    calL2Sub_<11>(aCnlm, tFp);
    if (LMAX == 11) return;
    calL2Sub_<12>(aCnlm, tFp);
}
template <jint L3IDX, jint SUBIDX>
static inline jdouble calL3SubSub_(jdouble *aCnlm) noexcept {
    constexpr jint i1 = L3_INDEX[L3IDX][SUBIDX][0];
    constexpr jint i2 = L3_INDEX[L3IDX][SUBIDX][1];
    constexpr jint i3 = L3_INDEX[L3IDX][SUBIDX][2];
    constexpr jdouble coeff = L3_COEFF[L3IDX][SUBIDX];
    return coeff * aCnlm[i1]*aCnlm[i2]*aCnlm[i3];
}
template <jint L3IDX>
static jdouble calL3Sub_(jdouble *aCnlm) noexcept {
    jdouble rFp3 = 0.0;
    constexpr jint tSize = L3_SIZE[L3IDX];
    if (tSize==0) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 0>(aCnlm);
    if (tSize==1) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 1>(aCnlm);
    if (tSize==2) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 2>(aCnlm);
    if (tSize==3) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 3>(aCnlm);
    if (tSize==4) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 4>(aCnlm);
    if (tSize==5) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 5>(aCnlm);
    if (tSize==6) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 6>(aCnlm);
    if (tSize==7) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 7>(aCnlm);
    if (tSize==8) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 8>(aCnlm);
    if (tSize==9) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 9>(aCnlm);
    if (tSize==10) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 10>(aCnlm);
    if (tSize==11) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 11>(aCnlm);
    if (tSize==12) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 12>(aCnlm);
    if (tSize==13) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 13>(aCnlm);
    if (tSize==14) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 14>(aCnlm);
    if (tSize==15) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 15>(aCnlm);
    if (tSize==16) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 16>(aCnlm);
    if (tSize==17) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 17>(aCnlm);
    if (tSize==18) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 18>(aCnlm);
    if (tSize==19) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 19>(aCnlm);
    if (tSize==20) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 20>(aCnlm);
    if (tSize==21) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 21>(aCnlm);
    if (tSize==22) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 22>(aCnlm);
    if (tSize==23) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 23>(aCnlm);
    if (tSize==24) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 24>(aCnlm);
    if (tSize==25) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 25>(aCnlm);
    if (tSize==26) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 26>(aCnlm);
    if (tSize==27) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 27>(aCnlm);
    if (tSize==28) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 28>(aCnlm);
    if (tSize==29) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 29>(aCnlm);
    if (tSize==30) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 30>(aCnlm);
    if (tSize==31) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 31>(aCnlm);
    if (tSize==32) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 32>(aCnlm);
    if (tSize==33) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 33>(aCnlm);
    if (tSize==34) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 34>(aCnlm);
    if (tSize==35) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 35>(aCnlm);
    if (tSize==36) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 36>(aCnlm);
    if (tSize==37) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 37>(aCnlm);
    if (tSize==38) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 38>(aCnlm);
    if (tSize==39) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 39>(aCnlm);
    if (tSize==40) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 40>(aCnlm);
    if (tSize==41) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 41>(aCnlm);
    if (tSize==42) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 42>(aCnlm);
    if (tSize==43) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 43>(aCnlm);
    if (tSize==44) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 44>(aCnlm);
    if (tSize==45) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 45>(aCnlm);
    if (tSize==46) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 46>(aCnlm);
    if (tSize==47) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 47>(aCnlm);
    if (tSize==48) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 48>(aCnlm);
    if (tSize==49) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 49>(aCnlm);
    if (tSize==50) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 50>(aCnlm);
    if (tSize==51) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 51>(aCnlm);
    if (tSize==52) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 52>(aCnlm);
    if (tSize==53) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 53>(aCnlm);
    if (tSize==54) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 54>(aCnlm);
    if (tSize==55) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 55>(aCnlm);
    if (tSize==56) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 56>(aCnlm);
    if (tSize==57) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 57>(aCnlm);
    if (tSize==58) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 58>(aCnlm);
    if (tSize==59) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 59>(aCnlm);
    if (tSize==60) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 60>(aCnlm);
    if (tSize==61) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 61>(aCnlm);
    if (tSize==62) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 62>(aCnlm);
    if (tSize==63) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 63>(aCnlm);
    if (tSize==64) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 64>(aCnlm);
    if (tSize==65) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 65>(aCnlm);
    if (tSize==66) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 66>(aCnlm);
    if (tSize==67) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 67>(aCnlm);
    if (tSize==68) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 68>(aCnlm);
    if (tSize==69) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 69>(aCnlm);
    if (tSize==70) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 70>(aCnlm);
    if (tSize==71) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 71>(aCnlm);
    if (tSize==72) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 72>(aCnlm);
    if (tSize==73) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 73>(aCnlm);
    if (tSize==74) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 74>(aCnlm);
    if (tSize==75) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 75>(aCnlm);
    if (tSize==76) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 76>(aCnlm);
    if (tSize==77) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 77>(aCnlm);
    if (tSize==78) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 78>(aCnlm);
    if (tSize==79) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 79>(aCnlm);
    if (tSize==80) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 80>(aCnlm);
    if (tSize==81) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 81>(aCnlm);
    if (tSize==82) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 82>(aCnlm);
    if (tSize==83) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 83>(aCnlm);
    if (tSize==84) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 84>(aCnlm);
    if (tSize==85) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 85>(aCnlm);
    if (tSize==86) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 86>(aCnlm);
    if (tSize==87) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 87>(aCnlm);
    if (tSize==88) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 88>(aCnlm);
    if (tSize==89) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 89>(aCnlm);
    if (tSize==90) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 90>(aCnlm);
    if (tSize==91) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 91>(aCnlm);
    if (tSize==92) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 92>(aCnlm);
    if (tSize==93) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 93>(aCnlm);
    if (tSize==94) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 94>(aCnlm);
    if (tSize==95) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 95>(aCnlm);
    if (tSize==96) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 96>(aCnlm);
    if (tSize==97) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 97>(aCnlm);
    if (tSize==98) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 98>(aCnlm);
    if (tSize==99) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 99>(aCnlm);
    if (tSize==100) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 100>(aCnlm);
    if (tSize==101) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 101>(aCnlm);
    if (tSize==102) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 102>(aCnlm);
    if (tSize==103) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 103>(aCnlm);
    if (tSize==104) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 104>(aCnlm);
    if (tSize==105) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 105>(aCnlm);
    if (tSize==106) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 106>(aCnlm);
    if (tSize==107) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 107>(aCnlm);
    if (tSize==108) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 108>(aCnlm);
    if (tSize==109) {return rFp3;} rFp3 += calL3SubSub_<L3IDX, 109>(aCnlm);
    return rFp3;
}
template <jint L3MAX, jboolean L3CROSS>
static void calL3_(jdouble *aCnlm, jdouble *rFp) noexcept {
    if (L3MAX <= 1) return;
    *rFp = calL3Sub_<0>(aCnlm); ++rFp;
    if (L3CROSS) {
        *rFp = calL3Sub_<1>(aCnlm); ++rFp;
    }
    if (L3MAX == 2) return;
    if (L3CROSS) {
        *rFp = calL3Sub_<2>(aCnlm); ++rFp;
        *rFp = calL3Sub_<3>(aCnlm); ++rFp;
    }
    if (L3MAX == 3) return;
    *rFp = calL3Sub_<4>(aCnlm); ++rFp;
    if (L3CROSS) {
        *rFp = calL3Sub_<5>(aCnlm); ++rFp;
        *rFp = calL3Sub_<6>(aCnlm); ++rFp;
        *rFp = calL3Sub_<7>(aCnlm); ++rFp;
        *rFp = calL3Sub_<8>(aCnlm); ++rFp;
    }
    if (L3MAX == 4) return;
    if (L3CROSS) {
        *rFp = calL3Sub_<9>(aCnlm); ++rFp;
        *rFp = calL3Sub_<10>(aCnlm); ++rFp;
        *rFp = calL3Sub_<11>(aCnlm); ++rFp;
        *rFp = calL3Sub_<12>(aCnlm); ++rFp;
        *rFp = calL3Sub_<13>(aCnlm); ++rFp;
    }
    if (L3MAX == 5) return;
    *rFp = calL3Sub_<14>(aCnlm); ++rFp;
    if (L3CROSS) {
        *rFp = calL3Sub_<15>(aCnlm); ++rFp;
        *rFp = calL3Sub_<16>(aCnlm); ++rFp;
        *rFp = calL3Sub_<17>(aCnlm); ++rFp;
        *rFp = calL3Sub_<18>(aCnlm); ++rFp;
        *rFp = calL3Sub_<19>(aCnlm); ++rFp;
        *rFp = calL3Sub_<20>(aCnlm); ++rFp;
        *rFp = calL3Sub_<21>(aCnlm); ++rFp;
        *rFp = calL3Sub_<22>(aCnlm); ++rFp;
    }
}
template <jint L4IDX, jint SUBIDX>
static inline jdouble calL4SubSub_(jdouble *aCnlm) noexcept {
    constexpr jint i1 = L4_INDEX[L4IDX][SUBIDX][0];
    constexpr jint i2 = L4_INDEX[L4IDX][SUBIDX][1];
    constexpr jint i3 = L4_INDEX[L4IDX][SUBIDX][2];
    constexpr jint i4 = L4_INDEX[L4IDX][SUBIDX][3];
    constexpr jdouble coeff = L4_COEFF[L4IDX][SUBIDX];
    return coeff * aCnlm[i1]*aCnlm[i2]*aCnlm[i3]*aCnlm[i4];
}
template <jint L4IDX>
static jdouble calL4Sub_(jdouble *aCnlm) noexcept {
    jdouble rFp4 = 0.0;
    constexpr jint tSize = L4_SIZE[L4IDX];
    if (tSize==0) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 0>(aCnlm);
    if (tSize==1) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 1>(aCnlm);
    if (tSize==2) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 2>(aCnlm);
    if (tSize==3) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 3>(aCnlm);
    if (tSize==4) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 4>(aCnlm);
    if (tSize==5) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 5>(aCnlm);
    if (tSize==6) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 6>(aCnlm);
    if (tSize==7) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 7>(aCnlm);
    if (tSize==8) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 8>(aCnlm);
    if (tSize==9) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 9>(aCnlm);
    if (tSize==10) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 10>(aCnlm);
    if (tSize==11) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 11>(aCnlm);
    if (tSize==12) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 12>(aCnlm);
    if (tSize==13) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 13>(aCnlm);
    if (tSize==14) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 14>(aCnlm);
    if (tSize==15) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 15>(aCnlm);
    if (tSize==16) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 16>(aCnlm);
    if (tSize==17) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 17>(aCnlm);
    if (tSize==18) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 18>(aCnlm);
    if (tSize==19) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 19>(aCnlm);
    if (tSize==20) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 20>(aCnlm);
    if (tSize==21) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 21>(aCnlm);
    if (tSize==22) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 22>(aCnlm);
    if (tSize==23) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 23>(aCnlm);
    if (tSize==24) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 24>(aCnlm);
    if (tSize==25) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 25>(aCnlm);
    if (tSize==26) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 26>(aCnlm);
    if (tSize==27) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 27>(aCnlm);
    if (tSize==28) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 28>(aCnlm);
    if (tSize==29) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 29>(aCnlm);
    if (tSize==30) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 30>(aCnlm);
    if (tSize==31) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 31>(aCnlm);
    if (tSize==32) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 32>(aCnlm);
    if (tSize==33) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 33>(aCnlm);
    if (tSize==34) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 34>(aCnlm);
    if (tSize==35) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 35>(aCnlm);
    if (tSize==36) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 36>(aCnlm);
    if (tSize==37) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 37>(aCnlm);
    if (tSize==38) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 38>(aCnlm);
    if (tSize==39) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 39>(aCnlm);
    if (tSize==40) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 40>(aCnlm);
    if (tSize==41) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 41>(aCnlm);
    if (tSize==42) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 42>(aCnlm);
    if (tSize==43) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 43>(aCnlm);
    if (tSize==44) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 44>(aCnlm);
    if (tSize==45) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 45>(aCnlm);
    if (tSize==46) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 46>(aCnlm);
    if (tSize==47) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 47>(aCnlm);
    if (tSize==48) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 48>(aCnlm);
    if (tSize==49) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 49>(aCnlm);
    if (tSize==50) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 50>(aCnlm);
    if (tSize==51) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 51>(aCnlm);
    if (tSize==52) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 52>(aCnlm);
    if (tSize==53) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 53>(aCnlm);
    if (tSize==54) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 54>(aCnlm);
    if (tSize==55) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 55>(aCnlm);
    if (tSize==56) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 56>(aCnlm);
    if (tSize==57) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 57>(aCnlm);
    if (tSize==58) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 58>(aCnlm);
    if (tSize==59) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 59>(aCnlm);
    if (tSize==60) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 60>(aCnlm);
    if (tSize==61) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 61>(aCnlm);
    if (tSize==62) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 62>(aCnlm);
    if (tSize==63) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 63>(aCnlm);
    if (tSize==64) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 64>(aCnlm);
    if (tSize==65) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 65>(aCnlm);
    if (tSize==66) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 66>(aCnlm);
    if (tSize==67) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 67>(aCnlm);
    if (tSize==68) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 68>(aCnlm);
    if (tSize==69) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 69>(aCnlm);
    if (tSize==70) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 70>(aCnlm);
    if (tSize==71) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 71>(aCnlm);
    if (tSize==72) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 72>(aCnlm);
    if (tSize==73) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 73>(aCnlm);
    if (tSize==74) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 74>(aCnlm);
    if (tSize==75) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 75>(aCnlm);
    if (tSize==76) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 76>(aCnlm);
    if (tSize==77) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 77>(aCnlm);
    if (tSize==78) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 78>(aCnlm);
    if (tSize==79) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 79>(aCnlm);
    if (tSize==80) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 80>(aCnlm);
    if (tSize==81) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 81>(aCnlm);
    if (tSize==82) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 82>(aCnlm);
    if (tSize==83) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 83>(aCnlm);
    if (tSize==84) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 84>(aCnlm);
    if (tSize==85) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 85>(aCnlm);
    if (tSize==86) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 86>(aCnlm);
    if (tSize==87) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 87>(aCnlm);
    if (tSize==88) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 88>(aCnlm);
    if (tSize==89) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 89>(aCnlm);
    if (tSize==90) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 90>(aCnlm);
    if (tSize==91) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 91>(aCnlm);
    if (tSize==92) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 92>(aCnlm);
    if (tSize==93) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 93>(aCnlm);
    if (tSize==94) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 94>(aCnlm);
    if (tSize==95) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 95>(aCnlm);
    if (tSize==96) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 96>(aCnlm);
    if (tSize==97) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 97>(aCnlm);
    if (tSize==98) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 98>(aCnlm);
    if (tSize==99) {return rFp4;} rFp4 += calL4SubSub_<L4IDX, 99>(aCnlm);
    return rFp4;
}
template <jint L4MAX, jboolean L4CROSS>
static void calL4_(jdouble *aCnlm, jdouble *rFp) noexcept {
    if (L4MAX < 1) return;
    *rFp = calL4Sub_<0>(aCnlm); ++rFp;
    if (L4MAX == 1) return;
    *rFp = calL4Sub_<1>(aCnlm); ++rFp;
    if (L4CROSS) {
        *rFp = calL4Sub_<2>(aCnlm); ++rFp;
    }
    if (L4MAX == 2) return;
    *rFp = calL4Sub_<3>(aCnlm); ++rFp;
    if (L4CROSS) {
        *rFp = calL4Sub_<4>(aCnlm); ++rFp;
        *rFp = calL4Sub_<5>(aCnlm); ++rFp;
        *rFp = calL4Sub_<6>(aCnlm); ++rFp;
        *rFp = calL4Sub_<7>(aCnlm); ++rFp;
        *rFp = calL4Sub_<8>(aCnlm); ++rFp;
    }
}

template <jint L>
static inline void calGradL2Sub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aNNGrad) noexcept {
    constexpr jint tStart = L*L;
    constexpr jint tLen = L+L+1;
    constexpr jint tEnd = tStart+tLen;
    constexpr jdouble tMul = 2.0 * PI4/(jdouble)tLen;
    jdouble subNNGrad = aNNGrad[L-1];
    for (jint i = tStart; i < tEnd; ++i) {
        rGradCnlm[i] += tMul * aCnlm[i] * subNNGrad;
    }
}
template <jint LMAX, jboolean NO_RADIAL>
static void calGradL2_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aNNGrad) noexcept {
    // l = 0
    jdouble *tNNGrad = aNNGrad;
    if (!NO_RADIAL) {
        rGradCnlm[0] += (PI4+PI4) * aCnlm[0] * tNNGrad[0];
        ++tNNGrad;
    }
    if (LMAX == 0) return;
    calGradL2Sub_<1>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 1) return;
    calGradL2Sub_<2>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 2) return;
    calGradL2Sub_<3>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 3) return;
    calGradL2Sub_<4>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 4) return;
    calGradL2Sub_<5>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 5) return;
    calGradL2Sub_<6>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 6) return;
    calGradL2Sub_<7>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 7) return;
    calGradL2Sub_<8>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 8) return;
    calGradL2Sub_<9>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 9) return;
    calGradL2Sub_<10>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 10) return;
    calGradL2Sub_<11>(aCnlm, rGradCnlm, tNNGrad);
    if (LMAX == 11) return;
    calGradL2Sub_<12>(aCnlm, rGradCnlm, tNNGrad);
}
template <jint L3IDX, jint SUBIDX>
static inline void calGradL3SubSub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint i1 = L3_INDEX[L3IDX][SUBIDX][0];
    constexpr jint i2 = L3_INDEX[L3IDX][SUBIDX][1];
    constexpr jint i3 = L3_INDEX[L3IDX][SUBIDX][2];
    constexpr jdouble coeff = L3_COEFF[L3IDX][SUBIDX];
    const jdouble tMul = coeff * aSubNNGrad;
    const jdouble tCnlm1 = aCnlm[i1];
    const jdouble tCnlm2 = aCnlm[i2];
    const jdouble tCnlm3 = aCnlm[i3];
    rGradCnlm[i1] += tMul * tCnlm2*tCnlm3;
    rGradCnlm[i2] += tMul * tCnlm1*tCnlm3;
    rGradCnlm[i3] += tMul * tCnlm1*tCnlm2;
}
template <jint L3IDX>
static void calGradL3Sub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint tSize = L3_SIZE[L3IDX];
    if (tSize==0) {return;} calGradL3SubSub_<L3IDX, 0>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==1) {return;} calGradL3SubSub_<L3IDX, 1>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==2) {return;} calGradL3SubSub_<L3IDX, 2>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==3) {return;} calGradL3SubSub_<L3IDX, 3>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==4) {return;} calGradL3SubSub_<L3IDX, 4>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==5) {return;} calGradL3SubSub_<L3IDX, 5>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==6) {return;} calGradL3SubSub_<L3IDX, 6>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==7) {return;} calGradL3SubSub_<L3IDX, 7>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==8) {return;} calGradL3SubSub_<L3IDX, 8>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==9) {return;} calGradL3SubSub_<L3IDX, 9>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==10) {return;} calGradL3SubSub_<L3IDX, 10>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==11) {return;} calGradL3SubSub_<L3IDX, 11>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==12) {return;} calGradL3SubSub_<L3IDX, 12>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==13) {return;} calGradL3SubSub_<L3IDX, 13>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==14) {return;} calGradL3SubSub_<L3IDX, 14>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==15) {return;} calGradL3SubSub_<L3IDX, 15>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==16) {return;} calGradL3SubSub_<L3IDX, 16>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==17) {return;} calGradL3SubSub_<L3IDX, 17>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==18) {return;} calGradL3SubSub_<L3IDX, 18>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==19) {return;} calGradL3SubSub_<L3IDX, 19>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==20) {return;} calGradL3SubSub_<L3IDX, 20>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==21) {return;} calGradL3SubSub_<L3IDX, 21>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==22) {return;} calGradL3SubSub_<L3IDX, 22>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==23) {return;} calGradL3SubSub_<L3IDX, 23>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==24) {return;} calGradL3SubSub_<L3IDX, 24>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==25) {return;} calGradL3SubSub_<L3IDX, 25>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==26) {return;} calGradL3SubSub_<L3IDX, 26>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==27) {return;} calGradL3SubSub_<L3IDX, 27>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==28) {return;} calGradL3SubSub_<L3IDX, 28>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==29) {return;} calGradL3SubSub_<L3IDX, 29>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==30) {return;} calGradL3SubSub_<L3IDX, 30>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==31) {return;} calGradL3SubSub_<L3IDX, 31>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==32) {return;} calGradL3SubSub_<L3IDX, 32>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==33) {return;} calGradL3SubSub_<L3IDX, 33>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==34) {return;} calGradL3SubSub_<L3IDX, 34>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==35) {return;} calGradL3SubSub_<L3IDX, 35>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==36) {return;} calGradL3SubSub_<L3IDX, 36>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==37) {return;} calGradL3SubSub_<L3IDX, 37>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==38) {return;} calGradL3SubSub_<L3IDX, 38>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==39) {return;} calGradL3SubSub_<L3IDX, 39>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==40) {return;} calGradL3SubSub_<L3IDX, 40>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==41) {return;} calGradL3SubSub_<L3IDX, 41>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==42) {return;} calGradL3SubSub_<L3IDX, 42>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==43) {return;} calGradL3SubSub_<L3IDX, 43>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==44) {return;} calGradL3SubSub_<L3IDX, 44>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==45) {return;} calGradL3SubSub_<L3IDX, 45>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==46) {return;} calGradL3SubSub_<L3IDX, 46>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==47) {return;} calGradL3SubSub_<L3IDX, 47>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==48) {return;} calGradL3SubSub_<L3IDX, 48>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==49) {return;} calGradL3SubSub_<L3IDX, 49>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==50) {return;} calGradL3SubSub_<L3IDX, 50>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==51) {return;} calGradL3SubSub_<L3IDX, 51>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==52) {return;} calGradL3SubSub_<L3IDX, 52>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==53) {return;} calGradL3SubSub_<L3IDX, 53>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==54) {return;} calGradL3SubSub_<L3IDX, 54>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==55) {return;} calGradL3SubSub_<L3IDX, 55>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==56) {return;} calGradL3SubSub_<L3IDX, 56>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==57) {return;} calGradL3SubSub_<L3IDX, 57>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==58) {return;} calGradL3SubSub_<L3IDX, 58>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==59) {return;} calGradL3SubSub_<L3IDX, 59>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==60) {return;} calGradL3SubSub_<L3IDX, 60>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==61) {return;} calGradL3SubSub_<L3IDX, 61>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==62) {return;} calGradL3SubSub_<L3IDX, 62>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==63) {return;} calGradL3SubSub_<L3IDX, 63>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==64) {return;} calGradL3SubSub_<L3IDX, 64>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==65) {return;} calGradL3SubSub_<L3IDX, 65>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==66) {return;} calGradL3SubSub_<L3IDX, 66>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==67) {return;} calGradL3SubSub_<L3IDX, 67>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==68) {return;} calGradL3SubSub_<L3IDX, 68>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==69) {return;} calGradL3SubSub_<L3IDX, 69>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==70) {return;} calGradL3SubSub_<L3IDX, 70>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==71) {return;} calGradL3SubSub_<L3IDX, 71>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==72) {return;} calGradL3SubSub_<L3IDX, 72>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==73) {return;} calGradL3SubSub_<L3IDX, 73>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==74) {return;} calGradL3SubSub_<L3IDX, 74>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==75) {return;} calGradL3SubSub_<L3IDX, 75>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==76) {return;} calGradL3SubSub_<L3IDX, 76>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==77) {return;} calGradL3SubSub_<L3IDX, 77>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==78) {return;} calGradL3SubSub_<L3IDX, 78>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==79) {return;} calGradL3SubSub_<L3IDX, 79>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==80) {return;} calGradL3SubSub_<L3IDX, 80>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==81) {return;} calGradL3SubSub_<L3IDX, 81>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==82) {return;} calGradL3SubSub_<L3IDX, 82>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==83) {return;} calGradL3SubSub_<L3IDX, 83>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==84) {return;} calGradL3SubSub_<L3IDX, 84>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==85) {return;} calGradL3SubSub_<L3IDX, 85>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==86) {return;} calGradL3SubSub_<L3IDX, 86>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==87) {return;} calGradL3SubSub_<L3IDX, 87>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==88) {return;} calGradL3SubSub_<L3IDX, 88>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==89) {return;} calGradL3SubSub_<L3IDX, 89>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==90) {return;} calGradL3SubSub_<L3IDX, 90>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==91) {return;} calGradL3SubSub_<L3IDX, 91>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==92) {return;} calGradL3SubSub_<L3IDX, 92>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==93) {return;} calGradL3SubSub_<L3IDX, 93>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==94) {return;} calGradL3SubSub_<L3IDX, 94>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==95) {return;} calGradL3SubSub_<L3IDX, 95>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==96) {return;} calGradL3SubSub_<L3IDX, 96>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==97) {return;} calGradL3SubSub_<L3IDX, 97>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==98) {return;} calGradL3SubSub_<L3IDX, 98>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==99) {return;} calGradL3SubSub_<L3IDX, 99>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==100) {return;} calGradL3SubSub_<L3IDX, 100>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==101) {return;} calGradL3SubSub_<L3IDX, 101>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==102) {return;} calGradL3SubSub_<L3IDX, 102>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==103) {return;} calGradL3SubSub_<L3IDX, 103>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==104) {return;} calGradL3SubSub_<L3IDX, 104>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==105) {return;} calGradL3SubSub_<L3IDX, 105>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==106) {return;} calGradL3SubSub_<L3IDX, 106>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==107) {return;} calGradL3SubSub_<L3IDX, 107>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==108) {return;} calGradL3SubSub_<L3IDX, 108>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==109) {return;} calGradL3SubSub_<L3IDX, 109>(aCnlm, rGradCnlm, aSubNNGrad);
}
template <jint L3MAX, jboolean L3CROSS>
static void calGradL3_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aNNGrad) noexcept {
    if (L3MAX <= 1) return;
    calGradL3Sub_<0>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    if (L3CROSS) {
        calGradL3Sub_<1>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 2) return;
    if (L3CROSS) {
        calGradL3Sub_<2>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<3>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 3) return;
    calGradL3Sub_<4>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    if (L3CROSS) {
        calGradL3Sub_<5>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<6>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<7>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<8>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 4) return;
    if (L3CROSS) {
        calGradL3Sub_<9>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<10>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<11>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<12>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<13>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 5) return;
    calGradL3Sub_<14>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    if (L3CROSS) {
        calGradL3Sub_<15>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<16>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<17>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<18>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<19>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<20>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<21>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL3Sub_<22>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    }
}
template <jint L4IDX, jint SUBIDX>
static inline void calGradL4SubSub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint i1 = L4_INDEX[L4IDX][SUBIDX][0];
    constexpr jint i2 = L4_INDEX[L4IDX][SUBIDX][1];
    constexpr jint i3 = L4_INDEX[L4IDX][SUBIDX][2];
    constexpr jint i4 = L4_INDEX[L4IDX][SUBIDX][3];
    constexpr jdouble coeff = L4_COEFF[L4IDX][SUBIDX];
    const jdouble tMul = coeff * aSubNNGrad;
    const jdouble tCnlm1 = aCnlm[i1];
    const jdouble tCnlm2 = aCnlm[i2];
    const jdouble tCnlm3 = aCnlm[i3];
    const jdouble tCnlm4 = aCnlm[i4];
    rGradCnlm[i1] += tMul * tCnlm2*tCnlm3*tCnlm4;
    rGradCnlm[i2] += tMul * tCnlm1*tCnlm3*tCnlm4;
    rGradCnlm[i3] += tMul * tCnlm1*tCnlm2*tCnlm4;
    rGradCnlm[i4] += tMul * tCnlm1*tCnlm2*tCnlm3;
}
template <jint L4IDX>
static void calGradL4Sub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint tSize = L4_SIZE[L4IDX];
    if (tSize==0) {return;} calGradL4SubSub_<L4IDX, 0>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==1) {return;} calGradL4SubSub_<L4IDX, 1>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==2) {return;} calGradL4SubSub_<L4IDX, 2>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==3) {return;} calGradL4SubSub_<L4IDX, 3>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==4) {return;} calGradL4SubSub_<L4IDX, 4>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==5) {return;} calGradL4SubSub_<L4IDX, 5>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==6) {return;} calGradL4SubSub_<L4IDX, 6>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==7) {return;} calGradL4SubSub_<L4IDX, 7>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==8) {return;} calGradL4SubSub_<L4IDX, 8>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==9) {return;} calGradL4SubSub_<L4IDX, 9>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==10) {return;} calGradL4SubSub_<L4IDX, 10>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==11) {return;} calGradL4SubSub_<L4IDX, 11>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==12) {return;} calGradL4SubSub_<L4IDX, 12>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==13) {return;} calGradL4SubSub_<L4IDX, 13>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==14) {return;} calGradL4SubSub_<L4IDX, 14>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==15) {return;} calGradL4SubSub_<L4IDX, 15>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==16) {return;} calGradL4SubSub_<L4IDX, 16>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==17) {return;} calGradL4SubSub_<L4IDX, 17>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==18) {return;} calGradL4SubSub_<L4IDX, 18>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==19) {return;} calGradL4SubSub_<L4IDX, 19>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==20) {return;} calGradL4SubSub_<L4IDX, 20>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==21) {return;} calGradL4SubSub_<L4IDX, 21>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==22) {return;} calGradL4SubSub_<L4IDX, 22>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==23) {return;} calGradL4SubSub_<L4IDX, 23>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==24) {return;} calGradL4SubSub_<L4IDX, 24>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==25) {return;} calGradL4SubSub_<L4IDX, 25>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==26) {return;} calGradL4SubSub_<L4IDX, 26>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==27) {return;} calGradL4SubSub_<L4IDX, 27>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==28) {return;} calGradL4SubSub_<L4IDX, 28>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==29) {return;} calGradL4SubSub_<L4IDX, 29>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==30) {return;} calGradL4SubSub_<L4IDX, 30>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==31) {return;} calGradL4SubSub_<L4IDX, 31>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==32) {return;} calGradL4SubSub_<L4IDX, 32>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==33) {return;} calGradL4SubSub_<L4IDX, 33>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==34) {return;} calGradL4SubSub_<L4IDX, 34>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==35) {return;} calGradL4SubSub_<L4IDX, 35>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==36) {return;} calGradL4SubSub_<L4IDX, 36>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==37) {return;} calGradL4SubSub_<L4IDX, 37>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==38) {return;} calGradL4SubSub_<L4IDX, 38>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==39) {return;} calGradL4SubSub_<L4IDX, 39>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==40) {return;} calGradL4SubSub_<L4IDX, 40>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==41) {return;} calGradL4SubSub_<L4IDX, 41>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==42) {return;} calGradL4SubSub_<L4IDX, 42>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==43) {return;} calGradL4SubSub_<L4IDX, 43>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==44) {return;} calGradL4SubSub_<L4IDX, 44>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==45) {return;} calGradL4SubSub_<L4IDX, 45>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==46) {return;} calGradL4SubSub_<L4IDX, 46>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==47) {return;} calGradL4SubSub_<L4IDX, 47>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==48) {return;} calGradL4SubSub_<L4IDX, 48>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==49) {return;} calGradL4SubSub_<L4IDX, 49>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==50) {return;} calGradL4SubSub_<L4IDX, 50>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==51) {return;} calGradL4SubSub_<L4IDX, 51>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==52) {return;} calGradL4SubSub_<L4IDX, 52>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==53) {return;} calGradL4SubSub_<L4IDX, 53>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==54) {return;} calGradL4SubSub_<L4IDX, 54>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==55) {return;} calGradL4SubSub_<L4IDX, 55>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==56) {return;} calGradL4SubSub_<L4IDX, 56>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==57) {return;} calGradL4SubSub_<L4IDX, 57>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==58) {return;} calGradL4SubSub_<L4IDX, 58>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==59) {return;} calGradL4SubSub_<L4IDX, 59>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==60) {return;} calGradL4SubSub_<L4IDX, 60>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==61) {return;} calGradL4SubSub_<L4IDX, 61>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==62) {return;} calGradL4SubSub_<L4IDX, 62>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==63) {return;} calGradL4SubSub_<L4IDX, 63>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==64) {return;} calGradL4SubSub_<L4IDX, 64>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==65) {return;} calGradL4SubSub_<L4IDX, 65>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==66) {return;} calGradL4SubSub_<L4IDX, 66>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==67) {return;} calGradL4SubSub_<L4IDX, 67>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==68) {return;} calGradL4SubSub_<L4IDX, 68>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==69) {return;} calGradL4SubSub_<L4IDX, 69>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==70) {return;} calGradL4SubSub_<L4IDX, 70>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==71) {return;} calGradL4SubSub_<L4IDX, 71>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==72) {return;} calGradL4SubSub_<L4IDX, 72>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==73) {return;} calGradL4SubSub_<L4IDX, 73>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==74) {return;} calGradL4SubSub_<L4IDX, 74>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==75) {return;} calGradL4SubSub_<L4IDX, 75>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==76) {return;} calGradL4SubSub_<L4IDX, 76>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==77) {return;} calGradL4SubSub_<L4IDX, 77>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==78) {return;} calGradL4SubSub_<L4IDX, 78>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==79) {return;} calGradL4SubSub_<L4IDX, 79>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==80) {return;} calGradL4SubSub_<L4IDX, 80>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==81) {return;} calGradL4SubSub_<L4IDX, 81>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==82) {return;} calGradL4SubSub_<L4IDX, 82>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==83) {return;} calGradL4SubSub_<L4IDX, 83>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==84) {return;} calGradL4SubSub_<L4IDX, 84>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==85) {return;} calGradL4SubSub_<L4IDX, 85>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==86) {return;} calGradL4SubSub_<L4IDX, 86>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==87) {return;} calGradL4SubSub_<L4IDX, 87>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==88) {return;} calGradL4SubSub_<L4IDX, 88>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==89) {return;} calGradL4SubSub_<L4IDX, 89>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==90) {return;} calGradL4SubSub_<L4IDX, 90>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==91) {return;} calGradL4SubSub_<L4IDX, 91>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==92) {return;} calGradL4SubSub_<L4IDX, 92>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==93) {return;} calGradL4SubSub_<L4IDX, 93>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==94) {return;} calGradL4SubSub_<L4IDX, 94>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==95) {return;} calGradL4SubSub_<L4IDX, 95>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==96) {return;} calGradL4SubSub_<L4IDX, 96>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==97) {return;} calGradL4SubSub_<L4IDX, 97>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==98) {return;} calGradL4SubSub_<L4IDX, 98>(aCnlm, rGradCnlm, aSubNNGrad);
    if (tSize==99) {return;} calGradL4SubSub_<L4IDX, 99>(aCnlm, rGradCnlm, aSubNNGrad);
}
template <jint L4MAX, jboolean L4CROSS>
static void calGradL4_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aNNGrad) noexcept {
    if (L4MAX < 1) return;
    calGradL4Sub_<0>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    if (L4MAX == 1) return;
    calGradL4Sub_<1>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    if (L4CROSS) {
        calGradL4Sub_<2>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L4MAX == 2) return;
    calGradL4Sub_<3>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    if (L4CROSS) {
        calGradL4Sub_<4>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL4Sub_<5>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL4Sub_<6>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL4Sub_<7>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
        calGradL4Sub_<8>(aCnlm, rGradCnlm, *aNNGrad); ++aNNGrad;
    }
}

template <jint L>
static inline void calGradNNGradL2Sub_(jdouble *aCnlm, jdouble *aGradNNGradCnlm, jdouble *rGradNNGrad) noexcept {
    constexpr jint tStart = L*L;
    constexpr jint tLen = L+L+1;
    const jdouble rDot = JSE_NNAP::dot<tLen>(aCnlm+tStart, aGradNNGradCnlm+tStart);
    rGradNNGrad[L-1] = (2.0 * PI4/(jdouble)tLen) * rDot;
}
template <jint LMAX, jboolean NO_RADIAL>
static void calGradNNGradL2_(jdouble *aCnlm, jdouble *aGradNNGradCnlm, jdouble *rGradNNGrad) noexcept {
    // l = 0
    jdouble *tGradNNGrad = rGradNNGrad;
    if (!NO_RADIAL) {
        tGradNNGrad[0] += (PI4+PI4) * aCnlm[0] * aGradNNGradCnlm[0];
        ++tGradNNGrad;
    }
    if (LMAX == 0) return;
    calGradNNGradL2Sub_<1>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 1) return;
    calGradNNGradL2Sub_<2>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 2) return;
    calGradNNGradL2Sub_<3>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 3) return;
    calGradNNGradL2Sub_<4>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 4) return;
    calGradNNGradL2Sub_<5>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 5) return;
    calGradNNGradL2Sub_<6>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 6) return;
    calGradNNGradL2Sub_<7>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 7) return;
    calGradNNGradL2Sub_<8>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 8) return;
    calGradNNGradL2Sub_<9>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 9) return;
    calGradNNGradL2Sub_<10>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 10) return;
    calGradNNGradL2Sub_<11>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
    if (LMAX == 11) return;
    calGradNNGradL2Sub_<12>(aCnlm, aGradNNGradCnlm, tGradNNGrad);
}
template <jint L3IDX, jint SUBIDX>
static inline jdouble calGradNNGradL3SubSub_(jdouble *aCnlm, jdouble *aGradNNGradCnlm) noexcept {
    jdouble rGGFp3 = 0.0;
    constexpr jint i1 = L3_INDEX[L3IDX][SUBIDX][0];
    constexpr jint i2 = L3_INDEX[L3IDX][SUBIDX][1];
    constexpr jint i3 = L3_INDEX[L3IDX][SUBIDX][2];
    constexpr jdouble coeff = L3_COEFF[L3IDX][SUBIDX];
    const jdouble tCnlm1 = aCnlm[i1];
    const jdouble tCnlm2 = aCnlm[i2];
    const jdouble tCnlm3 = aCnlm[i3];
    rGGFp3 += aGradNNGradCnlm[i1]*tCnlm2*tCnlm3;
    rGGFp3 += tCnlm1*aGradNNGradCnlm[i2]*tCnlm3;
    rGGFp3 += tCnlm1*tCnlm2*aGradNNGradCnlm[i3];
    return coeff*rGGFp3;
}
template <jint L3IDX>
static jdouble calGradNNGradL3Sub_(jdouble *aCnlm, jdouble *aGradNNGradCnlm) noexcept {
    jdouble rGGFp3 = 0.0;
    constexpr jint tSize = L3_SIZE[L3IDX];
    if (tSize==0) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 0>(aCnlm, aGradNNGradCnlm);
    if (tSize==1) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 1>(aCnlm, aGradNNGradCnlm);
    if (tSize==2) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 2>(aCnlm, aGradNNGradCnlm);
    if (tSize==3) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 3>(aCnlm, aGradNNGradCnlm);
    if (tSize==4) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 4>(aCnlm, aGradNNGradCnlm);
    if (tSize==5) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 5>(aCnlm, aGradNNGradCnlm);
    if (tSize==6) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 6>(aCnlm, aGradNNGradCnlm);
    if (tSize==7) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 7>(aCnlm, aGradNNGradCnlm);
    if (tSize==8) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 8>(aCnlm, aGradNNGradCnlm);
    if (tSize==9) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 9>(aCnlm, aGradNNGradCnlm);
    if (tSize==10) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 10>(aCnlm, aGradNNGradCnlm);
    if (tSize==11) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 11>(aCnlm, aGradNNGradCnlm);
    if (tSize==12) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 12>(aCnlm, aGradNNGradCnlm);
    if (tSize==13) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 13>(aCnlm, aGradNNGradCnlm);
    if (tSize==14) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 14>(aCnlm, aGradNNGradCnlm);
    if (tSize==15) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 15>(aCnlm, aGradNNGradCnlm);
    if (tSize==16) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 16>(aCnlm, aGradNNGradCnlm);
    if (tSize==17) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 17>(aCnlm, aGradNNGradCnlm);
    if (tSize==18) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 18>(aCnlm, aGradNNGradCnlm);
    if (tSize==19) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 19>(aCnlm, aGradNNGradCnlm);
    if (tSize==20) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 20>(aCnlm, aGradNNGradCnlm);
    if (tSize==21) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 21>(aCnlm, aGradNNGradCnlm);
    if (tSize==22) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 22>(aCnlm, aGradNNGradCnlm);
    if (tSize==23) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 23>(aCnlm, aGradNNGradCnlm);
    if (tSize==24) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 24>(aCnlm, aGradNNGradCnlm);
    if (tSize==25) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 25>(aCnlm, aGradNNGradCnlm);
    if (tSize==26) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 26>(aCnlm, aGradNNGradCnlm);
    if (tSize==27) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 27>(aCnlm, aGradNNGradCnlm);
    if (tSize==28) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 28>(aCnlm, aGradNNGradCnlm);
    if (tSize==29) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 29>(aCnlm, aGradNNGradCnlm);
    if (tSize==30) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 30>(aCnlm, aGradNNGradCnlm);
    if (tSize==31) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 31>(aCnlm, aGradNNGradCnlm);
    if (tSize==32) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 32>(aCnlm, aGradNNGradCnlm);
    if (tSize==33) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 33>(aCnlm, aGradNNGradCnlm);
    if (tSize==34) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 34>(aCnlm, aGradNNGradCnlm);
    if (tSize==35) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 35>(aCnlm, aGradNNGradCnlm);
    if (tSize==36) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 36>(aCnlm, aGradNNGradCnlm);
    if (tSize==37) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 37>(aCnlm, aGradNNGradCnlm);
    if (tSize==38) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 38>(aCnlm, aGradNNGradCnlm);
    if (tSize==39) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 39>(aCnlm, aGradNNGradCnlm);
    if (tSize==40) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 40>(aCnlm, aGradNNGradCnlm);
    if (tSize==41) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 41>(aCnlm, aGradNNGradCnlm);
    if (tSize==42) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 42>(aCnlm, aGradNNGradCnlm);
    if (tSize==43) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 43>(aCnlm, aGradNNGradCnlm);
    if (tSize==44) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 44>(aCnlm, aGradNNGradCnlm);
    if (tSize==45) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 45>(aCnlm, aGradNNGradCnlm);
    if (tSize==46) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 46>(aCnlm, aGradNNGradCnlm);
    if (tSize==47) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 47>(aCnlm, aGradNNGradCnlm);
    if (tSize==48) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 48>(aCnlm, aGradNNGradCnlm);
    if (tSize==49) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 49>(aCnlm, aGradNNGradCnlm);
    if (tSize==50) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 50>(aCnlm, aGradNNGradCnlm);
    if (tSize==51) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 51>(aCnlm, aGradNNGradCnlm);
    if (tSize==52) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 52>(aCnlm, aGradNNGradCnlm);
    if (tSize==53) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 53>(aCnlm, aGradNNGradCnlm);
    if (tSize==54) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 54>(aCnlm, aGradNNGradCnlm);
    if (tSize==55) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 55>(aCnlm, aGradNNGradCnlm);
    if (tSize==56) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 56>(aCnlm, aGradNNGradCnlm);
    if (tSize==57) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 57>(aCnlm, aGradNNGradCnlm);
    if (tSize==58) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 58>(aCnlm, aGradNNGradCnlm);
    if (tSize==59) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 59>(aCnlm, aGradNNGradCnlm);
    if (tSize==60) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 60>(aCnlm, aGradNNGradCnlm);
    if (tSize==61) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 61>(aCnlm, aGradNNGradCnlm);
    if (tSize==62) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 62>(aCnlm, aGradNNGradCnlm);
    if (tSize==63) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 63>(aCnlm, aGradNNGradCnlm);
    if (tSize==64) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 64>(aCnlm, aGradNNGradCnlm);
    if (tSize==65) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 65>(aCnlm, aGradNNGradCnlm);
    if (tSize==66) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 66>(aCnlm, aGradNNGradCnlm);
    if (tSize==67) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 67>(aCnlm, aGradNNGradCnlm);
    if (tSize==68) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 68>(aCnlm, aGradNNGradCnlm);
    if (tSize==69) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 69>(aCnlm, aGradNNGradCnlm);
    if (tSize==70) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 70>(aCnlm, aGradNNGradCnlm);
    if (tSize==71) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 71>(aCnlm, aGradNNGradCnlm);
    if (tSize==72) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 72>(aCnlm, aGradNNGradCnlm);
    if (tSize==73) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 73>(aCnlm, aGradNNGradCnlm);
    if (tSize==74) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 74>(aCnlm, aGradNNGradCnlm);
    if (tSize==75) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 75>(aCnlm, aGradNNGradCnlm);
    if (tSize==76) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 76>(aCnlm, aGradNNGradCnlm);
    if (tSize==77) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 77>(aCnlm, aGradNNGradCnlm);
    if (tSize==78) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 78>(aCnlm, aGradNNGradCnlm);
    if (tSize==79) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 79>(aCnlm, aGradNNGradCnlm);
    if (tSize==80) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 80>(aCnlm, aGradNNGradCnlm);
    if (tSize==81) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 81>(aCnlm, aGradNNGradCnlm);
    if (tSize==82) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 82>(aCnlm, aGradNNGradCnlm);
    if (tSize==83) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 83>(aCnlm, aGradNNGradCnlm);
    if (tSize==84) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 84>(aCnlm, aGradNNGradCnlm);
    if (tSize==85) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 85>(aCnlm, aGradNNGradCnlm);
    if (tSize==86) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 86>(aCnlm, aGradNNGradCnlm);
    if (tSize==87) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 87>(aCnlm, aGradNNGradCnlm);
    if (tSize==88) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 88>(aCnlm, aGradNNGradCnlm);
    if (tSize==89) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 89>(aCnlm, aGradNNGradCnlm);
    if (tSize==90) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 90>(aCnlm, aGradNNGradCnlm);
    if (tSize==91) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 91>(aCnlm, aGradNNGradCnlm);
    if (tSize==92) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 92>(aCnlm, aGradNNGradCnlm);
    if (tSize==93) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 93>(aCnlm, aGradNNGradCnlm);
    if (tSize==94) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 94>(aCnlm, aGradNNGradCnlm);
    if (tSize==95) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 95>(aCnlm, aGradNNGradCnlm);
    if (tSize==96) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 96>(aCnlm, aGradNNGradCnlm);
    if (tSize==97) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 97>(aCnlm, aGradNNGradCnlm);
    if (tSize==98) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 98>(aCnlm, aGradNNGradCnlm);
    if (tSize==99) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 99>(aCnlm, aGradNNGradCnlm);
    if (tSize==100) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 100>(aCnlm, aGradNNGradCnlm);
    if (tSize==101) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 101>(aCnlm, aGradNNGradCnlm);
    if (tSize==102) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 102>(aCnlm, aGradNNGradCnlm);
    if (tSize==103) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 103>(aCnlm, aGradNNGradCnlm);
    if (tSize==104) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 104>(aCnlm, aGradNNGradCnlm);
    if (tSize==105) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 105>(aCnlm, aGradNNGradCnlm);
    if (tSize==106) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 106>(aCnlm, aGradNNGradCnlm);
    if (tSize==107) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 107>(aCnlm, aGradNNGradCnlm);
    if (tSize==108) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 108>(aCnlm, aGradNNGradCnlm);
    if (tSize==109) {return rGGFp3;} rGGFp3 += calGradNNGradL3SubSub_<L3IDX, 109>(aCnlm, aGradNNGradCnlm);
    return rGGFp3;
}
template <jint L3MAX, jboolean L3CROSS>
static void calGradNNGradL3_(jdouble *aCnlm, jdouble *aGradNNGradCnlm, jdouble *rGradNNGrad) noexcept {
    if (L3MAX <= 1) return;
    *rGradNNGrad += calGradNNGradL3Sub_<0>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    if (L3CROSS) {
        *rGradNNGrad += calGradNNGradL3Sub_<1>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    }
    if (L3MAX == 2) return;
    if (L3CROSS) {
        *rGradNNGrad += calGradNNGradL3Sub_<2>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<3>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    }
    if (L3MAX == 3) return;
    *rGradNNGrad += calGradNNGradL3Sub_<4>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    if (L3CROSS) {
        *rGradNNGrad += calGradNNGradL3Sub_<5>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<6>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<7>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<8>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    }
    if (L3MAX == 4) return;
    if (L3CROSS) {
        *rGradNNGrad += calGradNNGradL3Sub_<9>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<10>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<11>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<12>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<13>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    }
    if (L3MAX == 5) return;
    *rGradNNGrad += calGradNNGradL3Sub_<14>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    if (L3CROSS) {
        *rGradNNGrad += calGradNNGradL3Sub_<15>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<16>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<17>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<18>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<19>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<20>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<21>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL3Sub_<22>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    }
}
template <jint L4IDX, jint SUBIDX>
static inline jdouble calGradNNGradL4SubSub_(jdouble *aCnlm, jdouble *aGradNNGradCnlm) noexcept {
    jdouble rGGFp4 = 0.0;
    constexpr jint i1 = L4_INDEX[L4IDX][SUBIDX][0];
    constexpr jint i2 = L4_INDEX[L4IDX][SUBIDX][1];
    constexpr jint i3 = L4_INDEX[L4IDX][SUBIDX][2];
    constexpr jint i4 = L4_INDEX[L4IDX][SUBIDX][3];
    constexpr jdouble coeff = L4_COEFF[L4IDX][SUBIDX];
    const jdouble tCnlm1 = aCnlm[i1];
    const jdouble tCnlm2 = aCnlm[i2];
    const jdouble tCnlm3 = aCnlm[i3];
    const jdouble tCnlm4 = aCnlm[i4];
    rGGFp4 += aGradNNGradCnlm[i1]*tCnlm2*tCnlm3*tCnlm4;
    rGGFp4 += tCnlm1*aGradNNGradCnlm[i2]*tCnlm3*tCnlm4;
    rGGFp4 += tCnlm1*tCnlm2*aGradNNGradCnlm[i3]*tCnlm4;
    rGGFp4 += tCnlm1*tCnlm2*tCnlm3*aGradNNGradCnlm[i4];
    return coeff*rGGFp4;
}
template <jint L4IDX>
static jdouble calGradNNGradL4Sub_(jdouble *aCnlm, jdouble *aGradNNGradCnlm) noexcept {
    jdouble rGGFp4 = 0.0;
    constexpr jint tSize = L4_SIZE[L4IDX];
    if (tSize==0) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 0>(aCnlm, aGradNNGradCnlm);
    if (tSize==1) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 1>(aCnlm, aGradNNGradCnlm);
    if (tSize==2) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 2>(aCnlm, aGradNNGradCnlm);
    if (tSize==3) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 3>(aCnlm, aGradNNGradCnlm);
    if (tSize==4) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 4>(aCnlm, aGradNNGradCnlm);
    if (tSize==5) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 5>(aCnlm, aGradNNGradCnlm);
    if (tSize==6) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 6>(aCnlm, aGradNNGradCnlm);
    if (tSize==7) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 7>(aCnlm, aGradNNGradCnlm);
    if (tSize==8) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 8>(aCnlm, aGradNNGradCnlm);
    if (tSize==9) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 9>(aCnlm, aGradNNGradCnlm);
    if (tSize==10) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 10>(aCnlm, aGradNNGradCnlm);
    if (tSize==11) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 11>(aCnlm, aGradNNGradCnlm);
    if (tSize==12) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 12>(aCnlm, aGradNNGradCnlm);
    if (tSize==13) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 13>(aCnlm, aGradNNGradCnlm);
    if (tSize==14) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 14>(aCnlm, aGradNNGradCnlm);
    if (tSize==15) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 15>(aCnlm, aGradNNGradCnlm);
    if (tSize==16) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 16>(aCnlm, aGradNNGradCnlm);
    if (tSize==17) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 17>(aCnlm, aGradNNGradCnlm);
    if (tSize==18) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 18>(aCnlm, aGradNNGradCnlm);
    if (tSize==19) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 19>(aCnlm, aGradNNGradCnlm);
    if (tSize==20) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 20>(aCnlm, aGradNNGradCnlm);
    if (tSize==21) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 21>(aCnlm, aGradNNGradCnlm);
    if (tSize==22) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 22>(aCnlm, aGradNNGradCnlm);
    if (tSize==23) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 23>(aCnlm, aGradNNGradCnlm);
    if (tSize==24) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 24>(aCnlm, aGradNNGradCnlm);
    if (tSize==25) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 25>(aCnlm, aGradNNGradCnlm);
    if (tSize==26) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 26>(aCnlm, aGradNNGradCnlm);
    if (tSize==27) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 27>(aCnlm, aGradNNGradCnlm);
    if (tSize==28) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 28>(aCnlm, aGradNNGradCnlm);
    if (tSize==29) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 29>(aCnlm, aGradNNGradCnlm);
    if (tSize==30) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 30>(aCnlm, aGradNNGradCnlm);
    if (tSize==31) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 31>(aCnlm, aGradNNGradCnlm);
    if (tSize==32) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 32>(aCnlm, aGradNNGradCnlm);
    if (tSize==33) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 33>(aCnlm, aGradNNGradCnlm);
    if (tSize==34) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 34>(aCnlm, aGradNNGradCnlm);
    if (tSize==35) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 35>(aCnlm, aGradNNGradCnlm);
    if (tSize==36) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 36>(aCnlm, aGradNNGradCnlm);
    if (tSize==37) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 37>(aCnlm, aGradNNGradCnlm);
    if (tSize==38) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 38>(aCnlm, aGradNNGradCnlm);
    if (tSize==39) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 39>(aCnlm, aGradNNGradCnlm);
    if (tSize==40) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 40>(aCnlm, aGradNNGradCnlm);
    if (tSize==41) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 41>(aCnlm, aGradNNGradCnlm);
    if (tSize==42) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 42>(aCnlm, aGradNNGradCnlm);
    if (tSize==43) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 43>(aCnlm, aGradNNGradCnlm);
    if (tSize==44) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 44>(aCnlm, aGradNNGradCnlm);
    if (tSize==45) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 45>(aCnlm, aGradNNGradCnlm);
    if (tSize==46) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 46>(aCnlm, aGradNNGradCnlm);
    if (tSize==47) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 47>(aCnlm, aGradNNGradCnlm);
    if (tSize==48) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 48>(aCnlm, aGradNNGradCnlm);
    if (tSize==49) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 49>(aCnlm, aGradNNGradCnlm);
    if (tSize==50) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 50>(aCnlm, aGradNNGradCnlm);
    if (tSize==51) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 51>(aCnlm, aGradNNGradCnlm);
    if (tSize==52) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 52>(aCnlm, aGradNNGradCnlm);
    if (tSize==53) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 53>(aCnlm, aGradNNGradCnlm);
    if (tSize==54) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 54>(aCnlm, aGradNNGradCnlm);
    if (tSize==55) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 55>(aCnlm, aGradNNGradCnlm);
    if (tSize==56) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 56>(aCnlm, aGradNNGradCnlm);
    if (tSize==57) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 57>(aCnlm, aGradNNGradCnlm);
    if (tSize==58) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 58>(aCnlm, aGradNNGradCnlm);
    if (tSize==59) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 59>(aCnlm, aGradNNGradCnlm);
    if (tSize==60) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 60>(aCnlm, aGradNNGradCnlm);
    if (tSize==61) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 61>(aCnlm, aGradNNGradCnlm);
    if (tSize==62) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 62>(aCnlm, aGradNNGradCnlm);
    if (tSize==63) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 63>(aCnlm, aGradNNGradCnlm);
    if (tSize==64) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 64>(aCnlm, aGradNNGradCnlm);
    if (tSize==65) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 65>(aCnlm, aGradNNGradCnlm);
    if (tSize==66) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 66>(aCnlm, aGradNNGradCnlm);
    if (tSize==67) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 67>(aCnlm, aGradNNGradCnlm);
    if (tSize==68) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 68>(aCnlm, aGradNNGradCnlm);
    if (tSize==69) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 69>(aCnlm, aGradNNGradCnlm);
    if (tSize==70) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 70>(aCnlm, aGradNNGradCnlm);
    if (tSize==71) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 71>(aCnlm, aGradNNGradCnlm);
    if (tSize==72) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 72>(aCnlm, aGradNNGradCnlm);
    if (tSize==73) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 73>(aCnlm, aGradNNGradCnlm);
    if (tSize==74) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 74>(aCnlm, aGradNNGradCnlm);
    if (tSize==75) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 75>(aCnlm, aGradNNGradCnlm);
    if (tSize==76) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 76>(aCnlm, aGradNNGradCnlm);
    if (tSize==77) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 77>(aCnlm, aGradNNGradCnlm);
    if (tSize==78) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 78>(aCnlm, aGradNNGradCnlm);
    if (tSize==79) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 79>(aCnlm, aGradNNGradCnlm);
    if (tSize==80) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 80>(aCnlm, aGradNNGradCnlm);
    if (tSize==81) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 81>(aCnlm, aGradNNGradCnlm);
    if (tSize==82) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 82>(aCnlm, aGradNNGradCnlm);
    if (tSize==83) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 83>(aCnlm, aGradNNGradCnlm);
    if (tSize==84) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 84>(aCnlm, aGradNNGradCnlm);
    if (tSize==85) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 85>(aCnlm, aGradNNGradCnlm);
    if (tSize==86) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 86>(aCnlm, aGradNNGradCnlm);
    if (tSize==87) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 87>(aCnlm, aGradNNGradCnlm);
    if (tSize==88) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 88>(aCnlm, aGradNNGradCnlm);
    if (tSize==89) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 89>(aCnlm, aGradNNGradCnlm);
    if (tSize==90) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 90>(aCnlm, aGradNNGradCnlm);
    if (tSize==91) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 91>(aCnlm, aGradNNGradCnlm);
    if (tSize==92) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 92>(aCnlm, aGradNNGradCnlm);
    if (tSize==93) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 93>(aCnlm, aGradNNGradCnlm);
    if (tSize==94) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 94>(aCnlm, aGradNNGradCnlm);
    if (tSize==95) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 95>(aCnlm, aGradNNGradCnlm);
    if (tSize==96) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 96>(aCnlm, aGradNNGradCnlm);
    if (tSize==97) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 97>(aCnlm, aGradNNGradCnlm);
    if (tSize==98) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 98>(aCnlm, aGradNNGradCnlm);
    if (tSize==99) {return rGGFp4;} rGGFp4 += calGradNNGradL4SubSub_<L4IDX, 99>(aCnlm, aGradNNGradCnlm);
    return rGGFp4;
}
template <jint L4MAX, jboolean L4CROSS>
static void calGradNNGradL4_(jdouble *aCnlm, jdouble *aGradNNGradCnlm, jdouble *rGradNNGrad) noexcept {
    if (L4MAX < 1) return;
    *rGradNNGrad += calGradNNGradL4Sub_<0>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    if (L4MAX == 1) return;
    *rGradNNGrad += calGradNNGradL4Sub_<1>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    if (L4CROSS) {
        *rGradNNGrad += calGradNNGradL4Sub_<2>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    }
    if (L4MAX == 2) return;
    *rGradNNGrad += calGradNNGradL4Sub_<3>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    if (L4CROSS) {
        *rGradNNGrad += calGradNNGradL4Sub_<4>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL4Sub_<5>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL4Sub_<6>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL4Sub_<7>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
        *rGradNNGrad += calGradNNGradL4Sub_<8>(aCnlm, aGradNNGradCnlm); ++rGradNNGrad;
    }
}

template <jint LMAX, jboolean NO_RADIAL>
static void calGradCnlmL2_(jdouble *rGradCnlm, jdouble *aGradNNGradCnlm, jdouble *aNNGrad) noexcept {
    calGradL2_<LMAX, NO_RADIAL>(aGradNNGradCnlm, rGradCnlm, aNNGrad);
}
template <jint L3IDX, jint SUBIDX>
static inline void calGradCnlmL3SubSub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aGradNNGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint i1 = L3_INDEX[L3IDX][SUBIDX][0];
    constexpr jint i2 = L3_INDEX[L3IDX][SUBIDX][1];
    constexpr jint i3 = L3_INDEX[L3IDX][SUBIDX][2];
    constexpr jdouble coeff = L3_COEFF[L3IDX][SUBIDX];
    const jdouble tMul = coeff * aSubNNGrad;
    const jdouble tCnlm1 = aCnlm[i1], tGGCnlm1 = aGradNNGradCnlm[i1];
    const jdouble tCnlm2 = aCnlm[i2], tGGCnlm2 = aGradNNGradCnlm[i2];
    const jdouble tCnlm3 = aCnlm[i3], tGGCnlm3 = aGradNNGradCnlm[i3];
    rGradCnlm[i1] += tMul * (tGGCnlm2*tCnlm3 + tCnlm2*tGGCnlm3);
    rGradCnlm[i2] += tMul * (tGGCnlm1*tCnlm3 + tCnlm1*tGGCnlm3);
    rGradCnlm[i3] += tMul * (tGGCnlm1*tCnlm2 + tCnlm1*tGGCnlm2);
}
template <jint L3IDX>
static void calGradCnlmL3Sub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aGradNNGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint tSize = L3_SIZE[L3IDX];
    if (tSize==0) {return;} calGradCnlmL3SubSub_<L3IDX, 0>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==1) {return;} calGradCnlmL3SubSub_<L3IDX, 1>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==2) {return;} calGradCnlmL3SubSub_<L3IDX, 2>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==3) {return;} calGradCnlmL3SubSub_<L3IDX, 3>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==4) {return;} calGradCnlmL3SubSub_<L3IDX, 4>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==5) {return;} calGradCnlmL3SubSub_<L3IDX, 5>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==6) {return;} calGradCnlmL3SubSub_<L3IDX, 6>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==7) {return;} calGradCnlmL3SubSub_<L3IDX, 7>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==8) {return;} calGradCnlmL3SubSub_<L3IDX, 8>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==9) {return;} calGradCnlmL3SubSub_<L3IDX, 9>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==10) {return;} calGradCnlmL3SubSub_<L3IDX, 10>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==11) {return;} calGradCnlmL3SubSub_<L3IDX, 11>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==12) {return;} calGradCnlmL3SubSub_<L3IDX, 12>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==13) {return;} calGradCnlmL3SubSub_<L3IDX, 13>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==14) {return;} calGradCnlmL3SubSub_<L3IDX, 14>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==15) {return;} calGradCnlmL3SubSub_<L3IDX, 15>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==16) {return;} calGradCnlmL3SubSub_<L3IDX, 16>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==17) {return;} calGradCnlmL3SubSub_<L3IDX, 17>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==18) {return;} calGradCnlmL3SubSub_<L3IDX, 18>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==19) {return;} calGradCnlmL3SubSub_<L3IDX, 19>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==20) {return;} calGradCnlmL3SubSub_<L3IDX, 20>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==21) {return;} calGradCnlmL3SubSub_<L3IDX, 21>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==22) {return;} calGradCnlmL3SubSub_<L3IDX, 22>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==23) {return;} calGradCnlmL3SubSub_<L3IDX, 23>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==24) {return;} calGradCnlmL3SubSub_<L3IDX, 24>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==25) {return;} calGradCnlmL3SubSub_<L3IDX, 25>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==26) {return;} calGradCnlmL3SubSub_<L3IDX, 26>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==27) {return;} calGradCnlmL3SubSub_<L3IDX, 27>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==28) {return;} calGradCnlmL3SubSub_<L3IDX, 28>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==29) {return;} calGradCnlmL3SubSub_<L3IDX, 29>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==30) {return;} calGradCnlmL3SubSub_<L3IDX, 30>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==31) {return;} calGradCnlmL3SubSub_<L3IDX, 31>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==32) {return;} calGradCnlmL3SubSub_<L3IDX, 32>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==33) {return;} calGradCnlmL3SubSub_<L3IDX, 33>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==34) {return;} calGradCnlmL3SubSub_<L3IDX, 34>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==35) {return;} calGradCnlmL3SubSub_<L3IDX, 35>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==36) {return;} calGradCnlmL3SubSub_<L3IDX, 36>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==37) {return;} calGradCnlmL3SubSub_<L3IDX, 37>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==38) {return;} calGradCnlmL3SubSub_<L3IDX, 38>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==39) {return;} calGradCnlmL3SubSub_<L3IDX, 39>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==40) {return;} calGradCnlmL3SubSub_<L3IDX, 40>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==41) {return;} calGradCnlmL3SubSub_<L3IDX, 41>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==42) {return;} calGradCnlmL3SubSub_<L3IDX, 42>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==43) {return;} calGradCnlmL3SubSub_<L3IDX, 43>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==44) {return;} calGradCnlmL3SubSub_<L3IDX, 44>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==45) {return;} calGradCnlmL3SubSub_<L3IDX, 45>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==46) {return;} calGradCnlmL3SubSub_<L3IDX, 46>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==47) {return;} calGradCnlmL3SubSub_<L3IDX, 47>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==48) {return;} calGradCnlmL3SubSub_<L3IDX, 48>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==49) {return;} calGradCnlmL3SubSub_<L3IDX, 49>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==50) {return;} calGradCnlmL3SubSub_<L3IDX, 50>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==51) {return;} calGradCnlmL3SubSub_<L3IDX, 51>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==52) {return;} calGradCnlmL3SubSub_<L3IDX, 52>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==53) {return;} calGradCnlmL3SubSub_<L3IDX, 53>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==54) {return;} calGradCnlmL3SubSub_<L3IDX, 54>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==55) {return;} calGradCnlmL3SubSub_<L3IDX, 55>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==56) {return;} calGradCnlmL3SubSub_<L3IDX, 56>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==57) {return;} calGradCnlmL3SubSub_<L3IDX, 57>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==58) {return;} calGradCnlmL3SubSub_<L3IDX, 58>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==59) {return;} calGradCnlmL3SubSub_<L3IDX, 59>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==60) {return;} calGradCnlmL3SubSub_<L3IDX, 60>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==61) {return;} calGradCnlmL3SubSub_<L3IDX, 61>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==62) {return;} calGradCnlmL3SubSub_<L3IDX, 62>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==63) {return;} calGradCnlmL3SubSub_<L3IDX, 63>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==64) {return;} calGradCnlmL3SubSub_<L3IDX, 64>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==65) {return;} calGradCnlmL3SubSub_<L3IDX, 65>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==66) {return;} calGradCnlmL3SubSub_<L3IDX, 66>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==67) {return;} calGradCnlmL3SubSub_<L3IDX, 67>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==68) {return;} calGradCnlmL3SubSub_<L3IDX, 68>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==69) {return;} calGradCnlmL3SubSub_<L3IDX, 69>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==70) {return;} calGradCnlmL3SubSub_<L3IDX, 70>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==71) {return;} calGradCnlmL3SubSub_<L3IDX, 71>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==72) {return;} calGradCnlmL3SubSub_<L3IDX, 72>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==73) {return;} calGradCnlmL3SubSub_<L3IDX, 73>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==74) {return;} calGradCnlmL3SubSub_<L3IDX, 74>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==75) {return;} calGradCnlmL3SubSub_<L3IDX, 75>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==76) {return;} calGradCnlmL3SubSub_<L3IDX, 76>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==77) {return;} calGradCnlmL3SubSub_<L3IDX, 77>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==78) {return;} calGradCnlmL3SubSub_<L3IDX, 78>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==79) {return;} calGradCnlmL3SubSub_<L3IDX, 79>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==80) {return;} calGradCnlmL3SubSub_<L3IDX, 80>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==81) {return;} calGradCnlmL3SubSub_<L3IDX, 81>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==82) {return;} calGradCnlmL3SubSub_<L3IDX, 82>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==83) {return;} calGradCnlmL3SubSub_<L3IDX, 83>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==84) {return;} calGradCnlmL3SubSub_<L3IDX, 84>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==85) {return;} calGradCnlmL3SubSub_<L3IDX, 85>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==86) {return;} calGradCnlmL3SubSub_<L3IDX, 86>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==87) {return;} calGradCnlmL3SubSub_<L3IDX, 87>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==88) {return;} calGradCnlmL3SubSub_<L3IDX, 88>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==89) {return;} calGradCnlmL3SubSub_<L3IDX, 89>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==90) {return;} calGradCnlmL3SubSub_<L3IDX, 90>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==91) {return;} calGradCnlmL3SubSub_<L3IDX, 91>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==92) {return;} calGradCnlmL3SubSub_<L3IDX, 92>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==93) {return;} calGradCnlmL3SubSub_<L3IDX, 93>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==94) {return;} calGradCnlmL3SubSub_<L3IDX, 94>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==95) {return;} calGradCnlmL3SubSub_<L3IDX, 95>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==96) {return;} calGradCnlmL3SubSub_<L3IDX, 96>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==97) {return;} calGradCnlmL3SubSub_<L3IDX, 97>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==98) {return;} calGradCnlmL3SubSub_<L3IDX, 98>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==99) {return;} calGradCnlmL3SubSub_<L3IDX, 99>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==100) {return;} calGradCnlmL3SubSub_<L3IDX, 100>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==101) {return;} calGradCnlmL3SubSub_<L3IDX, 101>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==102) {return;} calGradCnlmL3SubSub_<L3IDX, 102>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==103) {return;} calGradCnlmL3SubSub_<L3IDX, 103>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==104) {return;} calGradCnlmL3SubSub_<L3IDX, 104>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==105) {return;} calGradCnlmL3SubSub_<L3IDX, 105>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==106) {return;} calGradCnlmL3SubSub_<L3IDX, 106>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==107) {return;} calGradCnlmL3SubSub_<L3IDX, 107>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==108) {return;} calGradCnlmL3SubSub_<L3IDX, 108>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==109) {return;} calGradCnlmL3SubSub_<L3IDX, 109>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
}
template <jint L3MAX, jboolean L3CROSS>
static void calGradCnlmL3_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aGradNNGradCnlm, jdouble *aNNGrad) noexcept {
    if (L3MAX <= 1) return;
    calGradCnlmL3Sub_<0>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    if (L3CROSS) {
        calGradCnlmL3Sub_<1>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 2) return;
    if (L3CROSS) {
        calGradCnlmL3Sub_<2>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<3>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 3) return;
    calGradCnlmL3Sub_<4>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    if (L3CROSS) {
        calGradCnlmL3Sub_<5>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<6>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<7>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<8>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 4) return;
    if (L3CROSS) {
        calGradCnlmL3Sub_<9>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<10>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<11>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<12>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<13>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L3MAX == 5) return;
    calGradCnlmL3Sub_<14>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    if (L3CROSS) {
        calGradCnlmL3Sub_<15>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<16>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<17>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<18>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<19>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<20>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<21>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL3Sub_<22>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    }
}

template <jint L4IDX, jint SUBIDX>
static inline void calGradCnlmL4SubSub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aGradNNGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint i1 = L4_INDEX[L4IDX][SUBIDX][0];
    constexpr jint i2 = L4_INDEX[L4IDX][SUBIDX][1];
    constexpr jint i3 = L4_INDEX[L4IDX][SUBIDX][2];
    constexpr jint i4 = L4_INDEX[L4IDX][SUBIDX][3];
    constexpr jdouble coeff = L4_COEFF[L4IDX][SUBIDX];
    const jdouble tMul = coeff * aSubNNGrad;
    const jdouble tCnlm1 = aCnlm[i1], tGGCnlm1 = aGradNNGradCnlm[i1];
    const jdouble tCnlm2 = aCnlm[i2], tGGCnlm2 = aGradNNGradCnlm[i2];
    const jdouble tCnlm3 = aCnlm[i3], tGGCnlm3 = aGradNNGradCnlm[i3];
    const jdouble tCnlm4 = aCnlm[i4], tGGCnlm4 = aGradNNGradCnlm[i4];
    rGradCnlm[i1] += tMul * (tGGCnlm2*tCnlm3*tCnlm4 + tCnlm2*tGGCnlm3*tCnlm4 + tCnlm2*tCnlm3*tGGCnlm4);
    rGradCnlm[i2] += tMul * (tGGCnlm1*tCnlm3*tCnlm4 + tCnlm1*tGGCnlm3*tCnlm4 + tCnlm1*tCnlm3*tGGCnlm4);
    rGradCnlm[i3] += tMul * (tGGCnlm1*tCnlm2*tCnlm4 + tCnlm1*tGGCnlm2*tCnlm4 + tCnlm1*tCnlm2*tGGCnlm4);
    rGradCnlm[i4] += tMul * (tGGCnlm1*tCnlm2*tCnlm3 + tCnlm1*tGGCnlm2*tCnlm3 + tCnlm1*tCnlm2*tGGCnlm3);
}
template <jint L4IDX>
static void calGradCnlmL4Sub_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aGradNNGradCnlm, jdouble aSubNNGrad) noexcept {
    constexpr jint tSize = L4_SIZE[L4IDX];
    if (tSize==0) {return;} calGradCnlmL4SubSub_<L4IDX, 0>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==1) {return;} calGradCnlmL4SubSub_<L4IDX, 1>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==2) {return;} calGradCnlmL4SubSub_<L4IDX, 2>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==3) {return;} calGradCnlmL4SubSub_<L4IDX, 3>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==4) {return;} calGradCnlmL4SubSub_<L4IDX, 4>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==5) {return;} calGradCnlmL4SubSub_<L4IDX, 5>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==6) {return;} calGradCnlmL4SubSub_<L4IDX, 6>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==7) {return;} calGradCnlmL4SubSub_<L4IDX, 7>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==8) {return;} calGradCnlmL4SubSub_<L4IDX, 8>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==9) {return;} calGradCnlmL4SubSub_<L4IDX, 9>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==10) {return;} calGradCnlmL4SubSub_<L4IDX, 10>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==11) {return;} calGradCnlmL4SubSub_<L4IDX, 11>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==12) {return;} calGradCnlmL4SubSub_<L4IDX, 12>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==13) {return;} calGradCnlmL4SubSub_<L4IDX, 13>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==14) {return;} calGradCnlmL4SubSub_<L4IDX, 14>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==15) {return;} calGradCnlmL4SubSub_<L4IDX, 15>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==16) {return;} calGradCnlmL4SubSub_<L4IDX, 16>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==17) {return;} calGradCnlmL4SubSub_<L4IDX, 17>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==18) {return;} calGradCnlmL4SubSub_<L4IDX, 18>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==19) {return;} calGradCnlmL4SubSub_<L4IDX, 19>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==20) {return;} calGradCnlmL4SubSub_<L4IDX, 20>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==21) {return;} calGradCnlmL4SubSub_<L4IDX, 21>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==22) {return;} calGradCnlmL4SubSub_<L4IDX, 22>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==23) {return;} calGradCnlmL4SubSub_<L4IDX, 23>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==24) {return;} calGradCnlmL4SubSub_<L4IDX, 24>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==25) {return;} calGradCnlmL4SubSub_<L4IDX, 25>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==26) {return;} calGradCnlmL4SubSub_<L4IDX, 26>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==27) {return;} calGradCnlmL4SubSub_<L4IDX, 27>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==28) {return;} calGradCnlmL4SubSub_<L4IDX, 28>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==29) {return;} calGradCnlmL4SubSub_<L4IDX, 29>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==30) {return;} calGradCnlmL4SubSub_<L4IDX, 30>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==31) {return;} calGradCnlmL4SubSub_<L4IDX, 31>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==32) {return;} calGradCnlmL4SubSub_<L4IDX, 32>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==33) {return;} calGradCnlmL4SubSub_<L4IDX, 33>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==34) {return;} calGradCnlmL4SubSub_<L4IDX, 34>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==35) {return;} calGradCnlmL4SubSub_<L4IDX, 35>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==36) {return;} calGradCnlmL4SubSub_<L4IDX, 36>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==37) {return;} calGradCnlmL4SubSub_<L4IDX, 37>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==38) {return;} calGradCnlmL4SubSub_<L4IDX, 38>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==39) {return;} calGradCnlmL4SubSub_<L4IDX, 39>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==40) {return;} calGradCnlmL4SubSub_<L4IDX, 40>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==41) {return;} calGradCnlmL4SubSub_<L4IDX, 41>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==42) {return;} calGradCnlmL4SubSub_<L4IDX, 42>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==43) {return;} calGradCnlmL4SubSub_<L4IDX, 43>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==44) {return;} calGradCnlmL4SubSub_<L4IDX, 44>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==45) {return;} calGradCnlmL4SubSub_<L4IDX, 45>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==46) {return;} calGradCnlmL4SubSub_<L4IDX, 46>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==47) {return;} calGradCnlmL4SubSub_<L4IDX, 47>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==48) {return;} calGradCnlmL4SubSub_<L4IDX, 48>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==49) {return;} calGradCnlmL4SubSub_<L4IDX, 49>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==50) {return;} calGradCnlmL4SubSub_<L4IDX, 50>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==51) {return;} calGradCnlmL4SubSub_<L4IDX, 51>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==52) {return;} calGradCnlmL4SubSub_<L4IDX, 52>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==53) {return;} calGradCnlmL4SubSub_<L4IDX, 53>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==54) {return;} calGradCnlmL4SubSub_<L4IDX, 54>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==55) {return;} calGradCnlmL4SubSub_<L4IDX, 55>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==56) {return;} calGradCnlmL4SubSub_<L4IDX, 56>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==57) {return;} calGradCnlmL4SubSub_<L4IDX, 57>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==58) {return;} calGradCnlmL4SubSub_<L4IDX, 58>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==59) {return;} calGradCnlmL4SubSub_<L4IDX, 59>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==60) {return;} calGradCnlmL4SubSub_<L4IDX, 60>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==61) {return;} calGradCnlmL4SubSub_<L4IDX, 61>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==62) {return;} calGradCnlmL4SubSub_<L4IDX, 62>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==63) {return;} calGradCnlmL4SubSub_<L4IDX, 63>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==64) {return;} calGradCnlmL4SubSub_<L4IDX, 64>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==65) {return;} calGradCnlmL4SubSub_<L4IDX, 65>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==66) {return;} calGradCnlmL4SubSub_<L4IDX, 66>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==67) {return;} calGradCnlmL4SubSub_<L4IDX, 67>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==68) {return;} calGradCnlmL4SubSub_<L4IDX, 68>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==69) {return;} calGradCnlmL4SubSub_<L4IDX, 69>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==70) {return;} calGradCnlmL4SubSub_<L4IDX, 70>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==71) {return;} calGradCnlmL4SubSub_<L4IDX, 71>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==72) {return;} calGradCnlmL4SubSub_<L4IDX, 72>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==73) {return;} calGradCnlmL4SubSub_<L4IDX, 73>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==74) {return;} calGradCnlmL4SubSub_<L4IDX, 74>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==75) {return;} calGradCnlmL4SubSub_<L4IDX, 75>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==76) {return;} calGradCnlmL4SubSub_<L4IDX, 76>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==77) {return;} calGradCnlmL4SubSub_<L4IDX, 77>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==78) {return;} calGradCnlmL4SubSub_<L4IDX, 78>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==79) {return;} calGradCnlmL4SubSub_<L4IDX, 79>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==80) {return;} calGradCnlmL4SubSub_<L4IDX, 80>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==81) {return;} calGradCnlmL4SubSub_<L4IDX, 81>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==82) {return;} calGradCnlmL4SubSub_<L4IDX, 82>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==83) {return;} calGradCnlmL4SubSub_<L4IDX, 83>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==84) {return;} calGradCnlmL4SubSub_<L4IDX, 84>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==85) {return;} calGradCnlmL4SubSub_<L4IDX, 85>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==86) {return;} calGradCnlmL4SubSub_<L4IDX, 86>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==87) {return;} calGradCnlmL4SubSub_<L4IDX, 87>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==88) {return;} calGradCnlmL4SubSub_<L4IDX, 88>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==89) {return;} calGradCnlmL4SubSub_<L4IDX, 89>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==90) {return;} calGradCnlmL4SubSub_<L4IDX, 90>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==91) {return;} calGradCnlmL4SubSub_<L4IDX, 91>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==92) {return;} calGradCnlmL4SubSub_<L4IDX, 92>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==93) {return;} calGradCnlmL4SubSub_<L4IDX, 93>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==94) {return;} calGradCnlmL4SubSub_<L4IDX, 94>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==95) {return;} calGradCnlmL4SubSub_<L4IDX, 95>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==96) {return;} calGradCnlmL4SubSub_<L4IDX, 96>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==97) {return;} calGradCnlmL4SubSub_<L4IDX, 97>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==98) {return;} calGradCnlmL4SubSub_<L4IDX, 98>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
    if (tSize==99) {return;} calGradCnlmL4SubSub_<L4IDX, 99>(aCnlm, rGradCnlm, aGradNNGradCnlm, aSubNNGrad);
}
template <jint L4MAX, jboolean L4CROSS>
static void calGradCnlmL4_(jdouble *aCnlm, jdouble *rGradCnlm, jdouble *aGradNNGradCnlm, jdouble *aNNGrad) noexcept {
    if (L4MAX < 1) return;
    calGradCnlmL4Sub_<0>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    if (L4MAX == 1) return;
    calGradCnlmL4Sub_<1>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    if (L4CROSS) {
        calGradCnlmL4Sub_<2>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    }
    if (L4MAX == 2) return;
    calGradCnlmL4Sub_<3>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    if (L4CROSS) {
        calGradCnlmL4Sub_<4>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL4Sub_<5>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL4Sub_<6>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL4Sub_<7>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
        calGradCnlmL4Sub_<8>(aCnlm, rGradCnlm, aGradNNGradCnlm, *aNNGrad); ++aNNGrad;
    }
}

}

#endif //BASIS_SPHERICAL_UTIL_H
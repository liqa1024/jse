#include "jsex_nnap_basis_SphericalChebyshev.h"
#include "basis_util.h"

#ifdef __cplusplus
extern "C" {
#endif

#define SH_LARGEST_L (20)

#define WIGNER_222_000 (-0.23904572186687872)
#define WIGNER_222_011 (0.11952286093343936)
#define WIGNER_222_022 (0.23904572186687872)
#define WIGNER_222_112 (-0.29277002188455997)

#define WIGNER_112_000 (0.3651483716701107)
#define WIGNER_112_011 (-0.3162277660168379)
#define WIGNER_112_110 (0.18257418583505536)
#define WIGNER_112_112 (0.44721359549995787)

#define WIGNER_233_000 (0.19518001458970663)
#define WIGNER_233_011 (-0.14638501094227996)
#define WIGNER_233_022 (-0.0)
#define WIGNER_233_033 (0.2439750182371333)
#define WIGNER_233_110 (-0.06900655593423542)
#define WIGNER_233_220 (-0.2182178902359924)
#define WIGNER_233_112 (0.1889822365046136)
#define WIGNER_233_211 (0.23904572186687872)
#define WIGNER_233_123 (-0.2439750182371333)
#define WIGNER_233_213 (0.15430334996209188)

#define WIGNER_123_000 (-0.29277002188455997)
#define WIGNER_123_011 (0.2760262237369417)
#define WIGNER_123_022 (-0.2182178902359924)
#define WIGNER_123_110 (-0.1690308509457033)
#define WIGNER_123_101 (0.23904572186687872)
#define WIGNER_123_112 (-0.3086066999241838)
#define WIGNER_123_121 ( 0.09759000729485331)
#define WIGNER_123_123 (0.3779644730092272)

#define WIGNER_444_000 (0.13409704688030227)
#define WIGNER_444_011 (-0.06704852344015112)
#define WIGNER_444_022 (-0.08194819531574027)
#define WIGNER_444_033 (0.15644655469368596)
#define WIGNER_444_044 (0.10429770312912397)
#define WIGNER_444_112 (0.14135069854804388)
#define WIGNER_444_224 (0.18698939800169143)
#define WIGNER_444_123 (-0.06232979933389714)
#define WIGNER_444_134 (-0.1649091483060512)

#define WIGNER_224_000 (0.23904572186687872)
#define WIGNER_224_011 (-0.21821789023599236)
#define WIGNER_224_022 (0.15430334996209188)
#define WIGNER_224_110 (0.15936381457791915)
#define WIGNER_224_220 (0.03984095364447979)
#define WIGNER_224_112 (0.25197631533948484)
#define WIGNER_224_224 (0.3333333333333333)
#define WIGNER_224_121 (-0.0890870806374748)
#define WIGNER_224_123 (-0.23570226039551587)

#define WIGNER_334_000 (-0.16116459280507608)
#define WIGNER_334_011 (0.10403129732205986)
#define WIGNER_334_022 (0.046524210519923545)
#define WIGNER_334_033 (-0.21320071635561044)
#define WIGNER_334_110 (0.02686076546751269)
#define WIGNER_334_220 (0.18802535827258873)
#define WIGNER_334_330 (0.08058229640253803)
#define WIGNER_334_112 (-0.1698823971458752)
#define WIGNER_334_224 (-0.2247332874877474)
#define WIGNER_334_121 (-0.15194743527951726)
#define WIGNER_334_123 (0.10050378152592121)
#define WIGNER_334_132 (0.1973855084879307)
#define WIGNER_334_231 (-0.14712247158412492)
#define WIGNER_334_134 (0.17407765595569782)

#define WIGNER_244_000 (-0.1698823971458752)
#define WIGNER_244_011 (0.14440003757399392)
#define WIGNER_244_022 (-0.06795295885835007)
#define WIGNER_244_033 (-0.059458839001056314)
#define WIGNER_244_044 (0.23783535600422528)
#define WIGNER_244_110 (0.046524210519923545)
#define WIGNER_244_220 (0.19738550848793068)
#define WIGNER_244_211 (-0.20806259464411975)
#define WIGNER_244_112 (-0.13241022442571243)
#define WIGNER_244_224 (0.11009637651263607)
#define WIGNER_244_123 (0.19462473604038075)
#define WIGNER_244_213 (-0.1651445647689541)
#define WIGNER_244_134 (-0.2059714602177749)

#define WIGNER_134_000 (0.25197631533948484)
#define WIGNER_134_011 (-0.2439750182371333)
#define WIGNER_134_022 (0.2182178902359924)
#define WIGNER_134_033 (-0.16666666666666669)
#define WIGNER_134_110 (0.1543033499620919)
#define WIGNER_134_101 (-0.19920476822239896)
#define WIGNER_134_112 (0.2439750182371333)
#define WIGNER_134_121 (-0.1091089451179962)
#define WIGNER_134_123 (-0.2886751345948129)
#define WIGNER_134_132 (0.06299407883487121)
#define WIGNER_134_134 (0.33333333333333337)

static const jint L3NCOLS[5] = {0, 0, 2, 4, 9};
static const jint L3NCOLS_NOCROSS[5] = {0, 0, 1, 1, 2};
static const double SH_Alm[(SH_LARGEST_L+2)*(SH_LARGEST_L+1)/2] = {
    0.0,
    0.0, 0.0,
    1.9364916731037085, 0.0, 0.0,
    1.9720265943665387, 2.091650066335189, 0.0, 0.0,
    1.984313483298443, 2.04939015319192, 2.29128784747792, 0.0, 0.0,
    1.98997487421324, 2.03100960115899, 2.1712405933672376, 2.48746859276655, 0.0, 0.0,
    1.9930434571835665, 2.0213149892370277, 2.1139418156609704, 2.301368353023109, 2.6739483914241875, 0.0, 0.0,
    1.9948914348241344, 2.0155644370746373, 2.0816659994661326, 2.207940216581962, 2.4308621740219887, 2.850438562747845, 0.0, 0.0,
    1.996089927833914, 2.011869540407391, 2.0615528128088303, 2.15322168769582, 2.3048861143232218, 2.557041559783794, 3.017804310611087, 0.0, 0.0,
    1.9969111950679366, 2.0093531297410117, 2.048122358357819, 2.1180441711898057, 2.229177150706235, 2.401636346922061, 2.679137506321349, 3.1770662567847086, 0.0, 0.0,
    1.997498435543818, 2.0075614636426526, 2.038688303787511, 2.0939473213563384, 2.179449471770337, 2.3065125189341593, 2.496873044429772, 2.7970572771691153, 3.3291640592396967, 0.0, 0.0,
    1.9979328159850827, 2.006240264773888, 2.031798495964875, 2.0766559657295187, 2.1447610589527217, 2.2430448056157952, 2.3837686425440854, 2.5900450446533423, 2.910959328215754, 3.4749100707788108, 0.0, 0.0,
    1.998263134713633, 2.0052378963551982, 2.026608708444444, 2.0637972912229676, 2.1194781197266463, 2.1981657747106436, 2.307395517477243, 2.460209661583209, 2.680951323690902, 3.021089890583219, 3.614994027406106, 0.0, 0.0,
    1.998520162579474, 2.004459314343183, 2.0225995873897262, 2.053959590644373, 2.100420126042015, 2.165063509461097, 2.252817784447915, 2.3717082451262845, 2.53546276418555, 2.7695585470349866, 3.1277162108561214, 3.75, 0.0, 0.0,
    1.9987240828047461, 2.0038424627162224, 2.019436802675439, 2.0462565272714635, 2.085665361461421, 2.1398475105532757, 2.212182180562894, 2.307927774486216, 2.435532422657966, 2.6093477445855915, 2.8559149146989657, 3.2310988842807022, 3.880424243261593, 0.0, 0.0,
    1.9988885800753267, 2.003345416333104, 2.0168969490698876, 2.040107114108727, 2.0739902137422357, 2.120141504711419, 2.1809662438042814, 2.260078437898682, 2.363017336304797, 2.4986107250941583, 2.6817904466978773, 2.9401072717216916, 3.331480966792211, 4.006690832666208, 0.0, 0.0,
    1.9990231989649345, 2.002939017015334, 2.014825999813336, 2.035116803738375, 2.064582282206258, 2.104417123236605, 2.1563858652847827, 2.2230674720995864, 2.3082731640774234, 2.4177911997760035, 2.5607991541103545, 2.7527763762750106, 3.0222389997200043, 3.4290845264669656, 4.129164564412516, 0.0, 0.0,
    1.999134760937227, 2.002602473449653, 2.013114894621608, 2.03100960115899, 2.0568833780186058, 2.091650066335189, 2.1366369348357592, 2.1937410968480306, 2.265686062395524, 2.356455943866682, 2.4720661623652207, 2.622022120425379, 2.822324793743504, 3.1024184114977142, 3.5241105031922135, 4.248161366991607, 0.0, 0.0,
    1.9992282461607314, 2.0023206350873464, 2.011684617428885, 2.0275875100994063, 2.050498830661811, 2.081130384894172, 2.120501774999912, 2.170043987823959, 2.231763704062155, 2.3085099321848035, 2.404423007708918, 2.5257296658248256, 2.6822461565718467, 2.8904737863674566, 3.1807526624998683, 3.616739979706598, 4.363956650455962, 0.0, 0.0,
    1.9993073592865873, 2.0020822493927, 2.0104767610501466, 2.024705365770985, 2.045142707894042, 2.0723520109148583, 2.1071307505705477, 2.1505813167606567, 2.2042200113840402, 2.27014788693852, 2.351326355949745, 2.452039967047846, 2.5787147157554005, 2.7414640249326636, 2.957271469692045, 3.2573446421352252, 3.7071359757712075, 4.476792006187765, 0.0, 0.0,
    1.9993749023132206, 2.0018788167600157, 2.0094473837049796, 2.0222546987202583, 2.0406034646643136, 2.064945519862449, 2.0959143930173156, 2.1343747458109497, 2.181496864867922, 2.2388700687965297, 2.3086792761230392, 2.393988887964797, 2.499218627891526, 2.630984211674012, 2.7996848562146504, 3.0227707252027662, 3.3322915038553673, 3.7954453500749294, 4.586880604965702, 0.0, 0.0
};
static const double SH_Blm[(SH_LARGEST_L+2)*(SH_LARGEST_L+1)/2] = {
    0.0,
    0.0, 0.0,
    -0.5773502691896257, 0.0, 0.0,
    -0.5163977794943222, -0.4472135954999579, 0.0, 0.0,
    -0.50709255283711, -0.47809144373375745, -0.3779644730092272, 0.0, 0.0,
    -0.5039526306789697, -0.4879500364742666, -0.4364357804719847, -0.3333333333333333, 0.0, 0.0,
    -0.502518907629606, -0.49236596391733095, -0.4605661864718383, -0.40201512610368484, -0.30151134457776363, 0.0, 0.0,
    -0.5017452060042545, -0.4947274449181537, -0.47304991679126607, -0.4345240946267408, -0.3739787960033829, -0.2773500981126146, 0.0, 0.0,
    -0.501280411827603, -0.4961389383568338, -0.4803844614152614, -0.4529108136578383, -0.41137667560372115, -0.35082320772281167, -0.2581988897471611, 0.0, 0.0,
    -0.5009794328681196, -0.4970501217477084, -0.48507125007266594, -0.464420364012824, -0.4338609156373123, -0.39107694443752145, -0.3313667478318056, -0.24253562503633297, 0.0, 0.0,
    -0.5007733956671915, -0.4976726017934395, -0.4882520792370033, -0.47213368521878024, -0.44859602103995444, -0.4163827722217815, -0.3732544513450796, -0.3147557901458535, -0.22941573387056177, 0.0, 0.0,
    -0.5006261743217588, -0.4981167541368988, -0.49051147158797265, -0.4775669329409193, -0.45883146774112354, -0.43355498476206, -0.4005009394574071, -0.3575185993374057, -0.3003757045930553, -0.21821789023599236, 0.0, 0.0,
    -0.5005173307126191, -0.49844478627922684, -0.4921747909480132, -0.4815434123430768, -0.4662524041201569, -0.44582257006028225, -0.4195037983773235, -0.38609367125267213, -0.34352936171490267, -0.2877772315344771, -0.20851441405707477, 0.0, 0.0,
    -0.5004345937369794, -0.4986939463979015, -0.49343516379516894, -0.48454371185234896, -0.4718142596956708, -0.4549247429401158, -0.4333890711087691, -0.4064694223485302, -0.3730019232961255, -0.33100637062042226, -0.27662562992324985, -0.2, 0.0, 0.0,
    -0.5003702332976756, -0.49888765156985887, -0.4944132324730442, -0.48686449556014766, -0.4760952285695233, -0.46188021535170065, -0.44388854123195953, -0.4216370213557839, -0.39440531887330776, -0.361068373539376, -0.3197221015541813, -0.26666666666666666, -0.19245008972987526, 0.0, 0.0,
    -0.5003191829243042, -0.49904122634695197, -0.4951875684721383, -0.4886972804594683, -0.47946330148538413, -0.46732301954611777, -0.4520423357472069, -0.433289122413121, -0.4105878413676265, -0.38323753592253257, -0.3501504876259268, -0.30949223029508643, -0.25770378116168946, -0.18569533817705186, 0.0, 0.0,
    -0.5002780094738025, -0.4991650425568579, -0.4958111521072805, -0.49017034109842594, -0.4821623522493073, -0.4716666306365782, -0.458512369387107, -0.4424625195441246, -0.42318775433267225, -0.40022240757904204, -0.3728852122772354, -0.34012364433710335, -0.3001668056842815, -0.24958252127842895, -0.1796053020267749, 0.0, 0.0,
    -0.5002443195845779, -0.4992663238894528, -0.49632077414756665, -0.4913722879016409, -0.4843594796964828, -0.47519096331149147, -0.4637388957601683, -0.44982890197909525, -0.43322428885910585, -0.41360064512297223, -0.39050309681448225, -0.36326960977236206, -0.33088051609837776, -0.2916230242449912, -0.2421797398482414, -0.17407765595569785, 0.0, 0.0,
    -0.5002164033860247, -0.4993502271458874, -0.496742636335202, -0.49236596391733095, -0.4861724348043977, -0.47809144373375745, -0.4680252333449758, -0.4558423058385518, -0.4413674147523748, -0.4243660920556449, -0.40451991747794525, -0.3813850356982369, -0.3543178312491844, -0.3223291856101521, -0.28375954701028216, -0.23539595453459988, -0.1690308509457033, 0.0, 0.0,
    -0.5001930129390556, -0.4994205136163806, -0.49709581280096005, -0.4931969619160719, -0.4876862083736199, -0.48050809658946525, -0.4715864951351156, -0.4608201518545086, -0.44807611046807744, -0.4331798560007005, -0.41590019592802907, -0.3959251908590268, -0.37282185960072, -0.3459640439281511, -0.3143909967567437, -0.2764920911127051, -0.2291498472826297, -0.1643989873053573, 0.0, 0.0,
    -0.5001732201680236, -0.49947997905846986, -0.49739445855502595, -0.493899022003733, -0.48896343328028025, -0.4825435035810065, -0.4745789978762495, -0.46499055497527714, -0.4536752206382952, -0.44049993648148694, -0.4252918772715756, -0.40782369514309286, -0.38779008546009835, -0.3647686020700426, -0.3381495443514812, -0.3069985248304855, -0.26975001902701096, -0.22337423731498202, -0.16012815380508713, 0.0, 0.0
};
static const double SQRT_LPM_LMM1[(SH_LARGEST_L+1)*(SH_LARGEST_L+1)] = {
    0.0,
    0.0, 1.4142135623730951, 1.4142135623730951,
    0.0, 2.0, 2.449489742783178, 2.449489742783178, 2.0,
    0.0, 2.449489742783178, 3.1622776601683795, 3.4641016151377544, 3.4641016151377544, 3.1622776601683795, 2.449489742783178,
    0.0, 2.8284271247461903, 3.7416573867739413, 4.242640687119285, 4.47213595499958, 4.47213595499958, 4.242640687119285, 3.7416573867739413, 2.8284271247461903,
    0.0, 3.1622776601683795, 4.242640687119285, 4.898979485566356, 5.291502622129181, 5.477225575051661, 5.477225575051661, 5.291502622129181, 4.898979485566356, 4.242640687119285, 3.1622776601683795,
    0.0, 3.4641016151377544, 4.69041575982343, 5.477225575051661, 6.0, 6.324555320336759, 6.48074069840786, 6.48074069840786, 6.324555320336759, 6.0, 5.477225575051661, 4.69041575982343, 3.4641016151377544,
    0.0, 3.7416573867739413, 5.0990195135927845, 6.0, 6.6332495807108, 7.0710678118654755, 7.3484692283495345, 7.483314773547883, 7.483314773547883, 7.3484692283495345, 7.0710678118654755, 6.6332495807108, 6.0, 5.0990195135927845, 3.7416573867739413,
    0.0, 4.0, 5.477225575051661, 6.48074069840786, 7.211102550927978, 7.745966692414834, 8.12403840463596, 8.366600265340756, 8.48528137423857, 8.48528137423857, 8.366600265340756, 8.12403840463596, 7.745966692414834, 7.211102550927978, 6.48074069840786, 5.477225575051661, 4.0,
    0.0, 4.242640687119285, 5.830951894845301, 6.928203230275509, 7.745966692414834, 8.366600265340756, 8.831760866327848, 9.16515138991168, 9.38083151964686, 9.486832980505138, 9.486832980505138, 9.38083151964686, 9.16515138991168, 8.831760866327848, 8.366600265340756, 7.745966692414834, 6.928203230275509, 5.830951894845301, 4.242640687119285,
    0.0, 4.47213595499958, 6.164414002968976, 7.3484692283495345, 8.246211251235321, 8.94427190999916, 9.486832980505138, 9.899494936611665, 10.198039027185569, 10.392304845413264, 10.488088481701515, 10.488088481701515, 10.392304845413264, 10.198039027185569, 9.899494936611665, 9.486832980505138, 8.94427190999916, 8.246211251235321, 7.3484692283495345, 6.164414002968976, 4.47213595499958,
    0.0, 4.69041575982343, 6.48074069840786, 7.745966692414834, 8.717797887081348, 9.486832980505138, 10.099504938362077, 10.583005244258363, 10.954451150103322, 11.224972160321824, 11.40175425099138, 11.489125293076057, 11.489125293076057, 11.40175425099138, 11.224972160321824, 10.954451150103322, 10.583005244258363, 10.099504938362077, 9.486832980505138, 8.717797887081348, 7.745966692414834, 6.48074069840786, 4.69041575982343,
    0.0, 4.898979485566356, 6.782329983125268, 8.12403840463596, 9.16515138991168, 10.0, 10.677078252031311, 11.224972160321824, 11.661903789690601, 12.0, 12.24744871391589, 12.409673645990857, 12.489995996796797, 12.489995996796797, 12.409673645990857, 12.24744871391589, 12.0, 11.661903789690601, 11.224972160321824, 10.677078252031311, 10.0, 9.16515138991168, 8.12403840463596, 6.782329983125268, 4.898979485566356,
    0.0, 5.0990195135927845, 7.0710678118654755, 8.48528137423857, 9.591663046625438, 10.488088481701515, 11.224972160321824, 11.832159566199232, 12.328828005937952, 12.727922061357855, 13.038404810405298, 13.2664991614216, 13.416407864998739, 13.490737563232042, 13.490737563232042, 13.416407864998739, 13.2664991614216, 13.038404810405298, 12.727922061357855, 12.328828005937952, 11.832159566199232, 11.224972160321824, 10.488088481701515, 9.591663046625438, 8.48528137423857, 7.0710678118654755, 5.0990195135927845,
    0.0, 5.291502622129181, 7.3484692283495345, 8.831760866327848, 10.0, 10.954451150103322, 11.74734012447073, 12.409673645990857, 12.96148139681572, 13.416407864998739, 13.784048752090222, 14.071247279470288, 14.2828568570857, 14.422205101855956, 14.491376746189438, 14.491376746189438, 14.422205101855956, 14.2828568570857, 14.071247279470288, 13.784048752090222, 13.416407864998739, 12.96148139681572, 12.409673645990857, 11.74734012447073, 10.954451150103322, 10.0, 8.831760866327848, 7.3484692283495345, 5.291502622129181,
    0.0, 5.477225575051661, 7.615773105863909, 9.16515138991168, 10.392304845413264, 11.40175425099138, 12.24744871391589, 12.96148139681572, 13.564659966250536, 14.071247279470288, 14.491376746189438, 14.832396974191326, 15.0996688705415, 15.297058540778355, 15.427248620541512, 15.491933384829668, 15.491933384829668, 15.427248620541512, 15.297058540778355, 15.0996688705415, 14.832396974191326, 14.491376746189438, 14.071247279470288, 13.564659966250536, 12.96148139681572, 12.24744871391589, 11.40175425099138, 10.392304845413264, 9.16515138991168, 7.615773105863909, 5.477225575051661,
    0.0, 5.656854249492381, 7.874007874011811, 9.486832980505138, 10.770329614269007, 11.832159566199232, 12.727922061357855, 13.490737563232042, 14.142135623730951, 14.696938456699069, 15.165750888103101, 15.556349186104045, 15.874507866387544, 16.1245154965971, 16.30950643030009, 16.431676725154983, 16.492422502470642, 16.492422502470642, 16.431676725154983, 16.30950643030009, 16.1245154965971, 15.874507866387544, 15.556349186104045, 15.165750888103101, 14.696938456699069, 14.142135623730951, 13.490737563232042, 12.727922061357855, 11.832159566199232, 10.770329614269007, 9.486832980505138, 7.874007874011811, 5.656854249492381,
    0.0, 5.830951894845301, 8.12403840463596, 9.797958971132712, 11.135528725660043, 12.24744871391589, 13.19090595827292, 14.0, 14.696938456699069, 15.297058540778355, 15.811388300841896, 16.24807680927192, 16.61324772583615, 16.911534525287763, 17.146428199482248, 17.320508075688775, 17.435595774162696, 17.4928556845359, 17.4928556845359, 17.435595774162696, 17.320508075688775, 17.146428199482248, 16.911534525287763, 16.61324772583615, 16.24807680927192, 15.811388300841896, 15.297058540778355, 14.696938456699069, 14.0, 13.19090595827292, 12.24744871391589, 11.135528725660043, 9.797958971132712, 8.12403840463596, 5.830951894845301,
    0.0, 6.0, 8.366600265340756, 10.099504938362077, 11.489125293076057, 12.649110640673518, 13.638181696985855, 14.491376746189438, 15.231546211727817, 15.874507866387544, 16.431676725154983, 16.911534525287763, 17.320508075688775, 17.663521732655695, 17.944358444926362, 18.16590212458495, 18.33030277982336, 18.439088914585774, 18.49324200890693, 18.49324200890693, 18.439088914585774, 18.33030277982336, 18.16590212458495, 17.944358444926362, 17.663521732655695, 17.320508075688775, 16.911534525287763, 16.431676725154983, 15.874507866387544, 15.231546211727817, 14.491376746189438, 13.638181696985855, 12.649110640673518, 11.489125293076057, 10.099504938362077, 8.366600265340756, 6.0,
    0.0, 6.164414002968976, 8.602325267042627, 10.392304845413264, 11.832159566199232, 13.038404810405298, 14.071247279470288, 14.966629547095765, 15.748015748023622, 16.431676725154983, 17.029386365926403, 17.549928774784245, 18.0, 18.384776310850235, 18.708286933869708, 18.973665961010276, 19.183326093250876, 19.339079605813716, 19.44222209522358, 19.493588689617926, 19.493588689617926, 19.44222209522358, 19.339079605813716, 19.183326093250876, 18.973665961010276, 18.708286933869708, 18.384776310850235, 18.0, 17.549928774784245, 17.029386365926403, 16.431676725154983, 15.748015748023622, 14.966629547095765, 14.071247279470288, 13.038404810405298, 11.832159566199232, 10.392304845413264, 8.602325267042627, 6.164414002968976,
    0.0, 6.324555320336759, 8.831760866327848, 10.677078252031311, 12.165525060596439, 13.416407864998739, 14.491376746189438, 15.427248620541512, 16.24807680927192, 16.97056274847714, 17.60681686165901, 18.16590212458495, 18.65475810617763, 19.078784028338912, 19.44222209522358, 19.748417658131498, 20.0, 20.199009876724155, 20.346989949375804, 20.445048300260872, 20.493901531919196, 20.493901531919196, 20.445048300260872, 20.346989949375804, 20.199009876724155, 20.0, 19.748417658131498, 19.44222209522358, 19.078784028338912, 18.65475810617763, 18.16590212458495, 17.60681686165901, 16.97056274847714, 16.24807680927192, 15.427248620541512, 14.491376746189438, 13.416407864998739, 12.165525060596439, 10.677078252031311, 8.831760866327848, 6.324555320336759
};
static const double SQRT_LPM1_LMM[(SH_LARGEST_L+1)*(SH_LARGEST_L+1)] = {
    0.0,
    1.4142135623730951, 1.4142135623730951, 0.0,
    2.0, 2.449489742783178, 2.449489742783178, 2.0, 0.0,
    2.449489742783178, 3.1622776601683795, 3.4641016151377544, 3.4641016151377544, 3.1622776601683795, 2.449489742783178, 0.0,
    2.8284271247461903, 3.7416573867739413, 4.242640687119285, 4.47213595499958, 4.47213595499958, 4.242640687119285, 3.7416573867739413, 2.8284271247461903, 0.0,
    3.1622776601683795, 4.242640687119285, 4.898979485566356, 5.291502622129181, 5.477225575051661, 5.477225575051661, 5.291502622129181, 4.898979485566356, 4.242640687119285, 3.1622776601683795, 0.0,
    3.4641016151377544, 4.69041575982343, 5.477225575051661, 6.0, 6.324555320336759, 6.48074069840786, 6.48074069840786, 6.324555320336759, 6.0, 5.477225575051661, 4.69041575982343, 3.4641016151377544, 0.0,
    3.7416573867739413, 5.0990195135927845, 6.0, 6.6332495807108, 7.0710678118654755, 7.3484692283495345, 7.483314773547883, 7.483314773547883, 7.3484692283495345, 7.0710678118654755, 6.6332495807108, 6.0, 5.0990195135927845, 3.7416573867739413, 0.0,
    4.0, 5.477225575051661, 6.48074069840786, 7.211102550927978, 7.745966692414834, 8.12403840463596, 8.366600265340756, 8.48528137423857, 8.48528137423857, 8.366600265340756, 8.12403840463596, 7.745966692414834, 7.211102550927978, 6.48074069840786, 5.477225575051661, 4.0, 0.0,
    4.242640687119285, 5.830951894845301, 6.928203230275509, 7.745966692414834, 8.366600265340756, 8.831760866327848, 9.16515138991168, 9.38083151964686, 9.486832980505138, 9.486832980505138, 9.38083151964686, 9.16515138991168, 8.831760866327848, 8.366600265340756, 7.745966692414834, 6.928203230275509, 5.830951894845301, 4.242640687119285, 0.0,
    4.47213595499958, 6.164414002968976, 7.3484692283495345, 8.246211251235321, 8.94427190999916, 9.486832980505138, 9.899494936611665, 10.198039027185569, 10.392304845413264, 10.488088481701515, 10.488088481701515, 10.392304845413264, 10.198039027185569, 9.899494936611665, 9.486832980505138, 8.94427190999916, 8.246211251235321, 7.3484692283495345, 6.164414002968976, 4.47213595499958, 0.0,
    4.69041575982343, 6.48074069840786, 7.745966692414834, 8.717797887081348, 9.486832980505138, 10.099504938362077, 10.583005244258363, 10.954451150103322, 11.224972160321824, 11.40175425099138, 11.489125293076057, 11.489125293076057, 11.40175425099138, 11.224972160321824, 10.954451150103322, 10.583005244258363, 10.099504938362077, 9.486832980505138, 8.717797887081348, 7.745966692414834, 6.48074069840786, 4.69041575982343, 0.0,
    4.898979485566356, 6.782329983125268, 8.12403840463596, 9.16515138991168, 10.0, 10.677078252031311, 11.224972160321824, 11.661903789690601, 12.0, 12.24744871391589, 12.409673645990857, 12.489995996796797, 12.489995996796797, 12.409673645990857, 12.24744871391589, 12.0, 11.661903789690601, 11.224972160321824, 10.677078252031311, 10.0, 9.16515138991168, 8.12403840463596, 6.782329983125268, 4.898979485566356, 0.0,
    5.0990195135927845, 7.0710678118654755, 8.48528137423857, 9.591663046625438, 10.488088481701515, 11.224972160321824, 11.832159566199232, 12.328828005937952, 12.727922061357855, 13.038404810405298, 13.2664991614216, 13.416407864998739, 13.490737563232042, 13.490737563232042, 13.416407864998739, 13.2664991614216, 13.038404810405298, 12.727922061357855, 12.328828005937952, 11.832159566199232, 11.224972160321824, 10.488088481701515, 9.591663046625438, 8.48528137423857, 7.0710678118654755, 5.0990195135927845, 0.0,
    5.291502622129181, 7.3484692283495345, 8.831760866327848, 10.0, 10.954451150103322, 11.74734012447073, 12.409673645990857, 12.96148139681572, 13.416407864998739, 13.784048752090222, 14.071247279470288, 14.2828568570857, 14.422205101855956, 14.491376746189438, 14.491376746189438, 14.422205101855956, 14.2828568570857, 14.071247279470288, 13.784048752090222, 13.416407864998739, 12.96148139681572, 12.409673645990857, 11.74734012447073, 10.954451150103322, 10.0, 8.831760866327848, 7.3484692283495345, 5.291502622129181, 0.0,
    5.477225575051661, 7.615773105863909, 9.16515138991168, 10.392304845413264, 11.40175425099138, 12.24744871391589, 12.96148139681572, 13.564659966250536, 14.071247279470288, 14.491376746189438, 14.832396974191326, 15.0996688705415, 15.297058540778355, 15.427248620541512, 15.491933384829668, 15.491933384829668, 15.427248620541512, 15.297058540778355, 15.0996688705415, 14.832396974191326, 14.491376746189438, 14.071247279470288, 13.564659966250536, 12.96148139681572, 12.24744871391589, 11.40175425099138, 10.392304845413264, 9.16515138991168, 7.615773105863909, 5.477225575051661, 0.0,
    5.656854249492381, 7.874007874011811, 9.486832980505138, 10.770329614269007, 11.832159566199232, 12.727922061357855, 13.490737563232042, 14.142135623730951, 14.696938456699069, 15.165750888103101, 15.556349186104045, 15.874507866387544, 16.1245154965971, 16.30950643030009, 16.431676725154983, 16.492422502470642, 16.492422502470642, 16.431676725154983, 16.30950643030009, 16.1245154965971, 15.874507866387544, 15.556349186104045, 15.165750888103101, 14.696938456699069, 14.142135623730951, 13.490737563232042, 12.727922061357855, 11.832159566199232, 10.770329614269007, 9.486832980505138, 7.874007874011811, 5.656854249492381, 0.0,
    5.830951894845301, 8.12403840463596, 9.797958971132712, 11.135528725660043, 12.24744871391589, 13.19090595827292, 14.0, 14.696938456699069, 15.297058540778355, 15.811388300841896, 16.24807680927192, 16.61324772583615, 16.911534525287763, 17.146428199482248, 17.320508075688775, 17.435595774162696, 17.4928556845359, 17.4928556845359, 17.435595774162696, 17.320508075688775, 17.146428199482248, 16.911534525287763, 16.61324772583615, 16.24807680927192, 15.811388300841896, 15.297058540778355, 14.696938456699069, 14.0, 13.19090595827292, 12.24744871391589, 11.135528725660043, 9.797958971132712, 8.12403840463596, 5.830951894845301, 0.0,
    6.0, 8.366600265340756, 10.099504938362077, 11.489125293076057, 12.649110640673518, 13.638181696985855, 14.491376746189438, 15.231546211727817, 15.874507866387544, 16.431676725154983, 16.911534525287763, 17.320508075688775, 17.663521732655695, 17.944358444926362, 18.16590212458495, 18.33030277982336, 18.439088914585774, 18.49324200890693, 18.49324200890693, 18.439088914585774, 18.33030277982336, 18.16590212458495, 17.944358444926362, 17.663521732655695, 17.320508075688775, 16.911534525287763, 16.431676725154983, 15.874507866387544, 15.231546211727817, 14.491376746189438, 13.638181696985855, 12.649110640673518, 11.489125293076057, 10.099504938362077, 8.366600265340756, 6.0, 0.0,
    6.164414002968976, 8.602325267042627, 10.392304845413264, 11.832159566199232, 13.038404810405298, 14.071247279470288, 14.966629547095765, 15.748015748023622, 16.431676725154983, 17.029386365926403, 17.549928774784245, 18.0, 18.384776310850235, 18.708286933869708, 18.973665961010276, 19.183326093250876, 19.339079605813716, 19.44222209522358, 19.493588689617926, 19.493588689617926, 19.44222209522358, 19.339079605813716, 19.183326093250876, 18.973665961010276, 18.708286933869708, 18.384776310850235, 18.0, 17.549928774784245, 17.029386365926403, 16.431676725154983, 15.748015748023622, 14.966629547095765, 14.071247279470288, 13.038404810405298, 11.832159566199232, 10.392304845413264, 8.602325267042627, 6.164414002968976, 0.0,
    6.324555320336759, 8.831760866327848, 10.677078252031311, 12.165525060596439, 13.416407864998739, 14.491376746189438, 15.427248620541512, 16.24807680927192, 16.97056274847714, 17.60681686165901, 18.16590212458495, 18.65475810617763, 19.078784028338912, 19.44222209522358, 19.748417658131498, 20.0, 20.199009876724155, 20.346989949375804, 20.445048300260872, 20.493901531919196, 20.493901531919196, 20.445048300260872, 20.346989949375804, 20.199009876724155, 20.0, 19.748417658131498, 19.44222209522358, 19.078784028338912, 18.65475810617763, 18.16590212458495, 17.60681686165901, 16.97056274847714, 16.24807680927192, 15.427248620541512, 14.491376746189438, 13.416407864998739, 12.165525060596439, 10.677078252031311, 8.831760866327848, 6.324555320336759, 0.0
};

static inline void realNormalizedLegendreFull(jint aLMax, double aX, double aY, double *rDest) {
    double tPll = 0.28209479177387814347403972578039; // = sqrt(1/(4*PI))
    rDest[0] = tPll;
    if (aLMax > 0) {
        rDest[2] = SQRT3 * aX * tPll;
        tPll *= (-SQRT3DIV2 * aY);
        rDest[2+1] = tPll;
        rDest[2-1] = tPll;
        jint tStartL = 6, tStartLmm = 2, tStartLm2 = 0;
        jint tStartAB = 3;
        for (jint tL = 2; tL <= aLMax; ++tL) {
            for (jint tM = 0; tM < tL-1; ++tM) {
                jint tIdxAB = tStartAB+tM;
                double tPlm = SH_Alm[tIdxAB] * (aX*rDest[tStartLmm+tM] + SH_Blm[tIdxAB]*rDest[tStartLm2+tM]);
                if (tM == 0) {
                    rDest[tStartL] = tPlm;
                } else {
                    rDest[tStartL+tM] = tPlm;
                    rDest[tStartL-tM] = tPlm;
                }
            }
            double tPlm = aX * sqrt(2.0*(tL-1) + 3.0) * tPll;
            rDest[tStartL+(tL-1)] = tPlm;
            rDest[tStartL-(tL-1)] = tPlm;
            tPll *= (-sqrt(1.0 + 0.5/(double)tL) * aY);
            rDest[tStartL+tL] = tPll;
            rDest[tStartL-tL] = tPll;
            tStartLm2 = tStartLmm;
            tStartLmm = tStartL;
            tStartL += tL+tL+1+1;
            tStartAB += tL+1;
        }
    }
}
static inline void realSphericalHarmonicsFull4(jint aLMax, double aX, double aY, double aZ, double aDis, double *rDest) {
    double tXY = hypot(aX, aY);
    double tCosTheta = aZ / aDis;
    double tSinTheta = tXY / aDis;
    double tCosPhi;
    double tSinPhi;
    // avoid nan
    if (numericEqual_jse(tXY, 0.0)) {
        tCosPhi = 1.0;
        tSinPhi = 0.0;
    } else {
        tCosPhi = aX / tXY;
        tSinPhi = aY / tXY;
    }
    // cal real Legendre
    realNormalizedLegendreFull(aLMax, tCosTheta, tSinTheta, rDest);
    // cal sinMPhi & conMPhi
    double tSinMmmPhi = 0.0;
    double tCosMmmPhi = 1.0;
    double tSinMPhi = tSinPhi;
    double tCosMPhi = tCosPhi;
    const double tCosPhi2 = tCosMPhi+tCosMPhi;
    for (jint tM = 1; tM <= aLMax; ++tM) {
        jint tStartL = tM*tM+tM;
        const double fSqrt2CosMPhi = SQRT2*tCosMPhi;
        const double fSqrt2SinMPhi = SQRT2*tSinMPhi;
        for (jint tL = tM; tL <= aLMax; ++tL) {
            rDest[tStartL+tM] *= fSqrt2CosMPhi;
            rDest[tStartL-tM] *= fSqrt2SinMPhi;
            tStartL += tL+tL+2;
        }
        double tSinMppPhi = tCosPhi2 * tSinMPhi - tSinMmmPhi;
        double tCosMppPhi = tCosPhi2 * tCosMPhi - tCosMmmPhi;
        tSinMmmPhi = tSinMPhi; tCosMmmPhi = tCosMPhi;
        tSinMPhi = tSinMppPhi; tCosMPhi = tCosMppPhi;
    }
}


static inline void mplusCnlm(double *rCnlm, double *aY, double aFc, double aRn, jint aLength) {
    double tMul = aFc*aRn;
    for (jint i = 0; i < aLength; ++i) {
        rCnlm[i] += tMul*aY[i];
    }
}
static inline void mplusCnlmWt(double *rCnlm, double *rCnlmWt, double *aY, double aFc, double aRn, double aWt, jint aLength) {
    double tMul = aFc*aRn;
    for (jint i = 0; i < aLength; ++i) {
        double tCnli = tMul*aY[i];
        rCnlm[i] += tCnli;
        rCnlmWt[i] += aWt*tCnli;
    }
}

static inline void calL2_(double *aCnlm, double *rFp, jint aLMax, jboolean aNoRadial) {
    // l == 0
    double tCnl0;
    double tMul;
    double *tFp = rFp;
    if (!aNoRadial) {
        tCnl0 = aCnlm[0];
        tMul = PI4;
        tFp[0] = tMul * (tCnl0*tCnl0);
        ++tFp;
    }
    if (aLMax == 0) return;
    // l = 1
    tCnl0 = aCnlm[1]; double tCnl1 = aCnlm[1+1], tCnl2 = aCnlm[1+2];
    tMul = PI4/3;
    tFp[0] = tMul * (tCnl0*tCnl0 + tCnl1*tCnl1 + tCnl2*tCnl2);
    if (aLMax == 1) return;
    // l = 2
    tCnl0 = aCnlm[4]; tCnl1 = aCnlm[4+1]; tCnl2 = aCnlm[4+2]; double tCnl3 = aCnlm[4+3], tCnl4 = aCnlm[4+4];
    tMul = PI4/5;
    tFp[1] = tMul * (tCnl0*tCnl0 + tCnl1*tCnl1 + tCnl2*tCnl2 + tCnl3*tCnl3 + tCnl4*tCnl4);
    if (aLMax == 2) return;
    // l = 3
    tCnl0 = aCnlm[9]; tCnl1 = aCnlm[9+1]; tCnl2 = aCnlm[9+2]; tCnl3 = aCnlm[9+3]; tCnl4 = aCnlm[9+4]; double tCnl5 = aCnlm[9+5], tCnl6 = aCnlm[9+6];
    tMul = PI4/7;
    tFp[2] = tMul * (tCnl0*tCnl0 + tCnl1*tCnl1 + tCnl2*tCnl2 + tCnl3*tCnl3 + tCnl4*tCnl4 + tCnl5*tCnl5 + tCnl6*tCnl6);
    if (aLMax == 3) return;
    // l = 4
    tCnl0 = aCnlm[16]; tCnl1 = aCnlm[16+1]; tCnl2 = aCnlm[16+2]; tCnl3 = aCnlm[16+3]; tCnl4 = aCnlm[16+4]; tCnl5 = aCnlm[16+5]; tCnl6 = aCnlm[16+6]; double tCnl7 = aCnlm[16+7], tCnl8 = aCnlm[16+8];
    tMul = PI4/9;
    tFp[3] = tMul * (tCnl0*tCnl0 + tCnl1*tCnl1 + tCnl2*tCnl2 + tCnl3*tCnl3 + tCnl4*tCnl4 + tCnl5*tCnl5 + tCnl6*tCnl6 + tCnl7*tCnl7 + tCnl8*tCnl8);
    if (aLMax == 4) return;
    // l = 5
    tCnl0 = aCnlm[25]; tCnl1 = aCnlm[25+1]; tCnl2 = aCnlm[25+2]; tCnl3 = aCnlm[25+3]; tCnl4 = aCnlm[25+4]; tCnl5 = aCnlm[25+5]; tCnl6 = aCnlm[25+6]; tCnl7 = aCnlm[25+7]; tCnl8 = aCnlm[25+8]; double tCnl9 = aCnlm[25+9], tCnl10 = aCnlm[25+10];
    tMul = PI4/11;
    tFp[4] = tMul * (tCnl0*tCnl0 + tCnl1*tCnl1 + tCnl2*tCnl2 + tCnl3*tCnl3 + tCnl4*tCnl4 + tCnl5*tCnl5 + tCnl6*tCnl6 + tCnl7*tCnl7 + tCnl8*tCnl8 + tCnl9*tCnl9 + tCnl10*tCnl10);
    if (aLMax == 5) return;
    // l = 6
    tCnl0 = aCnlm[36]; tCnl1 = aCnlm[36+1]; tCnl2 = aCnlm[36+2]; tCnl3 = aCnlm[36+3]; tCnl4 = aCnlm[36+4]; tCnl5 = aCnlm[36+5]; tCnl6 = aCnlm[36+6]; tCnl7 = aCnlm[36+7]; tCnl8 = aCnlm[36+8]; tCnl9 = aCnlm[36+9]; tCnl10 = aCnlm[36+10]; double tCnl11 = aCnlm[36+11], tCnl12 = aCnlm[36+12];
    tMul = PI4/13;
    tFp[5] = tMul * (tCnl0*tCnl0 + tCnl1*tCnl1 + tCnl2*tCnl2 + tCnl3*tCnl3 + tCnl4*tCnl4 + tCnl5*tCnl5 + tCnl6*tCnl6 + tCnl7*tCnl7 + tCnl8*tCnl8 + tCnl9*tCnl9 + tCnl10*tCnl10 + tCnl11*tCnl11 + tCnl12*tCnl12);
    if (aLMax == 6) return;
    // else
    for (jint tL = 7; tL <= aLMax; ++tL) {
        jint tLen = tL+tL+1;
        double rDot = dot_jse(aCnlm + (tL*tL), tLen);
        tMul = PI4/(double)tLen;
        tFp[tL-1] = tMul * rDot;
    }
}
static inline void calL3_(double *aCnlm, double *rFp, jint aLMax, jboolean aNoRadial, jint aL3Max, jboolean aL3Cross) {
    if (aL3Max <= 1) return;
    jint tIdxFP = aNoRadial ? aLMax : (aLMax+1);
    /// l1 = l2 = l3 = 2
    double c20  = aCnlm[(2*2+2)  ];
    double c21  = aCnlm[(2*2+2)+1];
    double c2n1 = aCnlm[(2*2+2)-1];
    double c22  = aCnlm[(2*2+2)+2];
    double c2n2 = aCnlm[(2*2+2)-2];
    double rFp3 = 0.0;
    rFp3 += WIGNER_222_000 * c20*c20*c20;
    rFp3 -= (3.0*WIGNER_222_011) * c20 * (c21*c21 + c2n1*c2n1);
    rFp3 += (3.0*WIGNER_222_022) * c20 * (c22*c22 + c2n2*c2n2);
    rFp3 += (3.0*SQRT2_INV*WIGNER_222_112) * c22 * (c21*c21 - c2n1*c2n1);
    rFp3 += (6.0*SQRT2_INV*WIGNER_222_112) * c21*c2n1*c2n2;
    rFp[tIdxFP] = rFp3;
    ++tIdxFP;
    double c10, c11, c1n1;
    if (aL3Cross) {
        /// l1 = l2 = 1, l3 = 2
        c10  = aCnlm[(1+1)  ];
        c11  = aCnlm[(1+1)+1];
        c1n1 = aCnlm[(1+1)-1];
        rFp3 = 0.0;
        rFp3 += WIGNER_112_000 * c10*c10*c20;
        rFp3 -= WIGNER_112_110 * c20 * (c11*c11 + c1n1*c1n1);
        rFp3 -= (2.0*WIGNER_112_011) * c10 * (c11*c21 + c1n1*c2n1);
        rFp3 += (SQRT2_INV*WIGNER_112_112) * c22 * (c11*c11 - c1n1*c1n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_112_112) * c11*c1n1*c2n2;
        rFp[tIdxFP] = rFp3;
        ++tIdxFP;
    } else {
        c10 = c11 = c1n1 = 0.0;
    }
    if (aL3Max == 2) return;
    double c30, c31, c3n1, c32, c3n2, c33, c3n3;
    if (aL3Cross) {
        /// l1 = 2, l2 = l3 = 3
        c30  = aCnlm[(3*3+3)  ];
        c31  = aCnlm[(3*3+3)+1];
        c3n1 = aCnlm[(3*3+3)-1];
        c32  = aCnlm[(3*3+3)+2];
        c3n2 = aCnlm[(3*3+3)-2];
        c33  = aCnlm[(3*3+3)+3];
        c3n3 = aCnlm[(3*3+3)-3];
        rFp3 = 0.0;
        rFp3 += WIGNER_233_000 * c20*c30*c30;
        rFp3 -= WIGNER_233_011 * c20 * (c31*c31 + c3n1*c3n1);
        rFp3 += WIGNER_233_022 * c20 * (c32*c32 + c3n2*c3n2);
        rFp3 -= WIGNER_233_033 * c20 * (c33*c33 + c3n3*c3n3);
        rFp3 -= (2.0*WIGNER_233_110) * c30 * (c21*c31 + c2n1*c3n1);
        rFp3 += (2.0*WIGNER_233_220) * c30 * (c22*c32 + c2n2*c3n2);
        rFp3 += (SQRT2_INV*WIGNER_233_211) * c22 * (c31*c31 - c3n1*c3n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_233_211) * c2n2*c31*c3n1;
        rFp3 += (2.0*SQRT2_INV*WIGNER_233_112) * c21 * (c31*c32 + c3n1*c3n2);
        rFp3 += (2.0*SQRT2_INV*WIGNER_233_112) * c2n1 * (c31*c3n2 - c3n1*c32);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_233_123) * c21 * (c32*c33 + c3n2*c3n3);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_233_123) * c2n1 * (c32*c3n3 - c3n2*c33);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_233_213) * c22 * (c31*c33 + c3n1*c3n3);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_233_213) * c2n2 * (c31*c3n3 - c3n1*c33);
        rFp[tIdxFP] = rFp3;
        ++tIdxFP;
        /// l1 = 1, l2 = 2, l3 = 3
        rFp3 = 0.0;
        rFp3 += WIGNER_123_000 * c10*c20*c30;
        rFp3 -= WIGNER_123_011 * c10 * (c21*c31 + c2n1*c3n1);
        rFp3 += WIGNER_123_022 * c10 * (c22*c32 + c2n2*c3n2);
        rFp3 -= WIGNER_123_101 * c20 * (c11*c31 + c1n1*c3n1);
        rFp3 -= WIGNER_123_110 * c30 * (c11*c21 + c1n1*c2n1);
        rFp3 += (SQRT2_INV*WIGNER_123_112) * c11 * (c21*c32 + c2n1*c3n2);
        rFp3 += (SQRT2_INV*WIGNER_123_112) * c1n1 * (c21*c3n2 - c2n1*c32);
        rFp3 += (SQRT2_INV*WIGNER_123_121) * c11 * (c22*c31 + c2n2*c3n1);
        rFp3 += (SQRT2_INV*WIGNER_123_121) * c1n1 * (c2n2*c31 - c22*c3n1);
        rFp3 -= (SQRT2_INV*WIGNER_123_123) * c11 * (c22*c33 + c2n2*c3n3);
        rFp3 -= (SQRT2_INV*WIGNER_123_123) * c1n1 * (c22*c3n3 - c2n2*c33);
        rFp[tIdxFP] = rFp3;
        ++tIdxFP;
    } else {
        c30 = c31 = c3n1 = c32 = c3n2 = c33 = c3n3 = 0.0;
    }
    if (aL3Max == 3) return;
    /// l1 = l2 = l3 = 4
    double c40  = aCnlm[(4*4+4)  ];
    double c41  = aCnlm[(4*4+4)+1];
    double c4n1 = aCnlm[(4*4+4)-1];
    double c42  = aCnlm[(4*4+4)+2];
    double c4n2 = aCnlm[(4*4+4)-2];
    double c43  = aCnlm[(4*4+4)+3];
    double c4n3 = aCnlm[(4*4+4)-3];
    double c44  = aCnlm[(4*4+4)+4];
    double c4n4 = aCnlm[(4*4+4)-4];
    rFp3 = 0.0;
    rFp3 += WIGNER_444_000 * c40*c40*c40;
    rFp3 -= (3.0*WIGNER_444_011) * c40 * (c41*c41 + c4n1*c4n1);
    rFp3 += (3.0*WIGNER_444_022) * c40 * (c42*c42 + c4n2*c4n2);
    rFp3 -= (3.0*WIGNER_444_033) * c40 * (c43*c43 + c4n3*c4n3);
    rFp3 += (3.0*WIGNER_444_044) * c40 * (c44*c44 + c4n4*c4n4);
    rFp3 += (3.0*SQRT2_INV*WIGNER_444_112) * c42 * (c41*c41 - c4n1*c4n1);
    rFp3 += (6.0*SQRT2_INV*WIGNER_444_112) * c41*c4n1*c4n2;
    rFp3 += (3.0*SQRT2_INV*WIGNER_444_224) * c44 * (c42*c42 - c4n2*c4n2);
    rFp3 += (6.0*SQRT2_INV*WIGNER_444_224) * c42*c4n2*c4n4;
    rFp3 -= (6.0*SQRT2_INV*WIGNER_444_123) * c41 * (c42*c43 + c4n2*c4n3);
    rFp3 -= (6.0*SQRT2_INV*WIGNER_444_123) * c4n1 * (c42*c4n3 - c4n2*c43);
    rFp3 += (6.0*SQRT2_INV*WIGNER_444_134) * c41 * (c43*c44 + c4n3*c4n4);
    rFp3 += (6.0*SQRT2_INV*WIGNER_444_134) * c4n1 * (c43*c4n4 - c4n3*c44);
    rFp[tIdxFP] = rFp3;
    ++tIdxFP;
    if (aL3Cross) {
        /// l1 = l2 = 2, l3 = 4
        rFp3 = 0.0;
        rFp3 += WIGNER_224_000 * c20*c20*c40;
        rFp3 -= WIGNER_224_110 * c40 * (c21*c21 + c2n1*c2n1);
        rFp3 += WIGNER_224_220 * c40 * (c22*c22 + c2n2*c2n2);
        rFp3 -= (2.0*WIGNER_224_011) * c20 * (c21*c41 + c2n1*c4n1);
        rFp3 += (2.0*WIGNER_224_022) * c20 * (c22*c42 + c2n2*c4n2);
        rFp3 += (SQRT2_INV*WIGNER_224_112) * c42 * (c21*c21 - c2n1*c2n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_224_112) * c21*c2n1*c4n2;
        rFp3 += (SQRT2_INV*WIGNER_224_224) * c44 * (c22*c22 - c2n2*c2n2);
        rFp3 += (2.0*SQRT2_INV*WIGNER_224_224) * c22*c2n2*c4n4;
        rFp3 += (2.0*SQRT2_INV*WIGNER_224_121) * c21 * (c22*c41 + c2n2*c4n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_224_121) * c2n1 * (c2n2*c41 - c22*c4n1);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_224_123) * c21 * (c22*c43 + c2n2*c4n3);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_224_123) * c2n1 * (c22*c4n3 - c2n2*c43);
        rFp[tIdxFP] = rFp3;
        ++tIdxFP;
        /// l1 = l2 = 3, l3 = 4
        rFp3 = 0.0;
        rFp3 += WIGNER_334_000 * c30*c30*c40;
        rFp3 -= WIGNER_334_110 * c40 * (c31*c31 + c3n1*c3n1);
        rFp3 += WIGNER_334_220 * c40 * (c32*c32 + c3n2*c3n2);
        rFp3 -= WIGNER_334_330 * c40 * (c33*c33 + c3n3*c3n3);
        rFp3 -= (2.0*WIGNER_334_011) * c30 * (c31*c41 + c3n1*c4n1);
        rFp3 += (2.0*WIGNER_334_022) * c30 * (c32*c42 + c3n2*c4n2);
        rFp3 -= (2.0*WIGNER_334_033) * c30 * (c33*c43 + c3n3*c4n3);
        rFp3 += (SQRT2_INV*WIGNER_334_112) * c42 * (c31*c31 - c3n1*c3n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_334_112) * c31*c3n1*c4n2;
        rFp3 += (SQRT2_INV*WIGNER_334_224) * c44 * (c32*c32 - c3n2*c3n2);
        rFp3 += (2.0*SQRT2_INV*WIGNER_334_224) * c32*c3n2*c4n4;
        rFp3 += (2.0*SQRT2_INV*WIGNER_334_121) * c31 * (c32*c41 + c3n2*c4n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_334_121) * c3n1 * (c3n2*c41 - c32*c4n1);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_334_123) * c31 * (c32*c43 + c3n2*c4n3);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_334_123) * c3n1 * (c32*c4n3 - c3n2*c43);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_334_132) * c31 * (c33*c42 + c3n3*c4n2);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_334_132) * c3n1 * (c3n3*c42 - c33*c4n2);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_334_231) * c32 * (c33*c41 + c3n3*c4n1);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_334_231) * c3n2 * (c3n3*c41 - c33*c4n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_334_134) * c31 * (c33*c44 + c3n3*c4n4);
        rFp3 += (2.0*SQRT2_INV*WIGNER_334_134) * c3n1 * (c33*c4n4 - c3n3*c44);
        rFp[tIdxFP] = rFp3;
        ++tIdxFP;
        /// l1 = 2, l2 = l3 = 4
        rFp3 = 0.0;
        rFp3 += WIGNER_244_000 * c20*c40*c40;
        rFp3 -= WIGNER_244_011 * c20 * (c41*c41 + c4n1*c4n1);
        rFp3 += WIGNER_244_022 * c20 * (c42*c42 + c4n2*c4n2);
        rFp3 -= WIGNER_244_033 * c20 * (c43*c43 + c4n3*c4n3);
        rFp3 += WIGNER_244_044 * c20 * (c44*c44 + c4n4*c4n4);
        rFp3 -= (2.0*WIGNER_244_110) * c40 * (c21*c41 + c2n1*c4n1);
        rFp3 += (2.0*WIGNER_244_220) * c40 * (c22*c42 + c2n2*c4n2);
        rFp3 += (SQRT2_INV*WIGNER_244_211) * c22 * (c41*c41 - c4n1*c4n1);
        rFp3 += (2.0*SQRT2_INV*WIGNER_244_211) * c2n2*c41*c4n1;
        rFp3 += (2.0*SQRT2_INV*WIGNER_244_112) * c21 * (c41*c42 + c4n1*c4n2);
        rFp3 += (2.0*SQRT2_INV*WIGNER_244_112) * c2n1 * (c41*c4n2 - c4n1*c42);
        rFp3 += (2.0*SQRT2_INV*WIGNER_244_224) * c22 * (c42*c44 + c4n2*c4n4);
        rFp3 += (2.0*SQRT2_INV*WIGNER_244_224) * c2n2 * (c42*c4n4 - c4n2*c44);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_244_123) * c21 * (c42*c43 + c4n2*c4n3);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_244_123) * c2n1 * (c42*c4n3 - c4n2*c43);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_244_213) * c22 * (c41*c43 + c4n1*c4n3);
        rFp3 -= (2.0*SQRT2_INV*WIGNER_244_213) * c2n2 * (c41*c4n3 - c4n1*c43);
        rFp3 += (2.0*SQRT2_INV*WIGNER_244_134) * c21 * (c43*c44 + c4n3*c4n4);
        rFp3 += (2.0*SQRT2_INV*WIGNER_244_134) * c2n1 * (c43*c4n4 - c4n3*c44);
        rFp[tIdxFP] = rFp3;
        ++tIdxFP;
        /// l1 = 1, l2 = 3, l3 = 4
        rFp3 = 0.0;
        rFp3 += WIGNER_134_000 * c10*c30*c40;
        rFp3 -= WIGNER_134_011 * c10 * (c31*c41 + c3n1*c4n1);
        rFp3 += WIGNER_134_022 * c10 * (c32*c42 + c3n2*c4n2);
        rFp3 -= WIGNER_134_033 * c10 * (c33*c43 + c3n3*c4n3);
        rFp3 -= WIGNER_134_110 * c40 * (c11*c31 + c1n1*c3n1);
        rFp3 -= WIGNER_134_101 * c30 * (c11*c41 + c1n1*c4n1);
        rFp3 += (SQRT2_INV*WIGNER_134_112) * c11 * (c31*c42 + c3n1*c4n2);
        rFp3 += (SQRT2_INV*WIGNER_134_112) * c1n1 * (c31*c4n2 - c3n1*c42);
        rFp3 += (SQRT2_INV*WIGNER_134_121) * c11 * (c32*c41 + c3n2*c4n1);
        rFp3 += (SQRT2_INV*WIGNER_134_121) * c1n1 * (c3n2*c41 - c32*c4n1);
        rFp3 -= (SQRT2_INV*WIGNER_134_123) * c11 * (c32*c43 + c3n2*c4n3);
        rFp3 -= (SQRT2_INV*WIGNER_134_123) * c1n1 * (c32*c4n3 - c3n2*c43);
        rFp3 -= (SQRT2_INV*WIGNER_134_132) * c11 * (c33*c42 + c3n3*c4n2);
        rFp3 -= (SQRT2_INV*WIGNER_134_132) * c1n1 * (c3n3*c42 - c33*c4n2);
        rFp3 += (SQRT2_INV*WIGNER_134_134) * c11 * (c33*c44 + c3n3*c4n4);
        rFp3 += (SQRT2_INV*WIGNER_134_134) * c1n1 * (c33*c4n4 - c3n3*c44);
        rFp[tIdxFP] = rFp3;
        ++tIdxFP;
    }
}

static inline void calYPphi(double *rYPphi, double *aY, jint aL) {
    const jint tStart = aL*aL;
    const jint tIdx = tStart+aL;
    for (jint m = -aL; m <= aL; ++m) {
        rYPphi[tIdx+m] = -m * aY[tIdx-m];
    }
}
static inline void calYPtheta(double aCosPhi, double aSinPhi, double *rYPtheta, double *aY, jint aL) {
    switch(aL) {
    case 0: {
        rYPtheta[0] = 0.0;
        return;
    }
    case 1: {
        double tMul = SQRT_LPM_LMM1[2]*SQRT2_INV;
        rYPtheta[1] = -tMul * aSinPhi*aY[2];
        rYPtheta[2] =  tMul * (aCosPhi*aY[3] + aSinPhi*aY[1]);
        rYPtheta[3] = -tMul * aCosPhi*aY[2];
        return;
    }
    default: {
        const jint tStart = aL*aL;
        const jint tIdx = tStart+aL;
        double tMul = SQRT_LPM_LMM1[tIdx]*SQRT2_INV;
        rYPtheta[tIdx] = tMul * (aCosPhi*aY[tIdx+1] + aSinPhi*aY[tIdx-1]);
        rYPtheta[tIdx+1] = -tMul * aCosPhi*aY[tIdx];
        rYPtheta[tIdx-1] = -tMul * aSinPhi*aY[tIdx];
        for (jint tM = 2; tM <= aL; ++tM) {
            tMul = -0.5*SQRT_LPM_LMM1[tIdx+tM];
            rYPtheta[tIdx+tM] = tMul * (aCosPhi*aY[tIdx+tM-1] - aSinPhi*aY[tIdx-tM+1]);
            rYPtheta[tIdx-tM] = tMul * (aCosPhi*aY[tIdx-tM+1] + aSinPhi*aY[tIdx+tM-1]);
        }
        for (jint tM = 1; tM < aL; ++tM) {
            tMul = 0.5*SQRT_LPM1_LMM[tIdx+tM];
            rYPtheta[tIdx+tM] += tMul * (aCosPhi*aY[tIdx+tM+1] + aSinPhi*aY[tIdx-tM-1]);
            rYPtheta[tIdx-tM] += tMul * (aCosPhi*aY[tIdx-tM-1] - aSinPhi*aY[tIdx+tM+1]);
        }
        return;
    }}
}
static inline void calYPxyz(double aCosTheta, double aSinTheta, double aCosPhi, double aSinPhi, double aDis, double aDxy, jboolean aDxyCloseZero,
                            double *rYPx, double *rYPy, double *rYPz, double *aYPtheta, double *aYPphi, jint aLength) {
    const double thetaPx = -aCosTheta * aCosPhi / aDis;
    const double thetaPy = -aCosTheta * aSinPhi / aDis;
    const double thetaPz =  aSinTheta / aDis;
    const double phiPx = aDxyCloseZero ? 0.0 :  aSinPhi / aDxy;
    const double phiPy = aDxyCloseZero ? 0.0 : -aCosPhi / aDxy;
    for (jint i = 0; i < aLength; ++i) {
        const double tYPtheta = aYPtheta[i];
        const double tYPphi = aYPphi[i];
        rYPx[i] = tYPtheta*thetaPx + tYPphi*phiPx;
        rYPy[i] = tYPtheta*thetaPy + tYPphi*phiPy;
        rYPz[i] = tYPtheta*thetaPz;
    }
}
static inline void calCnlmPxyz(double *rCnlmPx, double *rCnlmPy, double *rCnlmPz,
                               double *aY, double *aYPx, double *aYPy, double *aYPz,
                               double aFc, double aFcPx, double aFcPy, double aFcPz,
                               double aRn, double aRnPx, double aRnPy, double aRnPz, jint aLength) {
    const double tMul = -(aFc*aRn);
    const double tMulX = -(aFc*aRnPx + aFcPx*aRn);
    const double tMulY = -(aFc*aRnPy + aFcPy*aRn);
    const double tMulZ = -(aFc*aRnPz + aFcPz*aRn);
    for (jint i = 0; i < aLength; ++i) {
        const double tY = aY[i];
        rCnlmPx[i] = tMulX*tY + tMul*aYPx[i];
        rCnlmPy[i] = tMulY*tY + tMul*aYPy[i];
        rCnlmPz[i] = tMulZ*tY + tMul*aYPz[i];
    }
}

static inline void calL2p_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                           double *rFpPx, double *rFpPy, double *rFpPz,
                           double aWt, jint aLMax, jboolean aNoRadial) {
    // l = 0
    double tCnl0;
    double tMul;
    double *tFpPx = rFpPx, *tFpPy = rFpPy, *tFpPz = rFpPz;
    if (!aNoRadial) {
        tCnl0 = aCnlm[0];
        tMul = aWt*(PI4+PI4);
        tFpPx[0] += tMul * (tCnl0*aCnlmPx[0]);
        tFpPy[0] += tMul * (tCnl0*aCnlmPy[0]);
        tFpPz[0] += tMul * (tCnl0*aCnlmPz[0]);
        ++tFpPx; ++tFpPy; ++tFpPz;
    }
    if (aLMax == 0) return;
    // l = 1
    tCnl0 = aCnlm[1]; double tCnl1 = aCnlm[1+1], tCnl2 = aCnlm[1+2];
    tMul = aWt*(PI4/3 + PI4/3);
    tFpPx[0] += tMul * (tCnl0*aCnlmPx[1] + tCnl1*aCnlmPx[1+1] + tCnl2*aCnlmPx[1+2]);
    tFpPy[0] += tMul * (tCnl0*aCnlmPy[1] + tCnl1*aCnlmPy[1+1] + tCnl2*aCnlmPy[1+2]);
    tFpPz[0] += tMul * (tCnl0*aCnlmPz[1] + tCnl1*aCnlmPz[1+1] + tCnl2*aCnlmPz[1+2]);
    if (aLMax == 1) return;
    // l = 2
    tCnl0 = aCnlm[4]; tCnl1 = aCnlm[4+1]; tCnl2 = aCnlm[4+2]; double tCnl3 = aCnlm[4+3], tCnl4 = aCnlm[4+4];
    tMul = aWt*(PI4/5 + PI4/5);
    tFpPx[1] += tMul * (tCnl0*aCnlmPx[4] + tCnl1*aCnlmPx[4+1] + tCnl2*aCnlmPx[4+2] + tCnl3*aCnlmPx[4+3] + tCnl4*aCnlmPx[4+4]);
    tFpPy[1] += tMul * (tCnl0*aCnlmPy[4] + tCnl1*aCnlmPy[4+1] + tCnl2*aCnlmPy[4+2] + tCnl3*aCnlmPy[4+3] + tCnl4*aCnlmPy[4+4]);
    tFpPz[1] += tMul * (tCnl0*aCnlmPz[4] + tCnl1*aCnlmPz[4+1] + tCnl2*aCnlmPz[4+2] + tCnl3*aCnlmPz[4+3] + tCnl4*aCnlmPz[4+4]);
    if (aLMax == 2) return;
    // l = 3
    tCnl0 = aCnlm[9]; tCnl1 = aCnlm[9+1]; tCnl2 = aCnlm[9+2]; tCnl3 = aCnlm[9+3]; tCnl4 = aCnlm[9+4]; double tCnl5 = aCnlm[9+5], tCnl6 = aCnlm[9+6];
    tMul = aWt*(PI4/7 + PI4/7);
    tFpPx[2] += tMul * (tCnl0*aCnlmPx[9] + tCnl1*aCnlmPx[9+1] + tCnl2*aCnlmPx[9+2] + tCnl3*aCnlmPx[9+3] + tCnl4*aCnlmPx[9+4] + tCnl5*aCnlmPx[9+5] + tCnl6*aCnlmPx[9+6]);
    tFpPy[2] += tMul * (tCnl0*aCnlmPy[9] + tCnl1*aCnlmPy[9+1] + tCnl2*aCnlmPy[9+2] + tCnl3*aCnlmPy[9+3] + tCnl4*aCnlmPy[9+4] + tCnl5*aCnlmPy[9+5] + tCnl6*aCnlmPy[9+6]);
    tFpPz[2] += tMul * (tCnl0*aCnlmPz[9] + tCnl1*aCnlmPz[9+1] + tCnl2*aCnlmPz[9+2] + tCnl3*aCnlmPz[9+3] + tCnl4*aCnlmPz[9+4] + tCnl5*aCnlmPz[9+5] + tCnl6*aCnlmPz[9+6]);
    if (aLMax == 3) return;
    // l = 4
    tCnl0 = aCnlm[16]; tCnl1 = aCnlm[16+1]; tCnl2 = aCnlm[16+2]; tCnl3 = aCnlm[16+3]; tCnl4 = aCnlm[16+4]; tCnl5 = aCnlm[16+5]; tCnl6 = aCnlm[16+6]; double tCnl7 = aCnlm[16+7], tCnl8 = aCnlm[16+8];
    tMul = aWt*(PI4/9 + PI4/9);
    tFpPx[3] += tMul * (tCnl0*aCnlmPx[16] + tCnl1*aCnlmPx[16+1] + tCnl2*aCnlmPx[16+2] + tCnl3*aCnlmPx[16+3] + tCnl4*aCnlmPx[16+4] + tCnl5*aCnlmPx[16+5] + tCnl6*aCnlmPx[16+6] + tCnl7*aCnlmPx[16+7] + tCnl8*aCnlmPx[16+8]);
    tFpPy[3] += tMul * (tCnl0*aCnlmPy[16] + tCnl1*aCnlmPy[16+1] + tCnl2*aCnlmPy[16+2] + tCnl3*aCnlmPy[16+3] + tCnl4*aCnlmPy[16+4] + tCnl5*aCnlmPy[16+5] + tCnl6*aCnlmPy[16+6] + tCnl7*aCnlmPy[16+7] + tCnl8*aCnlmPy[16+8]);
    tFpPz[3] += tMul * (tCnl0*aCnlmPz[16] + tCnl1*aCnlmPz[16+1] + tCnl2*aCnlmPz[16+2] + tCnl3*aCnlmPz[16+3] + tCnl4*aCnlmPz[16+4] + tCnl5*aCnlmPz[16+5] + tCnl6*aCnlmPz[16+6] + tCnl7*aCnlmPz[16+7] + tCnl8*aCnlmPz[16+8]);
    if (aLMax == 4) return;
    // l = 5
    tCnl0 = aCnlm[25]; tCnl1 = aCnlm[25+1]; tCnl2 = aCnlm[25+2]; tCnl3 = aCnlm[25+3]; tCnl4 = aCnlm[25+4]; tCnl5 = aCnlm[25+5]; tCnl6 = aCnlm[25+6]; tCnl7 = aCnlm[25+7]; tCnl8 = aCnlm[25+8]; double tCnl9 = aCnlm[25+9], tCnl10 = aCnlm[25+10];
    tMul = aWt*(PI4/11 + PI4/11);
    tFpPx[4] += tMul * (tCnl0*aCnlmPx[25] + tCnl1*aCnlmPx[25+1] + tCnl2*aCnlmPx[25+2] + tCnl3*aCnlmPx[25+3] + tCnl4*aCnlmPx[25+4] + tCnl5*aCnlmPx[25+5] + tCnl6*aCnlmPx[25+6] + tCnl7*aCnlmPx[25+7] + tCnl8*aCnlmPx[25+8] + tCnl9*aCnlmPx[25+9] + tCnl10*aCnlmPx[25+10]);
    tFpPy[4] += tMul * (tCnl0*aCnlmPy[25] + tCnl1*aCnlmPy[25+1] + tCnl2*aCnlmPy[25+2] + tCnl3*aCnlmPy[25+3] + tCnl4*aCnlmPy[25+4] + tCnl5*aCnlmPy[25+5] + tCnl6*aCnlmPy[25+6] + tCnl7*aCnlmPy[25+7] + tCnl8*aCnlmPy[25+8] + tCnl9*aCnlmPy[25+9] + tCnl10*aCnlmPy[25+10]);
    tFpPz[4] += tMul * (tCnl0*aCnlmPz[25] + tCnl1*aCnlmPz[25+1] + tCnl2*aCnlmPz[25+2] + tCnl3*aCnlmPz[25+3] + tCnl4*aCnlmPz[25+4] + tCnl5*aCnlmPz[25+5] + tCnl6*aCnlmPz[25+6] + tCnl7*aCnlmPz[25+7] + tCnl8*aCnlmPz[25+8] + tCnl9*aCnlmPz[25+9] + tCnl10*aCnlmPz[25+10]);
    if (aLMax == 5) return;
    // l = 6
    tCnl0 = aCnlm[36]; tCnl1 = aCnlm[36+1]; tCnl2 = aCnlm[36+2]; tCnl3 = aCnlm[36+3]; tCnl4 = aCnlm[36+4]; tCnl5 = aCnlm[36+5]; tCnl6 = aCnlm[36+6]; tCnl7 = aCnlm[36+7]; tCnl8 = aCnlm[36+8]; tCnl9 = aCnlm[36+9]; tCnl10 = aCnlm[36+10]; double tCnl11 = aCnlm[36+11], tCnl12 = aCnlm[36+12];
    tMul = aWt*(PI4/13 + PI4/13);
    tFpPx[5] += tMul * (tCnl0*aCnlmPx[36] + tCnl1*aCnlmPx[36+1] + tCnl2*aCnlmPx[36+2] + tCnl3*aCnlmPx[36+3] + tCnl4*aCnlmPx[36+4] + tCnl5*aCnlmPx[36+5] + tCnl6*aCnlmPx[36+6] + tCnl7*aCnlmPx[36+7] + tCnl8*aCnlmPx[36+8] + tCnl9*aCnlmPx[36+9] + tCnl10*aCnlmPx[36+10] + tCnl11*aCnlmPx[36+11] + tCnl12*aCnlmPx[36+12]);
    tFpPy[5] += tMul * (tCnl0*aCnlmPy[36] + tCnl1*aCnlmPy[36+1] + tCnl2*aCnlmPy[36+2] + tCnl3*aCnlmPy[36+3] + tCnl4*aCnlmPy[36+4] + tCnl5*aCnlmPy[36+5] + tCnl6*aCnlmPy[36+6] + tCnl7*aCnlmPy[36+7] + tCnl8*aCnlmPy[36+8] + tCnl9*aCnlmPy[36+9] + tCnl10*aCnlmPy[36+10] + tCnl11*aCnlmPy[36+11] + tCnl12*aCnlmPy[36+12]);
    tFpPz[5] += tMul * (tCnl0*aCnlmPz[36] + tCnl1*aCnlmPz[36+1] + tCnl2*aCnlmPz[36+2] + tCnl3*aCnlmPz[36+3] + tCnl4*aCnlmPz[36+4] + tCnl5*aCnlmPz[36+5] + tCnl6*aCnlmPz[36+6] + tCnl7*aCnlmPz[36+7] + tCnl8*aCnlmPz[36+8] + tCnl9*aCnlmPz[36+9] + tCnl10*aCnlmPz[36+10] + tCnl11*aCnlmPz[36+11] + tCnl12*aCnlmPz[36+12]);
    if (aLMax == 6) return;
    // else
    for (jint l = 7; l <= aLMax; ++l) {
        const jint tStart = l*l;
        const jint tLen = l+l+1;
        const jint tEnd = tStart+tLen;
        double rDotPx = 0.0, rDotPy = 0.0, rDotPz = 0.0;
        for (jint i=tStart; i < tEnd; ++i) {
            double tCnlm = aCnlm[i];
            rDotPx += tCnlm*aCnlmPx[i];
            rDotPy += tCnlm*aCnlmPy[i];
            rDotPz += tCnlm*aCnlmPz[i];
        }
        tMul = PI4/(double)tLen;
        tMul = aWt*(tMul+tMul);
        tFpPx[l-1] += tMul * rDotPx;
        tFpPy[l-1] += tMul * rDotPy;
        tFpPz[l-1] += tMul * rDotPz;
    }
}

static inline void calL3_222_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx = 2*2+2;
    const double c20  = aCnlm[tIdx  ];
    const double c21  = aCnlm[tIdx+1];
    const double c2n1 = aCnlm[tIdx-1];
    const double c22  = aCnlm[tIdx+2];
    const double c2n2 = aCnlm[tIdx-2];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = (3.0*WIGNER_222_000)*c20*c20 - (3.0*WIGNER_222_011)*(c21*c21 + c2n1*c2n1) + (3.0*WIGNER_222_022)*(c22*c22 + c2n2*c2n2);
    rFp3Px += tMul*aCnlmPx[tIdx];
    rFp3Py += tMul*aCnlmPy[tIdx];
    rFp3Pz += tMul*aCnlmPz[tIdx];
    
    double tMul1 = (-6.0*WIGNER_222_011)*c20*c21  + (6.0*SQRT2_INV*WIGNER_222_112)*c22*c21  + (6.0*SQRT2_INV*WIGNER_222_112)*c2n1*c2n2;
    double tMul2 = (-6.0*WIGNER_222_011)*c20*c2n1 - (6.0*SQRT2_INV*WIGNER_222_112)*c22*c2n1 + (6.0*SQRT2_INV*WIGNER_222_112)*c21*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx+1] + tMul2*aCnlmPx[tIdx-1];
    rFp3Py += tMul1*aCnlmPy[tIdx+1] + tMul2*aCnlmPy[tIdx-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx+1] + tMul2*aCnlmPz[tIdx-1];
    tMul1 = (6.0*WIGNER_222_022)*c20*c22  + (3.0*SQRT2_INV*WIGNER_222_112)*(c21*c21 - c2n1*c2n1);
    tMul2 = (6.0*WIGNER_222_022)*c20*c2n2 + (6.0*SQRT2_INV*WIGNER_222_112)*c21*c2n1;
    rFp3Px += tMul1*aCnlmPx[tIdx+2] + tMul2*aCnlmPx[tIdx-2];
    rFp3Py += tMul1*aCnlmPy[tIdx+2] + tMul2*aCnlmPy[tIdx-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx+2] + tMul2*aCnlmPz[tIdx-2];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_112_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx1 = 1+1;
    const jint tIdx2 = 2*2+2;
    const double c10  = aCnlm[tIdx1  ];
    const double c11  = aCnlm[tIdx1+1];
    const double c1n1 = aCnlm[tIdx1-1];
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_112_000*c10*c10 - WIGNER_112_110*(c11*c11 + c1n1*c1n1);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = (2.0*WIGNER_112_000)*c10*c20 - (2.0*WIGNER_112_011)*(c11*c21 + c1n1*c2n1);
    rFp3Px += tMul*aCnlmPx[tIdx1];
    rFp3Py += tMul*aCnlmPy[tIdx1];
    rFp3Pz += tMul*aCnlmPz[tIdx1];
    
    double tMul1 = (-2.0*WIGNER_112_110)*c20*c11  - (2.0*WIGNER_112_011)*c10*c21  + (2.0*SQRT2_INV*WIGNER_112_112)*c22*c11  + (2.0*SQRT2_INV*WIGNER_112_112)*c1n1*c2n2;
    double tMul2 = (-2.0*WIGNER_112_110)*c20*c1n1 - (2.0*WIGNER_112_011)*c10*c2n1 - (2.0*SQRT2_INV*WIGNER_112_112)*c22*c1n1 + (2.0*SQRT2_INV*WIGNER_112_112)*c11*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx1+1] + tMul2*aCnlmPx[tIdx1-1];
    rFp3Py += tMul1*aCnlmPy[tIdx1+1] + tMul2*aCnlmPy[tIdx1-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx1+1] + tMul2*aCnlmPz[tIdx1-1];
    
    tMul1 = (-2.0*WIGNER_112_011)*c10*c11;
    tMul2 = (-2.0*WIGNER_112_011)*c10*c1n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (SQRT2_INV*WIGNER_112_112)*(c11*c11 - c1n1*c1n1);
    tMul2 = (2.0*SQRT2_INV*WIGNER_112_112)*c11*c1n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_233_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx2 = 2*2+2;
    const jint tIdx3 = 3*3+3;
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_233_000*c30*c30 - WIGNER_233_011*(c31*c31 + c3n1*c3n1) + WIGNER_233_022*(c32*c32 + c3n2*c3n2) - WIGNER_233_033*(c33*c33 + c3n3*c3n3);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = (2.0*WIGNER_233_000)*c20*c30 - (2.0*WIGNER_233_110)*(c21*c31 + c2n1*c3n1) + (2.0*WIGNER_233_220)*(c22*c32 + c2n2*c3n2);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-2.0*WIGNER_233_110) * c30*c31  + (2.0*SQRT2_INV*WIGNER_233_112)*(c31*c32 + c3n1*c3n2) - (2.0*SQRT2_INV*WIGNER_233_123)*(c32*c33 + c3n2*c3n3);
    double tMul2 = (-2.0*WIGNER_233_110) * c30*c3n1 + (2.0*SQRT2_INV*WIGNER_233_112)*(c31*c3n2 - c3n1*c32) - (2.0*SQRT2_INV*WIGNER_233_123)*(c32*c3n3 - c3n2*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (2.0*WIGNER_233_220) * c30*c32  - (2.0*SQRT2_INV*WIGNER_233_213)*(c31*c33 + c3n1*c3n3) + (SQRT2_INV*WIGNER_233_211)*(c31*c31 - c3n1*c3n1);
    tMul2 = (2.0*WIGNER_233_220) * c30*c3n2 - (2.0*SQRT2_INV*WIGNER_233_213)*(c31*c3n3 - c3n1*c33) + (2.0*SQRT2_INV*WIGNER_233_211)*c31*c3n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-2.0*WIGNER_233_011)*c20*c31  - (2.0*WIGNER_233_110)*c30*c21  + (2.0*SQRT2_INV*WIGNER_233_211)*c22*c31  + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c32 + c2n1*c3n2) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c33 + c2n2*c3n3) + (2.0*SQRT2_INV*WIGNER_233_211)*c2n2*c3n1;
    tMul2 = (-2.0*WIGNER_233_011)*c20*c3n1 - (2.0*WIGNER_233_110)*c30*c2n1 - (2.0*SQRT2_INV*WIGNER_233_211)*c22*c3n1 + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c3n2 - c2n1*c32) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c3n3 - c2n2*c33) + (2.0*SQRT2_INV*WIGNER_233_211)*c31*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = (2.0*WIGNER_233_022)*c20*c32  + (2.0*WIGNER_233_220)*c30*c22  + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c31 - c2n1*c3n1) - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c33 + c2n1*c3n3);
    tMul2 = (2.0*WIGNER_233_022)*c20*c3n2 + (2.0*WIGNER_233_220)*c30*c2n2 + (2.0*SQRT2_INV*WIGNER_233_112)*(c21*c3n1 + c2n1*c31) - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c3n3 - c2n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-2.0*WIGNER_233_033)*c20*c33  - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c32 - c2n1*c3n2) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c31 - c2n2*c3n1);
    tMul2 = (-2.0*WIGNER_233_033)*c20*c3n3 - (2.0*SQRT2_INV*WIGNER_233_123)*(c21*c3n2 + c2n1*c32) - (2.0*SQRT2_INV*WIGNER_233_213)*(c22*c3n1 + c2n2*c31);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_123_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx1 = 1+1;
    const jint tIdx2 = 2*2+2;
    const jint tIdx3 = 3*3+3;
    const double c10  = aCnlm[tIdx1  ];
    const double c11  = aCnlm[tIdx1+1];
    const double c1n1 = aCnlm[tIdx1-1];
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_123_000*c20*c30 - WIGNER_123_011*(c21*c31 + c2n1*c3n1) + WIGNER_123_022*(c22*c32 + c2n2*c3n2);
    rFp3Px += tMul*aCnlmPx[tIdx1];
    rFp3Py += tMul*aCnlmPy[tIdx1];
    rFp3Pz += tMul*aCnlmPz[tIdx1];
    tMul = WIGNER_123_000*c10*c30 - WIGNER_123_101*(c11*c31 + c1n1*c3n1);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = WIGNER_123_000*c10*c20 - WIGNER_123_110*(c11*c21 + c1n1*c2n1);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-WIGNER_123_101)*c20*c31  - WIGNER_123_110*c30*c21  + (SQRT2_INV*WIGNER_123_112)*(c21*c32 + c2n1*c3n2) + (SQRT2_INV*WIGNER_123_121)*(c22*c31 + c2n2*c3n1) - (SQRT2_INV*WIGNER_123_123)*(c22*c33 + c2n2*c3n3);
    double tMul2 = (-WIGNER_123_101)*c20*c3n1 - WIGNER_123_110*c30*c2n1 + (SQRT2_INV*WIGNER_123_112)*(c21*c3n2 - c2n1*c32) + (SQRT2_INV*WIGNER_123_121)*(c2n2*c31 - c22*c3n1) - (SQRT2_INV*WIGNER_123_123)*(c22*c3n3 - c2n2*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx1+1] + tMul2*aCnlmPx[tIdx1-1];
    rFp3Py += tMul1*aCnlmPy[tIdx1+1] + tMul2*aCnlmPy[tIdx1-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx1+1] + tMul2*aCnlmPz[tIdx1-1];
    
    tMul1 = (-WIGNER_123_011)*c10*c31  - WIGNER_123_110*c30*c11  + (SQRT2_INV*WIGNER_123_112)*(c11*c32 + c1n1*c3n2);
    tMul2 = (-WIGNER_123_011)*c10*c3n1 - WIGNER_123_110*c30*c1n1 + (SQRT2_INV*WIGNER_123_112)*(c11*c3n2 - c1n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = WIGNER_123_022*c10*c32  + (SQRT2_INV*WIGNER_123_121)*(c11*c31 - c1n1*c3n1) - (SQRT2_INV*WIGNER_123_123)*(c11*c33 + c1n1*c3n3);
    tMul2 = WIGNER_123_022*c10*c3n2 + (SQRT2_INV*WIGNER_123_121)*(c11*c3n1 + c1n1*c31) - (SQRT2_INV*WIGNER_123_123)*(c11*c3n3 - c1n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-WIGNER_123_011)*c10*c21  - WIGNER_123_101*c20*c11  + (SQRT2_INV*WIGNER_123_121)*(c11*c22 + c1n1*c2n2);
    tMul2 = (-WIGNER_123_011)*c10*c2n1 - WIGNER_123_101*c20*c1n1 + (SQRT2_INV*WIGNER_123_121)*(c11*c2n2 - c1n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = WIGNER_123_022*c10*c22  + (SQRT2_INV*WIGNER_123_112)*(c11*c21 - c1n1*c2n1);
    tMul2 = WIGNER_123_022*c10*c2n2 + (SQRT2_INV*WIGNER_123_112)*(c11*c2n1 + c1n1*c21);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-SQRT2_INV*WIGNER_123_123)*(c11*c22 - c1n1*c2n2);
    tMul2 = (-SQRT2_INV*WIGNER_123_123)*(c11*c2n2 + c1n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_444_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                             double *rFpPx, double *rFpPy, double *rFpPz,
                             double aWt, jint aIdxFP) {
    const jint tIdx = 4*4+4;
    const double c40  = aCnlm[tIdx  ];
    const double c41  = aCnlm[tIdx+1];
    const double c4n1 = aCnlm[tIdx-1];
    const double c42  = aCnlm[tIdx+2];
    const double c4n2 = aCnlm[tIdx-2];
    const double c43  = aCnlm[tIdx+3];
    const double c4n3 = aCnlm[tIdx-3];
    const double c44  = aCnlm[tIdx+4];
    const double c4n4 = aCnlm[tIdx-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = (3.0*WIGNER_444_000)*c40*c40 - (3.0*WIGNER_444_011)*(c41*c41 + c4n1*c4n1) + (3.0*WIGNER_444_022)*(c42*c42 + c4n2*c4n2) - (3.0*WIGNER_444_033)*(c43*c43 + c4n3*c4n3) + (3.0*WIGNER_444_044)*(c44*c44 + c4n4*c4n4);
    rFp3Px += tMul*aCnlmPx[tIdx];
    rFp3Py += tMul*aCnlmPy[tIdx];
    rFp3Pz += tMul*aCnlmPz[tIdx];
    
    double tMul1 = (-6.0*WIGNER_444_011)*c40*c41  + (6.0*SQRT2_INV*WIGNER_444_112)*c42*c41  + (6.0*SQRT2_INV*WIGNER_444_112)*c4n1*c4n2 - (6.0*SQRT2_INV*WIGNER_444_123)*(c42*c43 + c4n2*c4n3) + (6.0*SQRT2_INV*WIGNER_444_134)*(c43*c44 + c4n3*c4n4);
    double tMul2 = (-6.0*WIGNER_444_011)*c40*c4n1 - (6.0*SQRT2_INV*WIGNER_444_112)*c42*c4n1 + (6.0*SQRT2_INV*WIGNER_444_112)*c41*c4n2  - (6.0*SQRT2_INV*WIGNER_444_123)*(c42*c4n3 - c4n2*c43) + (6.0*SQRT2_INV*WIGNER_444_134)*(c43*c4n4 - c4n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx+1] + tMul2*aCnlmPx[tIdx-1];
    rFp3Py += tMul1*aCnlmPy[tIdx+1] + tMul2*aCnlmPy[tIdx-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx+1] + tMul2*aCnlmPz[tIdx-1];
    tMul1 = (6.0*WIGNER_444_022)*c40*c42  + (6.0*SQRT2_INV*WIGNER_444_224)*c44*c42  - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c43 + c4n1*c4n3) + (6.0*SQRT2_INV*WIGNER_444_224)*c4n2*c4n4 + (3.0*SQRT2_INV*WIGNER_444_112)*(c41*c41 - c4n1*c4n1);
    tMul2 = (6.0*WIGNER_444_022)*c40*c4n2 - (6.0*SQRT2_INV*WIGNER_444_224)*c44*c4n2 - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c4n3 - c4n1*c43) + (6.0*SQRT2_INV*WIGNER_444_224)*c42*c4n4  + (6.0*SQRT2_INV*WIGNER_444_112)*c41*c4n1;
    rFp3Px += tMul1*aCnlmPx[tIdx+2] + tMul2*aCnlmPx[tIdx-2];
    rFp3Py += tMul1*aCnlmPy[tIdx+2] + tMul2*aCnlmPy[tIdx-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx+2] + tMul2*aCnlmPz[tIdx-2];
    tMul1 = (-6.0*WIGNER_444_033)*c40*c43  - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c42 - c4n1*c4n2) + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c44 + c4n1*c4n4);
    tMul2 = (-6.0*WIGNER_444_033)*c40*c4n3 - (6.0*SQRT2_INV*WIGNER_444_123)*(c41*c4n2 + c4n1*c42) + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c4n4 - c4n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx+3] + tMul2*aCnlmPx[tIdx-3];
    rFp3Py += tMul1*aCnlmPy[tIdx+3] + tMul2*aCnlmPy[tIdx-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx+3] + tMul2*aCnlmPz[tIdx-3];
    tMul1 = (6.0*WIGNER_444_044)*c40*c44  + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c43 - c4n1*c4n3) + (3.0*SQRT2_INV*WIGNER_444_224)*(c42*c42 - c4n2*c4n2);
    tMul2 = (6.0*WIGNER_444_044)*c40*c4n4 + (6.0*SQRT2_INV*WIGNER_444_134)*(c41*c4n3 + c4n1*c43) + (6.0*SQRT2_INV*WIGNER_444_224)*c42*c4n2;
    rFp3Px += tMul1*aCnlmPx[tIdx+4] + tMul2*aCnlmPx[tIdx-4];
    rFp3Py += tMul1*aCnlmPy[tIdx+4] + tMul2*aCnlmPy[tIdx-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx+4] + tMul2*aCnlmPz[tIdx-4];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_224_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx2 = 2*2+2;
    const jint tIdx4 = 4*4+4;
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_224_000*c20*c20 - WIGNER_224_110*(c21*c21 + c2n1*c2n1) + WIGNER_224_220*(c22*c22 + c2n2*c2n2);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    tMul = (2.0*WIGNER_224_000)*c20*c40 - (2.0*WIGNER_224_011)*(c21*c41 + c2n1*c4n1) + (2.0*WIGNER_224_022)*(c22*c42 + c2n2*c4n2);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    
    double tMul1 = (-2.0*WIGNER_224_110)*c40*c21  - (2.0*WIGNER_224_011)*c20*c41  + (2.0*SQRT2_INV*WIGNER_224_112)*c42*c21  + (2.0*SQRT2_INV*WIGNER_224_112)*c2n1*c4n2 + (2.0*SQRT2_INV*WIGNER_224_121)*(c22*c41 + c2n2*c4n1) - (2.0*SQRT2_INV*WIGNER_224_123)*(c22*c43 + c2n2*c4n3);
    double tMul2 = (-2.0*WIGNER_224_110)*c40*c2n1 - (2.0*WIGNER_224_011)*c20*c4n1 - (2.0*SQRT2_INV*WIGNER_224_112)*c42*c2n1 + (2.0*SQRT2_INV*WIGNER_224_112)*c21*c4n2  + (2.0*SQRT2_INV*WIGNER_224_121)*(c2n2*c41 - c22*c4n1) - (2.0*SQRT2_INV*WIGNER_224_123)*(c22*c4n3 - c2n2*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (2.0*WIGNER_224_220)*c40*c22  + (2.0*WIGNER_224_022)*c20*c42  + (2.0*SQRT2_INV*WIGNER_224_224)*c44*c22  + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c41 - c2n1*c4n1) - (2.0*SQRT2_INV*WIGNER_224_123)*(c21*c43 + c2n1*c4n3) + (2.0*SQRT2_INV*WIGNER_224_224)*c2n2*c4n4;
    tMul2 = (2.0*WIGNER_224_220)*c40*c2n2 + (2.0*WIGNER_224_022)*c20*c4n2 - (2.0*SQRT2_INV*WIGNER_224_224)*c44*c2n2 + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c4n1 + c2n1*c41) - (2.0*SQRT2_INV*WIGNER_224_123)*(c21*c4n3 - c2n1*c43) + (2.0*SQRT2_INV*WIGNER_224_224)*c22*c4n4;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-2.0*WIGNER_224_011)*c20*c21  + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c22 + c2n1*c2n2);
    tMul2 = (-2.0*WIGNER_224_011)*c20*c2n1 + (2.0*SQRT2_INV*WIGNER_224_121)*(c21*c2n2 - c2n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = (2.0*WIGNER_224_022)*c20*c22  + (SQRT2_INV*WIGNER_224_112)*(c21*c21 - c2n1*c2n1);
    tMul2 = (2.0*WIGNER_224_022)*c20*c2n2 + (2.0*SQRT2_INV*WIGNER_224_112)*c21*c2n1;
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-2.0*SQRT2_INV*WIGNER_224_123)*(c21*c22 - c2n1*c2n2);
    tMul2 = (-2.0*SQRT2_INV*WIGNER_224_123)*(c21*c2n2 + c2n1*c22);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (2.0*SQRT2_INV*WIGNER_224_224)*c22*c2n2;
    tMul2 = (SQRT2_INV*WIGNER_224_224)*(c22*c22 - c2n2*c2n2);
    rFp3Px += tMul1*aCnlmPx[tIdx4-4] + tMul2*aCnlmPx[tIdx4+4];
    rFp3Py += tMul1*aCnlmPy[tIdx4-4] + tMul2*aCnlmPy[tIdx4+4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4-4] + tMul2*aCnlmPz[tIdx4+4];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_334_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx3 = 3*3+3;
    const jint tIdx4 = 4*4+4;
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_334_000*c30*c30 - WIGNER_334_110*(c31*c31 + c3n1*c3n1) + WIGNER_334_220*(c32*c32 + c3n2*c3n2) - WIGNER_334_330*(c33*c33 + c3n3*c3n3);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    tMul = (2.0*WIGNER_334_000)*c30*c40 - (2.0*WIGNER_334_011)*(c31*c41 + c3n1*c4n1) + (2.0*WIGNER_334_022)*(c32*c42 + c3n2*c4n2) - (2.0*WIGNER_334_033)*(c33*c43 + c3n3*c4n3);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-2.0*WIGNER_334_110)*c40*c31  - (2.0*WIGNER_334_011)*c30*c41  + (2.0*SQRT2_INV*WIGNER_334_112)*c42*c31  + (2.0*SQRT2_INV*WIGNER_334_112)*c3n1*c4n2 + (2.0*SQRT2_INV*WIGNER_334_121)*(c32*c41 + c3n2*c4n1) - (2.0*SQRT2_INV*WIGNER_334_123)*(c32*c43 + c3n2*c4n3) - (2.0*SQRT2_INV*WIGNER_334_132)*(c33*c42 + c3n3*c4n2) + (2.0*SQRT2_INV*WIGNER_334_134)*(c33*c44 + c3n3*c4n4);
    double tMul2 = (-2.0*WIGNER_334_110)*c40*c3n1 - (2.0*WIGNER_334_011)*c30*c4n1 - (2.0*SQRT2_INV*WIGNER_334_112)*c42*c3n1 + (2.0*SQRT2_INV*WIGNER_334_112)*c31*c4n2  + (2.0*SQRT2_INV*WIGNER_334_121)*(c3n2*c41 - c32*c4n1) - (2.0*SQRT2_INV*WIGNER_334_123)*(c32*c4n3 - c3n2*c43) - (2.0*SQRT2_INV*WIGNER_334_132)*(c3n3*c42 - c33*c4n2) + (2.0*SQRT2_INV*WIGNER_334_134)*(c33*c4n4 - c3n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = (2.0*WIGNER_334_220)*c40*c32  + (2.0*WIGNER_334_022)*c30*c42  + (2.0*SQRT2_INV*WIGNER_334_224)*c44*c32  + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c41 - c3n1*c4n1) - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c43 + c3n1*c4n3) + (2.0*SQRT2_INV*WIGNER_334_224)*c3n2*c4n4 - (2.0*SQRT2_INV*WIGNER_334_231)*(c33*c41 + c3n3*c4n1);
    tMul2 = (2.0*WIGNER_334_220)*c40*c3n2 + (2.0*WIGNER_334_022)*c30*c4n2 - (2.0*SQRT2_INV*WIGNER_334_224)*c44*c3n2 + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c4n1 + c3n1*c41) - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c4n3 - c3n1*c43) + (2.0*SQRT2_INV*WIGNER_334_224)*c32*c4n4  - (2.0*SQRT2_INV*WIGNER_334_231)*(c3n3*c41 - c33*c4n1);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-2.0*WIGNER_334_330)*c40*c33  - (2.0*WIGNER_334_033)*c30*c43  - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c42 - c3n1*c4n2) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c41 - c3n2*c4n1) + (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c44 + c3n1*c4n4);
    tMul2 = (-2.0*WIGNER_334_330)*c40*c3n3 - (2.0*WIGNER_334_033)*c30*c4n3 - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c4n2 + c3n1*c42) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c4n1 + c3n2*c41) + (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c4n4 - c3n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    tMul1 = (-2.0*WIGNER_334_011)*c30*c31  + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c32 + c3n1*c3n2) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c33 + c3n2*c3n3);
    tMul2 = (-2.0*WIGNER_334_011)*c30*c3n1 + (2.0*SQRT2_INV*WIGNER_334_121)*(c31*c3n2 - c3n1*c32) - (2.0*SQRT2_INV*WIGNER_334_231)*(c32*c3n3 - c3n2*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = (2.0*WIGNER_334_022)*c30*c32  - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c33 + c3n1*c3n3) + (SQRT2_INV*WIGNER_334_112)*(c31*c31 - c3n1*c3n1);
    tMul2 = (2.0*WIGNER_334_022)*c30*c3n2 - (2.0*SQRT2_INV*WIGNER_334_132)*(c31*c3n3 - c3n1*c33) + (2.0*SQRT2_INV*WIGNER_334_112)*c31*c3n1;
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-2.0*WIGNER_334_033)*c30*c33  - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c32 - c3n1*c3n2);
    tMul2 = (-2.0*WIGNER_334_033)*c30*c3n3 - (2.0*SQRT2_INV*WIGNER_334_123)*(c31*c3n2 + c3n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c33 - c3n1*c3n3) + (SQRT2_INV*WIGNER_334_224)*(c32*c32 - c3n2*c3n2);
    tMul2 = (2.0*SQRT2_INV*WIGNER_334_134)*(c31*c3n3 + c3n1*c33) + (2.0*SQRT2_INV*WIGNER_334_224)*c32*c3n2;
    rFp3Px += tMul1*aCnlmPx[tIdx4+4] + tMul2*aCnlmPx[tIdx4-4];
    rFp3Py += tMul1*aCnlmPy[tIdx4+4] + tMul2*aCnlmPy[tIdx4-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+4] + tMul2*aCnlmPz[tIdx4-4];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_244_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx2 = 2*2+2;
    const jint tIdx4 = 4*4+4;
    const double c20  = aCnlm[tIdx2  ];
    const double c21  = aCnlm[tIdx2+1];
    const double c2n1 = aCnlm[tIdx2-1];
    const double c22  = aCnlm[tIdx2+2];
    const double c2n2 = aCnlm[tIdx2-2];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_244_000*c40*c40 - WIGNER_244_011*(c41*c41 + c4n1*c4n1) + WIGNER_244_022*(c42*c42 + c4n2*c4n2) - WIGNER_244_033*(c43*c43 + c4n3*c4n3) + WIGNER_244_044*(c44*c44 + c4n4*c4n4);
    rFp3Px += tMul*aCnlmPx[tIdx2];
    rFp3Py += tMul*aCnlmPy[tIdx2];
    rFp3Pz += tMul*aCnlmPz[tIdx2];
    tMul = (2.0*WIGNER_244_000)*c20*c40 - (2.0*WIGNER_244_110)*(c21*c41 + c2n1*c4n1) + (2.0*WIGNER_244_220)*(c22*c42 + c2n2*c4n2);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    
    double tMul1 = (-2.0*WIGNER_244_110)*c40*c41  + (2.0*SQRT2_INV*WIGNER_244_112)*(c41*c42 + c4n1*c4n2) - (2.0*SQRT2_INV*WIGNER_244_123)*(c42*c43 + c4n2*c4n3) + (2.0*SQRT2_INV*WIGNER_244_134)*(c43*c44 + c4n3*c4n4);
    double tMul2 = (-2.0*WIGNER_244_110)*c40*c4n1 + (2.0*SQRT2_INV*WIGNER_244_112)*(c41*c4n2 - c4n1*c42) - (2.0*SQRT2_INV*WIGNER_244_123)*(c42*c4n3 - c4n2*c43) + (2.0*SQRT2_INV*WIGNER_244_134)*(c43*c4n4 - c4n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx2+1] + tMul2*aCnlmPx[tIdx2-1];
    rFp3Py += tMul1*aCnlmPy[tIdx2+1] + tMul2*aCnlmPy[tIdx2-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+1] + tMul2*aCnlmPz[tIdx2-1];
    tMul1 = (2.0*WIGNER_244_220)*c40*c42  + (2.0*SQRT2_INV*WIGNER_244_224)*(c42*c44 + c4n2*c4n4) - (2.0*SQRT2_INV*WIGNER_244_213)*(c41*c43 + c4n1*c4n3) + (SQRT2_INV*WIGNER_244_211)*(c41*c41 - c4n1*c4n1);
    tMul2 = (2.0*WIGNER_244_220)*c40*c4n2 + (2.0*SQRT2_INV*WIGNER_244_224)*(c42*c4n4 - c4n2*c44) - (2.0*SQRT2_INV*WIGNER_244_213)*(c41*c4n3 - c4n1*c43) + (2.0*SQRT2_INV*WIGNER_244_211)*c41*c4n1;
    rFp3Px += tMul1*aCnlmPx[tIdx2+2] + tMul2*aCnlmPx[tIdx2-2];
    rFp3Py += tMul1*aCnlmPy[tIdx2+2] + tMul2*aCnlmPy[tIdx2-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx2+2] + tMul2*aCnlmPz[tIdx2-2];
    
    tMul1 = (-2.0*WIGNER_244_011)*c20*c41  - (2.0*WIGNER_244_110)*c40*c21  + (2.0*SQRT2_INV*WIGNER_244_211)*c22*c41  + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c42 + c2n1*c4n2) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c43 + c2n2*c4n3) + (2.0*SQRT2_INV*WIGNER_244_211)*c2n2*c4n1;
    tMul2 = (-2.0*WIGNER_244_011)*c20*c4n1 - (2.0*WIGNER_244_110)*c40*c2n1 - (2.0*SQRT2_INV*WIGNER_244_211)*c22*c4n1 + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c4n2 - c2n1*c42) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c4n3 - c2n2*c43) + (2.0*SQRT2_INV*WIGNER_244_211)*c41*c2n2;
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = (2.0*WIGNER_244_022)*c20*c42  + (2.0*WIGNER_244_220)*c40*c22  + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c41 - c2n1*c4n1) + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c44 + c2n2*c4n4) - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c43 + c2n1*c4n3);
    tMul2 = (2.0*WIGNER_244_022)*c20*c4n2 + (2.0*WIGNER_244_220)*c40*c2n2 + (2.0*SQRT2_INV*WIGNER_244_112)*(c21*c4n1 + c2n1*c41) + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c4n4 - c2n2*c44) - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c4n3 - c2n1*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-2.0*WIGNER_244_033)*c20*c43  - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c42 - c2n1*c4n2) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c41 - c2n2*c4n1) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c44 + c2n1*c4n4);
    tMul2 = (-2.0*WIGNER_244_033)*c20*c4n3 - (2.0*SQRT2_INV*WIGNER_244_123)*(c21*c4n2 + c2n1*c42) - (2.0*SQRT2_INV*WIGNER_244_213)*(c22*c4n1 + c2n2*c41) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c4n4 - c2n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (2.0*WIGNER_244_044)*c20*c44  + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c42 - c2n2*c4n2) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c43 - c2n1*c4n3);
    tMul2 = (2.0*WIGNER_244_044)*c20*c4n4 + (2.0*SQRT2_INV*WIGNER_244_224)*(c22*c4n2 + c2n2*c42) + (2.0*SQRT2_INV*WIGNER_244_134)*(c21*c4n3 + c2n1*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx4+4] + tMul2*aCnlmPx[tIdx4-4];
    rFp3Py += tMul1*aCnlmPy[tIdx4+4] + tMul2*aCnlmPy[tIdx4-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+4] + tMul2*aCnlmPz[tIdx4-4];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3_134_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                              double *rFpPx, double *rFpPy, double *rFpPz,
                              double aWt, jint aIdxFP) {
    const jint tIdx1 = 1+1;
    const jint tIdx3 = 3*3+3;
    const jint tIdx4 = 4*4+4;
    const double c10  = aCnlm[tIdx1  ];
    const double c11  = aCnlm[tIdx1+1];
    const double c1n1 = aCnlm[tIdx1-1];
    const double c30  = aCnlm[tIdx3  ];
    const double c31  = aCnlm[tIdx3+1];
    const double c3n1 = aCnlm[tIdx3-1];
    const double c32  = aCnlm[tIdx3+2];
    const double c3n2 = aCnlm[tIdx3-2];
    const double c33  = aCnlm[tIdx3+3];
    const double c3n3 = aCnlm[tIdx3-3];
    const double c40  = aCnlm[tIdx4  ];
    const double c41  = aCnlm[tIdx4+1];
    const double c4n1 = aCnlm[tIdx4-1];
    const double c42  = aCnlm[tIdx4+2];
    const double c4n2 = aCnlm[tIdx4-2];
    const double c43  = aCnlm[tIdx4+3];
    const double c4n3 = aCnlm[tIdx4-3];
    const double c44  = aCnlm[tIdx4+4];
    const double c4n4 = aCnlm[tIdx4-4];
    double rFp3Px = 0.0, rFp3Py = 0.0, rFp3Pz = 0.0;
    
    double tMul = WIGNER_134_000*c30*c40 - WIGNER_134_011*(c31*c41 + c3n1*c4n1) + WIGNER_134_022*(c32*c42 + c3n2*c4n2) - WIGNER_134_033*(c33*c43 + c3n3*c4n3);
    rFp3Px += tMul*aCnlmPx[tIdx1];
    rFp3Py += tMul*aCnlmPy[tIdx1];
    rFp3Pz += tMul*aCnlmPz[tIdx1];
    tMul = WIGNER_134_000*c10*c30 - WIGNER_134_110*(c11*c31 + c1n1*c3n1);
    rFp3Px += tMul*aCnlmPx[tIdx4];
    rFp3Py += tMul*aCnlmPy[tIdx4];
    rFp3Pz += tMul*aCnlmPz[tIdx4];
    tMul = WIGNER_134_000*c10*c40 - WIGNER_134_101*(c11*c41 + c1n1*c4n1);
    rFp3Px += tMul*aCnlmPx[tIdx3];
    rFp3Py += tMul*aCnlmPy[tIdx3];
    rFp3Pz += tMul*aCnlmPz[tIdx3];
    
    double tMul1 = (-WIGNER_134_110)*c40*c31  - WIGNER_134_101*c30*c41  + (SQRT2_INV*WIGNER_134_112)*(c31*c42 + c3n1*c4n2) + (SQRT2_INV*WIGNER_134_121)*(c32*c41 + c3n2*c4n1) - (SQRT2_INV*WIGNER_134_123)*(c32*c43 + c3n2*c4n3) - (SQRT2_INV*WIGNER_134_132)*(c33*c42 + c3n3*c4n2) + (SQRT2_INV*WIGNER_134_134)*(c33*c44 + c3n3*c4n4);
    double tMul2 = (-WIGNER_134_110)*c40*c3n1 - WIGNER_134_101*c30*c4n1 + (SQRT2_INV*WIGNER_134_112)*(c31*c4n2 - c3n1*c42) + (SQRT2_INV*WIGNER_134_121)*(c3n2*c41 - c32*c4n1) - (SQRT2_INV*WIGNER_134_123)*(c32*c4n3 - c3n2*c43) - (SQRT2_INV*WIGNER_134_132)*(c3n3*c42 - c33*c4n2) + (SQRT2_INV*WIGNER_134_134)*(c33*c4n4 - c3n3*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx1+1] + tMul2*aCnlmPx[tIdx1-1];
    rFp3Py += tMul1*aCnlmPy[tIdx1+1] + tMul2*aCnlmPy[tIdx1-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx1+1] + tMul2*aCnlmPz[tIdx1-1];
    
    tMul1 = (-WIGNER_134_011)*c10*c41  - WIGNER_134_110*c40*c11  + (SQRT2_INV*WIGNER_134_112)*(c11*c42 + c1n1*c4n2);
    tMul2 = (-WIGNER_134_011)*c10*c4n1 - WIGNER_134_110*c40*c1n1 + (SQRT2_INV*WIGNER_134_112)*(c11*c4n2 - c1n1*c42);
    rFp3Px += tMul1*aCnlmPx[tIdx3+1] + tMul2*aCnlmPx[tIdx3-1];
    rFp3Py += tMul1*aCnlmPy[tIdx3+1] + tMul2*aCnlmPy[tIdx3-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+1] + tMul2*aCnlmPz[tIdx3-1];
    tMul1 = WIGNER_134_022*c10*c42  + (SQRT2_INV*WIGNER_134_121)*(c11*c41 - c1n1*c4n1) - (SQRT2_INV*WIGNER_134_123)*(c11*c43 + c1n1*c4n3);
    tMul2 = WIGNER_134_022*c10*c4n2 + (SQRT2_INV*WIGNER_134_121)*(c11*c4n1 + c1n1*c41) - (SQRT2_INV*WIGNER_134_123)*(c11*c4n3 - c1n1*c43);
    rFp3Px += tMul1*aCnlmPx[tIdx3+2] + tMul2*aCnlmPx[tIdx3-2];
    rFp3Py += tMul1*aCnlmPy[tIdx3+2] + tMul2*aCnlmPy[tIdx3-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+2] + tMul2*aCnlmPz[tIdx3-2];
    tMul1 = (-WIGNER_134_033)*c10*c43  - (SQRT2_INV*WIGNER_134_132)*(c11*c42 - c1n1*c4n2) + (SQRT2_INV*WIGNER_134_134)*(c11*c44 + c1n1*c4n4);
    tMul2 = (-WIGNER_134_033)*c10*c4n3 - (SQRT2_INV*WIGNER_134_132)*(c11*c4n2 + c1n1*c42) + (SQRT2_INV*WIGNER_134_134)*(c11*c4n4 - c1n1*c44);
    rFp3Px += tMul1*aCnlmPx[tIdx3+3] + tMul2*aCnlmPx[tIdx3-3];
    rFp3Py += tMul1*aCnlmPy[tIdx3+3] + tMul2*aCnlmPy[tIdx3-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx3+3] + tMul2*aCnlmPz[tIdx3-3];
    
    tMul1 = (-WIGNER_134_011)*c10*c31  - WIGNER_134_101*c30*c11  + (SQRT2_INV*WIGNER_134_121)*(c11*c32 + c1n1*c3n2);
    tMul2 = (-WIGNER_134_011)*c10*c3n1 - WIGNER_134_101*c30*c1n1 + (SQRT2_INV*WIGNER_134_121)*(c11*c3n2 - c1n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx4+1] + tMul2*aCnlmPx[tIdx4-1];
    rFp3Py += tMul1*aCnlmPy[tIdx4+1] + tMul2*aCnlmPy[tIdx4-1];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+1] + tMul2*aCnlmPz[tIdx4-1];
    tMul1 = WIGNER_134_022*c10*c32  + (SQRT2_INV*WIGNER_134_112)*(c11*c31 - c1n1*c3n1) - (SQRT2_INV*WIGNER_134_132)*(c11*c33 + c1n1*c3n3);
    tMul2 = WIGNER_134_022*c10*c3n2 + (SQRT2_INV*WIGNER_134_112)*(c11*c3n1 + c1n1*c31) - (SQRT2_INV*WIGNER_134_132)*(c11*c3n3 - c1n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx4+2] + tMul2*aCnlmPx[tIdx4-2];
    rFp3Py += tMul1*aCnlmPy[tIdx4+2] + tMul2*aCnlmPy[tIdx4-2];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+2] + tMul2*aCnlmPz[tIdx4-2];
    tMul1 = (-WIGNER_134_033)*c10*c33  - (SQRT2_INV*WIGNER_134_123)*(c11*c32 - c1n1*c3n2);
    tMul2 = (-WIGNER_134_033)*c10*c3n3 - (SQRT2_INV*WIGNER_134_123)*(c11*c3n2 + c1n1*c32);
    rFp3Px += tMul1*aCnlmPx[tIdx4+3] + tMul2*aCnlmPx[tIdx4-3];
    rFp3Py += tMul1*aCnlmPy[tIdx4+3] + tMul2*aCnlmPy[tIdx4-3];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+3] + tMul2*aCnlmPz[tIdx4-3];
    tMul1 = (SQRT2_INV*WIGNER_134_134)*(c11*c33 - c1n1*c3n3);
    tMul2 = (SQRT2_INV*WIGNER_134_134)*(c11*c3n3 + c1n1*c33);
    rFp3Px += tMul1*aCnlmPx[tIdx4+4] + tMul2*aCnlmPx[tIdx4-4];
    rFp3Py += tMul1*aCnlmPy[tIdx4+4] + tMul2*aCnlmPy[tIdx4-4];
    rFp3Pz += tMul1*aCnlmPz[tIdx4+4] + tMul2*aCnlmPz[tIdx4-4];
    
    rFpPx[aIdxFP] += aWt*rFp3Px;
    rFpPy[aIdxFP] += aWt*rFp3Py;
    rFpPz[aIdxFP] += aWt*rFp3Pz;
}
static inline void calL3p_(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                           double *rFpPx, double *rFpPy, double *rFpPz,
                           double aWt, jint aLMax, jboolean aNoRadial, jint aL3Max, jboolean aL3Cross) {
    if (aL3Max <= 1) return;
    jint tIdxFP = aNoRadial ? aLMax : (aLMax+1);
    calL3_222_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
    ++tIdxFP;
    if (aL3Cross) {
        calL3_112_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
        ++tIdxFP;
    }
    if (aL3Max == 2) return;
    if (aL3Cross) {
        calL3_233_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
        ++tIdxFP;
        calL3_123_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
        ++tIdxFP;
    }
    if (aL3Max == 3) return;
    calL3_444_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
    ++tIdxFP;
    if (aL3Cross) {
        calL3_224_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
        ++tIdxFP;
        calL3_334_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
        ++tIdxFP;
        calL3_244_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
        ++tIdxFP;
        calL3_134_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz, rFpPx, rFpPy, rFpPz, aWt, tIdxFP);
        ++tIdxFP;
    }
}
static inline void cnlm2fpPxyz(double *aCnlm, double *aCnlmPx, double *aCnlmPy, double *aCnlmPz,
                               double *rFpPx, double *rFpPy, double *rFpPz,
                               double aWt, jint aLMax, jboolean aNoRadial, jint aL3Max, jboolean aL3Cross) {
    calL2p_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz,
            rFpPx, rFpPy, rFpPz,
            aWt, aLMax, aNoRadial);
    calL3p_(aCnlm, aCnlmPx, aCnlmPy, aCnlmPz,
            rFpPx, rFpPy, rFpPz,
            aWt, aLMax, aNoRadial, aL3Max, aL3Cross);
}


static inline void calCnlm(double *aNlDx, double *aNlDy, double *aNlDz, jint *aNlType, jint aNN,
                           double *rNlRn, double *rNlY, double *rCnlm, jboolean aBufferNl,
                           jint aTypeNum, double aRCut, jint aNMax, jint aLMaxMax, jint aLMAll, jint aWType) {
    // loop for neighbor
    for (jint j = 0; j < aNN; ++j) {
        jint type = aNlType[j];
        double dx = aNlDx[j], dy = aNlDy[j], dz = aNlDz[j];
        double dis = sqrt(dx*dx + dy*dy + dz*dz);
        // check rcut for merge
        if (dis >= aRCut) continue;
        // cal fc
        double fc = pow4_jse(1.0 - pow2_jse(dis/aRCut));
        // cal Rn
        double tRnX = 1.0 - 2.0*dis/aRCut;
        double *tRn = aBufferNl ? (rNlRn + j*(aNMax+1)) : rNlRn;
        chebyshevFull(aNMax, tRnX, tRn);
        switch(aWType) {
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_SINGLE: {
            // cal weight of type here
            double wt = ((type&1)==1) ? type : -type;
            for (jint n = 0; n <= aNMax; ++n) {
                tRn[n] *= wt;
            }
            break;
        }
        default: {
            break;
        }}
        // cal Y
        double *tY = aBufferNl ? (rNlY + j*aLMAll) : rNlY;
        realSphericalHarmonicsFull4(aLMaxMax, dx, dy, dz, dis, tY);
        // cal cnlm
        switch(aWType) {
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_EXFULL: {
            jint tShift = 0;
            if (aTypeNum == 1) {
                for (jint tN = 0; tN <= aNMax; ++tN, tShift+=aLMAll) {
                    mplusCnlm(rCnlm+tShift, tY, fc, tRn[tN], aLMAll);
                }
            } else {
                jint tShiftWt = (aNMax+1)*aLMAll*type;
                for (jint tN = 0; tN <= aNMax; ++tN, tShift+=aLMAll, tShiftWt+=aLMAll) {
                    mplusCnlmWt(rCnlm+tShift, rCnlm+tShiftWt, tY, fc, tRn[tN], 1.0, aLMAll);
                }
            }
            break;
        }
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_FULL: {
            jint tShift = (aNMax+1)*aLMAll*(type-1);
            for (jint tN = 0; tN <= aNMax; ++tN, tShift+=aLMAll) {
                mplusCnlm(rCnlm+tShift, tY, fc, tRn[tN], aLMAll);
            }
            break;
        }
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_NONE:
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_SINGLE: {
            jint tShift = 0;
            for (jint tN = 0; tN <= aNMax; ++tN, tShift+=aLMAll) {
                mplusCnlm(rCnlm+tShift, tY, fc, tRn[tN], aLMAll);
            }
            break;
        }
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_DEFAULT: {
            jint tShift = 0;
            if (aTypeNum == 1) {
                for (jint tN = 0; tN <= aNMax; ++tN, tShift+=aLMAll) {
                    mplusCnlm(rCnlm+tShift, tY, fc, tRn[tN], aLMAll);
                }
            } else {
                // cal weight of type here
                double wt = ((type&1)==1) ? type : -type;
                jint tShiftWt = (aNMax+1)*aLMAll;
                for (jint tN = 0; tN <= aNMax; ++tN, tShift+=aLMAll, tShiftWt+=aLMAll) {
                    mplusCnlmWt(rCnlm+tShift, rCnlm+tShiftWt, tY, fc, tRn[tN], wt, aLMAll);
                }
            }
            break;
        }
        default: {
            break;
        }}
    }
}

static inline void cnlm2fp(double *aCnlm, double *rFp, jint aSizeN, jint aSizeL, jint aLMax, jboolean aNoRadial, jint aL3Max, jboolean aL3Cross, jint tLMAll) {
    jint tShift = 0, tShiftFP = 0;
    for (jint tN = 0; tN < aSizeN; ++tN, tShift+=tLMAll, tShiftFP+=aSizeL) {
        calL2_(aCnlm+tShift, rFp+tShiftFP, aLMax, aNoRadial);
        calL3_(aCnlm+tShift, rFp+tShiftFP, aLMax, aNoRadial, aL3Max, aL3Cross);
    }
}


JNIEXPORT void JNICALL Java_jsex_nnap_basis_SphericalChebyshev_eval1(JNIEnv *aEnv, jclass aClazz,
        jdoubleArray aNlDx, jdoubleArray aNlDy, jdoubleArray aNlDz, jintArray aNlType, jint aNN,
        jdoubleArray rRn, jdoubleArray rY, jdoubleArray rCnlm, jdoubleArray rFp, jint aShiftFp,
        jint aTypeNum, jdouble aRCut, jint aNMax, jint aLMax, jboolean aNoRadial, jint aL3Max, jboolean aL3Cross, jint aWType) {
    // java array init
#ifdef __cplusplus
    double *tNlDx = (double *)aEnv->GetPrimitiveArrayCritical(aNlDx, NULL);
    double *tNlDy = (double *)aEnv->GetPrimitiveArrayCritical(aNlDy, NULL);
    double *tNlDz = (double *)aEnv->GetPrimitiveArrayCritical(aNlDz, NULL);
    jint *tNlType = (jint *)aEnv->GetPrimitiveArrayCritical(aNlType, NULL);
    double *tRn = (double *)aEnv->GetPrimitiveArrayCritical(rRn, NULL);
    double *tY = (double *)aEnv->GetPrimitiveArrayCritical(rY, NULL);
    double *tCnlm = (double *)aEnv->GetPrimitiveArrayCritical(rCnlm, NULL);
    double *tFp = (double *)aEnv->GetPrimitiveArrayCritical(rFp, NULL);
#else
    double *tNlDx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDx, NULL);
    double *tNlDy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDy, NULL);
    double *tNlDz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDz, NULL);
    jint *tNlType = (jint *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlType, NULL);
    double *tRn = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rRn, NULL);
    double *tY = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rY, NULL);
    double *tCnlm = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlm, NULL);
    double *tFp = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFp, NULL);
#endif
    
    // const init
    jint tSizeN;
    switch(aWType) {
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_EXFULL: {
        tSizeN = aTypeNum>1 ? (aTypeNum+1)*(aNMax+1) : (aNMax+1);
        break;
    }
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_FULL: {
        tSizeN = aTypeNum*(aNMax+1);
        break;
    }
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_NONE:
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_SINGLE: {
        tSizeN = aNMax+1;
        break;
    }
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_DEFAULT: {
        tSizeN = aTypeNum>1 ? (aNMax+aNMax+2) : (aNMax+1);
        break;
    }
    default: {
        tSizeN = 0;
        break;
    }}
    const jint tSizeL = (aNoRadial?aLMax:(aLMax+1)) + (aL3Cross?L3NCOLS:L3NCOLS_NOCROSS)[aL3Max];
    const jint tLMax = aLMax>aL3Max ? aLMax : aL3Max;
    const jint tLMAll = (tLMax+1)*(tLMax+1);
    const jint tSizeCnlm = tSizeN*tLMAll;
    // clear cnlm first
    double *tFp_ = tFp + aShiftFp;
    for (jint i = 0; i < tSizeCnlm; ++i) {
        tCnlm[i] = 0.0;
    }
    // do cal
    calCnlm(tNlDx, tNlDy, tNlDz, tNlType, aNN,
            tRn, tY, tCnlm, JNI_FALSE,
            aTypeNum, aRCut, aNMax, tLMax, tLMAll, aWType);
    cnlm2fp(tCnlm, tFp_, tSizeN, tSizeL, aLMax, aNoRadial, aL3Max, aL3Cross, tLMAll);
    
    // release java array
#ifdef __cplusplus
    aEnv->ReleasePrimitiveArrayCritical(aNlDx, tNlDx, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlDy, tNlDy, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlDz, tNlDz, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlType, tNlType, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(rRn, tRn, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rY, tY, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCnlm, tCnlm, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rFp, tFp, 0);
#else
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDx, tNlDx, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDy, tNlDy, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDz, tNlDz, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlType, tNlType, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rRn, rRn, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rY, rY, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlm, tCnlm, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFp, tFp, 0);
#endif
}

JNIEXPORT void JNICALL Java_jsex_nnap_basis_SphericalChebyshev_evalPartial1(JNIEnv *aEnv, jclass aClazz,
        jdoubleArray aNlDx, jdoubleArray aNlDy, jdoubleArray aNlDz, jintArray aNlType, jint aNN,
        jdoubleArray rNlRn, jdoubleArray rRnPx, jdoubleArray rRnPy, jdoubleArray rRnPz, jdoubleArray rCheby2,
        jdoubleArray rNlY, jdoubleArray rYPtheta, jdoubleArray rYPphi, jdoubleArray rYPx, jdoubleArray rYPy, jdoubleArray rYPz,
        jdoubleArray rCnlm, jdoubleArray rCnlmPx, jdoubleArray rCnlmPy, jdoubleArray rCnlmPz,
        jdoubleArray rFp, jint aSizeFp, jint aShiftFp, jdoubleArray rFpPx, jdoubleArray rFpPy, jdoubleArray rFpPz,
        jint aTypeNum, jdouble aRCut, jint aNMax, jint aLMax, jboolean aNoRadial, jint aL3Max, jboolean aL3Cross, jint aWType) {
    // java array init
#ifdef __cplusplus
    double *tNlDx = (double *)aEnv->GetPrimitiveArrayCritical(aNlDx, NULL);
    double *tNlDy = (double *)aEnv->GetPrimitiveArrayCritical(aNlDy, NULL);
    double *tNlDz = (double *)aEnv->GetPrimitiveArrayCritical(aNlDz, NULL);
    jint *tNlType = (jint *)aEnv->GetPrimitiveArrayCritical(aNlType, NULL);
    double *tNlRn = (double *)aEnv->GetPrimitiveArrayCritical(rNlRn, NULL);
    double *tRnPx = (double *)aEnv->GetPrimitiveArrayCritical(rRnPx, NULL);
    double *tRnPy = (double *)aEnv->GetPrimitiveArrayCritical(rRnPy, NULL);
    double *tRnPz = (double *)aEnv->GetPrimitiveArrayCritical(rRnPz, NULL);
    double *tCheby2 = (double *)aEnv->GetPrimitiveArrayCritical(rCheby2, NULL);
    double *tNlY = (double *)aEnv->GetPrimitiveArrayCritical(rNlY, NULL);
    double *tYPtheta = (double *)aEnv->GetPrimitiveArrayCritical(rYPtheta, NULL);
    double *tYPphi = (double *)aEnv->GetPrimitiveArrayCritical(rYPphi, NULL);
    double *tYPx = (double *)aEnv->GetPrimitiveArrayCritical(rYPx, NULL);
    double *tYPy = (double *)aEnv->GetPrimitiveArrayCritical(rYPy, NULL);
    double *tYPz = (double *)aEnv->GetPrimitiveArrayCritical(rYPz, NULL);
    double *tCnlm = (double *)aEnv->GetPrimitiveArrayCritical(rCnlm, NULL);
    double *tCnlmPx = (double *)aEnv->GetPrimitiveArrayCritical(rCnlmPx, NULL);
    double *tCnlmPy = (double *)aEnv->GetPrimitiveArrayCritical(rCnlmPy, NULL);
    double *tCnlmPz = (double *)aEnv->GetPrimitiveArrayCritical(rCnlmPz, NULL);
    double *tFp = (double *)aEnv->GetPrimitiveArrayCritical(rFp, NULL);
    double *tFpPx = (double *)aEnv->GetPrimitiveArrayCritical(rFpPx, NULL);
    double *tFpPy = (double *)aEnv->GetPrimitiveArrayCritical(rFpPy, NULL);
    double *tFpPz = (double *)aEnv->GetPrimitiveArrayCritical(rFpPz, NULL);
#else
    double *tNlDx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDx, NULL);
    double *tNlDy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDy, NULL);
    double *tNlDz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlDz, NULL);
    jint *tNlType = (jint *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, aNlType, NULL);
    double *tNlRn = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rNlRn, NULL);
    double *tRnPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rRnPx, NULL);
    double *tRnPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rRnPy, NULL);
    double *tRnPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rRnPz, NULL);
    double *tCheby2 = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCheby2, NULL);
    double *tNlY = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rNlY, NULL);
    double *tYPtheta = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPtheta, NULL);
    double *tYPphi = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPphi, NULL);
    double *tYPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPx, NULL);
    double *tYPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPy, NULL);
    double *tYPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rYPz, NULL);
    double *tCnlm = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlm, NULL);
    double *tCnlmPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlmPx, NULL);
    double *tCnlmPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlmPy, NULL);
    double *tCnlmPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rCnlmPz, NULL);
    double *tFp = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFp, NULL);
    double *tFpPx = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFpPx, NULL);
    double *tFpPy = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFpPy, NULL);
    double *tFpPz = (double *)(*aEnv)->GetPrimitiveArrayCritical(aEnv, rFpPz, NULL);
#endif

    // const init
    jint tSizeN;
    switch(aWType) {
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_EXFULL: {
        tSizeN = aTypeNum>1 ? (aTypeNum+1)*(aNMax+1) : (aNMax+1);
        break;
    }
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_FULL: {
        tSizeN = aTypeNum*(aNMax+1);
        break;
    }
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_NONE:
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_SINGLE: {
        tSizeN = aNMax+1;
        break;
    }
    case jsex_nnap_basis_SphericalChebyshev_WTYPE_DEFAULT: {
        tSizeN = aTypeNum>1 ? (aNMax+aNMax+2) : (aNMax+1);
        break;
    }
    default: {
        tSizeN = 0;
        break;
    }}
    const jint tSizeL = (aNoRadial?aLMax:(aLMax+1)) + (aL3Cross?L3NCOLS:L3NCOLS_NOCROSS)[aL3Max];
    const jint tLMax = aLMax>aL3Max ? aLMax : aL3Max;
    const jint tLMAll = (tLMax+1)*(tLMax+1);
    const jint tSizeCnlm = tSizeN*tLMAll;
    const jint tSize = tSizeN*tSizeL;
    // clear cnlm first
    double *tFp_ = tFp + aShiftFp;
    for (jint i = 0; i < tSizeCnlm; ++i) {
        tCnlm[i] = 0.0;
    }
    // cal cnlm and fp first
    calCnlm(tNlDx, tNlDy, tNlDz, tNlType, aNN,
            tNlRn, tNlY, tCnlm, JNI_TRUE,
            aTypeNum, aRCut, aNMax, tLMax, tLMAll, aWType);
    cnlm2fp(tCnlm, tFp_, tSizeN, tSizeL, aLMax, aNoRadial, aL3Max, aL3Cross, tLMAll);
    
    // loop for neighbor
    for (jint j = 0; j < aNN; ++j) {
        // clear fpPxyz here
        jint tShiftFpP = j*(aSizeFp+aShiftFp) + aShiftFp;
        double *tFpPx_ = tFpPx+tShiftFpP;
        double *tFpPy_ = tFpPy+tShiftFpP;
        double *tFpPz_ = tFpPz+tShiftFpP;
        for (jint i = 0; i < tSize; ++i) {
            tFpPx_[i] = 0.0;
            tFpPy_[i] = 0.0;
            tFpPz_[i] = 0.0;
        }
        // init nl
        jint type = tNlType[j];
        double dx = tNlDx[j], dy = tNlDy[j], dz = tNlDz[j];
        double dis = sqrt(dx*dx + dy*dy + dz*dz);
        // check rcut for merge
        if (dis >= aRCut) continue;
        // cal fc
        double fcMul = 1.0 - pow2_jse(dis/aRCut);
        double fcMul3 = pow3_jse(fcMul);
        double fc = fcMul3 * fcMul;
        double fcPMul = 8.0 * fcMul3 / (aRCut*aRCut);
        double fcPx = dx * fcPMul;
        double fcPy = dy * fcPMul;
        double fcPz = dz * fcPMul;
        // cal Rn
        double *tRn = tNlRn + j*(aNMax+1);
        const double tRnX = 1.0 - 2.0*dis/aRCut;
        chebyshev2Full(aNMax-1, tRnX, tCheby2);
        switch(aWType) {
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_SINGLE: {
            // cal weight of type here
            double wt = ((type&1)==1) ? type : -type;
            calRnPxyz(tRnPx, tRnPy, tRnPz, tCheby2, aNMax, dis, aRCut, wt, dx, dy, dz);
            break;
        }
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_EXFULL:
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_FULL:
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_NONE:
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_DEFAULT: {
            calRnPxyz(tRnPx, tRnPy, tRnPz, tCheby2, aNMax, dis, aRCut, 1.0, dx, dy, dz);
            break;
        }
        default: {
            break;
        }}
        // cal Ylm
        double dxy = hypot(dx, dy);
        double cosTheta = dz / dis;
        double sinTheta = dxy / dis;
        double cosPhi;
        double sinPhi;
        jboolean dxyCloseZero = numericEqual_jse(dxy, 0.0);
        if (dxyCloseZero) {
            cosPhi = 1.0;
            sinPhi = 0.0;
        } else {
            cosPhi = dx / dxy;
            sinPhi = dy / dxy;
        }
        double *tY = tNlY + j*tLMAll;
        if (dxyCloseZero) {
            // fix singularity
            for (jint k = 0; k < tLMAll; ++k) tYPphi[k] = 0.0;
        }
        for (jint tL = 0; tL <= tLMax; ++tL) {
            if (!dxyCloseZero) {
                calYPphi(tYPphi, tY, tL);
            }
            calYPtheta(cosPhi, sinPhi, tYPtheta, tY, tL);
        }
        // conert to Pxyz
        calYPxyz(cosTheta, sinTheta, cosPhi, sinPhi, dis, dxy, dxyCloseZero,
                 tYPx, tYPy, tYPz,
                 tYPtheta, tYPphi, tLMAll);
        // cal cnlmPxyz
        switch(aWType) {
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_EXFULL: {
            for (jint tN=0, tShift=0, tShiftFp=0; tN <= aNMax; ++tN, tShift+=tLMAll, tShiftFp+=tSizeL) {
                // cal cnlmPxyz first
                calCnlmPxyz(tCnlmPx, tCnlmPy, tCnlmPz,
                            tY, tYPx, tYPy, tYPz,
                            fc, fcPx, fcPy, fcPz,
                            tRn[tN], tRnPx[tN], tRnPy[tN], tRnPz[tN],
                            tLMAll);
                // accumulate to fp
                cnlm2fpPxyz(tCnlm+tShift, tCnlmPx, tCnlmPy, tCnlmPz,
                            tFpPx_+tShiftFp, tFpPy_+tShiftFp, tFpPz_+tShiftFp,
                            1.0, aLMax, aNoRadial, aL3Max, aL3Cross);
                if (aTypeNum > 1) {
                    jint tShift0 = tShift + (aNMax+1)*tLMAll*type;
                    jint tShiftFp0 = tShiftFp + (aNMax+1)*tSizeL*type;
                    cnlm2fpPxyz(tCnlm+tShift0, tCnlmPx, tCnlmPy, tCnlmPz,
                                tFpPx_+tShiftFp0, tFpPy_+tShiftFp0, tFpPz_+tShiftFp0,
                                1.0, aLMax, aNoRadial, aL3Max, aL3Cross);
                }
            }
            break;
        }
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_FULL: {
            jint tShift = (aNMax+1)*tLMAll*(type-1);
            jint tShiftFp = (aNMax+1)*tSizeL*(type-1);
            for (jint tN=0; tN <= aNMax; ++tN, tShift+=tLMAll, tShiftFp+=tSizeL) {
                // cal cnlmPxyz first
                calCnlmPxyz(tCnlmPx, tCnlmPy, tCnlmPz,
                            tY, tYPx, tYPy, tYPz,
                            fc, fcPx, fcPy, fcPz,
                            tRn[tN], tRnPx[tN], tRnPy[tN], tRnPz[tN],
                            tLMAll);
                // accumulate to fp
                cnlm2fpPxyz(tCnlm+tShift, tCnlmPx, tCnlmPy, tCnlmPz,
                            tFpPx_+tShiftFp, tFpPy_+tShiftFp, tFpPz_+tShiftFp,
                            1.0, aLMax, aNoRadial, aL3Max, aL3Cross);
            }
            break;
        }
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_NONE:
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_SINGLE: {
            for (jint tN=0, tShift=0, tShiftFp=0; tN <= aNMax; ++tN, tShift+=tLMAll, tShiftFp+=tSizeL) {
                // cal cnlmPxyz first
                calCnlmPxyz(tCnlmPx, tCnlmPy, tCnlmPz,
                            tY, tYPx, tYPy, tYPz,
                            fc, fcPx, fcPy, fcPz,
                            tRn[tN], tRnPx[tN], tRnPy[tN], tRnPz[tN],
                            tLMAll);
                // accumulate to fp
                cnlm2fpPxyz(tCnlm+tShift, tCnlmPx, tCnlmPy, tCnlmPz,
                            tFpPx_+tShiftFp, tFpPy_+tShiftFp, tFpPz_+tShiftFp,
                            1.0, aLMax, aNoRadial, aL3Max, aL3Cross);
            }
            break;
        }
        case jsex_nnap_basis_SphericalChebyshev_WTYPE_DEFAULT: {
            // cal weight of type here
            double wt = ((type&1)==1) ? type : -type;
            for (jint tN=0, tShift=0, tShiftFp=0; tN <= aNMax; ++tN, tShift+=tLMAll, tShiftFp+=tSizeL) {
                // cal cnlmPxyz first
                calCnlmPxyz(tCnlmPx, tCnlmPy, tCnlmPz,
                            tY, tYPx, tYPy, tYPz,
                            fc, fcPx, fcPy, fcPz,
                            tRn[tN], tRnPx[tN], tRnPy[tN], tRnPz[tN],
                            tLMAll);
                // accumulate to fp
                cnlm2fpPxyz(tCnlm+tShift, tCnlmPx, tCnlmPy, tCnlmPz,
                            tFpPx_+tShiftFp, tFpPy_+tShiftFp, tFpPz_+tShiftFp,
                            1.0, aLMax, aNoRadial, aL3Max, aL3Cross);
                if (aTypeNum > 1) {
                    jint tShift0 = tShift + (aNMax+1)*tLMAll;
                    jint tShiftFp0 = tShiftFp + (aNMax+1)*tSizeL;
                    cnlm2fpPxyz(tCnlm+tShift0, tCnlmPx, tCnlmPy, tCnlmPz,
                                tFpPx_+tShiftFp0, tFpPy_+tShiftFp0, tFpPz_+tShiftFp0,
                                wt, aLMax, aNoRadial, aL3Max, aL3Cross);
                }
            }
            break;
        }
        default: {
            break;
        }}
    }
    // release java array
#ifdef __cplusplus
    aEnv->ReleasePrimitiveArrayCritical(aNlDx, tNlDx, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlDy, tNlDy, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlDz, tNlDz, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(aNlType, tNlType, JNI_ABORT);
    aEnv->ReleasePrimitiveArrayCritical(rNlRn, tNlRn, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rRnPx, tRnPx, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rRnPy, tRnPy, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rRnPz, tRnPz, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCheby2, tCheby2, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rNlY, tNlY, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPtheta, tYPtheta, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPphi, tYPphi, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPx, tYPx, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPy, tYPy, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rYPz, tYPz, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCnlm, tCnlm, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCnlmPx, tCnlmPx, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCnlmPy, tCnlmPy, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rCnlmPz, tCnlmPz, JNI_ABORT); // buffer only
    aEnv->ReleasePrimitiveArrayCritical(rFp, tFp, 0);
    aEnv->ReleasePrimitiveArrayCritical(rFpPx, tFpPx, 0);
    aEnv->ReleasePrimitiveArrayCritical(rFpPy, tFpPy, 0);
    aEnv->ReleasePrimitiveArrayCritical(rFpPz, tFpPz, 0);
#else
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDx, tNlDx, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDy, tNlDy, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlDz, tNlDz, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, aNlType, tNlType, JNI_ABORT);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rNlRn, tNlRn, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rRnPx, tRnPx, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rRnPy, tRnPy, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rRnPz, tRnPz, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCheby2, tCheby2, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rNlY, tNlY, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPtheta, tYPtheta, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPphi, tYPphi, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPx, tYPx, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPy, tYPy, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rYPz, tYPz, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlm, tCnlm, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlmPx, tCnlmPx, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlmPy, tCnlmPy, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rCnlmPz, tCnlmPz, JNI_ABORT); // buffer only
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFp, tFp, 0);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFpPx, tFpPx, 0);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFpPy, tFpPy, 0);
    (*aEnv)->ReleasePrimitiveArrayCritical(aEnv, rFpPz, tFpPz, 0);
#endif
}

#ifdef __cplusplus
}
#endif
